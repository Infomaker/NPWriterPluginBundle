(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)})([function(module,exports,__webpack_require__){"use strict";var _index=__webpack_require__(1);var _index2=_interopRequireDefault(_index);var _index3=__webpack_require__(9);var _index4=_interopRequireDefault(_index3);var _index5=__webpack_require__(23);var _index6=_interopRequireDefault(_index5);var _index7=__webpack_require__(34);var _index8=_interopRequireDefault(_index7);var _index9=__webpack_require__(56);var _index10=_interopRequireDefault(_index9);var _index11=__webpack_require__(67);var _index12=_interopRequireDefault(_index11);var _HeaderEditorPackage=__webpack_require__(75);var _HeaderEditorPackage2=_interopRequireDefault(_HeaderEditorPackage);var _index13=__webpack_require__(81);var _index14=_interopRequireDefault(_index13);var _HeadlinePackage=__webpack_require__(96);var _HeadlinePackage2=_interopRequireDefault(_HeadlinePackage);var _Preamble=__webpack_require__(102);var _Preamble2=_interopRequireDefault(_Preamble);var _SubheadlinePackage=__webpack_require__(109);var _SubheadlinePackage2=_interopRequireDefault(_SubheadlinePackage);var _ParagraphPackage=__webpack_require__(115);var _ParagraphPackage2=_interopRequireDefault(_ParagraphPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(()=>{(0,_index2.default)();(0,_HeadlinePackage2.default)();(0,_Preamble2.default)();(0,_SubheadlinePackage2.default)();(0,_ParagraphPackage2.default)();(0,_index8.default)();(0,_index4.default)();(0,_index6.default)();(0,_HeaderEditorPackage2.default)();(0,_index10.default)();(0,_index12.default)();(0,_index14.default)()})()},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowPackage=__webpack_require__(2);var _PublishFlowPackage2=_interopRequireDefault(_PublishFlowPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PublishFlowPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowComponent=__webpack_require__(3);var _PublishFlowComponent2=_interopRequireDefault(_PublishFlowComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"publishflow",id:"se.infomaker.publishflow",index:100,configure:function configure(config){config.addPopover(this.id+"_1",{icon:"fa-ellipsis-h",button:"Save",align:"right"},_PublishFlowComponent2.default);config.addLabel("Save",{sv:"Spara"});config.addLabel("Save *",{sv:"Spara *"});config.addLabel("Cancel",{sv:"Avbryt"});config.addLabel("Publish article?",{sv:"Publicera artikeln?"});config.addLabel("This article is currently an unpublished draft",{sv:"Den här artikeln är ett ej publicerat utkast"});config.addLabel("Article is currently pending approval",{sv:"Artikeln väntar på godkännande"});config.addLabel("Scheduled",{sv:"Schemalagd"});config.addLabel("Article is scheduled to be published",{sv:"Artiklen är schemalagd för publicering"});config.addLabel("From",{sv:"Från"});config.addLabel("To",{sv:"Till"});config.addLabel("Republish article?",{sv:"Ompublicera artikeln?"});config.addLabel("Article was published",{sv:"Artikeln publicerades"});config.addLabel("Publish article again?",{sv:"Publicera artikeln igen?"});config.addLabel("Article has been canceled and is no longer published",{sv:"Artikeln har blivit avpublicerad och är ej längre publicerad"});config.addLabel("Unknown state",{sv:"Okänd status"});config.addLabel("This article has an unknown, unsupported, status",{sv:"Artikeln har en okänd eller felaktig status"});config.addLabel("Save as draft",{sv:"Spara som utkast"});config.addLabel("Ready for approval",{sv:"Klar för godkännande"});config.addLabel("Schedule for publish",{sv:"Schemalägg publicering"});config.addLabel("Republish article",{sv:"Ompublicera artikeln"});config.addLabel("Publish article",{sv:"Publicera artikeln"});config.addLabel("Unpublish article",{sv:"Avpublicera artikeln"});config.addLabel("imext:draft",{en:"Draft",sv:"Utkast"});config.addLabel("imext:done",{en:"Ready for approval",sv:"Klar för godkännande"});config.addLabel("stat:withheld",{en:"Scheduled for publication",sv:"Schemalagd för publicering"});config.addLabel("stat:usable",{en:"Published",sv:"Publicerad"});config.addLabel("stat:canceled",{en:"Unpublished",sv:"Avpublicerad"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowManager=__webpack_require__(4);var _PublishFlowManager2=_interopRequireDefault(_PublishFlowManager);__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{Component}=substance;const{api,moment,event}=writer;const pluginId="se.infomaker.publishflow";class PublishFlowComponent extends Component{constructor(...args){super(...args);api.events.on(pluginId,event.DOCUMENT_CHANGED,()=>{this.props.popover.setButtonText(this.getLabel("Save *"))});api.events.on(pluginId,event.DOCUMENT_SAVED,()=>{this._onDocumentSaved()});api.events.on(pluginId,event.DOCUMENT_SAVE_FAILED,()=>{this._onDocumentSaveFailed()});api.events.on(pluginId,event.USERACTION_CANCEL_SAVE,()=>{this._onDocumentSaveFailed()});api.events.on(pluginId,event.USERACTION_SAVE,()=>{this.defaultAction()})}dispose(){api.events.off(pluginId,"document:changed");api.events.off(pluginId,"document:saved")}getInitialState(){let status=api.newsItem.getPubStatus();this.publishFlowMgr=new _PublishFlowManager2.default(pluginId);return{status:status,pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop(),allowed:this.publishFlowMgr.getAllowedActions(status.qcode)}}didMount(){this.props.popover.setButtonText(this.getLabel("Save"));this._updateStatus();if(!api.browser.isSupported()){this.props.popover.disable()}}render($$){var el=$$("div").addClass("sc-np-publishflow").append(this.renderBody($$));return el}renderBody($$){let el=$$("div").addClass("sc-np-publish-body"),actions=this.renderAllowedActions($$);switch(this.state.status.qcode){case"imext:draft":el.append([$$("h2").append(this.getLabel("Publish article?")),$$("p").append(this.getLabel("This article is currently an unpublished draft"))]);break;case"imext:done":el.append([$$("h2").append(this.getLabel("Publish article?")),$$("p").append(this.getLabel("Article is currently pending approval"))]);break;case"stat:withheld":el.append([$$("h2").append(this.getLabel("Scheduled")),$$("p").append(this.getLabel("Article is scheduled to be published")+" "+moment(this.state.pubStart.value).fromNow())]);var specEl=$$("p").addClass("dates").append([$$("span").append(this.getLabel("From")+": "),$$("strong").append(moment(this.state.pubStart.value).format("YYYY-MM-DD HH:mm"))]);if(this.state.pubStop){let toObj=moment(this.state.pubStop.value);if(toObj.isValid()){specEl.append([$$("br"),$$("span").append(this.getLabel("To")+": "),$$("strong").append(moment(this.state.pubStop.value).format("YYYY-MM-DD HH:mm"))])}}el.append(specEl);break;case"stat:usable":el.append([$$("h2").append(this.getLabel("Republish article?")),$$("p").append(this.getLabel("Article was published")+" "+moment(this.state.pubStart.value).fromNow())]);break;case"stat:canceled":el.append([$$("h2").append(this.getLabel("Publish article again?")),$$("p").append(this.getLabel("Article has been canceled and is no longer published"))]);break;default:el.append([$$("h2").append(this.getLabel("Unknown state")),$$("p").append(this.getLabel("This article has an unknown, unsupported, status"))]);break}el.append(actions);el.append($$("div").css({"text-align":"right"}).append($$("button").addClass("sc-np-btn btn-secondary").append(this.getLabel("Cancel")).on("click",()=>{this.props.popover.close()})));return el}renderAllowedActions($$){let actionsEl=$$("div").addClass("sc-np-publish-actions");this.publishFlowMgr.getAllowedActions(this.state.status.qcode).forEach(action=>{switch(action){case"imext:draft":actionsEl.append(this.renderActionDraft($$));break;case"imext:done":actionsEl.append(this.renderActionDone($$));break;case"stat:withheld":actionsEl.append(this.renderActionWithheld($$));break;case"stat:usable":actionsEl.append(this.renderActionUsable($$));break;case"stat:canceled":actionsEl.append(this.renderActionCanceled($$));break}});return actionsEl}renderActionDraft($$){return $$("a").append([$$("i").addClass("fa fa-pencil"),$$("span").append(this.getLabel("Save as draft"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToDraft()})})}renderActionDone($$){return $$("a").append([$$("i").addClass("fa fa-check-circle-o"),$$("span").append(this.getLabel("Ready for approval"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToDone()})})}renderActionWithheld($$){let el=$$("div").addClass("sc-np-publish-action-section").ref("pfc-withheld");el.append($$("a").append([$$("i").addClass("fa fa-clock-o"),$$("span").append(this.getLabel("Schedule for publish"))]).addClass("more").on("click",()=>{if(this.refs["pfc-withheld"].hasClass("active")){this.refs["pfc-withheld"].removeClass("active")}else{this.refs["pfc-withheld"].addClass("active")}}));let fromVal="",toVal="";if(this.state.pubStart){fromVal=moment(this.state.pubStart.value).format("YYYY-MM-DDTHH:mm")}if(this.state.pubStop){toVal=moment(this.state.pubStop.value).format("YYYY-MM-DDTHH:mm")}el.append($$("div").addClass("sc-np-publish-action-section-content sc-np-date-time").append([$$("label").attr("for","pfc-lbl-withheld-from").append(this.getLabel("From")),$$("input").attr({id:"pfc-lbl-withheld-from",type:"datetime-local",required:true}).addClass("form-control").ref("pfc-lbl-withheld-from").val(fromVal),$$("label").attr("for","pfc-lbl-withheld-to").append(this.getLabel("To")),$$("input").attr({id:"pfc-lbl-withheld-to",type:"datetime-local"}).addClass("form-control").ref("pfc-lbl-withheld-to").val(toVal),$$("div").addClass("sc-np-publish-action-section-content-actions").append($$("button").addClass("sc-np-btn btn-secondary").append(this.getLabel("Save"))).on("click",()=>{try{var fromVal=this.refs["pfc-lbl-withheld-from"].val(),toVal=this.refs["pfc-lbl-withheld-to"].val();this._save(()=>{this.publishFlowMgr.setToWithheld(fromVal,toVal)})}catch(ex){this.refs["pfc-lbl-withheld-from"].addClass("imc-flash");window.setTimeout(()=>{this.refs["pfc-lbl-withheld-from"].removeClass("imc-flash")},500);return false}})]));return el}renderActionUsable($$){let el=$$("a");if(this.state.status.qcode==="stat:usable"){el.append([$$("i").addClass("fa fa-retweet"),$$("span").append(this.getLabel("Republish article"))])}else{el.append([$$("i").addClass("fa fa-send"),$$("span").append(this.getLabel("Publish article"))])}el.on("click",()=>{this._save(()=>{this.publishFlowMgr.setToUsable()})});return el}renderActionCanceled($$){return $$("a").append([$$("span").append($$("i").addClass("fa fa-ban"),this.getLabel("Unpublish article"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToCanceled()})})}defaultAction(){api.newsItem.save();this.props.popover.disable();this.props.popover.setIcon("fa-refresh fa-spin fa-fw")}_save(beforeSaveFunc){this._saveState();if(beforeSaveFunc){beforeSaveFunc()}this.defaultAction()}_saveState(){this.extendState({previousState:{pubStatus:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop()}})}_onDocumentSaveFailed(){this.props.popover.setIcon("fa-ellipsis-h");this.props.popover.enable();if(!this.state.previousState){this._updateStatus(false);return}api.newsItem.setPubStatus(pluginId,this.state.previousState.pubStatus);if(this.state.previousState.pubStart){api.newsItem.setPubStart(pluginId,this.state.previousState.pubStart)}else{api.newsItem.removePubStart(pluginId)}if(this.state.previousState.pubStop){api.newsItem.setPubStop(pluginId,this.state.previousState.pubStop)}else{api.newsItem.removePubStop(pluginId)}this.extendState({status:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop(),previousState:null});this._updateStatus(false)}_onDocumentSaved(){this.props.popover.setIcon("fa-ellipsis-h");this.props.popover.enable();this.extendState({status:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop()});this._updateStatus(true)}_updateStatus(updateButtonSavedLabel){if(updateButtonSavedLabel){this.props.popover.setButtonText(this.getLabel("Save"))}if(this.state.status.qcode==="stat:usable"){this.props.popover.setStatusText(this.getLabel(this.state.status.qcode)+" "+moment(this.state.pubStart.value).fromNow())}else if(this.state.status.qcode==="stat:withheld"){this.props.popover.setStatusText(this.getLabel(this.state.status.qcode)+" "+moment(this.state.pubStart.value).fromNow())}else{this.props.popover.setStatusText(this.getLabel(this.state.status.qcode))}}}exports.default=PublishFlowComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{api,moment}=writer;class PublishFlowConfiguration{constructor(pluginId){this.pluginId=pluginId;this.status={"imext:draft":{allowed:["imext:done","stat:usable","stat:withheld"]},"imext:done":{allowed:["stat:usable","imext:draft","stat:withheld"]},"stat:withheld":{allowed:["stat:withheld","stat:usable","stat:canceled","imext:draft"]},"stat:usable":{allowed:["stat:usable","stat:canceled"]},"stat:canceled":{allowed:["imext:draft","imext:done","stat:usable","stat:withheld"]}}}getAllowedActions(status){if(this.status[status]){return this.status[status].allowed}return[]}setToDraft(){this.setStatus("imext:draft",null,null)}setToDone(){this.setStatus("imext:done",null,null)}setToWithheld(from,to){let fromObj=moment(from),toObj=moment(to);if(!fromObj.isValid()){throw new Error("Invalid from date and time")}this.setStatus("stat:withheld",{value:fromObj.format("YYYY-MM-DDTHH:mm:ssZ")},!toObj.isValid()?null:{value:toObj.format("YYYY-MM-DDTHH:mm:ssZ")})}setToUsable(){this.setStatus("stat:usable",{value:moment().format("YYYY-MM-DDTHH:mm:ssZ")},null)}setToCanceled(){this.setStatus("stat:canceled",null,null)}setStatus(qcode,pubStart,pubStop){if(qcode){api.newsItem.setPubStatus(this.pluginId,{qcode:qcode})}if(pubStart===null){api.newsItem.removePubStart(this.pluginId)}else if(typeof pubStart!=="undefined"){api.newsItem.setPubStart(this.pluginId,pubStart)}if(pubStop===null){api.newsItem.removePubStop(this.pluginId)}else if(typeof pubStop!=="undefined"){api.newsItem.setPubStop(this.pluginId,pubStop)}}}exports.default=PublishFlowConfiguration},function(module,exports){},,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(10);var _SocialembedPackage=__webpack_require__(12);var _SocialembedPackage2=_interopRequireDefault(_SocialembedPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_SocialembedPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _SocialembedComponent=__webpack_require__(13);var _SocialembedComponent2=_interopRequireDefault(_SocialembedComponent);var _SocialembedCommand=__webpack_require__(15);var _SocialembedCommand2=_interopRequireDefault(_SocialembedCommand);var _SocialembedConverter=__webpack_require__(18);var _SocialembedConverter2=_interopRequireDefault(_SocialembedConverter);var _SocialembedMacro=__webpack_require__(19);var _SocialembedMacro2=_interopRequireDefault(_SocialembedMacro);var _SocialembedNode=__webpack_require__(20);var _SocialembedNode2=_interopRequireDefault(_SocialembedNode);var _DropSocialEmbed=__webpack_require__(22);var _DropSocialEmbed2=_interopRequireDefault(_DropSocialEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"socialembed",id:"se.infomaker.socialembed",configure:function configure(config){config.addNode(_SocialembedNode2.default);config.addCommand("socialembed",_SocialembedCommand2.default);config.addComponent(_SocialembedNode2.default.type,_SocialembedComponent2.default);config.addConverter("newsml",_SocialembedConverter2.default);config.addMacro(_SocialembedMacro2.default);config.addDragAndDrop(_DropSocialEmbed2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class SocialembedComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this.rerender,this,{path:[this.props.node.id]});this.context.api.document.triggerFetchResourceNode(this.props.node,{history:false})}dispose(){this.context.editorSession.off(this)}render($$){const node=this.props.node;const el=$$("div").addClass("im-blocknode__container").addClass(node.socialChannel).attr("contenteditable",false);if(node.hasPayload()){const innerEl=$$("div").ref("embed-container");const headerEl=this.renderHeader($$,node);const contentEl=this.renderContent($$,node);innerEl.append([headerEl,contentEl]);el.append(innerEl)}else if(node.errorMessage){el.append($$("div").addClass("se-error").append(node.errorMessage))}else{el.append($$(_substance.FontAwesomeIcon,{icon:"fa-spin fa-refresh"}))}return el}renderContent($$,node){return $$("div").ref("embedContent").addClass("im-blocknode__content full-width").html(node.html)}renderHeader($$,node){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:node.socialChannelIcon}),$$("strong").append(node.socialChannel).attr("contenteditable",false)]).addClass("header").attr("contenteditable",false)}removeEmbed(){this.context.api.document.deleteNode("socialembed",this.props.node)}}SocialembedComponent.noStyle=true;exports.default=SocialembedComponent},function(module,exports){module.exports=substance},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertEmbed=__webpack_require__(17);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class SocialembedCommand extends _writer.WriterCommand{execute(params){if(params.isPaste){const currentNode=params.selection.getPath();if(!currentNode){return false}const currentNodeId=currentNode[0];const previousNode=_writer.api.document.getPreviousNode(currentNodeId);_writer.api.document.deleteNode("socialembed",previousNode)}params.editorSession.transaction(tx=>{(0,_insertEmbed2.default)(tx,params.url)});return true}}exports.default=SocialembedCommand},function(module,exports){module.exports=writer},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=insertEmbed;function insertEmbed(tx,embedUrl){tx.insertBlockNode({type:"socialembed",dataType:"x-im/socialembed",url:embedUrl})}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"socialembed",tagName:"object",matchElement:function matchElement(el){return el.is('object[type="x-im/socialembed"]')},import:function _import(el,node){node.dataType=el.attr("type");const linkEl=el.find("links>link");node.url=linkEl.attr("url");node.uri=linkEl.attr("uri");node.linkType=linkEl.attr("type")},export:function _export(node,el,converter){const $$=converter.$$;el.attr({id:node.id,type:node.dataType});el.removeAttr("data-id");const links=$$("links");const link=$$("link");link.attr({rel:"self",type:node.linkType,url:node.url,uri:node.uri});links.append(link);el.append(links)}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={execute:function execute(params,context){const editorSession=context.editorSession;const text=params.text;if(params.action!=="break"){return}let match=/^\s*(https?:\/\/([^\s]+))\s*$/.exec(text);if(!match)return;let url=match[1];let hasMatch=false;if(url.indexOf("twitter")>0){hasMatch=true}else if(url.indexOf("instagram")>0){hasMatch=true}else if(url.indexOf("facebook")>0){hasMatch=true}else if(url.indexOf("vimeo")>0){hasMatch=true}else if(url.indexOf("soundcloud")>0){hasMatch=true}if(hasMatch){editorSession.executeCommand("socialembed",{url:url,isPaste:true});return true}return false}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _embedInfoFromURL=__webpack_require__(21);var _embedInfoFromURL2=_interopRequireDefault(_embedInfoFromURL);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class SocialembedNode extends _substance.BlockNode{fetchPayload(context,cb){let url=this.url;let embedInfo=(0,_embedInfoFromURL2.default)(url);switch(embedInfo.socialChannel){case"twitter":this._loadTwitter(url,context,cb);break;case"instagram":this._loadInstagram(url,context,cb);break;case"facebook":this._loadFacebook(url,context,cb);break;case"vimeo":this._loadVimeo(url,context,cb);break;case"soundcloud":this._loadSoundcloud(url,context,cb);break;default:cb(new Error("Could not resolve an embed for this url"))}}hasPayload(){return Boolean(this.html)}_loadInstagram(url,context,cb){const instagramBase=`https://api.instagram.com/oembed?url=${encodeURIComponent(url)}&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:instagramBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{let tplNode=document.createElement("template"),parentNode,oldImgNode,newImgNode;try{tplNode.innerHTML=json.html;parentNode=tplNode.content.childNodes[0].querySelector("blockquote>div");oldImgNode=tplNode.content.childNodes[0].querySelector("blockquote>div>div");newImgNode=document.createElement("img");newImgNode.setAttribute("src",json.thumbnail_url);newImgNode.style.width="100%";newImgNode.style.textAlign="center";tplNode.content.childNodes[0].style.boxShadow=null;parentNode.style.padding=0;parentNode.removeChild(oldImgNode);parentNode.insertBefore(newImgNode,parentNode.firstChild);json.html=tplNode.innerHTML}catch(ex){}cb(null,{author:json.author_url,html:json.html,uri:`im://instagram/${json.media_id}`,url:url,title:json.title,linkType:"x-im/instagram",socialChannel:"Instagram",socialChannelIcon:"fa-instagram"},{history:false})}).catch(error=>{cb(error)})}_loadFacebook(url,context,cb){const apiBase=`https://www.facebook.com/plugins/post/oembed.json?url=${encodeURIComponent(url)}&omitscript=true`;let postId=(0,_writer.uuidv5)("url","https://facebook.com");const matches=/.*[\/=](\d+)/.exec(url);if(matches&&matches.length===2){postId=matches[1]}_writer.api.router.get("/api/resourceproxy",{url:apiBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://facebook-post/${postId}`,url:json.url,linkType:"x-im/facebook-post",socialChannel:"Facebook",socialChannelIcon:"fa-facebook"},{history:false})}).catch(error=>{cb(error)})}_loadTwitter(url,context,cb){const twitterBase=`https://api.twitter.com/1/statuses/oembed.json?url=${encodeURIComponent(url)}&hide_media=false&omit_script=true`;const twitterPostId=/status*\/(\d+)/.exec(url);_writer.api.router.get("/api/resourceproxy",{url:twitterBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://tweet/${twitterPostId[1]}`,url:json.url,linkType:"x-im/tweet",socialChannel:"Twitter",socialChannelIcon:"fa-twitter"},{history:false})}).catch(error=>{cb(error)})}_loadVimeo(url,context,cb){const vimeoBase=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(url)}&format=json&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:vimeoBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://vimeo/${json.video_id}`,url:url,title:json.title,linkType:"x-im/vimeo",socialChannel:"Vimeo",socialChannelIcon:"fa-vimeo"},{history:false})}).catch(error=>{cb(error)})}_loadSoundcloud(url,context,cb){const soundcloudBase=`https://soundcloud.com/oembed?format=json&url=${encodeURIComponent(url)}&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:soundcloudBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://soundcloud/${encodeURIComponent(json.author_name+"."+json.title)}`,url:url,title:json.title,linkType:"x-im/soundcloud",socialChannel:"Soundcloud",socialChannelIcon:"fa-soundcloud"},{history:false})}).catch(error=>{cb(error)})}}SocialembedNode.isResource=true;SocialembedNode.define({type:"socialembed",dataType:"string",url:"string",data:{type:"string",optional:true},errorMessage:{type:"string",optional:true},html:{type:"string",optional:true},uri:{type:"string",optional:true},linkType:{type:"string",optional:true},author:{type:"string",optional:true},socialChannel:{type:"string",optional:true},socialChannelIcon:{type:"string",optional:true}});exports.default=SocialembedNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=embedInfoFromURL;var _writer=__webpack_require__(16);function embedInfoFromURL(url){if(!_writer.lodash.isString(url)){return{isEmbed:false}}let result={isEmbed:true};if(url.indexOf("twitter")>0){result.socialChannel="twitter"}else if(url.indexOf("instagram")>0){result.socialChannel="instagram"}else if(url.indexOf("facebook")>0){result.socialChannel="facebook"}else if(url.indexOf("vimeo")>0){result.socialChannel="vimeo"}else if(url.indexOf("soundcloud")>0){result.socialChannel="soundcloud"}else{result.isEmbed=false}return result}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _embedInfoFromURL=__webpack_require__(21);var _embedInfoFromURL2=_interopRequireDefault(_embedInfoFromURL);var _insertEmbed=__webpack_require__(17);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropSocialEmbed extends _substance.DragAndDropHandler{match(params){if(params.type==="uri"){let embedInfo=(0,_embedInfoFromURL2.default)(params.uri);return embedInfo.isEmbed}}drop(tx,params){(0,_insertEmbed2.default)(tx,params.uri)}}exports.default=DropSocialEmbed},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(24);var _XimteaserPackage=__webpack_require__(26);var _XimteaserPackage2=_interopRequireDefault(_XimteaserPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_XimteaserPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(24);var _XimteaserComponent=__webpack_require__(27);var _XimteaserComponent2=_interopRequireDefault(_XimteaserComponent);var _XimteaserConverter=__webpack_require__(29);var _XimteaserConverter2=_interopRequireDefault(_XimteaserConverter);var _Ximteaser=__webpack_require__(30);var _Ximteaser2=_interopRequireDefault(_Ximteaser);var _XimteaserTool=__webpack_require__(31);var _XimteaserTool2=_interopRequireDefault(_XimteaserTool);var _XimteaserCommand=__webpack_require__(32);var _XimteaserCommand2=_interopRequireDefault(_XimteaserCommand);var _XimteaserInsertImageCommand=__webpack_require__(33);var _XimteaserInsertImageCommand2=_interopRequireDefault(_XimteaserInsertImageCommand);var _substance=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"ximteaser",id:"se.infomaker.ximteaser",configure:function configure(config,pluginConfig){config.addNode(_Ximteaser2.default);config.addComponent(_Ximteaser2.default.type,_XimteaserComponent2.default);config.addConverter("newsml",_XimteaserConverter2.default);config.addContentMenuTopTool("ximteaser",_XimteaserTool2.default);config.addCommand("ximteaser",_XimteaserCommand2.default,pluginConfig);config.addCommand("ximteaserinsertimage",_XimteaserInsertImageCommand2.default,pluginConfig);config.addIcon("ximteaser",{fontawesome:" fa-newspaper-o"});if(_substance.platform.isMac){config.addKeyboardShortcut("cmd+alt+t",{command:"ximteaser"})}else{config.addKeyboardShortcut("ctrl+alt+t",{command:"ximteaser"})}config.addLabel("Insert Teaser",{en:"Insert Teaser",sv:"Infoga puff"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _FileInputComponent=__webpack_require__(28);var _FileInputComponent2=_interopRequireDefault(_FileInputComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class XimteaserComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this._onDocumentChange,this);this.parent.parent.attr("draggable",false);this.parent.attr("draggable",false);this.attr("draggable",false)}dispose(){this.context.editorSession.off(this)}_onDocumentChange(change){if(change.isAffected(this.props.node.id)||change.isAffected(this.props.node.imageFile)){this.rerender()}}render($$){const node=this.props.node;const el=$$("div").addClass("sc-ximteaser im-blocknode__container");const teaserFields=_writer.api.getConfigValue("se.infomaker.ximteaser","fields",[]);el.append(this.renderHeader($$));const ImageDisplay=_writer.api.ui.getComponent("imageDisplay");if(this.props.node.imageFile){el.append($$(ImageDisplay,{parentId:"se.infomaker.ximteaser",node:node,isolatedNodeState:this.props.isolatedNodeState,removeImage:this.removeImage.bind(this)}).ref("image"))}el.append(this.renderContent($$,teaserFields));return el}removeImage(){_writer.api.editorSession.transaction(tx=>{const node=this.props.node;tx.set([node.id,"imageFile"],null);tx.set([node.id,"subject"],"")})}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-newspaper-o"}),$$("strong").append(this.getLabel("Teaser")),$$(_FileInputComponent2.default,{onChange:this.triggerFileUpload.bind(this)})]).addClass("header")}triggerFileUpload(ev){const editorSession=_writer.api.editorSession;editorSession.executeCommand("ximteaserinsertimage",{type:"file",data:ev.target.files,context:{node:this.props.node}})}renderContent($$,teaserFields){const content=$$("div").addClass("im-blocknode__content full-width");if(teaserFields.indexOf("subject")>=0){content.append(this.renderSubjectEditor($$))}content.append(this.renderTitleEditor($$));if(teaserFields.indexOf("text")>=0){
content.append(this.renderTextEditor($$))}return content}renderSubjectEditor($$){if(this.props.node.imageFile){const subjectContainer=$$("div");const subjectEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"subject"],doc:this.props.doc}).ref("subject").addClass("x-im-teaser-subject");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-flag"});subjectContainer.append([icon,subjectEditor]);return subjectContainer}}renderTitleEditor($$){const titleContainer=$$("div");const titleEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"title"],doc:this.props.doc}).ref("title").addClass("x-im-teaser-title");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-header"});titleContainer.append([icon,titleEditor]);return titleContainer}renderTextEditor($$){const textContainer=$$("div");const textEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"text"],doc:this.props.doc}).ref("text").addClass("x-im-teaser-text");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-paragraph"});textContainer.append([icon,textEditor]);return textContainer}}exports.default=XimteaserComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class FileInputComponent extends _substance.Component{render($$){const uploadbutton=$$("span").addClass("upload-button").append($$(_substance.FontAwesomeIcon,{icon:"fa-upload"})).on("click",this.triggerFileDialog).attr("title",this.getLabel("Upload image"));const fileInput=$$("input").attr("type","file").attr("multiple","multiple").ref("fileInput").on("change",this.props.onChange);return $$("span").addClass("fileinput").append([uploadbutton,fileInput])}triggerFileDialog(){const evt=document.createEvent("MouseEvents");evt.initEvent("click",true,false);this.refs.fileInput.el.el.dispatchEvent(evt)}}exports.default=FileInputComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"ximteaser",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/teaser"},import:function _import(el,node,converter){const nodeId=el.attr("id");node.title=el.attr("title");node.dataType=el.attr("type");const linkEl=el.find("links>link");if(linkEl){node.imageType=linkEl.attr("type");let imageFile={id:(0,_writer.idGenerator)(),type:"npfile",imType:"x-im/image",parentNodeId:nodeId};if(linkEl.attr("uuid")){imageFile.uuid=linkEl.attr("uuid")}if(linkEl.attr("uri")){node.uri=linkEl.attr("uri")}if(linkEl.attr("url")){imageFile.url=linkEl.attr("url")}converter.createNode(imageFile);node.imageFile=imageFile.id;node.uuid=linkEl.attr("uuid")}const dataEl=el.find("data");node.crops={};if(dataEl){dataEl.children.forEach(function(child){if(child.tagName==="text"){node.text=converter.annotatedText(child,[node.id,"text"])}if(child.tagName==="subject"){node.subject=converter.annotatedText(child,[node.id,"subject"])}if(child.tagName==="width"){node.width=parseInt(child.text(),10)}if(child.tagName==="height"){node.height=parseInt(child.text(),10)}if(child.tagName==="crops"&&child.children.length>0){let crops={crops:[]};child.children.forEach(function(crop){if(crop.children.length===0){return}if(crop.tagName==="width"){crops.width=crop.text()}else if(crop.tagName==="height"){crops.height=crop.text()}else{var x=crop.find("x"),y=crop.find("y"),width=crop.find("width"),height=crop.find("height");crops.crops.push({name:crop.attr("name"),x:x.text(),y:y.text(),width:width.text(),height:height.text()})}});if(crops.crops.length){node.crops=crops}}})}},export:function _export(node,el,converter){const $$=converter.$$;el.removeAttr("data-id");el.attr({id:node.id,type:"x-im/teaser"});if(node.title){el.attr("title",converter.annotatedText([node.id,"title"]))}const data=$$("data");if(node.width){data.append($$("width").append(String(node.width)))}if(node.height){data.append($$("height").append(String(node.width)))}if(node.text){data.append($$("text").append(converter.annotatedText([node.id,"text"])))}if(node.subject){data.append($$("subject").append(converter.annotatedText([node.id,"subject"])))}if(node.crops){let crops=$$("crops");for(var x in node.crops.crops){var origCrop=node.crops.crops[x];crops.append($$("crop").attr("name",origCrop.name).append([$$("x").append(origCrop.x),$$("y").append(origCrop.y),$$("width").append(origCrop.width),$$("height").append(origCrop.height)]))}data.append(crops)}el.append(data);let fileNode=node.document.get(node.imageFile);if(fileNode&&fileNode.uuid!==""&&node.uri){const link=$$("link").attr({rel:"image",type:"x-im/image",uri:node.uri,uuid:fileNode.uuid});el.append($$("links").append(link))}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class Ximteaser extends _substance.BlockNode{getImageFile(){if(this.imageFile){return this.document.get(this.imageFile)}}getUrl(){let imageFile=this.getImageFile();if(imageFile){return imageFile.getUrl()}}setSoftcropData(data){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"crops"],data)})}handleDOMDocument(newsItemDOMDocument){const dom=newsItemDOMDocument.documentElement,uuid=dom.getAttribute("guid"),uri=dom.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]').getAttribute("value"),width=dom.querySelector("contentMeta > metadata > object > data > width"),height=dom.querySelector("contentMeta > metadata > object > data > height");_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"uuid"],uuid);tx.set([this.id,"uri"],uri);tx.set([this.id,"width"],width?width.textContent:"");tx.set([this.id,"height"],height?height.textContent:"")},{history:false})}}Ximteaser.define({type:"ximteaser",dataType:{type:"string",optional:false},imageFile:{type:"file",optional:true},uuid:{type:"string",optional:true},uri:{type:"string",optional:true},title:{type:"string",optional:false,default:""},subject:{type:"string",optional:false,default:""},text:{type:"string",optional:false,default:""},width:{type:"number",optional:true},height:{type:"number",optional:true},crops:{type:"object",default:[]}});exports.default=Ximteaser},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimteaserTool extends _substance.Tool{render($$){const el=$$("div");el.attr("title",this.getLabel("Insert Teaser"));el.append($$("button").addClass("se-tool").append($$("i").addClass("fa fa-newspaper-o")).on("click",this.insertTeaser));return el}insertTeaser(){const commandName=this.getCommandName();_writer.api.editorSession.executeCommand(commandName,{test:"hello"})}}exports.default=XimteaserTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimteaserCommand extends _writer.WriterCommand{execute(params,context){const teaserPosition=context.api.getConfigValue(this.config.id,"teaserPosition","bottom");const nodes=_writer.api.document.getDocumentNodes();const existingTeaser=nodes.filter(node=>{return node.dataType==="x-im/teaser"});if(existingTeaser.length>0){_writer.api.ui.showNotification("se.infomaker.ximteaser",_writer.api.getLabel("A teaser already exist"),_writer.api.getLabel("There is already a teaser in this document"));return false}switch(teaserPosition){case"top":this.insertTeaserAtTop(params);break;default:this.insertTeaserAtBottom(params);break}}insertTeaserAtTop(params){const editorSession=params.editorSession;const doc=editorSession.getDocument();editorSession.transaction(tx=>{const firstNodeId=doc.getNodes()["body"].nodes[0];tx.selection=doc.createSelection({type:"property",containerId:"body",path:[firstNodeId,"content"],startOffset:0});tx.insertBlockNode(this.getEmptyTeaserNode())})}insertTeaserAtBottom(params){const editorSession=params.editorSession;editorSession.transaction(tx=>{const body=tx.get("body");const node=tx.create(this.getEmptyTeaserNode());body.show(node.id)})}getEmptyTeaserNode(){return{type:"ximteaser",dataType:"x-im/teaser",id:(0,_writer.idGenerator)(),uuid:"",url:"",imageType:"x-im/image",title:"",text:"",crops:[]}}}exports.default=XimteaserCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimteaserInsertImageCommand extends _writer.WriterCommand{constructor(...args){super(...args);this.name="ximteaserinsertimage"}execute(params,context){const teaserNode=params.context.node;const editorSession=context.editorSession;const file=params.data[0];editorSession.transaction(tx=>{let imageFile=tx.create({parentNodeId:teaserNode.id,type:"npfile",imType:"x-im/image",mimeType:file.type,sourceFile:file});tx.set([teaserNode.id,"imageFile"],imageFile.id)});_writer.api.editorSession.fileManager.sync()}}exports.default=XimteaserInsertImageCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(35);__webpack_require__(37);__webpack_require__(39);var _XimimagePackage=__webpack_require__(41);var _XimimagePackage2=_interopRequireDefault(_XimimagePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_XimimagePackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports){},,function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimimageComponent=__webpack_require__(42);var _XimimageComponent2=_interopRequireDefault(_XimimageComponent);var _XimimageConverter=__webpack_require__(46);var _XimimageConverter2=_interopRequireDefault(_XimimageConverter);var _Ximimage=__webpack_require__(47);var _Ximimage2=_interopRequireDefault(_Ximimage);var _InsertImagesTool=__webpack_require__(48);var _InsertImagesTool2=_interopRequireDefault(_InsertImagesTool);var _InsertImagesCommand=__webpack_require__(49);var _InsertImagesCommand2=_interopRequireDefault(_InsertImagesCommand);var _DropImageFile=__webpack_require__(51);var _DropImageFile2=_interopRequireDefault(_DropImageFile);var _DropImageUri=__webpack_require__(52);var _DropImageUri2=_interopRequireDefault(_DropImageUri);var _DropImageUUID=__webpack_require__(53);var _DropImageUUID2=_interopRequireDefault(_DropImageUUID);var _XimimageFileProxy=__webpack_require__(54);var _XimimageFileProxy2=_interopRequireDefault(_XimimageFileProxy);var _InsertImageUrlCommand=__webpack_require__(55);var _InsertImageUrlCommand2=_interopRequireDefault(_InsertImageUrlCommand);var _ImageDisplay=__webpack_require__(43);var _ImageDisplay2=_interopRequireDefault(_ImageDisplay);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"ximimage",id:"se.infomaker.ximimage",configure:function configure(config){config.addNode(_Ximimage2.default);config.addComponent(_Ximimage2.default.type,_XimimageComponent2.default);config.addConverter("newsml",_XimimageConverter2.default);config.addContentMenuTopTool("insert-images",_InsertImagesTool2.default);config.addCommand("insert-images",_InsertImagesCommand2.default);config.addCommand("ximimage-insert-image-url",_InsertImageUrlCommand2.default);config.addComponent("imageDisplay",_ImageDisplay2.default);config.addConverter("newsml",_XimimageConverter2.default);config.addDragAndDrop(_DropImageFile2.default);config.addDragAndDrop(_DropImageUri2.default);config.addDragAndDrop(_DropImageUUID2.default);config.addIcon("image",{fontawesome:"fa-image"});config.addIcon("crop",{fontawesome:"fa-crop"});config.addIcon("user-plus",{fontawesome:"fa-user-plus"});config.addIcon("upload",{fontawesome:"fa-upload"});config.addIcon("remove",{fontawesome:"fa-times"});config.addFileProxy(_XimimageFileProxy2.default);config.addLabel("Upload image",{en:"Upload image",sv:"Ladda upp bild"});config.addLabel("remove-image-button-title",{en:"Remove image",sv:"Ta bort bild"});config.addLabel("Image archive information",{sv:"Arkivinformation om bild"});config.addLabel("Add to image byline",{sv:"Lägg till byline till bild"});config.addLabel("Add to byline",{sv:"Lägg till byline"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ImageDisplay=__webpack_require__(43);var _ImageDisplay2=_interopRequireDefault(_ImageDisplay);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{api}=writer;class XimimageComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){this.context.editorSession.off(this)}_onDocumentChange(change){if(change.isAffected(this.props.node.id)||change.isAffected(this.props.node.imageFile)){this.rerender()}}render($$){let node=this.props.node;let el=$$("div").addClass("sc-ximimage");let fields=api.getConfigValue("se.infomaker.ximimage","fields");el.append($$(_ImageDisplay2.default,{parentId:"se.infomaker.ximimage",node:node,isolatedNodeState:this.props.isolatedNodeState}).ref("image"));this.renderAuthors($$,el);fields.forEach(obj=>{if(obj.type==="option"){el.append(this.renderOptionField($$,obj))}else{el.append(this.renderTextField($$,obj))}});return el}renderAuthors($$,el){if(api.getConfigValue("se.infomaker.ximimage","byline")){const authorList=$$("ul").addClass("dialog-image-authorlist").attr("contenteditable",false);this.props.node.authors.forEach(item=>{const authorItem=this.renderAuthor($$,item);if(authorItem){authorList.append(authorItem)}});el.append($$("div").attr("contenteditable",false).addClass("x-im-image-authors").append(authorList))}}renderAuthor($$,author){const avatar=$$("span").addClass("x-im-image-author-token");const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;return $$("li").append($$("div").append([avatar,$$("div").append([$$("strong").append(author.name)]),$$("span").append($$("a").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"})).attr("title",this.getLabel("Remove")).on("click",()=>{this.removeAuthor(author)}))])).ref("item-"+refid)}removeAuthor(author){const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;delete this.refs["item-"+refid];const authors=this.props.node.authors;for(let n=0;n<authors.length;n++){if(!_writer.NilUUID.isNilUUID(author.uuid)&&authors[n].uuid===author.uuid){authors.splice(n,1);break}else if(_writer.NilUUID.isNilUUID(author.uuid)&&authors[n].name===author.name){authors.splice(n,1);break}}this.props.node.setAuthors(authors)}renderTextField($$,obj){return $$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,obj.name],doc:this.props.doc}).ref(obj.name).attr("title",obj.label).addClass("x-im-image-dynamic x-im-image-"+obj.name)}renderOptionField($$,obj){let options=[],currentOption=null;if(!this.props.node.alignment){currentOption=obj.options[0].name}else{currentOption=this.props.node.alignment}obj.options.forEach(option=>{let selectedClass=currentOption===option.name?" selected":"";options.push($$("em").addClass("fa "+option.icon+selectedClass).attr({contenteditable:"false",title:option.label}).on("click",()=>{if(option.name!==this.props.node.alignment){this.props.node.setAlignment(option.name);this.rerender()}return false}))});return $$("div").addClass("x-im-image-dynamic x-im-image-alignment").attr({contenteditable:"false"}).append(options)}}exports.default=XimimageComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ImageCropper=__webpack_require__(44);var _ImageCropper2=_interopRequireDefault(_ImageCropper);var _XimimageAddToBylineComponent=__webpack_require__(45);var _XimimageAddToBylineComponent2=_interopRequireDefault(_XimimageAddToBylineComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ImageDisplay extends _substance.Component{constructor(...args){super(...args)}_onDragStart(e){e.preventDefault();e.stopPropagation()}render($$){let imgContainer=$$("div").addClass("se-image-container").ref("imageContainer");let imgSrc;try{this.hasLoadingErrors=false;imgSrc=this.props.node.getUrl()}catch(e){this.hasLoadingErrors=e}let contentElement=$$(_substance.FontAwesomeIcon,{icon:"fa-picture-o"}).attr("style","font-size:25rem;color:#efefef");if(imgSrc){if(this.props.removeImage){const deleteButton=$$(_substance.Button,{icon:"remove"}).addClass("remove-image__button").attr("title",this.getLabel("remove-image-button-title")).on("click",()=>{this.props.removeImage()});imgContainer.append(deleteButton)}contentElement=$$("img",{src:imgSrc}).ref("img")}else if(this.hasLoadingErrors){contentElement=$$(_substance.FontAwesomeIcon,{icon:"fa-chain-broken"}).attr("style","font-size:4rem;").addClass("broken-image").attr("title",this.getLabel("Image could not be found"))}imgContainer.append(contentElement);const imageFile=this.context.doc.get(this.props.node.imageFile);const actionsEl=$$("div").addClass("se-actions");if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"byline")){actionsEl.append($$(_substance.Button,{icon:"user-plus"}).on("click",this._openAddToByline))}if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"imageinfo")){actionsEl.append($$(_substance.Button,{icon:"image"}).on("click",this._openMetaData))}if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"softcrop")){actionsEl.append($$(_substance.Button,{icon:"crop"}).on("click",this._openCropper))}imgContainer.append(actionsEl);let el=$$("div").addClass("sc-image-display");el.addClass("sm-"+this.props.isolatedNodeState);el.append(imgContainer);return el}_openMetaData(){_writer.api.router.getNewsItem(this.props.node.uuid,"x-im/image").then(response=>{_writer.api.ui.showDialog(this.getComponent("dialog-image"),{node:this.props.node,newsItem:response,disablebylinesearch:!_writer.api.getConfigValue(this.props.parentId,"bylinesearch")},{title:this.getLabel("Image archive information"),global:true,primary:this.getLabel("Save"),secondary:this.getLabel("Cancel")})})}_openAddToByline(){_writer.api.ui.showDialog(_XimimageAddToBylineComponent2.default,{authors:this.props.node.authors,removeAuthor:()=>author=>{this.props.node.removeAuthor(author)},addAuthor:(author,cbDone)=>{const authors=this.props.node.authors;authors.push(author);this.props.node.setAuthors(authors);cbDone()}},{title:this.getLabel("Add to image byline"),global:true,primary:this.getLabel("Close"),secondary:false})}_openCropper(){let tertiary=false;if(this.props.node.crops){tertiary=[{caption:this.getLabel("Remove"),callback:()=>{this.props.node.setSoftcropData([]);return true}}]}_writer.api.ui.showDialog(_ImageCropper2.default,{parentId:this.props.parentId,src:this.props.node.getUrl(),width:this.props.node.width,height:this.props.node.height,crops:this.props.node.crops.crops||[],callback:crops=>{this.props.node.setSoftcropData(crops)}},{tertiary:tertiary})}}exports.default=ImageDisplay},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);const{api}=writer;class ImageCropper extends _substance.Component{didMount(){this.cropEditor=new IMSoftcrop.Editor("ximimage__softcrop",{autocrop:false,debug:false});let definedCrops=api.getConfigValue(this.props.parentId,"crops",[]),encodedSrc=encodeURIComponent(this.props.src);this.cropEditor.addImage("/api/resourceproxy?url="+encodedSrc,()=>{let selected=true;for(var name in definedCrops){if(this.props.crops){this.addCrop(name,selected,definedCrops[name],this.props.crops)}else{this.createCrop(name,selected,definedCrops[name])}selected=false}})}createCrop(name,selected,definedCrop){this.cropEditor.addSoftcrop(name,selected,definedCrop[0],definedCrop[1])}addCrop(name,selected,definedCrop,existingCrops){var existingCrop=null;for(var n=0;n<existingCrops.length;n++){if(existingCrops[n].name===name){existingCrop=existingCrops[n];break}}if(!existingCrop){this.createCrop(name,selected,definedCrop);return}let imageWidth=this.props.width;let imageHeight=this.props.height;let matches=this.props.src.match(/&w=([0-9]*)/);if(Array.isArray(matches)&&matches.length===2){imageWidth=matches[1];imageHeight=Math.round(imageWidth/this.props.width*this.props.height)}this.cropEditor.addSoftcrop(name,selected,Math.round(existingCrop.width*imageWidth),Math.round(existingCrop.height*imageHeight),Math.round(existingCrop.x*imageWidth),Math.round(existingCrop.y*imageHeight))}render($$){return $$("div").attr("id","ximimage__softcrop").addClass("sc-image-cropper").ref("cropper")}onClose(status){if(status==="cancel"){return}let data=this.cropEditor.getSoftcropData(),crops=[];data.crops.forEach(crop=>{crops.push({name:crop.id,x:crop.x/data.width,y:crop.y/data.height,width:crop.width/data.width,height:crop.height/data.height})});this.props.callback({crops:crops})}}exports.default=ImageCropper},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimimageAddToBylineComponent extends _substance.Component{constructor(...args){super(...args)}render($$){const el=$$("div").ref("authorContainer").addClass("authors dialog-image-info clearfix");const bylinesearch=this.context.api.getConfigValue("se.infomaker.ximimage","bylinesearch");let searchComponent;if(bylinesearch){const AuthorSearchComponent=this.context.componentRegistry.get("form-search");searchComponent=$$(AuthorSearchComponent,{existingItems:this.props.authors,searchUrl:"/api/search/concepts/authors?q=",onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Add to byline")}).ref("authorSearchComponent")}else{const AuthorAddComponent=this.context.componentRegistry.get("form-add");searchComponent=$$(AuthorAddComponent,{existingItems:this.props.authors,onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Add to byline")}).ref("authorSearchComponent")}return el.append([searchComponent,this.renderAuthors($$)])}renderAuthors($$){const authorList=$$("ul").addClass("dialog-image-authorlist").attr("contenteditable",false);for(let n=0;n<this.props.authors.length;n++){const authorItem=this.renderAuthor($$,this.props.authors[n]);if(authorItem){authorList.append(authorItem)}}return $$("div").addClass("dialog-image-authors").append(authorList)}renderAuthor($$,author){let avatar;avatar=$$("span");const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;return $$("li").append($$("div").append([avatar,$$("div").append([$$("strong").append(author.name),$$("em").append(author.data?author.data.email?author.data.email:"":"")]),$$("span").append($$("a").append($$(_substance.FontAwesomeIcon,{icon:"remove"})).attr("title",this.getLabel("Remove")).on("click",function(){this.removeAuthor(author)}.bind(this)))])).ref("item-"+refid)}createAuthor(authorItem){const author={uuid:_writer.NilUUID.getNilUUID(),name:authorItem.inputValue};this.props.addAuthor(author,function(){this.rerender()}.bind(this))}addAuthor(authorItem){const author={uuid:authorItem.uuid,name:authorItem.name[0]};this.props.addAuthor(author,function(){this.rerender()}.bind(this))}removeAuthor(author){const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;delete this.refs["item-"+refid];this.props.removeAuthor(author)}onClose(){return true}}exports.default=XimimageAddToBylineComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"ximimage",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/image"},import:function _import(el,node,converter,newsItemConversion){const objectElementId=el.attr("id");var linkEl=el.find("links>link");let imageFile={id:(0,_writer.idGenerator)(),type:"npfile",imType:"x-im/image",parentNodeId:objectElementId};if(el.attr("uuid")){imageFile.uuid=el.attr("uuid")}if(linkEl&&linkEl.attr("uri")){node.uri=linkEl.attr("uri")}if(linkEl&&linkEl.attr("url")){imageFile.url=linkEl.attr("url")}converter.createNode(imageFile);node.imageFile=imageFile.id;node.uuid=el.attr("uuid");let dataEl;if(newsItemConversion){dataEl=el.find("data")}else{dataEl=linkEl.find("data")}node.caption="";node.alttext="";node.credit="";node.alignment="";if(dataEl){dataEl.children.forEach(function(child){if(child.tagName==="text"){node.caption=converter.annotatedText(child,[node.id,"caption"])}if(child.tagName==="alttext"){node.alttext=converter.annotatedText(child,[node.id,"alttext"])}if(child.tagName==="credit"){node.credit=converter.annotatedText(child,[node.id,"credit"])}if(child.tagName==="alignment"){node.alignment=child.text()}if(child.tagName==="width"){node.width=parseInt(child.text(),10)}if(child.tagName==="height"){node.height=parseInt(child.text(),10)}if(child.tagName==="crops"&&child.children.length>0){var crops={crops:[]};child.children.forEach(function(crop){if(crop.children.length===0){return}if(crop.tagName==="width"){crops.width=crop.text()}else if(crop.tagName==="height"){crops.height=crop.text()}else{var x=crop.find("x"),y=crop.find("y"),width=crop.find("width"),height=crop.find("height");crops.crops.push({name:crop.attr("name"),x:x.text(),y:y.text(),width:width.text(),height:height.text()})}});if(crops.crops.length){node.crops=crops}}})}node.authors=[];let authorLinks;if(newsItemConversion){authorLinks=el.find("links")}else{authorLinks=linkEl.find("links")}if(authorLinks){authorLinks.children.forEach(function(authorLinkEl){if("author"===authorLinkEl.getAttribute("rel")){node.authors.push({uuid:authorLinkEl.getAttribute("uuid"),name:authorLinkEl.getAttribute("title")})}else{console.warn("Unhandled link in image object",authorLinkEl)}})}},export:function _export(node,el,converter){var $$=converter.$$;let fileNode=node.document.get(node.imageFile);el.removeAttr("data-id");el.attr({id:node.id,type:"x-im/image",uuid:fileNode.uuid?fileNode.uuid:_writer.NilUUID.getNilUUID()});var data=$$("data").append([$$("width").append(String(node.width)),$$("height").append(String(node.height))]);let fields=_writer.api.getConfigValue("se.infomaker.ximimage","fields")||[];fields.forEach(obj=>{let name=obj.name==="caption"?"text":obj.name;if(!node[obj.name]){data.append($$(name).append(""))}else if(obj.type==="option"){data.append($$(name).append(node[obj.name]))}else{data.append($$(name).append(converter.annotatedText([node.id,obj.name])))}});if(node.crops){let crops=$$("crops");for(var x in node.crops.crops){if(node.crops.crops.hasOwnProperty(x)){var origCrop=node.crops.crops[x];crops.append($$("crop").attr("name",origCrop.name).append([$$("x").append(origCrop.x),$$("y").append(origCrop.y),$$("width").append(origCrop.width),$$("height").append(origCrop.height)]))}}data.append(crops)}var link=$$("link").attr({rel:"self",type:"x-im/image",uri:node.uri?node.uri:"",uuid:fileNode.uuid?fileNode.uuid:_writer.NilUUID.getNilUUID()}).append(data);if(node.authors.length){var authorLinks=$$("links");for(var n in node.authors){if(node.authors.hasOwnProperty(n)){var authorLink=$$("link").attr({rel:"author",uuid:node.authors[n].uuid,title:node.authors[n].name});if(!_writer.NilUUID.isNilUUID(node.authors[n].uuid)){authorLink.attr("type","x-im/author")}authorLinks.append(authorLink)}}link.append(authorLinks)}el.append($$("links").append(link))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _substance=__webpack_require__(14);const{BlockNode}=substance;class Ximimage extends BlockNode{getImageFile(){if(this.imageFile){return this.document.get(this.imageFile)}}getUrl(){let imageFile=this.getImageFile();if(imageFile){return imageFile.getUrl()}}setAlignment(alignment){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"alignment"],alignment)})}setSoftcropData(data){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"crops"],data)})}setAuthors(authors){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"authors"],authors)})}handleDOMDocument(newsItemDOMDocument){const dom=newsItemDOMDocument.documentElement,uuid=dom.getAttribute("guid"),uri=dom.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]'),text=dom.querySelector("contentMeta > metadata > object > data > text"),credit=dom.querySelector("contentMeta > metadata > object > data > credit"),width=dom.querySelector("contentMeta > metadata > object > data > width"),height=dom.querySelector("contentMeta > metadata > object > data > height");_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"uuid"],uuid?uuid:"");tx.set([this.id,"uri"],uri?uri.attributes["value"].value:"");tx.set([this.id,"caption"],text?text.textContent:"");tx.set([this.id,"credit"],credit?credit.textContent:"");tx.set([this.id,"width"],width?width.textContent:"");tx.set([this.id,"height"],height?height.textContent:"")},{history:false})}fetchPayload(context,cb){const fileNode=this.getImageFile();if(fileNode.sourceUUID){_writer.api.router.get("/api/newsitem/"+fileNode.uuid,{imType:"x-im/article"}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>response.text()).then(xmlString=>{const newsMLImporter=_writer.api.configurator.createImporter("newsml",{api:_writer.api});const newsMLConverters=context.converterRegistry.get("newsml");const ximImageConverter=newsMLConverters.get("ximimage");const imageNewsItemDocument=_substance.DefaultDOMElement.parseXML(xmlString);const imageNewsItem=imageNewsItemDocument[0];let imageObjectElement=imageNewsItem.find('contentMeta > metadata > object[type="x-im/image"]');let node={};const defaultDOMImageNewsitem=_substance.DefaultDOMElement.parseXML(imageObjectElement.outerHTML);ximImageConverter.import(defaultDOMImageNewsitem,node,newsMLImporter,true);const uri=imageNewsItem.find('itemMetaExtProperty[type="imext:uri"]').attr("value");const uuid=imageNewsItem.attr("guid");node.uri=uri;node.uuid=uuid;node.imageFile=fileNode.id;cb(null,node)}).catch(e=>{cb(e)})}}}Ximimage.isResource=true;Ximimage.define({type:"ximimage",uuid:{type:"string",optional:true},uri:{type:"string",optional:true},imageFile:{type:"file"},width:{type:"number",optional:true},height:{type:"number",optional:true},errorMessage:{type:"string",optional:true},crops:{type:"object",default:[]},authors:{type:"array",default:[]},caption:{type:"string",default:""},alttext:{type:"string",optional:true},credit:{type:"string",optional:true},alignment:{type:"string",optional:true}});exports.default=Ximimage},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class XimimageTool extends _substance.Tool{render($$){var el=$$("div");el.attr("title",this.getLabel("Upload image"));el.append($$("button").addClass("se-tool").append($$("i").addClass("fa fa-image")).on("click",this.triggerFileDialog));el.append($$("input").attr("type","file").attr("multiple","multiple").attr("id","x-im-image-fileupload").ref("x-im-image-fileupload").on("change",this.triggerFileUpload));return el;
}triggerFileDialog(){var evt=document.createEvent("MouseEvents");evt.initEvent("click",true,false);this.refs["x-im-image-fileupload"].el.el.dispatchEvent(evt)}triggerFileUpload(ev){this.context.editorSession.executeCommand("insert-images",{files:ev.target.files})}}exports.default=XimimageTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class XimimageCommand extends _writer.WriterCommand{execute(params){params.editorSession.transaction(tx=>{Array.prototype.forEach.call(params.files,file=>{(0,_insertImage2.default)(tx,file)})});_writer.api.editorSession.fileManager.sync();return true}}exports.default=XimimageCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(tx,data){let isFile=data instanceof File,nodeId=(0,_writer.idGenerator)();if(!typeof data==="string"&&!isFile){throw new Error("Unsupported data. Must be File or String")}const imageFileNode={parentNodeId:nodeId,type:"npfile",imType:"x-im/image"};if(isFile){imageFileNode["sourceFile"]=data}else if(typeof data==="string"){imageFileNode["sourceUrl"]=data}let imageFile=tx.create(imageFileNode);tx.insertBlockNode({id:nodeId,type:"ximimage",imageFile:imageFile.id,caption:"",alttext:"",credit:"",alignment:"",width:0,height:0})};var _writer=__webpack_require__(16)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _substance=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropImageFile extends _substance.DragAndDropHandler{match(params){return params.type==="file"&&_writer.lodash.startsWith(params.file.type,"image")}drop(tx,params){(0,_insertImage2.default)(tx,params.file);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}exports.default=DropImageFile},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropImageUri extends _substance.DragAndDropHandler{match(params){return params.type==="uri"&&_isImage(params.uri)}drop(tx,params){(0,_insertImage2.default)(tx,params.uri);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}function _isImage(uri){return uri.indexOf(".jpg")>0||uri.indexOf(".png")>0||uri.indexOf(".gif")>0}exports.default=DropImageUri},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class DropImageUUID extends _substance.DragAndDropHandler{match(params){if(this.isExistingImageDrop(params)){console.info("Implement support for handle existing image drop",this.getDataFromURL(params.uri));return true}return false}isExistingImageDrop(params){if(params.uri&&params.uri.indexOf("x-im-entity://x-im/image")>=0){return true}}drop(tx,params){const dropData=this.getDataFromURL(params.uri);const uuid=dropData.uuid;const nodeId=(0,_writer.idGenerator)();if(!dropData.uuid){throw new Error("Unsupported data. UUID must exist")}const imageFileNode={parentNodeId:nodeId,type:"npfile",imType:"x-im/image",uuid:uuid,sourceUUID:uuid};let imageFile=tx.create(imageFileNode);tx.insertBlockNode({id:nodeId,type:"ximimage",imageFile:imageFile.id,caption:dropData.name,alttext:"",credit:"",alignment:""})}getDataFromURL(url){const queryParamKey="data=";const dataPosition=url.indexOf(queryParamKey);let encodedData=url.substr(dataPosition+queryParamKey.length,url.length);return JSON.parse(window.atob(encodedData))}}exports.default=DropImageUUID},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimimageFileProxy extends _writer.NPFileProxy{}XimimageFileProxy.match=function(fileNode){return fileNode.imType==="x-im/image"};exports.default=XimimageFileProxy},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class InsertImageUrlCommand extends _writer.WriterCommand{execute(params){_writer.api.editorSession.transaction(tx=>{(0,_insertImage2.default)(tx,params.imageUrl)});_writer.api.editorSession.fileManager.sync()}}exports.default=InsertImageUrlCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _YoutubeEmbedPackage=__webpack_require__(57);var _YoutubeEmbedPackage2=_interopRequireDefault(_YoutubeEmbedPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_YoutubeEmbedPackage2.default)}else{console.error("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(58);var _YoutubeEmbedCommand=__webpack_require__(60);var _YoutubeEmbedCommand2=_interopRequireDefault(_YoutubeEmbedCommand);var _YoutubeEmbedNode=__webpack_require__(62);var _YoutubeEmbedNode2=_interopRequireDefault(_YoutubeEmbedNode);var _YoutubeEmbedComponent=__webpack_require__(63);var _YoutubeEmbedComponent2=_interopRequireDefault(_YoutubeEmbedComponent);var _YoutubeEmbedConverter=__webpack_require__(64);var _YoutubeEmbedConverter2=_interopRequireDefault(_YoutubeEmbedConverter);var _YoutubeEmbedMacro=__webpack_require__(65);var _YoutubeEmbedMacro2=_interopRequireDefault(_YoutubeEmbedMacro);var _YoutubeEmbedValidation=__webpack_require__(66);var _YoutubeEmbedValidation2=_interopRequireDefault(_YoutubeEmbedValidation);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.youtubeembed",name:"youtubeembed",configure:function configure(config){config.addConverter("newsml",_YoutubeEmbedConverter2.default);config.addComponent("youtubeembed",_YoutubeEmbedComponent2.default);config.addValidator(_YoutubeEmbedValidation2.default);config.addCommand("youtubeembed",_YoutubeEmbedCommand2.default);config.addNode(_YoutubeEmbedNode2.default);config.addMacro(_YoutubeEmbedMacro2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertEmbed=__webpack_require__(61);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class YoutubeEmbedCommand extends _writer.WriterCommand{execute(params){if(params.isPaste){const currentNode=params.selection.getPath();if(!currentNode){return false}const currentNodeId=currentNode[0];const previousNode=_writer.api.document.getPreviousNode(currentNodeId);_writer.api.document.deleteNode("youtubeembed",previousNode)}params.editorSession.transaction(tx=>{(0,_insertEmbed2.default)(tx,params.url)});return true}}exports.default=YoutubeEmbedCommand},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=insertEmbed;function insertEmbed(tx,embedUrl){tx.insertBlockNode({type:"youtubeembed",dataType:"x-im/youtube",url:embedUrl})}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class YoutubeEmbedNode extends _substance.BlockNode{fetchPayload(context,cb){let url=this.url;var baseUrl="https://youtube.com/oembed?url=";var apiUrl=baseUrl+this.url;_writer.api.router.get("/api/resourceproxy/",{url:apiUrl}).then(response=>response.json()).then(json=>{cb(null,{html:json.html,uri:url,thumbnail_url:json.thumbnail_url,title:json.title},{history:false})}).catch(e=>{cb(e)})}hasPayload(){return Boolean(this.html)}}YoutubeEmbedNode.isResource=true;YoutubeEmbedNode.define({type:"youtubeembed",dataType:"string",url:"string",start:{type:"string",default:"00:00"},errorMessage:{type:"string",optional:true},html:{type:"string",optional:true},thumbnail_url:{type:"string",default:""},uri:{type:"string",optional:true},linkType:{type:"string",optional:true},title:{type:"string",default:""}});exports.default=YoutubeEmbedNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class YoutubeEmbedComponent extends _substance.Component{constructor(...args){super(...args);_writer.api.document.triggerFetchResourceNode(this.props.node,{history:false})}didMount(){_writer.api.editorSession.onRender("document",this.rerender,this,{path:[this.props.node.id]})}dispose(){_writer.api.editorSession.off(this)}render($$){const el=$$("div").addClass("im-blocknode__container im-youtube");el.append(this.renderHeader($$));el.append(this.renderContent($$));return el}renderContent($$){const content=$$("div").addClass("im-blocknode__content full-width");const thumbnail=$$("img").attr("src",this.props.node.thumbnail_url).attr("style","width:100%");const startTimeEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"start"],doc:this.props.doc}).ref("startTime").addClass("start-time-editor");content.append(thumbnail);content.append($$(_substance.FontAwesomeIcon,{icon:"fa-clock-o"}));content.append(startTimeEditor);return content}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-youtube"}),$$("strong").append(this.getLabel("Youtube video")+" - "+this.props.node.title)]).addClass("header")}}exports.default=YoutubeEmbedComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"youtubeembed",tagName:"object",matchElement:function matchElement(el){return el.is('object[type="x-im/youtube"]')},import:function _import(el,node){node.dataType=el.attr("type");node.url=el.attr("url");node.uri=el.attr("uri");const startTimeEl=el.find("data > start");let startTimeFromEl=0;if(startTimeEl){startTimeFromEl=startTimeEl.text()}const startTime=_writer.moment.duration(parseInt(startTimeFromEl,10),"seconds");node.start=startTime.minutes()+":"+startTime.seconds()},export:function _export(node,el,converter){const $$=converter.$$;el.attr({id:node.id,type:node.dataType,url:node.url,uri:node.uri});let seconds;if(node.start&&node.start.indexOf(":")>-1){const startTime=node.start.split(":");seconds=parseInt(startTime[0],10)*60+parseInt(startTime[1],10)}else{seconds=node.start}const data=$$("data");data.append($$("start").append(seconds));el.removeAttr("data-id");el.append(data)}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={execute:function execute(params,context){let editorSession=context.editorSession;let text=params.text;if(!params.action==="break")return;let match=/^\s*(https?:\/\/([^\s]+))\s*$/.exec(text);if(!match)return;let url=match[1];if(url.indexOf("youtube")>0){editorSession.executeCommand("youtubeembed",{url:url,isPaste:true});return true}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class YoutubeEmbedValidation extends _writer.Validator{constructor(...args){super(...args)}validate(){const youtubeItems=this.newsItem.querySelectorAll('object[type="x-im/youtube"]');Array.prototype.forEach.call(youtubeItems,item=>{const startEl=item.querySelector("start");const time=parseInt(startEl.textContent,10);if(!Number.isInteger(time)){this.addWarning(_writer.api.getLabel("Youtube video has a invalid start time"))}})}}exports.default=YoutubeEmbedValidation},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _HistoryPackage=__webpack_require__(68);var _HistoryPackage2=_interopRequireDefault(_HistoryPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_HistoryPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(69);var _HistoryMainComponent=__webpack_require__(71);var _HistoryMainComponent2=_interopRequireDefault(_HistoryMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.history",name:"history",configure:function configure(config){config.addLabel("history-popover-headline",{en:"Changes since last successful save",sv:"Senaste ändringar"});config.addLabel("history-popover-description",{en:"Changes since last successful save",sv:"Ändringar sedan senast lyckade uppdatering till servern."});config.addPopover("historymaincomponent",{icon:"fa-history",align:"right"},_HistoryMainComponent2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _VersionSelectorDialog=__webpack_require__(72);var _VersionSelectorDialog2=_interopRequireDefault(_VersionSelectorDialog);var _HistoryItemComponent=__webpack_require__(74);var _HistoryItemComponent2=_interopRequireDefault(_HistoryItemComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class HistoryMainComponent extends _substance.Component{constructor(...args){super(...args);_writer.api.events.on("history",_writer.event.DOCUMENT_SAVED,()=>{_writer.api.history.deleteHistory(_writer.api.newsItem.getIdForArticle())});_writer.api.events.on("history",_writer.event.HISTORY_SAVED,()=>{this.updateHistoryState()});_writer.api.events.on("history",_writer.event.HISTORY_CLEARED,()=>{this.updateHistoryState()})}dispose(){_writer.api.events.off("history","document:saved");_writer.api.events.off("history","history:added");_writer.api.events.off("history","history:saved")}didMount(){var historyArticles=_writer.api.history.getHistory();var unsavedArticles=historyArticles.filter(function(history){return history.unsavedArticle===true});let buttonText="No thanks, create a new article";let description="We've found some unsaved articles. Click on the version you would like to restore";let title="Unsaved articles found";let historyForArticle=_writer.api.history.get(_writer.api.newsItem.getIdForArticle());if(historyForArticle&&historyForArticle.versions&&historyForArticle.versions.length>0&&_writer.api.newsItem.hasTemporaryId()){return}else if(!_writer.api.newsItem.hasTemporaryId()&&historyForArticle.versions.length>0){unsavedArticles=[historyForArticle];buttonText="Continue with last saved version";description="We found some unsaved changes for this article.";title="Unsaved changes found for this article"}else if(!_writer.api.newsItem.hasTemporaryId()&&historyForArticle.versions.length===0){return}else if(unsavedArticles.length===0){return}if(_writer.api.document.getDocumentStatus()==="writerHasNoDocument"){_writer.api.ui.showDialog(_VersionSelectorDialog2.default,{unsavedArticles:unsavedArticles,descriptionText:description,applyVersion:this.applyVersion.bind(this)},{global:true,secondary:false,primary:this.getLabel(buttonText),title:this.getLabel(title)})}}updateHistoryState(){let id=this.context.api.newsItem.getIdForArticle();this.setState({historyForArticle:this.context.api.history.get(id)})}getInitialState(){let id=this.context.api.newsItem.getIdForArticle();return{historyForArticle:this.context.api.history.get(id)}}render($$){var el=$$("div").addClass("imc-history light").append($$("h2").append(this.getLabel("history-popover-headline")));el.append($$("p").append(this.getLabel("history-popover-description")));if(this.state.historyForArticle===false){return el}const scrollpane=_writer.api.ui.getComponent("scroll-pane");const scroll=$$(scrollpane,{scrollbarType:"native"});let versions=this.state.historyForArticle.versions.reverse().slice(0,100).map(function(version){return this.renderHistoryItem($$,version,this.state.historyForArticle)}.bind(this));scroll.append(versions);el.append(scroll);var historyArticles=this.context.api.history.getHistory();var unsavedArticles=historyArticles.filter(function(history){return history.unsavedArticle===true});if(this.context.api.newsItem.hasTemporaryId()){el.append(this.renderSeeAllUnsavedLink($$,unsavedArticles))}return el}renderSeeAllUnsavedLink($$,unsavedArticles){return $$("a").addClass("all-unsaved-articles").append(this.getLabel("See all other unsaved articles")).on("click",()=>{this.context.api.ui.showDialog(_VersionSelectorDialog2.default,{unsavedArticles:unsavedArticles,descriptionText:this.getLabel("We've found some unsaved articles. Click on the version you would like to restore"),applyVersion:this.applyVersion.bind(this)},{global:true,secondary:false,title:this.getLabel("Following unsaved articles found")})})}renderHistoryItem($$,version,article){return $$(_HistoryItemComponent2.default,{version:version,article:article,applyVersion:this.applyVersion.bind(this)})}applyVersion(version,article){_writer.api.newsItem.setTemporaryId(article.id);_writer.api.events.documentIsUnsaved();_writer.api.newsItem.setSource(version.src,null,true)}}exports.default=HistoryMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _ArticleItem=__webpack_require__(73);var _ArticleItem2=_interopRequireDefault(_ArticleItem);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class VersionSelectorDialog extends _substance.Component{render($$){const el=$$("div").addClass("restore-history-dialog");const unsavedArticles=this.props.unsavedArticles;el.append($$("p").append(this.getLabel(this.props.descriptionText)));let versions=unsavedArticles.map(article=>{return $$(_ArticleItem2.default,{article:article,applyVersion:this.applyVersion.bind(this)})});el.append(versions);return el}applyVersion(version,article){this.props.applyVersion(version,article)}onClose(status){if("cancel"===status){return true}return true}}exports.default=VersionSelectorDialog},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _HistoryItemComponent=__webpack_require__(74);var _HistoryItemComponent2=_interopRequireDefault(_HistoryItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ArticleItem extends _substance.Component{render($$){let el=$$("div").addClass("history-article");let article=this.props.article;const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("icon-delete").attr("title",this.getLabel("Ignore and clear history"))).on("click",function(){this.context.api.history.deleteHistory(article.id);this.remove()}.bind(this));el.append(deleteButton);let title=article.id;el.append($$("h4").append(title));let versions=article.versions.slice(0,100).map(function(version){return this.renderHistoryItem($$,version,article)}.bind(this));el.append(versions);return el}renderHistoryItem($$,version,article){return $$(_HistoryItemComponent2.default,{version:version,article:article,applyVersion:this.props.applyVersion.bind(this)})}}exports.default=ArticleItem},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class HistoryItemComponent extends _substance.Component{render($$){var version=this.props.version;var icon,title;if(this.context.api.newsItemArticle.firstElementChild.outerHTML===version.src){icon="fa fa-check";title=this.getLabel("Identical with the active version")}else{icon="fa fa-file-text-o"}var outer=$$("div").addClass("history-version-item light").append($$("i").addClass(icon).attr("title",title)).on("click",()=>{this.props.applyVersion(version,this.props.article)});var inner=$$("div");inner.append($$("span").append((0,_writer.moment)(version.time).from()));if(version.action==="saved"){inner.addClass("saved")}outer.append(inner);return outer}}exports.default=HistoryItemComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(76);var _HeaderEditorNode=__webpack_require__(78);var _HeaderEditorNode2=_interopRequireDefault(_HeaderEditorNode);var _HeaderEditorComponent=__webpack_require__(79);var _HeaderEditorComponent2=_interopRequireDefault(_HeaderEditorComponent);var _HeaderEditorConverter=__webpack_require__(80);var _HeaderEditorConverter2=_interopRequireDefault(_HeaderEditorConverter);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const HeaderEditorPackage={id:"se.infomaker.headereditor",name:"headereditor",configure:config=>{config.addNode(_HeaderEditorNode2.default);config.addConverter("newsml",_HeaderEditorConverter2.default);config.addTextEditComponent(_HeaderEditorNode2.default.type,_HeaderEditorComponent2.default,{display:"top"});config.addLabel("leadin",{en:"Leadin",sv:"Ingress"})}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(HeaderEditorPackage)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class HeaderEditorNode extends _substance.DocumentNode{}HeaderEditorNode.type="headereditor";HeaderEditorNode.define({headline:"text",dateline:"text",leadin:"text"});exports.default=HeaderEditorNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class HeaderEditorComponent extends _substance.Component{constructor(...args){super(...args);this.context.editorSession.onUpdate(editorSession=>{const surface=editorSession.getFocusedSurface();if(surface){const icons=this.el.findAll(".fa");if(surface.name!=="body"){icons.forEach(icons=>{icons.addClass("active")})}else{icons.forEach(icons=>{icons.removeClass("active")})}}},this)}render($$){const el=$$("div").addClass("sc-np-headereditor");const headerGroupFields=_writer.api.getConfigValue("se.infomaker.headereditor","elements")||["headline","leadin"];const fields=headerGroupFields.map(function(field){return this.getElement($$,field)}.bind(this));el.append(fields);return el}getElement($$,field){switch(field){case"headline":return this.getElementForField($$,field,"fa-header");case"leadin":return this.getElementForField($$,field,"fa-paragraph");default:return this.getElementForField($$,field,"fa-paragraph")}}getElementForField($$,field,fieldIcon){const el=$$("span").addClass("sc-metdata-text__container").attr({contenteditable:false,title:_writer.api.getLabel(field)});el.append($$(_substance.FontAwesomeIcon,{icon:fieldIcon}).attr({contenteditable:false}));el.append($$(_substance.TextPropertyEditor,{name:field,tagName:"div",commands:this.props.headlineCommands,withoutBreak:false,path:[this.props.node.id,field]}).addClass("se-"+field));return el}}exports.default=HeaderEditorComponent},function(module,exports){"use strict";module.exports={type:"headereditor",tagName:"group",matchElement:function matchElement(el){const headlineElement=el.find('group[type="header"] > element[type="headline"]');const leadinElement=el.find('group[type="header"] > element[type="leadin"]');if(headlineElement||leadinElement){return true}},findElementForType:function findElementForType(el,type){return el.find('element[type="'+type+'"]')},getDefaultFields:function getDefaultFields(){return["headline","leadin"]},import:function _import(el,node,converter){let oldPreserveValue;oldPreserveValue=converter.state.preserveWhitespace;node.id="headereditor";const api=converter.context.api;const headerFields=api.getConfigValue("se.infomaker.headereditor","elements")||this.getDefaultFields();headerFields.forEach(field=>{var element=this.findElementForType(el,field);if(element){converter.state.preserveWhitespace=true;node[field]=converter.annotatedText(element,["headereditor",field])}});converter.state.preserveWhitespace=oldPreserveValue},export:function _export(node,el,converter){const $$=converter.$$;el.attr("type","header");const api=converter.context.api;const headerFields=api.getConfigValue("se.infomaker.headereditor","elements")||this.getDefaultFields();const elements=headerFields.map(function(field){if(node.hasOwnProperty(field)){return $$("element").attr("type",field).attr("id","group-header-"+field).append(converter.annotatedText([node.id,field]))}else{console.error("Field "+field+" not supported");return null}});el.append(elements)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(82);var _XimpdfPackage=__webpack_require__(84);var _XimpdfPackage2=_interopRequireDefault(_XimpdfPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_XimpdfPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimpdfComponent=__webpack_require__(85);var _XimpdfComponent2=_interopRequireDefault(_XimpdfComponent);var _XimpdfConverter=__webpack_require__(86);var _XimpdfConverter2=_interopRequireDefault(_XimpdfConverter);var _Ximpdf=__webpack_require__(87);var _Ximpdf2=_interopRequireDefault(_Ximpdf);var _XimpdfFileNode=__webpack_require__(88);var _XimpdfFileNode2=_interopRequireDefault(_XimpdfFileNode);var _InsertPdfsTool=__webpack_require__(89);var _InsertPdfsTool2=_interopRequireDefault(_InsertPdfsTool);var _InsertPdfsCommand=__webpack_require__(90);var _InsertPdfsCommand2=_interopRequireDefault(_InsertPdfsCommand);var _DropPdfFile=__webpack_require__(92);var _DropPdfFile2=_interopRequireDefault(_DropPdfFile);var _DropPdfUri=__webpack_require__(93);var _DropPdfUri2=_interopRequireDefault(_DropPdfUri);var _XimpdfMacro=__webpack_require__(94);var _XimpdfMacro2=_interopRequireDefault(_XimpdfMacro);var _XimpdfFileProxy=__webpack_require__(95);var _XimpdfFileProxy2=_interopRequireDefault(_XimpdfFileProxy);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"ximpdf",id:"se.infomaker.ximpdf",configure:function configure(config){config.addNode(_Ximpdf2.default);config.addComponent(_Ximpdf2.default.type,_XimpdfComponent2.default);config.addConverter("newsml",_XimpdfConverter2.default);config.addContentMenuTopTool("insert-pdfs",_InsertPdfsTool2.default);config.addCommand("insert-pdfs",_InsertPdfsCommand2.default);config.addNode(_XimpdfFileNode2.default);config.addDragAndDrop(_DropPdfFile2.default);config.addDragAndDrop(_DropPdfUri2.default);config.addMacro(_XimpdfMacro2.default);config.addFileProxy(_XimpdfFileProxy2.default);config.addLabel("Insert PDF document",{en:"Insert PDF document",sv:"Infoga PDF dokument"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimpdfComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){this.context.editorSession.off(this)}_onDocumentChange(change){if(change.isAffected(this.props.node.id)||change.isAffected(this.props.node.pdfFile)){this.rerender()}}render($$){const doc=_writer.api.doc;const node=this.props.node;const fileNode=doc.get(node.pdfFile);const el=$$("div").addClass("im-blocknode__container ximpdf__container");const textEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"text"],doc:this.props.doc}).ref("text").addClass("im-blocknode__content");const loadingSpan=$$("span").append("Loading...").addClass("text-pdf");if(fileNode.uuid){el.append([this.renderHeader($$,fileNode),textEditor])}else{el.append([this.renderHeader($$,fileNode),loadingSpan])}return el}renderContent($$){const content=$$("div").addClass("im-blocknode__content");const link=$$("a").append(this.props.node.label).attr("href","#"+this.props.node.uuid).attr("target","_blank").on("click",function(evt){evt.stopPropagation()});content.append(link);return content}renderHeader($$,fileNode){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-file-pdf-o"}),$$("a").append(this.getLabel("Portable Document Format")).attr("contenteditable",false).attr("href",fileNode.url).addClass("pdf-link").attr("target","_blank").on("click",function(evt){evt.stopPropagation()})]).addClass("header").attr("contenteditable",false)}}exports.default=XimpdfComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"ximpdf",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/pdf"},import:function _import(el,node,converter){let linkEl=el.find("links>link");let pdfFile={id:(0,_writer.idGenerator)(),type:"npfile",imType:"x-im/pdf",parentNodeId:node.id};if(el.attr("uuid")){pdfFile.uuid=el.attr("uuid")}if(linkEl.attr("uri")){pdfFile.uri=linkEl.attr("uri")}if(linkEl.attr("url")){pdfFile.url=linkEl.attr("url")}converter.createNode(pdfFile);node.pdfFile=pdfFile.id;node.uri=pdfFile.uri;node.uuid=pdfFile.uuid;let dataEl=linkEl.find("data");if(dataEl){dataEl.children.forEach(function(child){if(child.tagName==="text"){node.text=converter.annotatedText(child,[node.id,"text"])}})}},export:function _export(node,el,converter){const $$=converter.$$;const fileNode=node.document.get(node.pdfFile);el.removeAttr("data-id");el.attr({id:node.id,type:"x-im/pdf"});const data=$$("data").append([$$("text").append(converter.annotatedText([node.id,"text"]))]);el.attr("uuid",fileNode.uuid);const link=$$("link").attr({rel:"self",type:"x-im/pdf",uri:node.uri?node.uri:"",uuid:fileNode.uuid?fileNode.uuid:_writer.NilUUID.getNilUUID()}).append(data);el.append($$("links").append(link))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class Ximpdf extends _substance.BlockNode{getPdfFile(){if(this.pdfFile){return this.document.get(this.pdfFile)}}getUrl(){let pdfFile=this.getPdfFile();if(pdfFile){return pdfFile.getUrl();
}}handleDOMDocument(newsItemDOMDocument){const document=newsItemDOMDocument.documentElement;const uri=document.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]').getAttribute("value");let text=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > text');const objectName=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > objectName');if(text){text=text.textContent}else if(objectName){text=objectName.textContent}else{text=document.querySelector("itemMeta > fileName").textContent}_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"uri"],uri);tx.set([this.id,"text"],text)},{history:false})}}Ximpdf.define({type:"ximpdf",pdfFile:{type:"file"},uri:{type:"string",optional:true},text:{type:"string",optional:true}});exports.default=Ximpdf},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimpdfFileNode extends _substance.FileNode{constructor(...args){super(...args)}handleDocument(xmlString){return new Promise((resolve,reject)=>{try{let doc=_writer.api.editorSession.getDocument();if(!doc.get(this.pdfNodeId)){return resolve()}const parser=new DOMParser;let newsItemDOM=parser.parseFromString(xmlString,"text/xml");let document=newsItemDOM.documentElement;let uuid=document.getAttribute("guid");const uri=document.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]').getAttribute("value");let text=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > text');let objectName=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > objectName');if(text){text=text.textContent}else if(objectName){text=objectName.textContent}else{text=document.querySelector("itemMeta > fileName").textContent}_writer.api.editorSession.transaction(tx=>{tx.set([this.pdfNodeId,"uri"],uri);tx.set([this.pdfNodeId,"text"],text)},{history:false});this.uuid=uuid;resolve()}catch(e){reject(e)}})}getImType(){return"x-im/pdf"}}XimpdfFileNode.define({type:"ximpdffile",pdfNodeId:{type:"string",optional:false},uuid:{type:"string",optional:true},url:{type:"string",optional:true},sourceFile:{type:"object",optional:true},sourceUrl:{type:"string",optional:true}});exports.default=XimpdfFileNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class XimpdfsTool extends _substance.Tool{render($$){var el=$$("div");el.attr("title",this.getLabel("Insert PDF document"));el.append($$("button").addClass("se-tool").append($$("i").addClass("fa fa-file-pdf-o")).on("click",this.triggerFileDialog));el.append($$("input").attr("type","file").attr("multiple","multiple").attr("id","x-im-pdf-fileupload").ref("x-im-pdf-fileupload").on("change",this.triggerFileUpload));return el}triggerFileDialog(){var evt=document.createEvent("MouseEvents");evt.initEvent("click",true,false);this.refs["x-im-pdf-fileupload"].el.el.dispatchEvent(evt)}triggerFileUpload(ev){this.context.editorSession.executeCommand("insert-pdfs",{files:ev.target.files})}}exports.default=XimpdfsTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _InsertPdfCommand=__webpack_require__(91);var _InsertPdfCommand2=_interopRequireDefault(_InsertPdfCommand);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class XimpdfCommand extends _writer.WriterCommand{execute(params){if(typeof params.files==="string"){params.editorSession.transaction(tx=>{(0,_InsertPdfCommand2.default)(tx,params.files)})}else{params.editorSession.transaction(tx=>{Array.prototype.forEach.call(params.files,file=>{(0,_InsertPdfCommand2.default)(tx,file)})})}_writer.api.editorSession.fileManager.sync();return true}}exports.default=XimpdfCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(tx,data){const parentNodeId=(0,_writer.idGenerator)();const pdfFileNode={type:"npfile",parentNodeId:parentNodeId,imType:"x-im/pdf"};let isFile=data instanceof File;if(isFile){pdfFileNode["sourceFile"]=data}else if(typeof data==="string"){pdfFileNode["sourceUrl"]=data}else{throw new Error("Unsupported data. Must be File or String")}let pdfFile=tx.create(pdfFileNode);tx.insertBlockNode({id:parentNodeId,type:"ximpdf",pdfFile:pdfFile.id})};var _writer=__webpack_require__(16)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _InsertPdfCommand=__webpack_require__(91);var _InsertPdfCommand2=_interopRequireDefault(_InsertPdfCommand);var _substance=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropPdfFile extends _substance.DragAndDropHandler{match(params){return params.type==="file"&&params.file.type==="application/pdf"}drop(tx,params){(0,_InsertPdfCommand2.default)(tx,params.file);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}exports.default=DropPdfFile},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _InsertPdfCommand=__webpack_require__(91);var _InsertPdfCommand2=_interopRequireDefault(_InsertPdfCommand);var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropPdfUri extends _substance.DragAndDropHandler{match(params){return params.type==="uri"&&_isImage(params.uri)}drop(tx,params){(0,_InsertPdfCommand2.default)(tx,params.uri);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}function _isImage(uri){return uri.indexOf(".pdf")>0}exports.default=DropPdfUri},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={execute:function execute(params,context){let editorSession=context.editorSession;let text=params.text;if(!params.action==="break"){return}let match=/^\s*(https?:\/\/([^\s]+))\s*$/.exec(text);if(!match){return}let url=match[1];let hasMatch=false;if(url.indexOf(".pdf")>0){hasMatch=true}if(hasMatch){editorSession.executeCommand("insert-pdfs",{files:text});return true}return false}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimpdfFileProxy extends _writer.NPFileProxy{}XimpdfFileProxy.match=function(fileNode){return fileNode.imType==="x-im/pdf"};exports.default=XimpdfFileProxy},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _Headline=__webpack_require__(97);var _Headline2=_interopRequireDefault(_Headline);var _HeadlineComponent=__webpack_require__(100);var _HeadlineComponent2=_interopRequireDefault(_HeadlineComponent);var _HeadlineConverter=__webpack_require__(101);var _HeadlineConverter2=_interopRequireDefault(_HeadlineConverter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const headlinePackage={id:"se.infomaker.headline",name:"headline",configure:function configure(config){config.addNode(_Headline2.default);config.addComponent(_Headline2.default.type,_HeadlineComponent2.default);config.addConverter("newsml",_HeadlineConverter2.default);config.addTextType({name:"headline",data:{type:"headline"}});const headlineLbl={en:"Headline",de:"Headline",sv:"Rubrik"};config.addLabel("headline.content",headlineLbl);config.addLabel("headline",headlineLbl)}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(headlinePackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(98);var _substance=__webpack_require__(14);class Headline extends _substance.TextBlock{}Headline.type="headline";exports.default=Headline},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class HeadlineComponent extends _substance.Component{render($$){return $$("div").addClass("sc-headline").attr("data-id",this.props.node.id).append($$(_substance.TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=HeadlineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"headline",tagName:"element",matchElement:function matchElement(el){return el.is('element[type="headline"]')},import:function _import(el,node,converter){var state=converter.state;var oldValue=state.trimWhitespaces;state.trimWhitespaces=true;node.content=converter.annotatedText(el,[node.id,"content"]);state.trimWhitespaces=oldValue},export:function _export(node,el,converter){return el.attr("type","headline").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(103);var _PreamblePackage=__webpack_require__(105);var _PreamblePackage2=_interopRequireDefault(_PreamblePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PreamblePackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PreambleComponent=__webpack_require__(106);var _PreambleComponent2=_interopRequireDefault(_PreambleComponent);var _PreambleConverter=__webpack_require__(107);var _PreambleConverter2=_interopRequireDefault(_PreambleConverter);var _PreambleNode=__webpack_require__(108);var _PreambleNode2=_interopRequireDefault(_PreambleNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"preamble",id:"se.infomaker.preamble",configure:function configure(config){_PreambleNode2.default.type=this.name;_PreambleConverter2.default.type=_PreambleNode2.default.type;_PreambleConverter2.default.element=_PreambleNode2.default.type;config.addNode(_PreambleNode2.default);config.addComponent(_PreambleNode2.default.type,_PreambleComponent2.default);config.addConverter("newsml",_PreambleConverter2.default);config.addTextType({name:this.name,data:{type:_PreambleNode2.default.type}});config.addLabel("preamble",{en:"Preamble",sv:"Ingress"});config.addLabel("preamble.content",{en:"Preamble",sv:"Ingress"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class PreambleComponent extends Component{render($$){return $$("div").addClass("sc-preamble").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=PreambleComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="preamble"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","preamble").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class PreambleNode extends TextBlock{}PreambleNode.define({id:{type:"string"}});exports.default=PreambleNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _Subheadline=__webpack_require__(110);var _Subheadline2=_interopRequireDefault(_Subheadline);var _SubheadlineComponent=__webpack_require__(113);var _SubheadlineComponent2=_interopRequireDefault(_SubheadlineComponent);var _SubheadlineConverter=__webpack_require__(114);var _SubheadlineConverter2=_interopRequireDefault(_SubheadlineConverter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const subheadlinePackage={id:"se.infomaker.subheadline",name:"subheadline",configure:function configure(config){config.addNode(_Subheadline2.default);config.addComponent(_Subheadline2.default.type,_SubheadlineComponent2.default);config.addConverter("newsml",_SubheadlineConverter2.default);config.addTextType({name:"subheadline",data:{type:"subheadline"}});config.addLabel("subheadline",{en:"Subheadline",de:"Subheadline",sv:"Underrubrik"});config.addLabel("subheadline.content",{en:"Subheadline",de:"Subheadline",sv:"Underrubrikrik"})}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(subheadlinePackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(111);var _substance=__webpack_require__(14);class Subheadline extends _substance.TextBlock{}Subheadline.type="subheadline";Subheadline.define({level:{type:"number",default:1},contentType:{type:"string",optional:true},format:{type:"string",default:"html"}});exports.default=Subheadline},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class SubheadlineComponent extends _substance.Component{render($$){let node=this.props.node;return $$("div").addClass("sc-subheadline sc-level-"+node.level).attr("data-id",node.id).append($$(_substance.TextPropertyComponent,{path:[node.id,"content"]}))}}exports.default=SubheadlineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"subheadline",tagName:"element",matchElement:function matchElement(el){return/subheadline\d$/.exec(el.attr("type"))},import:function _import(el,node,converter){var state=converter.state;var oldValue=state.trimWhitespaces;state.trimWhitespaces=true;node.content=converter.annotatedText(el,[node.id,"content"]);node.level=parseInt(String(el.attr("type")[11]),10);state.trimWhitespaces=oldValue},export:function _export(node,el,converter){el.attr({type:node.contentType,format:node.format});return el.attr("type","subheadline"+node.level).append(converter.annotatedText([node.id,"content"]))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _Paragraph=__webpack_require__(116);var _Paragraph2=_interopRequireDefault(_Paragraph);var _ParagraphComponent=__webpack_require__(119);var _ParagraphComponent2=_interopRequireDefault(_ParagraphComponent);var _ParagraphConverter=__webpack_require__(120);var _ParagraphConverter2=_interopRequireDefault(_ParagraphConverter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const paragraphPackage={id:"se.infomaker.paragraph",name:"paragraph",configure:function configure(config){config.addNode(_Paragraph2.default);config.addComponent(_Paragraph2.default.type,_ParagraphComponent2.default);config.addConverter("newsml",_ParagraphConverter2.default);config.addTextType({name:"paragraph",data:{type:"paragraph"}});config.addLabel("paragraph",{en:"Paragraph",de:"Paragraph"});config.addLabel("paragraph.content",{en:"Paragraph",de:"Paragraph"})}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(paragraphPackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(117);var _substance=__webpack_require__(14);class Paragraph extends _substance.TextBlock{}Paragraph.type="paragraph";exports.default=Paragraph},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class ParagraphComponent extends _substance.Component{render($$){return $$("div").addClass("sc-paragraph").attr("data-id",this.props.node.id).append($$(_substance.TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=ParagraphComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"paragraph",tagName:"element",matchElement:function matchElement(el){return el.is('element[type="body"]')||el.is('element[type="paragraph"]')},import:function _import(el,node,converter){var state=converter.state;var oldValue=state.trimWhitespaces;state.trimWhitespaces=true;node.content=converter.annotatedText(el,[node.id,"content"]);state.trimWhitespaces=oldValue},export:function _export(node,el,converter){el.attr("type","body").append(converter.annotatedText([node.id,"content"]))}}}]);(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)})([function(module,exports,__webpack_require__){"use strict";var _index=__webpack_require__(121);var _index2=_interopRequireDefault(_index);var _index3=__webpack_require__(1);var _index4=_interopRequireDefault(_index3);var _index5=__webpack_require__(9);var _index6=_interopRequireDefault(_index5);var _index7=__webpack_require__(126);var _index8=_interopRequireDefault(_index7);var _index9=__webpack_require__(23);var _index10=_interopRequireDefault(_index9);var _index11=__webpack_require__(34);var _index12=_interopRequireDefault(_index11);var _index13=__webpack_require__(131);var _index14=_interopRequireDefault(_index13);var _index15=__webpack_require__(153);var _index16=_interopRequireDefault(_index15);var _index17=__webpack_require__(56);var _index18=_interopRequireDefault(_index17);var _index19=__webpack_require__(164);var _index20=_interopRequireDefault(_index19);var _index21=__webpack_require__(67);var _index22=_interopRequireDefault(_index21);var _index23=__webpack_require__(177);var _index24=_interopRequireDefault(_index23);var _index25=__webpack_require__(182);var _index26=_interopRequireDefault(_index25);var _index27=__webpack_require__(187);var _index28=_interopRequireDefault(_index27);var _index29=__webpack_require__(201);var _index30=_interopRequireDefault(_index29);var _DefaultvalidationPackage=__webpack_require__(214);var _DefaultvalidationPackage2=_interopRequireDefault(_DefaultvalidationPackage);var _HeaderEditorPackage=__webpack_require__(75);var _HeaderEditorPackage2=_interopRequireDefault(_HeaderEditorPackage);var _index31=__webpack_require__(81);var _index32=_interopRequireDefault(_index31);var _index33=__webpack_require__(216);var _index34=_interopRequireDefault(_index33);var _index35=__webpack_require__(223);var _index36=_interopRequireDefault(_index35);var _index37=__webpack_require__(232);var _index38=_interopRequireDefault(_index37);var _index39=__webpack_require__(240);var _index40=_interopRequireDefault(_index39);var _index41=__webpack_require__(247);var _index42=_interopRequireDefault(_index41);var _Drophead=__webpack_require__(252);var _Drophead2=_interopRequireDefault(_Drophead);var _Pagedateline=__webpack_require__(259);var _Pagedateline2=_interopRequireDefault(_Pagedateline);var _Dateline=__webpack_require__(266);var _Dateline2=_interopRequireDefault(_Dateline);var _Preleadin=__webpack_require__(273);var _Preleadin2=_interopRequireDefault(_Preleadin);var _Madmansrow=__webpack_require__(280);var _Madmansrow2=_interopRequireDefault(_Madmansrow);var _Preamble=__webpack_require__(102);var _Preamble2=_interopRequireDefault(_Preamble);var _BlockquotePackage=__webpack_require__(287);var _BlockquotePackage2=_interopRequireDefault(_BlockquotePackage);var _ParagraphPackage=__webpack_require__(115);var _ParagraphPackage2=_interopRequireDefault(_ParagraphPackage);var _SubheadlinePackage=__webpack_require__(109);var _SubheadlinePackage2=_interopRequireDefault(_SubheadlinePackage);var _HeadlinePackage=__webpack_require__(96);var _HeadlinePackage2=_interopRequireDefault(_HeadlinePackage);var _HtmlembedPackage=__webpack_require__(293);var _HtmlembedPackage2=_interopRequireDefault(_HtmlembedPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(()=>{(0,_index14.default)("position");(0,_index14.default)("polygon");(0,_index2.default)();(0,_index12.default)();(0,_index6.default)();(0,_index10.default)();(0,_index4.default)();(0,_index8.default)();(0,_HeaderEditorPackage2.default)();(0,_index16.default)();(0,_index18.default)();(0,_index20.default)();(0,_index22.default)();(0,_index32.default)();(0,_DefaultvalidationPackage2.default)();(0,_index24.default)();(0,_index26.default)();(0,_index34.default)();(0,_index36.default)();(0,_index28.default)();(0,_index30.default)();(0,_index38.default)();(0,_index40.default)();(0,_index42.default)();(0,_BlockquotePackage2.default)();(0,_ParagraphPackage2.default)();(0,_HeadlinePackage2.default)();(0,_SubheadlinePackage2.default)();(0,_Preleadin2.default)();(0,_Preamble2.default)();(0,_Dateline2.default)();(0,_Pagedateline2.default)();(0,_Drophead2.default)();(0,_Madmansrow2.default)();(0,_HtmlembedPackage2.default)()})()},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowPackage=__webpack_require__(2);var _PublishFlowPackage2=_interopRequireDefault(_PublishFlowPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PublishFlowPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowComponent=__webpack_require__(3);var _PublishFlowComponent2=_interopRequireDefault(_PublishFlowComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"publishflow",id:"se.infomaker.publishflow",index:100,configure:function configure(config){config.addPopover(this.id+"_1",{icon:"fa-ellipsis-h",button:"Save",align:"right"},_PublishFlowComponent2.default);config.addLabel("Save",{sv:"Spara"});config.addLabel("Save *",{sv:"Spara *"});config.addLabel("Cancel",{sv:"Avbryt"});config.addLabel("Publish article?",{sv:"Publicera artikeln?"});config.addLabel("This article is currently an unpublished draft",{sv:"Den här artikeln är ett ej publicerat utkast"});config.addLabel("Article is currently pending approval",{sv:"Artikeln väntar på godkännande"});config.addLabel("Scheduled",{sv:"Schemalagd"});config.addLabel("Article is scheduled to be published",{sv:"Artiklen är schemalagd för publicering"});config.addLabel("From",{sv:"Från"});config.addLabel("To",{sv:"Till"});config.addLabel("Republish article?",{sv:"Ompublicera artikeln?"});config.addLabel("Article was published",{sv:"Artikeln publicerades"});config.addLabel("Publish article again?",{sv:"Publicera artikeln igen?"});config.addLabel("Article has been canceled and is no longer published",{sv:"Artikeln har blivit avpublicerad och är ej längre publicerad"});config.addLabel("Unknown state",{sv:"Okänd status"});config.addLabel("This article has an unknown, unsupported, status",{sv:"Artikeln har en okänd eller felaktig status"});config.addLabel("Save as draft",{sv:"Spara som utkast"});config.addLabel("Ready for approval",{sv:"Klar för godkännande"});config.addLabel("Schedule for publish",{sv:"Schemalägg publicering"});config.addLabel("Republish article",{sv:"Ompublicera artikeln"});config.addLabel("Publish article",{sv:"Publicera artikeln"});config.addLabel("Unpublish article",{sv:"Avpublicera artikeln"});config.addLabel("imext:draft",{en:"Draft",sv:"Utkast"});config.addLabel("imext:done",{en:"Ready for approval",sv:"Klar för godkännande"});config.addLabel("stat:withheld",{en:"Scheduled for publication",sv:"Schemalagd för publicering"});config.addLabel("stat:usable",{en:"Published",sv:"Publicerad"});config.addLabel("stat:canceled",{en:"Unpublished",sv:"Avpublicerad"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowManager=__webpack_require__(4);var _PublishFlowManager2=_interopRequireDefault(_PublishFlowManager);__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{Component}=substance;const{api,moment,event}=writer;const pluginId="se.infomaker.publishflow";class PublishFlowComponent extends Component{constructor(...args){super(...args);api.events.on(pluginId,event.DOCUMENT_CHANGED,()=>{this.props.popover.setButtonText(this.getLabel("Save *"))});api.events.on(pluginId,event.DOCUMENT_SAVED,()=>{this._onDocumentSaved()});api.events.on(pluginId,event.DOCUMENT_SAVE_FAILED,()=>{this._onDocumentSaveFailed()});api.events.on(pluginId,event.USERACTION_CANCEL_SAVE,()=>{this._onDocumentSaveFailed()});api.events.on(pluginId,event.USERACTION_SAVE,()=>{this.defaultAction()})}dispose(){api.events.off(pluginId,"document:changed");api.events.off(pluginId,"document:saved")}getInitialState(){let status=api.newsItem.getPubStatus();this.publishFlowMgr=new _PublishFlowManager2.default(pluginId);return{status:status,pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop(),allowed:this.publishFlowMgr.getAllowedActions(status.qcode)}}didMount(){this.props.popover.setButtonText(this.getLabel("Save"));this._updateStatus();if(!api.browser.isSupported()){this.props.popover.disable()}}render($$){var el=$$("div").addClass("sc-np-publishflow").append(this.renderBody($$));return el}renderBody($$){let el=$$("div").addClass("sc-np-publish-body"),actions=this.renderAllowedActions($$);switch(this.state.status.qcode){case"imext:draft":el.append([$$("h2").append(this.getLabel("Publish article?")),$$("p").append(this.getLabel("This article is currently an unpublished draft"))]);break;case"imext:done":el.append([$$("h2").append(this.getLabel("Publish article?")),$$("p").append(this.getLabel("Article is currently pending approval"))]);break;case"stat:withheld":el.append([$$("h2").append(this.getLabel("Scheduled")),$$("p").append(this.getLabel("Article is scheduled to be published")+" "+moment(this.state.pubStart.value).fromNow())]);var specEl=$$("p").addClass("dates").append([$$("span").append(this.getLabel("From")+": "),$$("strong").append(moment(this.state.pubStart.value).format("YYYY-MM-DD HH:mm"))]);if(this.state.pubStop){let toObj=moment(this.state.pubStop.value);if(toObj.isValid()){specEl.append([$$("br"),$$("span").append(this.getLabel("To")+": "),$$("strong").append(moment(this.state.pubStop.value).format("YYYY-MM-DD HH:mm"))])}}el.append(specEl);break;case"stat:usable":el.append([$$("h2").append(this.getLabel("Republish article?")),$$("p").append(this.getLabel("Article was published")+" "+moment(this.state.pubStart.value).fromNow())]);break;case"stat:canceled":el.append([$$("h2").append(this.getLabel("Publish article again?")),$$("p").append(this.getLabel("Article has been canceled and is no longer published"))]);break;default:el.append([$$("h2").append(this.getLabel("Unknown state")),$$("p").append(this.getLabel("This article has an unknown, unsupported, status"))]);break}el.append(actions);el.append($$("div").css({"text-align":"right"}).append($$("button").addClass("sc-np-btn btn-secondary").append(this.getLabel("Cancel")).on("click",()=>{this.props.popover.close()})));return el}renderAllowedActions($$){let actionsEl=$$("div").addClass("sc-np-publish-actions");this.publishFlowMgr.getAllowedActions(this.state.status.qcode).forEach(action=>{switch(action){case"imext:draft":actionsEl.append(this.renderActionDraft($$));break;case"imext:done":actionsEl.append(this.renderActionDone($$));break;case"stat:withheld":actionsEl.append(this.renderActionWithheld($$));break;case"stat:usable":actionsEl.append(this.renderActionUsable($$));break;case"stat:canceled":actionsEl.append(this.renderActionCanceled($$));break}});return actionsEl}renderActionDraft($$){return $$("a").append([$$("i").addClass("fa fa-pencil"),$$("span").append(this.getLabel("Save as draft"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToDraft()})})}renderActionDone($$){return $$("a").append([$$("i").addClass("fa fa-check-circle-o"),$$("span").append(this.getLabel("Ready for approval"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToDone()})})}renderActionWithheld($$){let el=$$("div").addClass("sc-np-publish-action-section").ref("pfc-withheld");el.append($$("a").append([$$("i").addClass("fa fa-clock-o"),$$("span").append(this.getLabel("Schedule for publish"))]).addClass("more").on("click",()=>{if(this.refs["pfc-withheld"].hasClass("active")){this.refs["pfc-withheld"].removeClass("active")}else{this.refs["pfc-withheld"].addClass("active")}}));let fromVal="",toVal="";if(this.state.pubStart){fromVal=moment(this.state.pubStart.value).format("YYYY-MM-DDTHH:mm")}if(this.state.pubStop){toVal=moment(this.state.pubStop.value).format("YYYY-MM-DDTHH:mm")}el.append($$("div").addClass("sc-np-publish-action-section-content sc-np-date-time").append([$$("label").attr("for","pfc-lbl-withheld-from").append(this.getLabel("From")),$$("input").attr({id:"pfc-lbl-withheld-from",type:"datetime-local",required:true}).addClass("form-control").ref("pfc-lbl-withheld-from").val(fromVal),$$("label").attr("for","pfc-lbl-withheld-to").append(this.getLabel("To")),$$("input").attr({id:"pfc-lbl-withheld-to",type:"datetime-local"}).addClass("form-control").ref("pfc-lbl-withheld-to").val(toVal),$$("div").addClass("sc-np-publish-action-section-content-actions").append($$("button").addClass("sc-np-btn btn-secondary").append(this.getLabel("Save"))).on("click",()=>{try{var fromVal=this.refs["pfc-lbl-withheld-from"].val(),toVal=this.refs["pfc-lbl-withheld-to"].val();this._save(()=>{this.publishFlowMgr.setToWithheld(fromVal,toVal)})}catch(ex){this.refs["pfc-lbl-withheld-from"].addClass("imc-flash");window.setTimeout(()=>{this.refs["pfc-lbl-withheld-from"].removeClass("imc-flash")},500);return false}})]));return el}renderActionUsable($$){let el=$$("a");if(this.state.status.qcode==="stat:usable"){el.append([$$("i").addClass("fa fa-retweet"),$$("span").append(this.getLabel("Republish article"))])}else{el.append([$$("i").addClass("fa fa-send"),$$("span").append(this.getLabel("Publish article"))])}el.on("click",()=>{this._save(()=>{this.publishFlowMgr.setToUsable()})});return el}renderActionCanceled($$){return $$("a").append([$$("span").append($$("i").addClass("fa fa-ban"),this.getLabel("Unpublish article"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToCanceled()})})}defaultAction(){api.newsItem.save();this.props.popover.disable();this.props.popover.setIcon("fa-refresh fa-spin fa-fw")}_save(beforeSaveFunc){this._saveState();if(beforeSaveFunc){beforeSaveFunc()}this.defaultAction()}_saveState(){this.extendState({previousState:{pubStatus:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop()}})}_onDocumentSaveFailed(){
this.props.popover.setIcon("fa-ellipsis-h");this.props.popover.enable();if(!this.state.previousState){this._updateStatus(false);return}api.newsItem.setPubStatus(pluginId,this.state.previousState.pubStatus);if(this.state.previousState.pubStart){api.newsItem.setPubStart(pluginId,this.state.previousState.pubStart)}else{api.newsItem.removePubStart(pluginId)}if(this.state.previousState.pubStop){api.newsItem.setPubStop(pluginId,this.state.previousState.pubStop)}else{api.newsItem.removePubStop(pluginId)}this.extendState({status:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop(),previousState:null});this._updateStatus(false)}_onDocumentSaved(){this.props.popover.setIcon("fa-ellipsis-h");this.props.popover.enable();this.extendState({status:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop()});this._updateStatus(true)}_updateStatus(updateButtonSavedLabel){if(updateButtonSavedLabel){this.props.popover.setButtonText(this.getLabel("Save"))}if(this.state.status.qcode==="stat:usable"){this.props.popover.setStatusText(this.getLabel(this.state.status.qcode)+" "+moment(this.state.pubStart.value).fromNow())}else if(this.state.status.qcode==="stat:withheld"){this.props.popover.setStatusText(this.getLabel(this.state.status.qcode)+" "+moment(this.state.pubStart.value).fromNow())}else{this.props.popover.setStatusText(this.getLabel(this.state.status.qcode))}}}exports.default=PublishFlowComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{api,moment}=writer;class PublishFlowConfiguration{constructor(pluginId){this.pluginId=pluginId;this.status={"imext:draft":{allowed:["imext:done","stat:usable","stat:withheld"]},"imext:done":{allowed:["stat:usable","imext:draft","stat:withheld"]},"stat:withheld":{allowed:["stat:withheld","stat:usable","stat:canceled","imext:draft"]},"stat:usable":{allowed:["stat:usable","stat:canceled"]},"stat:canceled":{allowed:["imext:draft","imext:done","stat:usable","stat:withheld"]}}}getAllowedActions(status){if(this.status[status]){return this.status[status].allowed}return[]}setToDraft(){this.setStatus("imext:draft",null,null)}setToDone(){this.setStatus("imext:done",null,null)}setToWithheld(from,to){let fromObj=moment(from),toObj=moment(to);if(!fromObj.isValid()){throw new Error("Invalid from date and time")}this.setStatus("stat:withheld",{value:fromObj.format("YYYY-MM-DDTHH:mm:ssZ")},!toObj.isValid()?null:{value:toObj.format("YYYY-MM-DDTHH:mm:ssZ")})}setToUsable(){this.setStatus("stat:usable",{value:moment().format("YYYY-MM-DDTHH:mm:ssZ")},null)}setToCanceled(){this.setStatus("stat:canceled",null,null)}setStatus(qcode,pubStart,pubStop){if(qcode){api.newsItem.setPubStatus(this.pluginId,{qcode:qcode})}if(pubStart===null){api.newsItem.removePubStart(this.pluginId)}else if(typeof pubStart!=="undefined"){api.newsItem.setPubStart(this.pluginId,pubStart)}if(pubStop===null){api.newsItem.removePubStop(this.pluginId)}else if(typeof pubStop!=="undefined"){api.newsItem.setPubStop(this.pluginId,pubStop)}}}exports.default=PublishFlowConfiguration},function(module,exports){},,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(10);var _SocialembedPackage=__webpack_require__(12);var _SocialembedPackage2=_interopRequireDefault(_SocialembedPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_SocialembedPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _SocialembedComponent=__webpack_require__(13);var _SocialembedComponent2=_interopRequireDefault(_SocialembedComponent);var _SocialembedCommand=__webpack_require__(15);var _SocialembedCommand2=_interopRequireDefault(_SocialembedCommand);var _SocialembedConverter=__webpack_require__(18);var _SocialembedConverter2=_interopRequireDefault(_SocialembedConverter);var _SocialembedMacro=__webpack_require__(19);var _SocialembedMacro2=_interopRequireDefault(_SocialembedMacro);var _SocialembedNode=__webpack_require__(20);var _SocialembedNode2=_interopRequireDefault(_SocialembedNode);var _DropSocialEmbed=__webpack_require__(22);var _DropSocialEmbed2=_interopRequireDefault(_DropSocialEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"socialembed",id:"se.infomaker.socialembed",configure:function configure(config){config.addNode(_SocialembedNode2.default);config.addCommand("socialembed",_SocialembedCommand2.default);config.addComponent(_SocialembedNode2.default.type,_SocialembedComponent2.default);config.addConverter("newsml",_SocialembedConverter2.default);config.addMacro(_SocialembedMacro2.default);config.addDragAndDrop(_DropSocialEmbed2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class SocialembedComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this.rerender,this,{path:[this.props.node.id]});this.context.api.document.triggerFetchResourceNode(this.props.node,{history:false})}dispose(){this.context.editorSession.off(this)}render($$){const node=this.props.node;const el=$$("div").addClass("im-blocknode__container").addClass(node.socialChannel).attr("contenteditable",false);if(node.hasPayload()){const innerEl=$$("div").ref("embed-container");const headerEl=this.renderHeader($$,node);const contentEl=this.renderContent($$,node);innerEl.append([headerEl,contentEl]);el.append(innerEl)}else if(node.errorMessage){el.append($$("div").addClass("se-error").append(node.errorMessage))}else{el.append($$(_substance.FontAwesomeIcon,{icon:"fa-spin fa-refresh"}))}return el}renderContent($$,node){return $$("div").ref("embedContent").addClass("im-blocknode__content full-width").html(node.html)}renderHeader($$,node){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:node.socialChannelIcon}),$$("strong").append(node.socialChannel).attr("contenteditable",false)]).addClass("header").attr("contenteditable",false)}removeEmbed(){this.context.api.document.deleteNode("socialembed",this.props.node)}}SocialembedComponent.noStyle=true;exports.default=SocialembedComponent},function(module,exports){module.exports=substance},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertEmbed=__webpack_require__(17);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class SocialembedCommand extends _writer.WriterCommand{execute(params){if(params.isPaste){const currentNode=params.selection.getPath();if(!currentNode){return false}const currentNodeId=currentNode[0];const previousNode=_writer.api.document.getPreviousNode(currentNodeId);_writer.api.document.deleteNode("socialembed",previousNode)}params.editorSession.transaction(tx=>{(0,_insertEmbed2.default)(tx,params.url)});return true}}exports.default=SocialembedCommand},function(module,exports){module.exports=writer},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=insertEmbed;function insertEmbed(tx,embedUrl){tx.insertBlockNode({type:"socialembed",dataType:"x-im/socialembed",url:embedUrl})}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"socialembed",tagName:"object",matchElement:function matchElement(el){return el.is('object[type="x-im/socialembed"]')},import:function _import(el,node){node.dataType=el.attr("type");const linkEl=el.find("links>link");node.url=linkEl.attr("url");node.uri=linkEl.attr("uri");node.linkType=linkEl.attr("type")},export:function _export(node,el,converter){const $$=converter.$$;el.attr({id:node.id,type:node.dataType});el.removeAttr("data-id");const links=$$("links");const link=$$("link");link.attr({rel:"self",type:node.linkType,url:node.url,uri:node.uri});links.append(link);el.append(links)}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={execute:function execute(params,context){const editorSession=context.editorSession;const text=params.text;if(params.action!=="break"){return}let match=/^\s*(https?:\/\/([^\s]+))\s*$/.exec(text);if(!match)return;let url=match[1];let hasMatch=false;if(url.indexOf("twitter")>0){hasMatch=true}else if(url.indexOf("instagram")>0){hasMatch=true}else if(url.indexOf("facebook")>0){hasMatch=true}else if(url.indexOf("vimeo")>0){hasMatch=true}else if(url.indexOf("soundcloud")>0){hasMatch=true}if(hasMatch){editorSession.executeCommand("socialembed",{url:url,isPaste:true});return true}return false}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _embedInfoFromURL=__webpack_require__(21);var _embedInfoFromURL2=_interopRequireDefault(_embedInfoFromURL);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class SocialembedNode extends _substance.BlockNode{fetchPayload(context,cb){let url=this.url;let embedInfo=(0,_embedInfoFromURL2.default)(url);switch(embedInfo.socialChannel){case"twitter":this._loadTwitter(url,context,cb);break;case"instagram":this._loadInstagram(url,context,cb);break;case"facebook":this._loadFacebook(url,context,cb);break;case"vimeo":this._loadVimeo(url,context,cb);break;case"soundcloud":this._loadSoundcloud(url,context,cb);break;default:cb(new Error("Could not resolve an embed for this url"))}}hasPayload(){return Boolean(this.html)}_loadInstagram(url,context,cb){const instagramBase=`https://api.instagram.com/oembed?url=${encodeURIComponent(url)}&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:instagramBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{let tplNode=document.createElement("template"),parentNode,oldImgNode,newImgNode;try{tplNode.innerHTML=json.html;parentNode=tplNode.content.childNodes[0].querySelector("blockquote>div");oldImgNode=tplNode.content.childNodes[0].querySelector("blockquote>div>div");newImgNode=document.createElement("img");newImgNode.setAttribute("src",json.thumbnail_url);newImgNode.style.width="100%";newImgNode.style.textAlign="center";tplNode.content.childNodes[0].style.boxShadow=null;parentNode.style.padding=0;parentNode.removeChild(oldImgNode);parentNode.insertBefore(newImgNode,parentNode.firstChild);json.html=tplNode.innerHTML}catch(ex){}cb(null,{author:json.author_url,html:json.html,uri:`im://instagram/${json.media_id}`,url:url,title:json.title,linkType:"x-im/instagram",socialChannel:"Instagram",socialChannelIcon:"fa-instagram"},{history:false})}).catch(error=>{cb(error)})}_loadFacebook(url,context,cb){const apiBase=`https://www.facebook.com/plugins/post/oembed.json?url=${encodeURIComponent(url)}&omitscript=true`;let postId=(0,_writer.uuidv5)("url","https://facebook.com");const matches=/.*[\/=](\d+)/.exec(url);if(matches&&matches.length===2){postId=matches[1]}_writer.api.router.get("/api/resourceproxy",{url:apiBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://facebook-post/${postId}`,url:json.url,linkType:"x-im/facebook-post",socialChannel:"Facebook",socialChannelIcon:"fa-facebook"},{history:false})}).catch(error=>{cb(error)})}_loadTwitter(url,context,cb){const twitterBase=`https://api.twitter.com/1/statuses/oembed.json?url=${encodeURIComponent(url)}&hide_media=false&omit_script=true`;const twitterPostId=/status*\/(\d+)/.exec(url);_writer.api.router.get("/api/resourceproxy",{url:twitterBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://tweet/${twitterPostId[1]}`,url:json.url,linkType:"x-im/tweet",socialChannel:"Twitter",socialChannelIcon:"fa-twitter"},{history:false})}).catch(error=>{cb(error)})}_loadVimeo(url,context,cb){const vimeoBase=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(url)}&format=json&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:vimeoBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://vimeo/${json.video_id}`,url:url,title:json.title,linkType:"x-im/vimeo",socialChannel:"Vimeo",socialChannelIcon:"fa-vimeo"},{history:false})}).catch(error=>{cb(error)})}_loadSoundcloud(url,context,cb){const soundcloudBase=`https://soundcloud.com/oembed?format=json&url=${encodeURIComponent(url)}&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:soundcloudBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://soundcloud/${encodeURIComponent(json.author_name+"."+json.title)}`,url:url,title:json.title,linkType:"x-im/soundcloud",socialChannel:"Soundcloud",socialChannelIcon:"fa-soundcloud"},{history:false})}).catch(error=>{cb(error)})}}SocialembedNode.isResource=true;SocialembedNode.define({type:"socialembed",dataType:"string",url:"string",data:{type:"string",optional:true},errorMessage:{type:"string",optional:true},html:{type:"string",optional:true},uri:{type:"string",optional:true},linkType:{type:"string",optional:true},author:{type:"string",optional:true},socialChannel:{type:"string",optional:true},socialChannelIcon:{type:"string",optional:true}});exports.default=SocialembedNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=embedInfoFromURL;var _writer=__webpack_require__(16);function embedInfoFromURL(url){if(!_writer.lodash.isString(url)){return{isEmbed:false}}let result={isEmbed:true};if(url.indexOf("twitter")>0){result.socialChannel="twitter"}else if(url.indexOf("instagram")>0){result.socialChannel="instagram"}else if(url.indexOf("facebook")>0){result.socialChannel="facebook"}else if(url.indexOf("vimeo")>0){result.socialChannel="vimeo"}else if(url.indexOf("soundcloud")>0){result.socialChannel="soundcloud"}else{result.isEmbed=false}return result}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _embedInfoFromURL=__webpack_require__(21);var _embedInfoFromURL2=_interopRequireDefault(_embedInfoFromURL);var _insertEmbed=__webpack_require__(17);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropSocialEmbed extends _substance.DragAndDropHandler{match(params){if(params.type==="uri"){let embedInfo=(0,_embedInfoFromURL2.default)(params.uri);return embedInfo.isEmbed}}drop(tx,params){(0,_insertEmbed2.default)(tx,params.uri)}}exports.default=DropSocialEmbed},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(24);var _XimteaserPackage=__webpack_require__(26);var _XimteaserPackage2=_interopRequireDefault(_XimteaserPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_XimteaserPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(24);var _XimteaserComponent=__webpack_require__(27);var _XimteaserComponent2=_interopRequireDefault(_XimteaserComponent);var _XimteaserConverter=__webpack_require__(29);var _XimteaserConverter2=_interopRequireDefault(_XimteaserConverter);var _Ximteaser=__webpack_require__(30);var _Ximteaser2=_interopRequireDefault(_Ximteaser);var _XimteaserTool=__webpack_require__(31);var _XimteaserTool2=_interopRequireDefault(_XimteaserTool);var _XimteaserCommand=__webpack_require__(32);var _XimteaserCommand2=_interopRequireDefault(_XimteaserCommand);var _XimteaserInsertImageCommand=__webpack_require__(33);var _XimteaserInsertImageCommand2=_interopRequireDefault(_XimteaserInsertImageCommand);var _substance=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"ximteaser",id:"se.infomaker.ximteaser",configure:function configure(config,pluginConfig){config.addNode(_Ximteaser2.default);config.addComponent(_Ximteaser2.default.type,_XimteaserComponent2.default);config.addConverter("newsml",_XimteaserConverter2.default);config.addContentMenuTopTool("ximteaser",_XimteaserTool2.default);config.addCommand("ximteaser",_XimteaserCommand2.default,pluginConfig);config.addCommand("ximteaserinsertimage",_XimteaserInsertImageCommand2.default,pluginConfig);config.addIcon("ximteaser",{fontawesome:" fa-newspaper-o"});if(_substance.platform.isMac){config.addKeyboardShortcut("cmd+alt+t",{command:"ximteaser"})}else{config.addKeyboardShortcut("ctrl+alt+t",{command:"ximteaser"})}config.addLabel("Insert Teaser",{en:"Insert Teaser",sv:"Infoga puff"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _FileInputComponent=__webpack_require__(28);var _FileInputComponent2=_interopRequireDefault(_FileInputComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class XimteaserComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this._onDocumentChange,this);this.parent.parent.attr("draggable",false);this.parent.attr("draggable",false);this.attr("draggable",false)}dispose(){this.context.editorSession.off(this)}_onDocumentChange(change){if(change.isAffected(this.props.node.id)||change.isAffected(this.props.node.imageFile)){this.rerender()}}render($$){const node=this.props.node;const el=$$("div").addClass("sc-ximteaser im-blocknode__container");const teaserFields=_writer.api.getConfigValue("se.infomaker.ximteaser","fields",[]);el.append(this.renderHeader($$));const ImageDisplay=_writer.api.ui.getComponent("imageDisplay");if(this.props.node.imageFile){el.append($$(ImageDisplay,{parentId:"se.infomaker.ximteaser",node:node,isolatedNodeState:this.props.isolatedNodeState,removeImage:this.removeImage.bind(this)}).ref("image"))}el.append(this.renderContent($$,teaserFields));return el}removeImage(){_writer.api.editorSession.transaction(tx=>{const node=this.props.node;tx.set([node.id,"imageFile"],null);tx.set([node.id,"subject"],"")})}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-newspaper-o"}),$$("strong").append(this.getLabel("Teaser")),$$(_FileInputComponent2.default,{onChange:this.triggerFileUpload.bind(this)})]).addClass("header")}triggerFileUpload(ev){const editorSession=_writer.api.editorSession;editorSession.executeCommand("ximteaserinsertimage",{type:"file",data:ev.target.files,context:{node:this.props.node}})}renderContent($$,teaserFields){const content=$$("div").addClass("im-blocknode__content full-width");if(teaserFields.indexOf("subject")>=0){content.append(this.renderSubjectEditor($$))}content.append(this.renderTitleEditor($$));if(teaserFields.indexOf("text")>=0){content.append(this.renderTextEditor($$))}return content}renderSubjectEditor($$){if(this.props.node.imageFile){const subjectContainer=$$("div");const subjectEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"subject"],doc:this.props.doc}).ref("subject").addClass("x-im-teaser-subject");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-flag"});subjectContainer.append([icon,subjectEditor]);return subjectContainer}}renderTitleEditor($$){const titleContainer=$$("div");const titleEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"title"],doc:this.props.doc}).ref("title").addClass("x-im-teaser-title");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-header"});titleContainer.append([icon,titleEditor]);return titleContainer}renderTextEditor($$){const textContainer=$$("div");const textEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"text"],doc:this.props.doc}).ref("text").addClass("x-im-teaser-text");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-paragraph"});textContainer.append([icon,textEditor]);return textContainer}}exports.default=XimteaserComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class FileInputComponent extends _substance.Component{render($$){const uploadbutton=$$("span").addClass("upload-button").append($$(_substance.FontAwesomeIcon,{icon:"fa-upload"})).on("click",this.triggerFileDialog).attr("title",this.getLabel("Upload image"));const fileInput=$$("input").attr("type","file").attr("multiple","multiple").ref("fileInput").on("change",this.props.onChange);return $$("span").addClass("fileinput").append([uploadbutton,fileInput])}triggerFileDialog(){const evt=document.createEvent("MouseEvents");evt.initEvent("click",true,false);this.refs.fileInput.el.el.dispatchEvent(evt)}}exports.default=FileInputComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"ximteaser",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/teaser"},import:function _import(el,node,converter){const nodeId=el.attr("id");node.title=el.attr("title");node.dataType=el.attr("type");const linkEl=el.find("links>link");if(linkEl){node.imageType=linkEl.attr("type");let imageFile={id:(0,_writer.idGenerator)(),type:"npfile",imType:"x-im/image",parentNodeId:nodeId};if(linkEl.attr("uuid")){imageFile.uuid=linkEl.attr("uuid")}if(linkEl.attr("uri")){node.uri=linkEl.attr("uri")}if(linkEl.attr("url")){imageFile.url=linkEl.attr("url")}converter.createNode(imageFile);node.imageFile=imageFile.id;node.uuid=linkEl.attr("uuid")}const dataEl=el.find("data");node.crops={};if(dataEl){dataEl.children.forEach(function(child){if(child.tagName==="text"){node.text=converter.annotatedText(child,[node.id,"text"])}if(child.tagName==="subject"){node.subject=converter.annotatedText(child,[node.id,"subject"])}if(child.tagName==="width"){node.width=parseInt(child.text(),10)}if(child.tagName==="height"){node.height=parseInt(child.text(),10)}if(child.tagName==="crops"&&child.children.length>0){let crops={crops:[]};child.children.forEach(function(crop){if(crop.children.length===0){return}if(crop.tagName==="width"){crops.width=crop.text()}else if(crop.tagName==="height"){crops.height=crop.text()}else{var x=crop.find("x"),y=crop.find("y"),width=crop.find("width"),height=crop.find("height");crops.crops.push({name:crop.attr("name"),x:x.text(),y:y.text(),width:width.text(),height:height.text()})}});if(crops.crops.length){node.crops=crops}}})}},export:function _export(node,el,converter){const $$=converter.$$;el.removeAttr("data-id");el.attr({id:node.id,type:"x-im/teaser"});if(node.title){el.attr("title",converter.annotatedText([node.id,"title"]))}const data=$$("data");if(node.width){data.append($$("width").append(String(node.width)))}if(node.height){data.append($$("height").append(String(node.width)))}if(node.text){data.append($$("text").append(converter.annotatedText([node.id,"text"])))}if(node.subject){data.append($$("subject").append(converter.annotatedText([node.id,"subject"])))}if(node.crops){let crops=$$("crops");for(var x in node.crops.crops){var origCrop=node.crops.crops[x];crops.append($$("crop").attr("name",origCrop.name).append([$$("x").append(origCrop.x),$$("y").append(origCrop.y),$$("width").append(origCrop.width),$$("height").append(origCrop.height)]))}data.append(crops)}el.append(data);let fileNode=node.document.get(node.imageFile);if(fileNode&&fileNode.uuid!==""&&node.uri){const link=$$("link").attr({rel:"image",type:"x-im/image",uri:node.uri,uuid:fileNode.uuid});el.append($$("links").append(link))}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class Ximteaser extends _substance.BlockNode{getImageFile(){if(this.imageFile){return this.document.get(this.imageFile)}}getUrl(){let imageFile=this.getImageFile();if(imageFile){return imageFile.getUrl()}}setSoftcropData(data){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"crops"],data)})}handleDOMDocument(newsItemDOMDocument){const dom=newsItemDOMDocument.documentElement,uuid=dom.getAttribute("guid"),uri=dom.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]').getAttribute("value"),width=dom.querySelector("contentMeta > metadata > object > data > width"),height=dom.querySelector("contentMeta > metadata > object > data > height");_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"uuid"],uuid);tx.set([this.id,"uri"],uri);tx.set([this.id,"width"],width?width.textContent:"");tx.set([this.id,"height"],height?height.textContent:"")},{history:false})}}Ximteaser.define({type:"ximteaser",dataType:{type:"string",optional:false},imageFile:{type:"file",optional:true},uuid:{type:"string",optional:true},uri:{type:"string",optional:true},title:{type:"string",optional:false,default:""},subject:{type:"string",optional:false,default:""},text:{type:"string",optional:false,default:""},width:{type:"number",optional:true},height:{type:"number",optional:true},crops:{type:"object",default:[]}});exports.default=Ximteaser},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimteaserTool extends _substance.Tool{render($$){const el=$$("div");el.attr("title",this.getLabel("Insert Teaser"));el.append($$("button").addClass("se-tool").append($$("i").addClass("fa fa-newspaper-o")).on("click",this.insertTeaser));return el}insertTeaser(){const commandName=this.getCommandName();_writer.api.editorSession.executeCommand(commandName,{test:"hello"})}}exports.default=XimteaserTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimteaserCommand extends _writer.WriterCommand{execute(params,context){const teaserPosition=context.api.getConfigValue(this.config.id,"teaserPosition","bottom");const nodes=_writer.api.document.getDocumentNodes();const existingTeaser=nodes.filter(node=>{return node.dataType==="x-im/teaser"});if(existingTeaser.length>0){_writer.api.ui.showNotification("se.infomaker.ximteaser",_writer.api.getLabel("A teaser already exist"),_writer.api.getLabel("There is already a teaser in this document"));return false}switch(teaserPosition){case"top":this.insertTeaserAtTop(params);break;default:this.insertTeaserAtBottom(params);break}}insertTeaserAtTop(params){const editorSession=params.editorSession;const doc=editorSession.getDocument();editorSession.transaction(tx=>{const firstNodeId=doc.getNodes()["body"].nodes[0];tx.selection=doc.createSelection({type:"property",containerId:"body",path:[firstNodeId,"content"],startOffset:0});tx.insertBlockNode(this.getEmptyTeaserNode())})}insertTeaserAtBottom(params){const editorSession=params.editorSession;editorSession.transaction(tx=>{const body=tx.get("body");const node=tx.create(this.getEmptyTeaserNode());body.show(node.id)})}getEmptyTeaserNode(){return{type:"ximteaser",dataType:"x-im/teaser",id:(0,_writer.idGenerator)(),uuid:"",url:"",imageType:"x-im/image",title:"",text:"",crops:[]}}}exports.default=XimteaserCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimteaserInsertImageCommand extends _writer.WriterCommand{constructor(...args){super(...args);this.name="ximteaserinsertimage"}execute(params,context){const teaserNode=params.context.node;const editorSession=context.editorSession;const file=params.data[0];editorSession.transaction(tx=>{let imageFile=tx.create({parentNodeId:teaserNode.id,type:"npfile",imType:"x-im/image",mimeType:file.type,sourceFile:file});tx.set([teaserNode.id,"imageFile"],imageFile.id)});_writer.api.editorSession.fileManager.sync()}}exports.default=XimteaserInsertImageCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(35);__webpack_require__(37);__webpack_require__(39);var _XimimagePackage=__webpack_require__(41);var _XimimagePackage2=_interopRequireDefault(_XimimagePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_XimimagePackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports){},,function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimimageComponent=__webpack_require__(42);var _XimimageComponent2=_interopRequireDefault(_XimimageComponent);var _XimimageConverter=__webpack_require__(46);var _XimimageConverter2=_interopRequireDefault(_XimimageConverter);var _Ximimage=__webpack_require__(47);var _Ximimage2=_interopRequireDefault(_Ximimage);var _InsertImagesTool=__webpack_require__(48);var _InsertImagesTool2=_interopRequireDefault(_InsertImagesTool);var _InsertImagesCommand=__webpack_require__(49);var _InsertImagesCommand2=_interopRequireDefault(_InsertImagesCommand);var _DropImageFile=__webpack_require__(51);var _DropImageFile2=_interopRequireDefault(_DropImageFile);var _DropImageUri=__webpack_require__(52);var _DropImageUri2=_interopRequireDefault(_DropImageUri);var _DropImageUUID=__webpack_require__(53);var _DropImageUUID2=_interopRequireDefault(_DropImageUUID);var _XimimageFileProxy=__webpack_require__(54);var _XimimageFileProxy2=_interopRequireDefault(_XimimageFileProxy);var _InsertImageUrlCommand=__webpack_require__(55);var _InsertImageUrlCommand2=_interopRequireDefault(_InsertImageUrlCommand);var _ImageDisplay=__webpack_require__(43);var _ImageDisplay2=_interopRequireDefault(_ImageDisplay);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"ximimage",id:"se.infomaker.ximimage",configure:function configure(config){config.addNode(_Ximimage2.default);config.addComponent(_Ximimage2.default.type,_XimimageComponent2.default);config.addConverter("newsml",_XimimageConverter2.default);config.addContentMenuTopTool("insert-images",_InsertImagesTool2.default);config.addCommand("insert-images",_InsertImagesCommand2.default);config.addCommand("ximimage-insert-image-url",_InsertImageUrlCommand2.default);config.addComponent("imageDisplay",_ImageDisplay2.default);config.addConverter("newsml",_XimimageConverter2.default);config.addDragAndDrop(_DropImageFile2.default);config.addDragAndDrop(_DropImageUri2.default);config.addDragAndDrop(_DropImageUUID2.default);config.addIcon("image",{
fontawesome:"fa-image"});config.addIcon("crop",{fontawesome:"fa-crop"});config.addIcon("user-plus",{fontawesome:"fa-user-plus"});config.addIcon("upload",{fontawesome:"fa-upload"});config.addIcon("remove",{fontawesome:"fa-times"});config.addFileProxy(_XimimageFileProxy2.default);config.addLabel("Upload image",{en:"Upload image",sv:"Ladda upp bild"});config.addLabel("remove-image-button-title",{en:"Remove image",sv:"Ta bort bild"});config.addLabel("Image archive information",{sv:"Arkivinformation om bild"});config.addLabel("Add to image byline",{sv:"Lägg till byline till bild"});config.addLabel("Add to byline",{sv:"Lägg till byline"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ImageDisplay=__webpack_require__(43);var _ImageDisplay2=_interopRequireDefault(_ImageDisplay);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{api}=writer;class XimimageComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){this.context.editorSession.off(this)}_onDocumentChange(change){if(change.isAffected(this.props.node.id)||change.isAffected(this.props.node.imageFile)){this.rerender()}}render($$){let node=this.props.node;let el=$$("div").addClass("sc-ximimage");let fields=api.getConfigValue("se.infomaker.ximimage","fields");el.append($$(_ImageDisplay2.default,{parentId:"se.infomaker.ximimage",node:node,isolatedNodeState:this.props.isolatedNodeState}).ref("image"));this.renderAuthors($$,el);fields.forEach(obj=>{if(obj.type==="option"){el.append(this.renderOptionField($$,obj))}else{el.append(this.renderTextField($$,obj))}});return el}renderAuthors($$,el){if(api.getConfigValue("se.infomaker.ximimage","byline")){const authorList=$$("ul").addClass("dialog-image-authorlist").attr("contenteditable",false);this.props.node.authors.forEach(item=>{const authorItem=this.renderAuthor($$,item);if(authorItem){authorList.append(authorItem)}});el.append($$("div").attr("contenteditable",false).addClass("x-im-image-authors").append(authorList))}}renderAuthor($$,author){const avatar=$$("span").addClass("x-im-image-author-token");const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;return $$("li").append($$("div").append([avatar,$$("div").append([$$("strong").append(author.name)]),$$("span").append($$("a").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"})).attr("title",this.getLabel("Remove")).on("click",()=>{this.removeAuthor(author)}))])).ref("item-"+refid)}removeAuthor(author){const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;delete this.refs["item-"+refid];const authors=this.props.node.authors;for(let n=0;n<authors.length;n++){if(!_writer.NilUUID.isNilUUID(author.uuid)&&authors[n].uuid===author.uuid){authors.splice(n,1);break}else if(_writer.NilUUID.isNilUUID(author.uuid)&&authors[n].name===author.name){authors.splice(n,1);break}}this.props.node.setAuthors(authors)}renderTextField($$,obj){return $$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,obj.name],doc:this.props.doc}).ref(obj.name).attr("title",obj.label).addClass("x-im-image-dynamic x-im-image-"+obj.name)}renderOptionField($$,obj){let options=[],currentOption=null;if(!this.props.node.alignment){currentOption=obj.options[0].name}else{currentOption=this.props.node.alignment}obj.options.forEach(option=>{let selectedClass=currentOption===option.name?" selected":"";options.push($$("em").addClass("fa "+option.icon+selectedClass).attr({contenteditable:"false",title:option.label}).on("click",()=>{if(option.name!==this.props.node.alignment){this.props.node.setAlignment(option.name);this.rerender()}return false}))});return $$("div").addClass("x-im-image-dynamic x-im-image-alignment").attr({contenteditable:"false"}).append(options)}}exports.default=XimimageComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ImageCropper=__webpack_require__(44);var _ImageCropper2=_interopRequireDefault(_ImageCropper);var _XimimageAddToBylineComponent=__webpack_require__(45);var _XimimageAddToBylineComponent2=_interopRequireDefault(_XimimageAddToBylineComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ImageDisplay extends _substance.Component{constructor(...args){super(...args)}_onDragStart(e){e.preventDefault();e.stopPropagation()}render($$){let imgContainer=$$("div").addClass("se-image-container").ref("imageContainer");let imgSrc;try{this.hasLoadingErrors=false;imgSrc=this.props.node.getUrl()}catch(e){this.hasLoadingErrors=e}let contentElement=$$(_substance.FontAwesomeIcon,{icon:"fa-picture-o"}).attr("style","font-size:25rem;color:#efefef");if(imgSrc){if(this.props.removeImage){const deleteButton=$$(_substance.Button,{icon:"remove"}).addClass("remove-image__button").attr("title",this.getLabel("remove-image-button-title")).on("click",()=>{this.props.removeImage()});imgContainer.append(deleteButton)}contentElement=$$("img",{src:imgSrc}).ref("img")}else if(this.hasLoadingErrors){contentElement=$$(_substance.FontAwesomeIcon,{icon:"fa-chain-broken"}).attr("style","font-size:4rem;").addClass("broken-image").attr("title",this.getLabel("Image could not be found"))}imgContainer.append(contentElement);const imageFile=this.context.doc.get(this.props.node.imageFile);const actionsEl=$$("div").addClass("se-actions");if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"byline")){actionsEl.append($$(_substance.Button,{icon:"user-plus"}).on("click",this._openAddToByline))}if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"imageinfo")){actionsEl.append($$(_substance.Button,{icon:"image"}).on("click",this._openMetaData))}if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"softcrop")){actionsEl.append($$(_substance.Button,{icon:"crop"}).on("click",this._openCropper))}imgContainer.append(actionsEl);let el=$$("div").addClass("sc-image-display");el.addClass("sm-"+this.props.isolatedNodeState);el.append(imgContainer);return el}_openMetaData(){_writer.api.router.getNewsItem(this.props.node.uuid,"x-im/image").then(response=>{_writer.api.ui.showDialog(this.getComponent("dialog-image"),{node:this.props.node,newsItem:response,disablebylinesearch:!_writer.api.getConfigValue(this.props.parentId,"bylinesearch")},{title:this.getLabel("Image archive information"),global:true,primary:this.getLabel("Save"),secondary:this.getLabel("Cancel")})})}_openAddToByline(){_writer.api.ui.showDialog(_XimimageAddToBylineComponent2.default,{authors:this.props.node.authors,removeAuthor:()=>author=>{this.props.node.removeAuthor(author)},addAuthor:(author,cbDone)=>{const authors=this.props.node.authors;authors.push(author);this.props.node.setAuthors(authors);cbDone()}},{title:this.getLabel("Add to image byline"),global:true,primary:this.getLabel("Close"),secondary:false})}_openCropper(){let tertiary=false;if(this.props.node.crops){tertiary=[{caption:this.getLabel("Remove"),callback:()=>{this.props.node.setSoftcropData([]);return true}}]}_writer.api.ui.showDialog(_ImageCropper2.default,{parentId:this.props.parentId,src:this.props.node.getUrl(),width:this.props.node.width,height:this.props.node.height,crops:this.props.node.crops.crops||[],callback:crops=>{this.props.node.setSoftcropData(crops)}},{tertiary:tertiary})}}exports.default=ImageDisplay},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);const{api}=writer;class ImageCropper extends _substance.Component{didMount(){this.cropEditor=new IMSoftcrop.Editor("ximimage__softcrop",{autocrop:false,debug:false});let definedCrops=api.getConfigValue(this.props.parentId,"crops",[]),encodedSrc=encodeURIComponent(this.props.src);this.cropEditor.addImage("/api/resourceproxy?url="+encodedSrc,()=>{let selected=true;for(var name in definedCrops){if(this.props.crops){this.addCrop(name,selected,definedCrops[name],this.props.crops)}else{this.createCrop(name,selected,definedCrops[name])}selected=false}})}createCrop(name,selected,definedCrop){this.cropEditor.addSoftcrop(name,selected,definedCrop[0],definedCrop[1])}addCrop(name,selected,definedCrop,existingCrops){var existingCrop=null;for(var n=0;n<existingCrops.length;n++){if(existingCrops[n].name===name){existingCrop=existingCrops[n];break}}if(!existingCrop){this.createCrop(name,selected,definedCrop);return}let imageWidth=this.props.width;let imageHeight=this.props.height;let matches=this.props.src.match(/&w=([0-9]*)/);if(Array.isArray(matches)&&matches.length===2){imageWidth=matches[1];imageHeight=Math.round(imageWidth/this.props.width*this.props.height)}this.cropEditor.addSoftcrop(name,selected,Math.round(existingCrop.width*imageWidth),Math.round(existingCrop.height*imageHeight),Math.round(existingCrop.x*imageWidth),Math.round(existingCrop.y*imageHeight))}render($$){return $$("div").attr("id","ximimage__softcrop").addClass("sc-image-cropper").ref("cropper")}onClose(status){if(status==="cancel"){return}let data=this.cropEditor.getSoftcropData(),crops=[];data.crops.forEach(crop=>{crops.push({name:crop.id,x:crop.x/data.width,y:crop.y/data.height,width:crop.width/data.width,height:crop.height/data.height})});this.props.callback({crops:crops})}}exports.default=ImageCropper},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimimageAddToBylineComponent extends _substance.Component{constructor(...args){super(...args)}render($$){const el=$$("div").ref("authorContainer").addClass("authors dialog-image-info clearfix");const bylinesearch=this.context.api.getConfigValue("se.infomaker.ximimage","bylinesearch");let searchComponent;if(bylinesearch){const AuthorSearchComponent=this.context.componentRegistry.get("form-search");searchComponent=$$(AuthorSearchComponent,{existingItems:this.props.authors,searchUrl:"/api/search/concepts/authors?q=",onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Add to byline")}).ref("authorSearchComponent")}else{const AuthorAddComponent=this.context.componentRegistry.get("form-add");searchComponent=$$(AuthorAddComponent,{existingItems:this.props.authors,onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Add to byline")}).ref("authorSearchComponent")}return el.append([searchComponent,this.renderAuthors($$)])}renderAuthors($$){const authorList=$$("ul").addClass("dialog-image-authorlist").attr("contenteditable",false);for(let n=0;n<this.props.authors.length;n++){const authorItem=this.renderAuthor($$,this.props.authors[n]);if(authorItem){authorList.append(authorItem)}}return $$("div").addClass("dialog-image-authors").append(authorList)}renderAuthor($$,author){let avatar;avatar=$$("span");const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;return $$("li").append($$("div").append([avatar,$$("div").append([$$("strong").append(author.name),$$("em").append(author.data?author.data.email?author.data.email:"":"")]),$$("span").append($$("a").append($$(_substance.FontAwesomeIcon,{icon:"remove"})).attr("title",this.getLabel("Remove")).on("click",function(){this.removeAuthor(author)}.bind(this)))])).ref("item-"+refid)}createAuthor(authorItem){const author={uuid:_writer.NilUUID.getNilUUID(),name:authorItem.inputValue};this.props.addAuthor(author,function(){this.rerender()}.bind(this))}addAuthor(authorItem){const author={uuid:authorItem.uuid,name:authorItem.name[0]};this.props.addAuthor(author,function(){this.rerender()}.bind(this))}removeAuthor(author){const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;delete this.refs["item-"+refid];this.props.removeAuthor(author)}onClose(){return true}}exports.default=XimimageAddToBylineComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"ximimage",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/image"},import:function _import(el,node,converter,newsItemConversion){const objectElementId=el.attr("id");var linkEl=el.find("links>link");let imageFile={id:(0,_writer.idGenerator)(),type:"npfile",imType:"x-im/image",parentNodeId:objectElementId};if(el.attr("uuid")){imageFile.uuid=el.attr("uuid")}if(linkEl&&linkEl.attr("uri")){node.uri=linkEl.attr("uri")}if(linkEl&&linkEl.attr("url")){imageFile.url=linkEl.attr("url")}converter.createNode(imageFile);node.imageFile=imageFile.id;node.uuid=el.attr("uuid");let dataEl;if(newsItemConversion){dataEl=el.find("data")}else{dataEl=linkEl.find("data")}node.caption="";node.alttext="";node.credit="";node.alignment="";if(dataEl){dataEl.children.forEach(function(child){if(child.tagName==="text"){node.caption=converter.annotatedText(child,[node.id,"caption"])}if(child.tagName==="alttext"){node.alttext=converter.annotatedText(child,[node.id,"alttext"])}if(child.tagName==="credit"){node.credit=converter.annotatedText(child,[node.id,"credit"])}if(child.tagName==="alignment"){node.alignment=child.text()}if(child.tagName==="width"){node.width=parseInt(child.text(),10)}if(child.tagName==="height"){node.height=parseInt(child.text(),10)}if(child.tagName==="crops"&&child.children.length>0){var crops={crops:[]};child.children.forEach(function(crop){if(crop.children.length===0){return}if(crop.tagName==="width"){crops.width=crop.text()}else if(crop.tagName==="height"){crops.height=crop.text()}else{var x=crop.find("x"),y=crop.find("y"),width=crop.find("width"),height=crop.find("height");crops.crops.push({name:crop.attr("name"),x:x.text(),y:y.text(),width:width.text(),height:height.text()})}});if(crops.crops.length){node.crops=crops}}})}node.authors=[];let authorLinks;if(newsItemConversion){authorLinks=el.find("links")}else{authorLinks=linkEl.find("links")}if(authorLinks){authorLinks.children.forEach(function(authorLinkEl){if("author"===authorLinkEl.getAttribute("rel")){node.authors.push({uuid:authorLinkEl.getAttribute("uuid"),name:authorLinkEl.getAttribute("title")})}else{console.warn("Unhandled link in image object",authorLinkEl)}})}},export:function _export(node,el,converter){var $$=converter.$$;let fileNode=node.document.get(node.imageFile);el.removeAttr("data-id");el.attr({id:node.id,type:"x-im/image",uuid:fileNode.uuid?fileNode.uuid:_writer.NilUUID.getNilUUID()});var data=$$("data").append([$$("width").append(String(node.width)),$$("height").append(String(node.height))]);let fields=_writer.api.getConfigValue("se.infomaker.ximimage","fields")||[];fields.forEach(obj=>{let name=obj.name==="caption"?"text":obj.name;if(!node[obj.name]){data.append($$(name).append(""))}else if(obj.type==="option"){data.append($$(name).append(node[obj.name]))}else{data.append($$(name).append(converter.annotatedText([node.id,obj.name])))}});if(node.crops){let crops=$$("crops");for(var x in node.crops.crops){if(node.crops.crops.hasOwnProperty(x)){var origCrop=node.crops.crops[x];crops.append($$("crop").attr("name",origCrop.name).append([$$("x").append(origCrop.x),$$("y").append(origCrop.y),$$("width").append(origCrop.width),$$("height").append(origCrop.height)]))}}data.append(crops)}var link=$$("link").attr({rel:"self",type:"x-im/image",uri:node.uri?node.uri:"",uuid:fileNode.uuid?fileNode.uuid:_writer.NilUUID.getNilUUID()}).append(data);if(node.authors.length){var authorLinks=$$("links");for(var n in node.authors){if(node.authors.hasOwnProperty(n)){var authorLink=$$("link").attr({rel:"author",uuid:node.authors[n].uuid,title:node.authors[n].name});if(!_writer.NilUUID.isNilUUID(node.authors[n].uuid)){authorLink.attr("type","x-im/author")}authorLinks.append(authorLink)}}link.append(authorLinks)}el.append($$("links").append(link))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _substance=__webpack_require__(14);const{BlockNode}=substance;class Ximimage extends BlockNode{getImageFile(){if(this.imageFile){return this.document.get(this.imageFile)}}getUrl(){let imageFile=this.getImageFile();if(imageFile){return imageFile.getUrl()}}setAlignment(alignment){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"alignment"],alignment)})}setSoftcropData(data){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"crops"],data)})}setAuthors(authors){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"authors"],authors)})}handleDOMDocument(newsItemDOMDocument){const dom=newsItemDOMDocument.documentElement,uuid=dom.getAttribute("guid"),uri=dom.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]'),text=dom.querySelector("contentMeta > metadata > object > data > text"),credit=dom.querySelector("contentMeta > metadata > object > data > credit"),width=dom.querySelector("contentMeta > metadata > object > data > width"),height=dom.querySelector("contentMeta > metadata > object > data > height");_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"uuid"],uuid?uuid:"");tx.set([this.id,"uri"],uri?uri.attributes["value"].value:"");tx.set([this.id,"caption"],text?text.textContent:"");tx.set([this.id,"credit"],credit?credit.textContent:"");tx.set([this.id,"width"],width?width.textContent:"");tx.set([this.id,"height"],height?height.textContent:"")},{history:false})}fetchPayload(context,cb){const fileNode=this.getImageFile();if(fileNode.sourceUUID){_writer.api.router.get("/api/newsitem/"+fileNode.uuid,{imType:"x-im/article"}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>response.text()).then(xmlString=>{const newsMLImporter=_writer.api.configurator.createImporter("newsml",{api:_writer.api});const newsMLConverters=context.converterRegistry.get("newsml");const ximImageConverter=newsMLConverters.get("ximimage");const imageNewsItemDocument=_substance.DefaultDOMElement.parseXML(xmlString);const imageNewsItem=imageNewsItemDocument[0];let imageObjectElement=imageNewsItem.find('contentMeta > metadata > object[type="x-im/image"]');let node={};const defaultDOMImageNewsitem=_substance.DefaultDOMElement.parseXML(imageObjectElement.outerHTML);ximImageConverter.import(defaultDOMImageNewsitem,node,newsMLImporter,true);const uri=imageNewsItem.find('itemMetaExtProperty[type="imext:uri"]').attr("value");const uuid=imageNewsItem.attr("guid");node.uri=uri;node.uuid=uuid;node.imageFile=fileNode.id;cb(null,node)}).catch(e=>{cb(e)})}}}Ximimage.isResource=true;Ximimage.define({type:"ximimage",uuid:{type:"string",optional:true},uri:{type:"string",optional:true},imageFile:{type:"file"},width:{type:"number",optional:true},height:{type:"number",optional:true},errorMessage:{type:"string",optional:true},crops:{type:"object",default:[]},authors:{type:"array",default:[]},caption:{type:"string",default:""},alttext:{type:"string",optional:true},credit:{type:"string",optional:true},alignment:{type:"string",optional:true}});exports.default=Ximimage},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class XimimageTool extends _substance.Tool{render($$){var el=$$("div");el.attr("title",this.getLabel("Upload image"));el.append($$("button").addClass("se-tool").append($$("i").addClass("fa fa-image")).on("click",this.triggerFileDialog));el.append($$("input").attr("type","file").attr("multiple","multiple").attr("id","x-im-image-fileupload").ref("x-im-image-fileupload").on("change",this.triggerFileUpload));return el}triggerFileDialog(){var evt=document.createEvent("MouseEvents");evt.initEvent("click",true,false);this.refs["x-im-image-fileupload"].el.el.dispatchEvent(evt)}triggerFileUpload(ev){this.context.editorSession.executeCommand("insert-images",{files:ev.target.files})}}exports.default=XimimageTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class XimimageCommand extends _writer.WriterCommand{execute(params){params.editorSession.transaction(tx=>{Array.prototype.forEach.call(params.files,file=>{(0,_insertImage2.default)(tx,file)})});_writer.api.editorSession.fileManager.sync();return true}}exports.default=XimimageCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(tx,data){let isFile=data instanceof File,nodeId=(0,_writer.idGenerator)();if(!typeof data==="string"&&!isFile){throw new Error("Unsupported data. Must be File or String")}const imageFileNode={parentNodeId:nodeId,type:"npfile",imType:"x-im/image"};if(isFile){imageFileNode["sourceFile"]=data}else if(typeof data==="string"){imageFileNode["sourceUrl"]=data}let imageFile=tx.create(imageFileNode);tx.insertBlockNode({id:nodeId,type:"ximimage",imageFile:imageFile.id,caption:"",alttext:"",credit:"",alignment:"",width:0,height:0})};var _writer=__webpack_require__(16)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _substance=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropImageFile extends _substance.DragAndDropHandler{match(params){return params.type==="file"&&_writer.lodash.startsWith(params.file.type,"image")}drop(tx,params){(0,_insertImage2.default)(tx,params.file);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}exports.default=DropImageFile},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropImageUri extends _substance.DragAndDropHandler{match(params){return params.type==="uri"&&_isImage(params.uri)}drop(tx,params){(0,_insertImage2.default)(tx,params.uri);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}function _isImage(uri){return uri.indexOf(".jpg")>0||uri.indexOf(".png")>0||uri.indexOf(".gif")>0}exports.default=DropImageUri},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class DropImageUUID extends _substance.DragAndDropHandler{match(params){if(this.isExistingImageDrop(params)){console.info("Implement support for handle existing image drop",this.getDataFromURL(params.uri));return true}return false}isExistingImageDrop(params){if(params.uri&&params.uri.indexOf("x-im-entity://x-im/image")>=0){return true}}drop(tx,params){const dropData=this.getDataFromURL(params.uri);const uuid=dropData.uuid;const nodeId=(0,_writer.idGenerator)();if(!dropData.uuid){throw new Error("Unsupported data. UUID must exist")}const imageFileNode={parentNodeId:nodeId,type:"npfile",imType:"x-im/image",uuid:uuid,sourceUUID:uuid};let imageFile=tx.create(imageFileNode);tx.insertBlockNode({id:nodeId,type:"ximimage",imageFile:imageFile.id,caption:dropData.name,alttext:"",credit:"",alignment:""})}getDataFromURL(url){const queryParamKey="data=";const dataPosition=url.indexOf(queryParamKey);let encodedData=url.substr(dataPosition+queryParamKey.length,url.length);return JSON.parse(window.atob(encodedData))}}exports.default=DropImageUUID},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimimageFileProxy extends _writer.NPFileProxy{}XimimageFileProxy.match=function(fileNode){return fileNode.imType==="x-im/image"};exports.default=XimimageFileProxy},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class InsertImageUrlCommand extends _writer.WriterCommand{execute(params){_writer.api.editorSession.transaction(tx=>{(0,_insertImage2.default)(tx,params.imageUrl)});_writer.api.editorSession.fileManager.sync()}}exports.default=InsertImageUrlCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _YoutubeEmbedPackage=__webpack_require__(57);var _YoutubeEmbedPackage2=_interopRequireDefault(_YoutubeEmbedPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_YoutubeEmbedPackage2.default)}else{console.error("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(58);var _YoutubeEmbedCommand=__webpack_require__(60);var _YoutubeEmbedCommand2=_interopRequireDefault(_YoutubeEmbedCommand);var _YoutubeEmbedNode=__webpack_require__(62);var _YoutubeEmbedNode2=_interopRequireDefault(_YoutubeEmbedNode);var _YoutubeEmbedComponent=__webpack_require__(63);var _YoutubeEmbedComponent2=_interopRequireDefault(_YoutubeEmbedComponent);var _YoutubeEmbedConverter=__webpack_require__(64);var _YoutubeEmbedConverter2=_interopRequireDefault(_YoutubeEmbedConverter);var _YoutubeEmbedMacro=__webpack_require__(65);var _YoutubeEmbedMacro2=_interopRequireDefault(_YoutubeEmbedMacro);var _YoutubeEmbedValidation=__webpack_require__(66);var _YoutubeEmbedValidation2=_interopRequireDefault(_YoutubeEmbedValidation);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.youtubeembed",name:"youtubeembed",configure:function configure(config){config.addConverter("newsml",_YoutubeEmbedConverter2.default);config.addComponent("youtubeembed",_YoutubeEmbedComponent2.default);config.addValidator(_YoutubeEmbedValidation2.default);config.addCommand("youtubeembed",_YoutubeEmbedCommand2.default);config.addNode(_YoutubeEmbedNode2.default);config.addMacro(_YoutubeEmbedMacro2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertEmbed=__webpack_require__(61);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class YoutubeEmbedCommand extends _writer.WriterCommand{execute(params){if(params.isPaste){const currentNode=params.selection.getPath();if(!currentNode){return false}const currentNodeId=currentNode[0];const previousNode=_writer.api.document.getPreviousNode(currentNodeId);_writer.api.document.deleteNode("youtubeembed",previousNode)}params.editorSession.transaction(tx=>{(0,_insertEmbed2.default)(tx,params.url)});return true}}exports.default=YoutubeEmbedCommand},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=insertEmbed;function insertEmbed(tx,embedUrl){tx.insertBlockNode({type:"youtubeembed",dataType:"x-im/youtube",url:embedUrl})}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class YoutubeEmbedNode extends _substance.BlockNode{fetchPayload(context,cb){let url=this.url;var baseUrl="https://youtube.com/oembed?url=";var apiUrl=baseUrl+this.url;_writer.api.router.get("/api/resourceproxy/",{url:apiUrl}).then(response=>response.json()).then(json=>{cb(null,{html:json.html,uri:url,thumbnail_url:json.thumbnail_url,title:json.title},{history:false})}).catch(e=>{cb(e)})}hasPayload(){return Boolean(this.html)}}YoutubeEmbedNode.isResource=true;YoutubeEmbedNode.define({type:"youtubeembed",dataType:"string",url:"string",start:{type:"string",default:"00:00"},errorMessage:{type:"string",optional:true},html:{type:"string",optional:true},thumbnail_url:{type:"string",default:""},uri:{type:"string",optional:true},linkType:{type:"string",optional:true},title:{type:"string",default:""}});exports.default=YoutubeEmbedNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class YoutubeEmbedComponent extends _substance.Component{constructor(...args){super(...args);_writer.api.document.triggerFetchResourceNode(this.props.node,{history:false})}didMount(){_writer.api.editorSession.onRender("document",this.rerender,this,{path:[this.props.node.id]})}dispose(){_writer.api.editorSession.off(this)}render($$){const el=$$("div").addClass("im-blocknode__container im-youtube");el.append(this.renderHeader($$));el.append(this.renderContent($$));return el}renderContent($$){const content=$$("div").addClass("im-blocknode__content full-width");const thumbnail=$$("img").attr("src",this.props.node.thumbnail_url).attr("style","width:100%");const startTimeEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"start"],doc:this.props.doc}).ref("startTime").addClass("start-time-editor");content.append(thumbnail);content.append($$(_substance.FontAwesomeIcon,{icon:"fa-clock-o"}));content.append(startTimeEditor);return content}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-youtube"}),$$("strong").append(this.getLabel("Youtube video")+" - "+this.props.node.title)]).addClass("header")}}exports.default=YoutubeEmbedComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"youtubeembed",tagName:"object",matchElement:function matchElement(el){return el.is('object[type="x-im/youtube"]')},import:function _import(el,node){node.dataType=el.attr("type");node.url=el.attr("url");node.uri=el.attr("uri");const startTimeEl=el.find("data > start");let startTimeFromEl=0;if(startTimeEl){startTimeFromEl=startTimeEl.text()}const startTime=_writer.moment.duration(parseInt(startTimeFromEl,10),"seconds");node.start=startTime.minutes()+":"+startTime.seconds()},export:function _export(node,el,converter){const $$=converter.$$;el.attr({id:node.id,type:node.dataType,url:node.url,uri:node.uri});let seconds;if(node.start&&node.start.indexOf(":")>-1){const startTime=node.start.split(":");seconds=parseInt(startTime[0],10)*60+parseInt(startTime[1],10)}else{seconds=node.start}const data=$$("data");data.append($$("start").append(seconds));el.removeAttr("data-id");el.append(data)}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={execute:function execute(params,context){let editorSession=context.editorSession;let text=params.text;if(!params.action==="break")return;let match=/^\s*(https?:\/\/([^\s]+))\s*$/.exec(text);if(!match)return;let url=match[1];if(url.indexOf("youtube")>0){
editorSession.executeCommand("youtubeembed",{url:url,isPaste:true});return true}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class YoutubeEmbedValidation extends _writer.Validator{constructor(...args){super(...args)}validate(){const youtubeItems=this.newsItem.querySelectorAll('object[type="x-im/youtube"]');Array.prototype.forEach.call(youtubeItems,item=>{const startEl=item.querySelector("start");const time=parseInt(startEl.textContent,10);if(!Number.isInteger(time)){this.addWarning(_writer.api.getLabel("Youtube video has a invalid start time"))}})}}exports.default=YoutubeEmbedValidation},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _HistoryPackage=__webpack_require__(68);var _HistoryPackage2=_interopRequireDefault(_HistoryPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_HistoryPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(69);var _HistoryMainComponent=__webpack_require__(71);var _HistoryMainComponent2=_interopRequireDefault(_HistoryMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.history",name:"history",configure:function configure(config){config.addLabel("history-popover-headline",{en:"Changes since last successful save",sv:"Senaste ändringar"});config.addLabel("history-popover-description",{en:"Changes since last successful save",sv:"Ändringar sedan senast lyckade uppdatering till servern."});config.addPopover("historymaincomponent",{icon:"fa-history",align:"right"},_HistoryMainComponent2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _VersionSelectorDialog=__webpack_require__(72);var _VersionSelectorDialog2=_interopRequireDefault(_VersionSelectorDialog);var _HistoryItemComponent=__webpack_require__(74);var _HistoryItemComponent2=_interopRequireDefault(_HistoryItemComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class HistoryMainComponent extends _substance.Component{constructor(...args){super(...args);_writer.api.events.on("history",_writer.event.DOCUMENT_SAVED,()=>{_writer.api.history.deleteHistory(_writer.api.newsItem.getIdForArticle())});_writer.api.events.on("history",_writer.event.HISTORY_SAVED,()=>{this.updateHistoryState()});_writer.api.events.on("history",_writer.event.HISTORY_CLEARED,()=>{this.updateHistoryState()})}dispose(){_writer.api.events.off("history","document:saved");_writer.api.events.off("history","history:added");_writer.api.events.off("history","history:saved")}didMount(){var historyArticles=_writer.api.history.getHistory();var unsavedArticles=historyArticles.filter(function(history){return history.unsavedArticle===true});let buttonText="No thanks, create a new article";let description="We've found some unsaved articles. Click on the version you would like to restore";let title="Unsaved articles found";let historyForArticle=_writer.api.history.get(_writer.api.newsItem.getIdForArticle());if(historyForArticle&&historyForArticle.versions&&historyForArticle.versions.length>0&&_writer.api.newsItem.hasTemporaryId()){return}else if(!_writer.api.newsItem.hasTemporaryId()&&historyForArticle.versions.length>0){unsavedArticles=[historyForArticle];buttonText="Continue with last saved version";description="We found some unsaved changes for this article.";title="Unsaved changes found for this article"}else if(!_writer.api.newsItem.hasTemporaryId()&&historyForArticle.versions.length===0){return}else if(unsavedArticles.length===0){return}if(_writer.api.document.getDocumentStatus()==="writerHasNoDocument"){_writer.api.ui.showDialog(_VersionSelectorDialog2.default,{unsavedArticles:unsavedArticles,descriptionText:description,applyVersion:this.applyVersion.bind(this)},{global:true,secondary:false,primary:this.getLabel(buttonText),title:this.getLabel(title)})}}updateHistoryState(){let id=this.context.api.newsItem.getIdForArticle();this.setState({historyForArticle:this.context.api.history.get(id)})}getInitialState(){let id=this.context.api.newsItem.getIdForArticle();return{historyForArticle:this.context.api.history.get(id)}}render($$){var el=$$("div").addClass("imc-history light").append($$("h2").append(this.getLabel("history-popover-headline")));el.append($$("p").append(this.getLabel("history-popover-description")));if(this.state.historyForArticle===false){return el}const scrollpane=_writer.api.ui.getComponent("scroll-pane");const scroll=$$(scrollpane,{scrollbarType:"native"});let versions=this.state.historyForArticle.versions.reverse().slice(0,100).map(function(version){return this.renderHistoryItem($$,version,this.state.historyForArticle)}.bind(this));scroll.append(versions);el.append(scroll);var historyArticles=this.context.api.history.getHistory();var unsavedArticles=historyArticles.filter(function(history){return history.unsavedArticle===true});if(this.context.api.newsItem.hasTemporaryId()){el.append(this.renderSeeAllUnsavedLink($$,unsavedArticles))}return el}renderSeeAllUnsavedLink($$,unsavedArticles){return $$("a").addClass("all-unsaved-articles").append(this.getLabel("See all other unsaved articles")).on("click",()=>{this.context.api.ui.showDialog(_VersionSelectorDialog2.default,{unsavedArticles:unsavedArticles,descriptionText:this.getLabel("We've found some unsaved articles. Click on the version you would like to restore"),applyVersion:this.applyVersion.bind(this)},{global:true,secondary:false,title:this.getLabel("Following unsaved articles found")})})}renderHistoryItem($$,version,article){return $$(_HistoryItemComponent2.default,{version:version,article:article,applyVersion:this.applyVersion.bind(this)})}applyVersion(version,article){_writer.api.newsItem.setTemporaryId(article.id);_writer.api.events.documentIsUnsaved();_writer.api.newsItem.setSource(version.src,null,true)}}exports.default=HistoryMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _ArticleItem=__webpack_require__(73);var _ArticleItem2=_interopRequireDefault(_ArticleItem);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class VersionSelectorDialog extends _substance.Component{render($$){const el=$$("div").addClass("restore-history-dialog");const unsavedArticles=this.props.unsavedArticles;el.append($$("p").append(this.getLabel(this.props.descriptionText)));let versions=unsavedArticles.map(article=>{return $$(_ArticleItem2.default,{article:article,applyVersion:this.applyVersion.bind(this)})});el.append(versions);return el}applyVersion(version,article){this.props.applyVersion(version,article)}onClose(status){if("cancel"===status){return true}return true}}exports.default=VersionSelectorDialog},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _HistoryItemComponent=__webpack_require__(74);var _HistoryItemComponent2=_interopRequireDefault(_HistoryItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ArticleItem extends _substance.Component{render($$){let el=$$("div").addClass("history-article");let article=this.props.article;const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("icon-delete").attr("title",this.getLabel("Ignore and clear history"))).on("click",function(){this.context.api.history.deleteHistory(article.id);this.remove()}.bind(this));el.append(deleteButton);let title=article.id;el.append($$("h4").append(title));let versions=article.versions.slice(0,100).map(function(version){return this.renderHistoryItem($$,version,article)}.bind(this));el.append(versions);return el}renderHistoryItem($$,version,article){return $$(_HistoryItemComponent2.default,{version:version,article:article,applyVersion:this.props.applyVersion.bind(this)})}}exports.default=ArticleItem},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class HistoryItemComponent extends _substance.Component{render($$){var version=this.props.version;var icon,title;if(this.context.api.newsItemArticle.firstElementChild.outerHTML===version.src){icon="fa fa-check";title=this.getLabel("Identical with the active version")}else{icon="fa fa-file-text-o"}var outer=$$("div").addClass("history-version-item light").append($$("i").addClass(icon).attr("title",title)).on("click",()=>{this.props.applyVersion(version,this.props.article)});var inner=$$("div");inner.append($$("span").append((0,_writer.moment)(version.time).from()));if(version.action==="saved"){inner.addClass("saved")}outer.append(inner);return outer}}exports.default=HistoryItemComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(76);var _HeaderEditorNode=__webpack_require__(78);var _HeaderEditorNode2=_interopRequireDefault(_HeaderEditorNode);var _HeaderEditorComponent=__webpack_require__(79);var _HeaderEditorComponent2=_interopRequireDefault(_HeaderEditorComponent);var _HeaderEditorConverter=__webpack_require__(80);var _HeaderEditorConverter2=_interopRequireDefault(_HeaderEditorConverter);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const HeaderEditorPackage={id:"se.infomaker.headereditor",name:"headereditor",configure:config=>{config.addNode(_HeaderEditorNode2.default);config.addConverter("newsml",_HeaderEditorConverter2.default);config.addTextEditComponent(_HeaderEditorNode2.default.type,_HeaderEditorComponent2.default,{display:"top"});config.addLabel("leadin",{en:"Leadin",sv:"Ingress"})}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(HeaderEditorPackage)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class HeaderEditorNode extends _substance.DocumentNode{}HeaderEditorNode.type="headereditor";HeaderEditorNode.define({headline:"text",dateline:"text",leadin:"text"});exports.default=HeaderEditorNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class HeaderEditorComponent extends _substance.Component{constructor(...args){super(...args);this.context.editorSession.onUpdate(editorSession=>{const surface=editorSession.getFocusedSurface();if(surface){const icons=this.el.findAll(".fa");if(surface.name!=="body"){icons.forEach(icons=>{icons.addClass("active")})}else{icons.forEach(icons=>{icons.removeClass("active")})}}},this)}render($$){const el=$$("div").addClass("sc-np-headereditor");const headerGroupFields=_writer.api.getConfigValue("se.infomaker.headereditor","elements")||["headline","leadin"];const fields=headerGroupFields.map(function(field){return this.getElement($$,field)}.bind(this));el.append(fields);return el}getElement($$,field){switch(field){case"headline":return this.getElementForField($$,field,"fa-header");case"leadin":return this.getElementForField($$,field,"fa-paragraph");default:return this.getElementForField($$,field,"fa-paragraph")}}getElementForField($$,field,fieldIcon){const el=$$("span").addClass("sc-metdata-text__container").attr({contenteditable:false,title:_writer.api.getLabel(field)});el.append($$(_substance.FontAwesomeIcon,{icon:fieldIcon}).attr({contenteditable:false}));el.append($$(_substance.TextPropertyEditor,{name:field,tagName:"div",commands:this.props.headlineCommands,withoutBreak:false,path:[this.props.node.id,field]}).addClass("se-"+field));return el}}exports.default=HeaderEditorComponent},function(module,exports){"use strict";module.exports={type:"headereditor",tagName:"group",matchElement:function matchElement(el){const headlineElement=el.find('group[type="header"] > element[type="headline"]');const leadinElement=el.find('group[type="header"] > element[type="leadin"]');if(headlineElement||leadinElement){return true}},findElementForType:function findElementForType(el,type){return el.find('element[type="'+type+'"]')},getDefaultFields:function getDefaultFields(){return["headline","leadin"]},import:function _import(el,node,converter){let oldPreserveValue;oldPreserveValue=converter.state.preserveWhitespace;node.id="headereditor";const api=converter.context.api;const headerFields=api.getConfigValue("se.infomaker.headereditor","elements")||this.getDefaultFields();headerFields.forEach(field=>{var element=this.findElementForType(el,field);if(element){converter.state.preserveWhitespace=true;node[field]=converter.annotatedText(element,["headereditor",field])}});converter.state.preserveWhitespace=oldPreserveValue},export:function _export(node,el,converter){const $$=converter.$$;el.attr("type","header");const api=converter.context.api;const headerFields=api.getConfigValue("se.infomaker.headereditor","elements")||this.getDefaultFields();const elements=headerFields.map(function(field){if(node.hasOwnProperty(field)){return $$("element").attr("type",field).attr("id","group-header-"+field).append(converter.annotatedText([node.id,field]))}else{console.error("Field "+field+" not supported");return null}});el.append(elements)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(82);var _XimpdfPackage=__webpack_require__(84);var _XimpdfPackage2=_interopRequireDefault(_XimpdfPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_XimpdfPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimpdfComponent=__webpack_require__(85);var _XimpdfComponent2=_interopRequireDefault(_XimpdfComponent);var _XimpdfConverter=__webpack_require__(86);var _XimpdfConverter2=_interopRequireDefault(_XimpdfConverter);var _Ximpdf=__webpack_require__(87);var _Ximpdf2=_interopRequireDefault(_Ximpdf);var _XimpdfFileNode=__webpack_require__(88);var _XimpdfFileNode2=_interopRequireDefault(_XimpdfFileNode);var _InsertPdfsTool=__webpack_require__(89);var _InsertPdfsTool2=_interopRequireDefault(_InsertPdfsTool);var _InsertPdfsCommand=__webpack_require__(90);var _InsertPdfsCommand2=_interopRequireDefault(_InsertPdfsCommand);var _DropPdfFile=__webpack_require__(92);var _DropPdfFile2=_interopRequireDefault(_DropPdfFile);var _DropPdfUri=__webpack_require__(93);var _DropPdfUri2=_interopRequireDefault(_DropPdfUri);var _XimpdfMacro=__webpack_require__(94);var _XimpdfMacro2=_interopRequireDefault(_XimpdfMacro);var _XimpdfFileProxy=__webpack_require__(95);var _XimpdfFileProxy2=_interopRequireDefault(_XimpdfFileProxy);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"ximpdf",id:"se.infomaker.ximpdf",configure:function configure(config){config.addNode(_Ximpdf2.default);config.addComponent(_Ximpdf2.default.type,_XimpdfComponent2.default);config.addConverter("newsml",_XimpdfConverter2.default);config.addContentMenuTopTool("insert-pdfs",_InsertPdfsTool2.default);config.addCommand("insert-pdfs",_InsertPdfsCommand2.default);config.addNode(_XimpdfFileNode2.default);config.addDragAndDrop(_DropPdfFile2.default);config.addDragAndDrop(_DropPdfUri2.default);config.addMacro(_XimpdfMacro2.default);config.addFileProxy(_XimpdfFileProxy2.default);config.addLabel("Insert PDF document",{en:"Insert PDF document",sv:"Infoga PDF dokument"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimpdfComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){this.context.editorSession.off(this)}_onDocumentChange(change){if(change.isAffected(this.props.node.id)||change.isAffected(this.props.node.pdfFile)){this.rerender()}}render($$){const doc=_writer.api.doc;const node=this.props.node;const fileNode=doc.get(node.pdfFile);const el=$$("div").addClass("im-blocknode__container ximpdf__container");const textEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"text"],doc:this.props.doc}).ref("text").addClass("im-blocknode__content");const loadingSpan=$$("span").append("Loading...").addClass("text-pdf");if(fileNode.uuid){el.append([this.renderHeader($$,fileNode),textEditor])}else{el.append([this.renderHeader($$,fileNode),loadingSpan])}return el}renderContent($$){const content=$$("div").addClass("im-blocknode__content");const link=$$("a").append(this.props.node.label).attr("href","#"+this.props.node.uuid).attr("target","_blank").on("click",function(evt){evt.stopPropagation()});content.append(link);return content}renderHeader($$,fileNode){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-file-pdf-o"}),$$("a").append(this.getLabel("Portable Document Format")).attr("contenteditable",false).attr("href",fileNode.url).addClass("pdf-link").attr("target","_blank").on("click",function(evt){evt.stopPropagation()})]).addClass("header").attr("contenteditable",false)}}exports.default=XimpdfComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"ximpdf",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/pdf"},import:function _import(el,node,converter){let linkEl=el.find("links>link");let pdfFile={id:(0,_writer.idGenerator)(),type:"npfile",imType:"x-im/pdf",parentNodeId:node.id};if(el.attr("uuid")){pdfFile.uuid=el.attr("uuid")}if(linkEl.attr("uri")){pdfFile.uri=linkEl.attr("uri")}if(linkEl.attr("url")){pdfFile.url=linkEl.attr("url")}converter.createNode(pdfFile);node.pdfFile=pdfFile.id;node.uri=pdfFile.uri;node.uuid=pdfFile.uuid;let dataEl=linkEl.find("data");if(dataEl){dataEl.children.forEach(function(child){if(child.tagName==="text"){node.text=converter.annotatedText(child,[node.id,"text"])}})}},export:function _export(node,el,converter){const $$=converter.$$;const fileNode=node.document.get(node.pdfFile);el.removeAttr("data-id");el.attr({id:node.id,type:"x-im/pdf"});const data=$$("data").append([$$("text").append(converter.annotatedText([node.id,"text"]))]);el.attr("uuid",fileNode.uuid);const link=$$("link").attr({rel:"self",type:"x-im/pdf",uri:node.uri?node.uri:"",uuid:fileNode.uuid?fileNode.uuid:_writer.NilUUID.getNilUUID()}).append(data);el.append($$("links").append(link))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class Ximpdf extends _substance.BlockNode{getPdfFile(){if(this.pdfFile){return this.document.get(this.pdfFile)}}getUrl(){let pdfFile=this.getPdfFile();if(pdfFile){return pdfFile.getUrl()}}handleDOMDocument(newsItemDOMDocument){const document=newsItemDOMDocument.documentElement;const uri=document.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]').getAttribute("value");let text=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > text');const objectName=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > objectName');if(text){text=text.textContent}else if(objectName){text=objectName.textContent}else{text=document.querySelector("itemMeta > fileName").textContent}_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"uri"],uri);tx.set([this.id,"text"],text)},{history:false})}}Ximpdf.define({type:"ximpdf",pdfFile:{type:"file"},uri:{type:"string",optional:true},text:{type:"string",optional:true}});exports.default=Ximpdf},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimpdfFileNode extends _substance.FileNode{constructor(...args){super(...args)}handleDocument(xmlString){return new Promise((resolve,reject)=>{try{let doc=_writer.api.editorSession.getDocument();if(!doc.get(this.pdfNodeId)){return resolve()}const parser=new DOMParser;let newsItemDOM=parser.parseFromString(xmlString,"text/xml");let document=newsItemDOM.documentElement;let uuid=document.getAttribute("guid");const uri=document.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]').getAttribute("value");let text=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > text');let objectName=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > objectName');if(text){text=text.textContent}else if(objectName){text=objectName.textContent}else{text=document.querySelector("itemMeta > fileName").textContent}_writer.api.editorSession.transaction(tx=>{tx.set([this.pdfNodeId,"uri"],uri);tx.set([this.pdfNodeId,"text"],text)},{history:false});this.uuid=uuid;resolve()}catch(e){reject(e)}})}getImType(){return"x-im/pdf"}}XimpdfFileNode.define({type:"ximpdffile",pdfNodeId:{type:"string",optional:false},uuid:{type:"string",optional:true},url:{type:"string",optional:true},sourceFile:{type:"object",optional:true},sourceUrl:{type:"string",optional:true}});exports.default=XimpdfFileNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class XimpdfsTool extends _substance.Tool{render($$){var el=$$("div");el.attr("title",this.getLabel("Insert PDF document"));el.append($$("button").addClass("se-tool").append($$("i").addClass("fa fa-file-pdf-o")).on("click",this.triggerFileDialog));el.append($$("input").attr("type","file").attr("multiple","multiple").attr("id","x-im-pdf-fileupload").ref("x-im-pdf-fileupload").on("change",this.triggerFileUpload));return el}triggerFileDialog(){var evt=document.createEvent("MouseEvents");evt.initEvent("click",true,false);this.refs["x-im-pdf-fileupload"].el.el.dispatchEvent(evt)}triggerFileUpload(ev){this.context.editorSession.executeCommand("insert-pdfs",{files:ev.target.files})}}exports.default=XimpdfsTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _InsertPdfCommand=__webpack_require__(91);var _InsertPdfCommand2=_interopRequireDefault(_InsertPdfCommand);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class XimpdfCommand extends _writer.WriterCommand{execute(params){if(typeof params.files==="string"){params.editorSession.transaction(tx=>{(0,_InsertPdfCommand2.default)(tx,params.files)})}else{params.editorSession.transaction(tx=>{Array.prototype.forEach.call(params.files,file=>{(0,_InsertPdfCommand2.default)(tx,file)})})}_writer.api.editorSession.fileManager.sync();return true}}exports.default=XimpdfCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(tx,data){const parentNodeId=(0,_writer.idGenerator)();const pdfFileNode={type:"npfile",parentNodeId:parentNodeId,imType:"x-im/pdf"};let isFile=data instanceof File;if(isFile){pdfFileNode["sourceFile"]=data}else if(typeof data==="string"){pdfFileNode["sourceUrl"]=data}else{throw new Error("Unsupported data. Must be File or String")}let pdfFile=tx.create(pdfFileNode);tx.insertBlockNode({id:parentNodeId,type:"ximpdf",pdfFile:pdfFile.id})};var _writer=__webpack_require__(16)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _InsertPdfCommand=__webpack_require__(91);var _InsertPdfCommand2=_interopRequireDefault(_InsertPdfCommand);var _substance=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropPdfFile extends _substance.DragAndDropHandler{match(params){return params.type==="file"&&params.file.type==="application/pdf"}drop(tx,params){(0,_InsertPdfCommand2.default)(tx,params.file);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}exports.default=DropPdfFile},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _InsertPdfCommand=__webpack_require__(91);var _InsertPdfCommand2=_interopRequireDefault(_InsertPdfCommand);var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropPdfUri extends _substance.DragAndDropHandler{match(params){return params.type==="uri"&&_isImage(params.uri)}drop(tx,params){(0,_InsertPdfCommand2.default)(tx,params.uri);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}function _isImage(uri){return uri.indexOf(".pdf")>0}exports.default=DropPdfUri},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={execute:function execute(params,context){let editorSession=context.editorSession;let text=params.text;if(!params.action==="break"){return}let match=/^\s*(https?:\/\/([^\s]+))\s*$/.exec(text);if(!match){return}let url=match[1];let hasMatch=false;if(url.indexOf(".pdf")>0){hasMatch=true}if(hasMatch){editorSession.executeCommand("insert-pdfs",{files:text});return true}return false}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimpdfFileProxy extends _writer.NPFileProxy{}XimpdfFileProxy.match=function(fileNode){return fileNode.imType==="x-im/pdf"};exports.default=XimpdfFileProxy},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _Headline=__webpack_require__(97);var _Headline2=_interopRequireDefault(_Headline);var _HeadlineComponent=__webpack_require__(100);var _HeadlineComponent2=_interopRequireDefault(_HeadlineComponent);var _HeadlineConverter=__webpack_require__(101);var _HeadlineConverter2=_interopRequireDefault(_HeadlineConverter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const headlinePackage={id:"se.infomaker.headline",name:"headline",configure:function configure(config){config.addNode(_Headline2.default);config.addComponent(_Headline2.default.type,_HeadlineComponent2.default);config.addConverter("newsml",_HeadlineConverter2.default);config.addTextType({name:"headline",data:{type:"headline"}});const headlineLbl={en:"Headline",de:"Headline",sv:"Rubrik"};config.addLabel("headline.content",headlineLbl);config.addLabel("headline",headlineLbl)}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(headlinePackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(98);var _substance=__webpack_require__(14);class Headline extends _substance.TextBlock{}Headline.type="headline";exports.default=Headline},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class HeadlineComponent extends _substance.Component{render($$){return $$("div").addClass("sc-headline").attr("data-id",this.props.node.id).append($$(_substance.TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=HeadlineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"headline",tagName:"element",matchElement:function matchElement(el){return el.is('element[type="headline"]')},import:function _import(el,node,converter){var state=converter.state;var oldValue=state.trimWhitespaces;state.trimWhitespaces=true;node.content=converter.annotatedText(el,[node.id,"content"]);state.trimWhitespaces=oldValue},export:function _export(node,el,converter){return el.attr("type","headline").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(103);var _PreamblePackage=__webpack_require__(105);var _PreamblePackage2=_interopRequireDefault(_PreamblePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PreamblePackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PreambleComponent=__webpack_require__(106);var _PreambleComponent2=_interopRequireDefault(_PreambleComponent);var _PreambleConverter=__webpack_require__(107);var _PreambleConverter2=_interopRequireDefault(_PreambleConverter);var _PreambleNode=__webpack_require__(108);var _PreambleNode2=_interopRequireDefault(_PreambleNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"preamble",id:"se.infomaker.preamble",configure:function configure(config){_PreambleNode2.default.type=this.name;_PreambleConverter2.default.type=_PreambleNode2.default.type;_PreambleConverter2.default.element=_PreambleNode2.default.type;config.addNode(_PreambleNode2.default);config.addComponent(_PreambleNode2.default.type,_PreambleComponent2.default);config.addConverter("newsml",_PreambleConverter2.default);config.addTextType({name:this.name,data:{type:_PreambleNode2.default.type}});config.addLabel("preamble",{en:"Preamble",sv:"Ingress"});config.addLabel("preamble.content",{en:"Preamble",sv:"Ingress"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class PreambleComponent extends Component{render($$){return $$("div").addClass("sc-preamble").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=PreambleComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="preamble"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","preamble").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class PreambleNode extends TextBlock{}PreambleNode.define({id:{
type:"string"}});exports.default=PreambleNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _Subheadline=__webpack_require__(110);var _Subheadline2=_interopRequireDefault(_Subheadline);var _SubheadlineComponent=__webpack_require__(113);var _SubheadlineComponent2=_interopRequireDefault(_SubheadlineComponent);var _SubheadlineConverter=__webpack_require__(114);var _SubheadlineConverter2=_interopRequireDefault(_SubheadlineConverter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const subheadlinePackage={id:"se.infomaker.subheadline",name:"subheadline",configure:function configure(config){config.addNode(_Subheadline2.default);config.addComponent(_Subheadline2.default.type,_SubheadlineComponent2.default);config.addConverter("newsml",_SubheadlineConverter2.default);config.addTextType({name:"subheadline",data:{type:"subheadline"}});config.addLabel("subheadline",{en:"Subheadline",de:"Subheadline",sv:"Underrubrik"});config.addLabel("subheadline.content",{en:"Subheadline",de:"Subheadline",sv:"Underrubrikrik"})}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(subheadlinePackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(111);var _substance=__webpack_require__(14);class Subheadline extends _substance.TextBlock{}Subheadline.type="subheadline";Subheadline.define({level:{type:"number",default:1},contentType:{type:"string",optional:true},format:{type:"string",default:"html"}});exports.default=Subheadline},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class SubheadlineComponent extends _substance.Component{render($$){let node=this.props.node;return $$("div").addClass("sc-subheadline sc-level-"+node.level).attr("data-id",node.id).append($$(_substance.TextPropertyComponent,{path:[node.id,"content"]}))}}exports.default=SubheadlineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"subheadline",tagName:"element",matchElement:function matchElement(el){return/subheadline\d$/.exec(el.attr("type"))},import:function _import(el,node,converter){var state=converter.state;var oldValue=state.trimWhitespaces;state.trimWhitespaces=true;node.content=converter.annotatedText(el,[node.id,"content"]);node.level=parseInt(String(el.attr("type")[11]),10);state.trimWhitespaces=oldValue},export:function _export(node,el,converter){el.attr({type:node.contentType,format:node.format});return el.attr("type","subheadline"+node.level).append(converter.annotatedText([node.id,"content"]))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _Paragraph=__webpack_require__(116);var _Paragraph2=_interopRequireDefault(_Paragraph);var _ParagraphComponent=__webpack_require__(119);var _ParagraphComponent2=_interopRequireDefault(_ParagraphComponent);var _ParagraphConverter=__webpack_require__(120);var _ParagraphConverter2=_interopRequireDefault(_ParagraphConverter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const paragraphPackage={id:"se.infomaker.paragraph",name:"paragraph",configure:function configure(config){config.addNode(_Paragraph2.default);config.addComponent(_Paragraph2.default.type,_ParagraphComponent2.default);config.addConverter("newsml",_ParagraphConverter2.default);config.addTextType({name:"paragraph",data:{type:"paragraph"}});config.addLabel("paragraph",{en:"Paragraph",de:"Paragraph"});config.addLabel("paragraph.content",{en:"Paragraph",de:"Paragraph"})}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(paragraphPackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(117);var _substance=__webpack_require__(14);class Paragraph extends _substance.TextBlock{}Paragraph.type="paragraph";exports.default=Paragraph},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class ParagraphComponent extends _substance.Component{render($$){return $$("div").addClass("sc-paragraph").attr("data-id",this.props.node.id).append($$(_substance.TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=ParagraphComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"paragraph",tagName:"element",matchElement:function matchElement(el){return el.is('element[type="body"]')||el.is('element[type="paragraph"]')},import:function _import(el,node,converter){var state=converter.state;var oldValue=state.trimWhitespaces;state.trimWhitespaces=true;node.content=converter.annotatedText(el,[node.id,"content"]);state.trimWhitespaces=oldValue},export:function _export(node,el,converter){el.attr("type","body").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TextAnalyzerPackage=__webpack_require__(122);var _TextAnalyzerPackage2=_interopRequireDefault(_TextAnalyzerPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_TextAnalyzerPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TextAnalyzerComponent=__webpack_require__(123);var _TextAnalyzerComponent2=_interopRequireDefault(_TextAnalyzerComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"textanalyzer",id:"se.infomaker.textanalyzer",index:5e3,configure:function configure(config){config.addLabel("Characters",{sv:"Antal tecken"});config.addLabel("Words",{sv:"Antal ord"});config.addPopover("textanalyzer",{icon:"fa-info",align:"right"},_TextAnalyzerComponent2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(124);const{Component}=substance;const{api,event}=writer;class TextanalyzerComponent extends Component{dispose(){api.events.off("textanalyzer",event.DOCUMENT_CHANGED)}constructor(...args){super(...args);api.events.on("textanalyzer",event.DOCUMENT_CHANGED,()=>{this.calculateText()})}calculateText(){var count=this.getCount();this.setState({textLength:count.textLength,words:count.words})}didMount(){}render($$){var el=$$("div").addClass("textanalyzer plugin");var numberContainer=$$("div").addClass("number__container clearfix");var textlengthEl=$$("div").addClass("count-info").append($$("span").append(this.state.textLength.toString())).append($$("p").append(this.getLabel("Characters"))).attr("title",this.getLabel("Characters"));var wordsEl=$$("div").addClass("count-info").append($$("span").append(this.state.words.toString())).append($$("p").append(this.getLabel("Words"))).attr("title",this.getLabel("Words"));numberContainer.append([textlengthEl,wordsEl]);el.append(numberContainer);return el}getInitialState(){var count=this.getCount();return{textLength:count.textLength,words:count.words}}getCount(){var nodes=api.document.getDocumentNodes();var textContent="";nodes.forEach(function(node){if(node.content){textContent+=node.content.trim()}});var words=textContent.split(/\s+/);var textLength=textContent.length;return{words:words.length,textLength:textLength}}}exports.default=TextanalyzerComponent},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _NewsPriority=__webpack_require__(127);var _NewsPriority2=_interopRequireDefault(_NewsPriority);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_NewsPriority2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(128);var _NewsPriorityComponent=__webpack_require__(130);var _NewsPriorityComponent2=_interopRequireDefault(_NewsPriorityComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"newspriority",id:"se.infomaker.newspriority",configure:function configure(config){config.addComponentToSidebarWithTabId(this.id,"main",_NewsPriorityComponent2.default);config.addLabel("newsvalue",{en:"Newsvalue",sv:"Nyhetsvärde"});config.addLabel("Lifetime",{en:"Lifetime",sv:"Livslängd"});config.addLabel("enter-date-and-time",{en:"Enter date and time",sv:"Ange datum och tid"})}}},function(module,exports){},,function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component}=substance;const{api,moment,idGenerator}=writer;const{isObject,isEmpty}=writer.lodash;const pluginId="se.infomaker.newspriority";class NewsPriorityComponent extends Component{constructor(...args){super(...args);api.events.on("newspriority","data:duplicated",()=>{api.clearNewsPriority("newspriority");this.rerender()})}getInitialState(){this.scores=api.getConfigValue(pluginId,"scores");this.lifetimes=api.getConfigValue(pluginId,"lifetimes");this.durationKey=api.getConfigValue(pluginId,"durationKey");this.defaultScoreIndex=api.getConfigValue(pluginId,"defaultScoresIndex");this.defaultLifetimeIndex=api.getConfigValue(pluginId,"defaultLifetimesIndex");var newsValue={score:this.scores[this.defaultScoreIndex].value,description:this.lifetimes[this.defaultLifetimeIndex].label,format:"lifetimecode"};newsValue[this.durationKey]=this.lifetimes[this.defaultLifetimeIndex].value;return newsValue}updateState(){var newsPriority=api.newsItem.getNewsPriority(pluginId);if(!newsPriority){var template={$id:idGenerator(),$type:"x-im/newsvalue",data:{description:this.lifetimes[this.defaultLifetimeIndex].label,end:"",format:"lifetimecode",score:this.scores[this.defaultScoreIndex].value}};template.data[this.durationKey]=this.lifetimes[this.defaultLifetimeIndex].value;api.newsItem.setNewsPriority("newspriority",template);newsPriority=api.newsItem.getNewsPriority(pluginId);if(isObject(newsPriority.data[this.durationKey])){newsPriority.data[this.durationKey]=template.data[this.durationKey]}}else{if(newsPriority.data.end&&!this.extendedState){this.extendedState={end:newsPriority.data.end}}}if(Number(newsPriority.data.score)===Number(this.state.score)){return}var newState={score:newsPriority.data.score,description:newsPriority.data.description,format:newsPriority.data.format,end:newsPriority.data.end};newState[this.durationKey]=newsPriority.data[this.durationKey];this.setState(newState)}render($$){this.updateState();var el=$$("div");var prioTitle=$$("h2").text(this.getLabel("newsvalue"));el.append(prioTitle);el.append(this._renderPriority($$));var lifetimeTitle=$$("h2").text(this.getLabel("Lifetime"));el.append(lifetimeTitle);if(this.lifetimes.length>1){el.append(this._renderLifeTime($$))}el.append(this._renderDatetimeInput($$).ref("datePickerComponent"));return el}_renderPriority($$){var prio=$$("div").addClass("btn-group");var buttons=this.scores.map(function(score){return $$("button").addClass("btn btn-secondary sc-np-btn").text(String(score.value)).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual").attr("title",score.text).addClass(parseInt(this.state.score,10)===score.value?"active":"").on("click",function(){this.setNewsPriority(score.value)}.bind(this))}.bind(this));prio.append(buttons);return prio}_renderLifeTime($$){var lifetime=$$("div").addClass("btn-group lifetime");var buttons=this.lifetimes.map(function(lifetime){return $$("button").addClass("btn btn-secondary sc-np-btn").text(lifetime.label).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual").attr("title",lifetime.text).addClass(this.state[this.durationKey]===lifetime.value?"active":"").on("click",function(e){this.setLifetime(e,lifetime)}.bind(this))}.bind(this));lifetime.append(buttons);return lifetime}_renderDatetimeInput($$){var form=$$("form").attr("id","npLifetimeForm");var fieldset=$$("fieldset").addClass("form-group").ref("datePickerFieldset");var text=this.getLabel("enter-date-and-time");var endTime=api.newsItem.getNewsPriority("newspriority").data.end;if(endTime!==""&&!isEmpty(endTime)){text="✓ "+text}var small=$$("div").append($$("small").addClass("text-muted").text(text)).addClass("hidden").ref("datePickerInstructionText");var input=$$("input").attr("type","datetime-local").addClass("form-control").attr("id","npLifetimeInput").on("change",this.setLifetimeDatetime).ref("datePickerInput");input.on("focus",()=>{this.refs.datePickerInstructionText.el.removeClass("hidden")});input.on("blur",()=>{this.refs.datePickerInstructionText.el.addClass("hidden")});if(this.state.end&&this.state.end.length>0){input.val(this.state.end.substring(0,16))}if(this.state[this.durationKey]!=="custom"&&this.lifetimes.length>1){form.attr("style","display: none;")}form.append(fieldset.append(input).append(small));return form}setNewsPriority(score){var newsPriority=api.newsItem.getNewsPriority(pluginId);newsPriority.data.score=score;api.newsItem.setNewsPriority(pluginId,newsPriority);this.extendState({score:newsPriority.data.score})}setLifetime(ev,lifetime){var newsPriority=api.newsItem.getNewsPriority(pluginId);for(var n=0;n<this.lifetimes.length;n++){if(ev.target.textContent===this.lifetimes[n].label){newsPriority.data.description=this.lifetimes[n].label;newsPriority.data[this.durationKey]=this.lifetimes[n].value;break}}var extendedState={};if(this.extendedState&&this.extendedState.end){extendedState.end=this.extendedState.end}if(lifetime.value==="custom"&&this.extendedState&&this.extendedState.end){newsPriority.data.end=this.extendedState.end}else{newsPriority.data.end=""}api.newsItem.setNewsPriority("newspriority",newsPriority);extendedState["description"]=newsPriority.data.description;extendedState[this.durationKey]=newsPriority.data[this.durationKey];this.extendState(extendedState)}setLifetimeDatetime(ev){var newsPriority=api.newsItem.getNewsPriority(pluginId);if(ev.target.value===""){newsPriority.data.end={}}else{newsPriority.data.end=moment(ev.target.value).format("YYYY-MM-DDTHH:mm:ssZ")}api.newsItem.setNewsPriority("newspriority",newsPriority);this.extendState({end:newsPriority.data.end})}}exports.default=NewsPriorityComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XImPlacePackage=__webpack_require__(132);var _XImPlacePackage2=_interopRequireDefault(_XImPlacePackage);var _XImPlacePackagePolygon=__webpack_require__(151);var _XImPlacePackagePolygon2=_interopRequireDefault(_XImPlacePackagePolygon);var _XImPlacePackagePosition=__webpack_require__(152);var _XImPlacePackagePosition2=_interopRequireDefault(_XImPlacePackagePosition);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(placeType=>{if(_writer.registerPlugin){switch(placeType){case"position":(0,_writer.registerPlugin)(_XImPlacePackagePosition2.default);break;case"polygon":(0,_writer.registerPlugin)(_XImPlacePackagePolygon2.default);break;default:(0,_writer.registerPlugin)(_XImPlacePackage2.default)}}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(133);var _XimPlacePackageConfigure=__webpack_require__(135);var _XimPlacePackageConfigure2=_interopRequireDefault(_XimPlacePackageConfigure);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const id="se.infomaker.ximplace";exports.default={id:id,name:"ximplace",configure:(0,_XimPlacePackageConfigure2.default)(id)}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _LocationMainComponent=__webpack_require__(136);var _LocationMainComponent2=_interopRequireDefault(_LocationMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(pluginId=>{return(config,pluginConfigObject)=>{config.addComponentToSidebarWithTabId(pluginId,"main",_LocationMainComponent2.default,pluginConfigObject);config.addLabel("Locations",{en:"Locations",sv:"Platser och områden"});config.addLabel("Areas",{en:"Areas",sv:"Län/Kommuner/Områden"});config.addLabel("Positions",{en:"Positions",sv:"Platser"});config.addLabel("Search locations",{en:"Search locations",sv:"Sök platser/områden"});config.addLabel("Search positions",{en:"Search positions",sv:"Sök platser"});config.addLabel("Search areas",{en:"Search areas",sv:"Sök områden"});config.addLabel("ximplace-error-save",{en:"Error saving place",sv:"Fel vid sparande av plats"});config.addLabel("Place",{en:"Place",sv:"Plats"});config.addLabel("Edit of polygons is not currently supported",{en:"Edit of polygons is not currently supported",sv:"Redigering av polygoner är för närvarande inte möjlig"})}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _LocationListComponent=__webpack_require__(137);var _LocationListComponent2=_interopRequireDefault(_LocationListComponent);var _LocationDetailComponent=__webpack_require__(141);var _LocationDetailComponent2=_interopRequireDefault(_LocationDetailComponent);var _concept=__webpack_require__(150);var _concept2=_interopRequireDefault(_concept);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class LocationMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximplace"}configureFeatures(){const features=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"features");switch(features){case"position":this.features="position";this.t={title:this.getLabel("Positions"),placeholder:this.getLabel("Search positions")};break;case"polygon":this.features="polygon";this.t={title:this.getLabel("Areas"),placeholder:this.getLabel("Search areas")};break;default:this.features="all";this.t={title:this.getLabel("Locations"),placeholder:this.getLabel("Search locations")}}this.polygonIsEditable=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"polygon.editable",true)}getInitialState(){this.configureFeatures();return{existingLocations:_writer.api.newsItem.getLocations(this.features)}}reload(){this.setState({existingLocations:_writer.api.newsItem.getLocations(this.features)})}render($$){const el=$$("div").addClass("location-main").append($$("h2").append(this.t.title));const locationList=$$(_LocationListComponent2.default,{locations:this.state.existingLocations,openMap:this.openMap.bind(this),removeLocation:this.removeLocation.bind(this)}).ref("locationList");let query="q=";if(this.features!=="all"){query="f="+this.features+"&q="}const LocationSearchComponent=this.context.componentRegistry.get("form-search");const searchComponent=$$(LocationSearchComponent,{existingItems:this.state.existingLocations,searchUrl:"/api/search/concepts/locations?"+query,onSelect:this.addLocation.bind(this),onCreate:this.createMap.bind(this),createAllowed:this.features!=="polygon",placeholderText:this.t.placeholder}).ref("authorSearchComponent");el.append(locationList);el.append(searchComponent);return el}createMap(selectedItem,exists){const parser=new DOMParser;const placeXML=parser.parseFromString(_concept2.default.place,"text/xml").firstChild;const location=_writer.jxon.build(placeXML);const properties={newLocation:true,exists:exists,query:selectedItem.inputValue,reload:this.reload.bind(this),editable:true,plugin:this.props.pluginConfigObject,location:location};_writer.api.ui.showDialog(_LocationDetailComponent2.default,properties,{title:this.getLabel("Place"),global:true,primary:this.getLabel("Save")})}addLocation(item){const useGeometryType=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"useGeometryType");if(useGeometryType===true&&!item.hasOwnProperty("geometryType")){throw new Error("Writer configured to use geometry type for locations but no geometry type provided by concept backend")}const location={title:item.name[0],uuid:item.uuid,data:item.location?{position:item.location[0]}:{},type:useGeometryType?item.geometryType[0]:"x-im/place"};_writer.api.newsItem.addLocation(this.name,location);this.reload()}removeLocation(location){_writer.api.newsItem.removeLinkByUUID(this.name,location.uuid);this.reload()}openMap(item){let editable=true;if(item.concept.metadata.object["@type"]==="x-im/polygon"&&false===this.polygonIsEditable){editable=false}const properties={newLocation:false,query:item.inputValue,location:item,reload:this.reload.bind(this),editable:editable,plugin:this.props.pluginConfigObject};_writer.api.ui.showDialog(_LocationDetailComponent2.default,properties,{title:this.getLabel("Place")+" "+item.concept.name,global:true,primary:editable?this.getLabel("Save"):this.getLabel("Close"),secondary:editable?this.getLabel("Cancel"):false})}}exports.default=LocationMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _LocationItemComponent=__webpack_require__(138);var _LocationItemComponent2=_interopRequireDefault(_LocationItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class LocationListComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximplace"}render($$){const el=$$("ul").addClass("tag-list").ref("locationItemList");const locations=this.props.locations.map(location=>{return $$(_LocationItemComponent2.default,{location:location,openMap:this.props.openMap.bind(this),removeLocation:this.props.removeLocation.bind(this)}).ref(location.uuid)});el.append(locations);return el}}exports.default=LocationListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _lodash=__webpack_require__(139);class LocationItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximplace"}loadLocation(){const api=this.context.api;api.router.getConceptItem(this.props.location.uuid,this.props.location.type).then(xml=>{const conceptXML=xml.querySelector("conceptItem");try{this.setState({loadedLocation:_writer.jxon.build(conceptXML),isLoaded:true})}catch(e){this.setState({isLoaded:true,couldNotLoad:true})}}).catch(()=>{this.setState({isLoaded:true,couldNotLoad:true})})}render($$){const location=this.props.location;const locItem=$$("li").addClass("tag-list__item");const displayNameEl=$$("span");let locationType="position";if(!this.state.isLoaded){displayNameEl.addClass("tag-item__title tag-item__title--loading").append(location.title);this.loadLocation()}else{if(this.state.couldNotLoad){displayNameEl.addClass("tag-item__title tag-item__title--no-avatar tag-item__title--notexisting").append(location.title).attr("title",this.getLabel("This item could not be loaded. UUID: ")+location.uuid)}else{locationType=this.state.loadedLocation.concept.metadata.object["@type"];displayNameEl.addClass("tag-item__title tag-item__title--no-avatar").append(this.state.loadedLocation.concept.name);displayNameEl.attr("title",location.title);LocationItemComponent.updateTagItemName(displayNameEl,this.state.loadedLocation);displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");if(this.state.loadedLocation.concept.name!==location.title){this.setState({isLoaded:false})}displayNameEl.on("click",function(){this.props.openMap(this.state.loadedLocation)}.bind(this))}locItem.append(displayNameEl);const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("Remove from article"))).on("click",function(){this.removeTag(location)}.bind(this));locItem.append(deleteButton);let icon="fa-map-marker";if(locationType==="x-im/polygon"){icon="fa-map"}locItem.append($$(_substance.FontAwesomeIcon,{icon:icon}).addClass("tag-icon"))}return locItem}removeTag(location){this.props.removeLocation(location)}static updateTagItemName(tagItem,loadedTag){if(loadedTag.concept&&loadedTag.concept.definition){const definition=(0,_lodash.isArray)(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(let i=0;i<definition.length;i++){const item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}}exports.default=LocationItemComponent},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(module,global){(function(){var undefined;var VERSION="3.5.0";var BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,REARG_FLAG=128,ARY_FLAG=256;var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...";var HOT_COUNT=150,HOT_SPAN=16;var LAZY_DROP_WHILE_FLAG=0,LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2;var FUNC_ERROR_TEXT="Expected a function";var PLACEHOLDER="__lodash_placeholder__";var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reUnescapedHtml=/[&<>"'`]/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reFuncName=/^\s*function[ \n\r\t]+\w/;var reHexPrefix=/^0[xX]/;var reHostCtor=/^\[object .+?Constructor\]$/;var reLatin1=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g;var reNoMatch=/($^)/;var reRegExpChars=/[.*+?^${}()|[\]\/\\]/g,reHasRegExpChars=RegExp(reRegExpChars.source);var reThis=/\bthis\b/;var reUnescapedString=/['\n\r\u2028\u2029\\]/g;var reWords=function(){var upper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",lower="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(upper+"+(?="+upper+lower+")|"+upper+"?"+lower+"|"+upper+"+|[0-9]+","g")}();var whitespace=" \t\v\f \ufeff"+"\n\r\u2028\u2029"+" ᠎             　";var contextProps=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window","WinRTError"];var templateCounter=-1;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[stringTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[mapTag]=cloneableTags[setTag]=cloneableTags[weakMapTag]=false;var debounceOptions={leading:false,maxWait:0,trailing:false};var deburredLetters={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"};var objectTypes={function:true,object:true};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module;var freeGlobal=freeExports&&freeModule&&typeof global=="object"&&global;var freeWindow=objectTypes[typeof window]&&window;var moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports;var root=freeGlobal||freeWindow!==(this&&this.window)&&freeWindow||this;function baseCompareAscending(value,other){if(value!==other){var valIsReflexive=value===value,othIsReflexive=other===other;if(value>other||!valIsReflexive||typeof value=="undefined"&&othIsReflexive){return 1}if(value<other||!othIsReflexive||typeof other=="undefined"&&valIsReflexive){return-1}}return 0}function baseIndexOf(array,value,fromIndex){if(value!==value){return indexOfNaN(array,fromIndex)}var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function baseIsFunction(value){return typeof value=="function"||false}function baseToString(value){if(typeof value=="string"){return value}return value==null?"":value+""}function charAtCallback(string){return string.charCodeAt(0)}function charsLeftIndex(string,chars){var index=-1,length=string.length;while(++index<length&&chars.indexOf(string.charAt(index))>-1){}return index}function charsRightIndex(string,chars){var index=string.length;while(index--&&chars.indexOf(string.charAt(index))>-1){}return index}function compareAscending(object,other){return baseCompareAscending(object.criteria,other.criteria)||object.index-other.index;
}function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=baseCompareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result}return result*(orders[index]?1:-1)}}return object.index-other.index}function deburrLetter(letter){return deburredLetters[letter]}function escapeHtmlChar(chr){return htmlEscapes[chr]}function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function indexOfNaN(array,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?0:-1);while(fromRight?index--:++index<length){var other=array[index];if(other!==other){return index}}return-1}function isObjectLike(value){return value&&typeof value=="object"||false}function isSpace(charCode){return charCode<=160&&(charCode>=9&&charCode<=13)||charCode==32||charCode==160||charCode==5760||charCode==6158||charCode>=8192&&(charCode<=8202||charCode==8232||charCode==8233||charCode==8239||charCode==8287||charCode==12288||charCode==65279)}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){if(array[index]===placeholder){array[index]=PLACEHOLDER;result[++resIndex]=index}}return result}function sortedUniq(array,iteratee){var seen,index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(!index||seen!==computed){seen=computed;result[++resIndex]=value}}return result}function trimmedLeftIndex(string){var index=-1,length=string.length;while(++index<length&&isSpace(string.charCodeAt(index))){}return index}function trimmedRightIndex(string){var index=string.length;while(index--&&isSpace(string.charCodeAt(index))){}return index}function unescapeHtmlChar(chr){return htmlUnescapes[chr]}function runInContext(context){context=context?_.defaults(root.Object(),context,_.pick(root,contextProps)):root;var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayProto=Array.prototype,objectProto=Object.prototype,stringProto=String.prototype;var document=(document=context.window)&&document.document;var fnToString=Function.prototype.toString;var getLength=baseProperty("length");var hasOwnProperty=objectProto.hasOwnProperty;var idCounter=0;var objToString=objectProto.toString;var oldDash=context._;var reNative=RegExp("^"+escapeRegExp(objToString).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ArrayBuffer=isNative(ArrayBuffer=context.ArrayBuffer)&&ArrayBuffer,bufferSlice=isNative(bufferSlice=ArrayBuffer&&new ArrayBuffer(0).slice)&&bufferSlice,ceil=Math.ceil,clearTimeout=context.clearTimeout,floor=Math.floor,getPrototypeOf=isNative(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf,push=arrayProto.push,propertyIsEnumerable=objectProto.propertyIsEnumerable,Set=isNative(Set=context.Set)&&Set,setTimeout=context.setTimeout,splice=arrayProto.splice,Uint8Array=isNative(Uint8Array=context.Uint8Array)&&Uint8Array,WeakMap=isNative(WeakMap=context.WeakMap)&&WeakMap;var Float64Array=function(){try{var func=isNative(func=context.Float64Array)&&func,result=new func(new ArrayBuffer(10),0,1)&&func}catch(e){}return result}();var nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeCreate=isNative(nativeCreate=Object.create)&&nativeCreate,nativeIsFinite=context.isFinite,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeNow=isNative(nativeNow=Date.now)&&nativeNow,nativeNumIsFinite=isNative(nativeNumIsFinite=Number.isFinite)&&nativeNumIsFinite,nativeParseInt=context.parseInt,nativeRandom=Math.random;var NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,POSITIVE_INFINITY=Number.POSITIVE_INFINITY;var MAX_ARRAY_LENGTH=Math.pow(2,32)-1,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;var FLOAT64_BYTES_PER_ELEMENT=Float64Array?Float64Array.BYTES_PER_ELEMENT:0;var MAX_SAFE_INTEGER=Math.pow(2,53)-1;var metaMap=WeakMap&&new WeakMap;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value}if(hasOwnProperty.call(value,"__chain__")&&hasOwnProperty.call(value,"__wrapped__")){return wrapperClone(value)}}return new LodashWrapper(value)}function baseLodash(){}function LodashWrapper(value,chainAll,actions){this.__wrapped__=value;this.__actions__=actions||[];this.__chain__=!!chainAll}var support=lodash.support={};(function(x){support.funcDecomp=!isNative(context.WinRTError)&&reThis.test(runInContext);support.funcNames=typeof Function.name=="string";try{support.dom=document.createDocumentFragment().nodeType===11}catch(e){support.dom=false}try{support.nonEnumArgs=!propertyIsEnumerable.call(arguments,1)}catch(e){support.nonEnumArgs=true}})(0,0);lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};function LazyWrapper(value){this.__wrapped__=value;this.__actions__=null;this.__dir__=1;this.__dropCount__=0;this.__filtered__=false;this.__iteratees__=null;this.__takeCount__=POSITIVE_INFINITY;this.__views__=null}function lazyClone(){var actions=this.__actions__,iteratees=this.__iteratees__,views=this.__views__,result=new LazyWrapper(this.__wrapped__);result.__actions__=actions?arrayCopy(actions):null;result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=iteratees?arrayCopy(iteratees):null;result.__takeCount__=this.__takeCount__;result.__views__=views?arrayCopy(views):null;return result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true}else{result=this.clone();result.__dir__*=-1}return result}function lazyValue(){var array=this.__wrapped__.value();if(!isArray(array)){return baseWrapperValue(array,this.__actions__)}var dir=this.__dir__,isRight=dir<0,view=getView(0,array.length,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,takeCount=nativeMin(length,this.__takeCount__),iteratees=this.__iteratees__,iterLength=iteratees?iteratees.length:0,resIndex=0,result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type;if(type==LAZY_DROP_WHILE_FLAG){if(data.done&&(isRight?index>data.index:index<data.index)){data.count=0;data.done=false}data.index=index;if(!data.done){var limit=data.limit;if(!(data.done=limit>-1?data.count++>=limit:!iteratee(value))){continue outer}}}else{var computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer}else{break outer}}}}result[resIndex++]=value}return result}function MapCache(){this.__data__={}}function mapDelete(key){return this.has(key)&&delete this.__data__[key]}function mapGet(key){return key=="__proto__"?undefined:this.__data__[key]}function mapHas(key){return key!="__proto__"&&hasOwnProperty.call(this.__data__,key)}function mapSet(key,value){if(key!="__proto__"){this.__data__[key]=value}return this}function SetCache(values){var length=values?values.length:0;this.data={hash:nativeCreate(null),set:new Set};while(length--){this.push(values[length])}}function cacheIndexOf(cache,value){var data=cache.data,result=typeof value=="string"||isObject(value)?data.set.has(value):data.hash[value];return result?0:-1}function cachePush(value){var data=this.data;if(typeof value=="string"||isObject(value)){data.set.add(value)}else{data.hash[value]=true}}function arrayCopy(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayEachRight(array,iteratee){var length=array.length;while(length--){if(iteratee(array[length],length,array)===false){break}}return array}function arrayEvery(array,predicate){var index=-1,length=array.length;while(++index<length){if(!predicate(array[index],index,array)){return false}}return true}function arrayFilter(array,predicate){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[++resIndex]=value}}return result}function arrayMap(array,iteratee){var index=-1,length=array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function arrayMax(array){var index=-1,length=array.length,result=NEGATIVE_INFINITY;while(++index<length){var value=array[index];if(value>result){result=value}}return result}function arrayMin(array){var index=-1,length=array.length,result=POSITIVE_INFINITY;while(++index<length){var value=array[index];if(value<result){result=value}}return result}function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;if(initFromArray&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function arrayReduceRight(array,iteratee,accumulator,initFromArray){var length=array.length;if(initFromArray&&length){accumulator=array[--length]}while(length--){accumulator=iteratee(accumulator,array[length],length,array)}return accumulator}function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function assignDefaults(objectValue,sourceValue){return typeof objectValue=="undefined"?sourceValue:objectValue}function assignOwnDefaults(objectValue,sourceValue,key,object){return typeof objectValue=="undefined"||!hasOwnProperty.call(object,key)?sourceValue:objectValue}function baseAssign(object,source,customizer){var props=keys(source);if(!customizer){return baseCopy(source,object,props)}var index=-1,length=props.length;while(++index<length){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);if((result===result?result!==value:value===value)||typeof value=="undefined"&&!(key in object)){object[key]=result}}return object}function baseAt(collection,props){var index=-1,length=collection.length,isArr=isLength(length),propsLength=props.length,result=Array(propsLength);while(++index<propsLength){var key=props[index];if(isArr){key=parseFloat(key);result[index]=isIndex(key,length)?collection[key]:undefined}else{result[index]=collection[key]}}return result}function baseCopy(source,object,props){if(!props){props=object;object={}}var index=-1,length=props.length;while(++index<length){var key=props[index];object[key]=source[key]}return object}function baseBindAll(object,methodNames){var index=-1,length=methodNames.length;while(++index<length){var key=methodNames[index];object[key]=createWrapper(object[key],BIND_FLAG,object)}return object}function baseCallback(func,thisArg,argCount){var type=typeof func;if(type=="function"){return typeof thisArg!="undefined"&&isBindable(func)?bindCallback(func,thisArg,argCount):func}if(func==null){return identity}if(type=="object"){return baseMatches(func)}return typeof thisArg=="undefined"?baseProperty(func+""):baseMatchesProperty(func+"",thisArg)}function baseClone(value,isDeep,customizer,key,object,stackA,stackB){var result;if(customizer){result=object?customizer(value,key,object):customizer(value)}if(typeof result!="undefined"){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return arrayCopy(value,result)}}else{var tag=objToString.call(value),isFunc=tag==funcTag;if(tag==objectTag||tag==argsTag||isFunc&&!object){result=initCloneObject(isFunc?{}:value);if(!isDeep){return baseCopy(value,result,keys(value))}}else{return cloneableTags[tag]?initCloneByTag(value,tag,isDeep):object?value:{}}}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==value){return stackB[length]}}stackA.push(value);stackB.push(result);(isArr?arrayEach:baseForOwn)(value,function(subValue,key){result[key]=baseClone(subValue,isDeep,customizer,key,value,stackA,stackB)});return result}var baseCreate=function(){function Object(){}return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null}return result||context.Object()}}();function baseDelay(func,wait,args,fromIndex){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return setTimeout(function(){func.apply(undefined,baseSlice(args,fromIndex))},wait)}function baseDifference(array,values){var length=array?array.length:0,result=[];if(!length){return result}var index=-1,indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf,cache=isCommon&&values.length>=200?createCache(values):null,valuesLength=values.length;if(cache){indexOf=cacheIndexOf;isCommon=false;values=cache}outer:while(++index<length){var value=array[index];if(isCommon&&value===value){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===value){continue outer}}result.push(value)}else if(indexOf(values,value,0)<0){result.push(value)}}return result}function baseEach(collection,iteratee){var length=collection?collection.length:0;if(!isLength(length)){return baseForOwn(collection,iteratee)}var index=-1,iterable=toObject(collection);while(++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}function baseEachRight(collection,iteratee){var length=collection?collection.length:0;if(!isLength(length)){return baseForOwnRight(collection,iteratee)}var iterable=toObject(collection);while(length--){if(iteratee(iterable[length],length,iterable)===false){break}}return collection}function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result});return result}function baseFill(array,value,start,end){var length=array.length;start=start==null?0:+start||0;if(start<0){start=-start>length?0:length+start}end=typeof end=="undefined"||end>length?length:+end||0;if(end<0){end+=length}length=start>end?0:end>>>0;start>>>=0;while(start<length){array[start++]=value}return array}function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}function baseFind(collection,predicate,eachFunc,retKey){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=retKey?key:value;return false}});return result}function baseFlatten(array,isDeep,isStrict,fromIndex){var index=fromIndex-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(isObjectLike(value)&&isLength(value.length)&&(isArray(value)||isArguments(value))){if(isDeep){value=baseFlatten(value,isDeep,isStrict,0)}var valIndex=-1,valLength=value.length;result.length+=valLength;while(++valIndex<valLength){result[++resIndex]=value[valIndex]}}else if(!isStrict){result[++resIndex]=value}}return result}function baseFor(object,iteratee,keysFunc){var index=-1,iterable=toObject(object),props=keysFunc(object),length=props.length;while(++index<length){var key=props[index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}function baseForRight(object,iteratee,keysFunc){var iterable=toObject(object),props=keysFunc(object),length=props.length;while(length--){var key=props[length];if(iteratee(iterable[key],key,iterable)===false){break}}return object}function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn)}function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return baseForRight(object,iteratee,keys)}function baseFunctions(object,props){var index=-1,length=props.length,resIndex=-1,result=[];while(++index<length){var key=props[index];if(isFunction(object[key])){result[++resIndex]=key}}return result}function baseInvoke(collection,methodName,args){var index=-1,isFunc=typeof methodName=="function",length=collection?collection.length:0,result=isLength(length)?Array(length):[];baseEach(collection,function(value){var func=isFunc?methodName:value!=null&&value[methodName];result[++index]=func?func.apply(value,args):undefined});return result}function baseIsEqual(value,other,customizer,isWhere,stackA,stackB){if(value===other){return value!==0||1/value==1/other}var valType=typeof value,othType=typeof other;if(valType!="function"&&valType!="object"&&othType!="function"&&othType!="object"||value==null||other==null){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,customizer,isWhere,stackA,stackB)}function baseIsEqualDeep(object,other,equalFunc,customizer,isWhere,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=objToString.call(object);if(objTag==argsTag){objTag=objectTag}else if(objTag!=objectTag){objIsArr=isTypedArray(object)}}if(!othIsArr){othTag=objToString.call(other);if(othTag==argsTag){othTag=objectTag}else if(othTag!=objectTag){othIsArr=isTypedArray(other)}}var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!(objIsArr||objIsObj)){return equalByTag(object,other,objTag)}var valWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(valWrapped||othWrapped){return equalFunc(valWrapped?object.value():object,othWrapped?other.value():other,customizer,isWhere,stackA,stackB)}if(!isSameTag){return false}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==object){return stackB[length]==other}}stackA.push(object);stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isWhere,stackA,stackB);stackA.pop();stackB.pop();return result}function baseIsMatch(object,props,values,strictCompareFlags,customizer){var length=props.length;if(object==null){return!length}var index=-1,noCustomizer=!customizer;while(++index<length){if(noCustomizer&&strictCompareFlags[index]?values[index]!==object[props[index]]:!hasOwnProperty.call(object,props[index])){return false}}index=-1;while(++index<length){var key=props[index];if(noCustomizer&&strictCompareFlags[index]){var result=hasOwnProperty.call(object,key)}else{var objValue=object[key],srcValue=values[index];result=customizer?customizer(objValue,srcValue,key):undefined;if(typeof result=="undefined"){result=baseIsEqual(srcValue,objValue,customizer,true)}}if(!result){return false}}return true}function baseMap(collection,iteratee){var result=[];baseEach(collection,function(value,key,collection){result.push(iteratee(value,key,collection))});return result}function baseMatches(source){var props=keys(source),length=props.length;if(length==1){var key=props[0],value=source[key];if(isStrictComparable(value)){return function(object){return object!=null&&object[key]===value&&hasOwnProperty.call(object,key)}}}var values=Array(length),strictCompareFlags=Array(length);while(length--){value=source[props[length]];values[length]=value;strictCompareFlags[length]=isStrictComparable(value)}return function(object){return baseIsMatch(object,props,values,strictCompareFlags)}}function baseMatchesProperty(key,value){if(isStrictComparable(value)){return function(object){return object!=null&&object[key]===value}}return function(object){return object!=null&&baseIsEqual(value,object[key],null,true)}}function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object)){return object}var isSrcArr=isLength(source.length)&&(isArray(source)||isTypedArray(source));(isSrcArr?arrayEach:baseForOwn)(source,function(srcValue,key,source){if(isObjectLike(srcValue)){stackA||(stackA=[]);stackB||(stackB=[]);return baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB)}var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=typeof result=="undefined";if(isCommon){result=srcValue}if((isSrcArr||typeof result!="undefined")&&(isCommon||(result===result?result!==value:value===value))){object[key]=result}});return object}function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){var length=stackA.length,srcValue=source[key];while(length--){if(stackA[length]==srcValue){object[key]=stackB[length];return}}var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=typeof result=="undefined";if(isCommon){result=srcValue;if(isLength(srcValue.length)&&(isArray(srcValue)||isTypedArray(srcValue))){result=isArray(value)?value:value?arrayCopy(value):[]}else if(isPlainObject(srcValue)||isArguments(srcValue)){result=isArguments(value)?toPlainObject(value):isPlainObject(value)?value:{}}else{isCommon=false}}stackA.push(srcValue);stackB.push(result);if(isCommon){object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB)}else if(result===result?result!==value:value===value){object[key]=result}}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePullAt(array,indexes){var length=indexes.length,result=baseAt(array,indexes);indexes.sort(baseCompareAscending);while(length--){var index=parseFloat(indexes[length]);if(index!=previous&&isIndex(index)){var previous=index;splice.call(array,index,1)}}return result}function baseRandom(min,max){return min+floor(nativeRandom()*(max-min+1))}function baseReduce(collection,iteratee,accumulator,initFromCollection,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initFromCollection?(initFromCollection=false,value):iteratee(accumulator,value,index,collection)});return accumulator}var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func};function baseSlice(array,start,end){var index=-1,length=array.length;start=start==null?0:+start||0;if(start<0){start=-start>length?0:length+start}end=typeof end=="undefined"||end>length?length:+end||0;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result});return!!result}function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value}return array}function baseSortByOrder(collection,props,orders){var index=-1,length=collection.length,result=isLength(length)?Array(length):[];baseEach(collection,function(value){var length=props.length,criteria=Array(length);while(length--){criteria[length]=value==null?undefined:value[props[length]]}result[++index]={criteria:criteria,index:index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function baseUniq(array,iteratee){var index=-1,indexOf=getIndexOf(),length=array.length,isCommon=indexOf==baseIndexOf,isLarge=isCommon&&length>=200,seen=isLarge?createCache():null,result=[];if(seen){indexOf=cacheIndexOf;isCommon=false}else{isLarge=false;seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(isCommon&&value===value){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(indexOf(seen,computed,0)<0){if(iteratee||isLarge){seen.push(computed)}result.push(value)}}return result}function baseValues(object,props){var index=-1,length=props.length,result=Array(length);while(++index<length){result[index]=object[props[index]]}return result}function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value()}var index=-1,length=actions.length;while(++index<length){var args=[result],action=actions[index];push.apply(args,action.args);result=action.func.apply(action.thisArg,args)}return result}function binaryIndex(array,value,retHighest){var low=0,high=array?array.length:low;if(typeof value=="number"&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];if(retHighest?computed<=value:computed<value){low=mid+1}else{high=mid}}return high}return binaryIndexBy(array,value,identity,retHighest)}function binaryIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=array?array.length:0,valIsNaN=value!==value,valIsUndef=typeof value=="undefined";while(low<high){var mid=floor((low+high)/2),computed=iteratee(array[mid]),isReflexive=computed===computed;if(valIsNaN){var setLow=isReflexive||retHighest}else if(valIsUndef){setLow=isReflexive&&(retHighest||typeof computed!="undefined")}else{setLow=retHighest?computed<=value:computed<value}if(setLow){low=mid+1}else{high=mid}}return nativeMin(high,MAX_ARRAY_INDEX)}function bindCallback(func,thisArg,argCount){if(typeof func!="function"){return identity}if(typeof thisArg=="undefined"){return func}switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function bufferClone(buffer){return bufferSlice.call(buffer,0)}if(!bufferSlice){bufferClone=!(ArrayBuffer&&Uint8Array)?constant(null):function(buffer){var byteLength=buffer.byteLength,floatLength=Float64Array?floor(byteLength/FLOAT64_BYTES_PER_ELEMENT):0,offset=floatLength*FLOAT64_BYTES_PER_ELEMENT,result=new ArrayBuffer(byteLength);if(floatLength){var view=new Float64Array(result,0,floatLength);view.set(new Float64Array(buffer,0,floatLength))}if(byteLength!=offset){view=new Uint8Array(result,offset);view.set(new Uint8Array(buffer,offset))}return result}}function composeArgs(args,partials,holders){var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(argsLength+leftLength);while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex]}while(++argsIndex<holdersLength){result[holders[argsIndex]]=args[argsIndex]}while(argsLength--){result[leftIndex++]=args[argsIndex++]}return result}function composeArgsRight(args,partials,holders){var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);while(++argsIndex<argsLength){result[argsIndex]=args[argsIndex]}var pad=argsIndex;while(++rightIndex<rightLength){result[pad+rightIndex]=partials[rightIndex]}while(++holdersIndex<holdersLength){result[pad+holders[holdersIndex]]=args[argsIndex++]}return result}function createAggregator(setter,initializer){return function(collection,iteratee,thisArg){var result=initializer?initializer():{};iteratee=getCallback(iteratee,thisArg,3);if(isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];setter(result,value,iteratee(value,index,collection),collection)}}else{baseEach(collection,function(value,key,collection){setter(result,value,iteratee(value,key,collection),collection)})}return result}}function createAssigner(assigner){return function(){var args=arguments,length=args.length,object=args[0];if(length<2||object==null){return object}var customizer=args[length-2],thisArg=args[length-1],guard=args[3];if(length>3&&typeof customizer=="function"){customizer=bindCallback(customizer,thisArg,5);length-=2}else{customizer=length>2&&typeof thisArg=="function"?thisArg:null;length-=customizer?1:0}if(guard&&isIterateeCall(args[1],args[2],guard)){customizer=length==3?null:customizer;length=2}var index=0;while(++index<length){var source=args[index];if(source){assigner(object,source,customizer)}}return object}}function createBindWrapper(func,thisArg){var Ctor=createCtorWrapper(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(thisArg,arguments)}return wrapper}var createCache=!(nativeCreate&&Set)?constant(null):function(values){return new SetCache(values)};function createComposer(fromRight){return function(){var length=arguments.length,index=length,fromIndex=fromRight?length-1:0;if(!length){return function(){return arguments[0]}}var funcs=Array(length);while(index--){funcs[index]=arguments[index];if(typeof funcs[index]!="function"){throw new TypeError(FUNC_ERROR_TEXT)}}return function(){var index=fromIndex,result=funcs[index].apply(this,arguments);while(fromRight?index--:++index<length){result=funcs[index].call(this,result)}return result}}}function createCompounder(callback){return function(string){var index=-1,array=words(deburr(string)),length=array.length,result="";while(++index<length){result=callback(result,array[index],index)}return result}}function createCtorWrapper(Ctor){return function(){var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,arguments);return isObject(result)?result:thisBinding}}function createExtremum(arrayFunc,isMin){return function(collection,iteratee,thisArg){if(thisArg&&isIterateeCall(collection,iteratee,thisArg)){iteratee=null}var func=getCallback(),noIteratee=iteratee==null;if(!(func===baseCallback&&noIteratee)){noIteratee=false;iteratee=func(iteratee,thisArg,3)}if(noIteratee){var isArr=isArray(collection);if(!isArr&&isString(collection)){iteratee=charAtCallback}else{return arrayFunc(isArr?collection:toIterable(collection))}}return extremumBy(collection,iteratee,isMin)}}function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryBound=bitmask&CURRY_BOUND_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG;var Ctor=!isBindKey&&createCtorWrapper(func),key=func;function wrapper(){var length=arguments.length,index=length,args=Array(length);while(index--){args[index]=arguments[index]}if(partials){args=composeArgs(args,partials,holders)}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight)}if(isCurry||isCurryRight){var placeholder=wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);length-=argsHolders.length;if(length<arity){var newArgPos=argPos?arrayCopy(argPos):null,newArity=nativeMax(arity-length,0),newsHolders=isCurry?argsHolders:null,newHoldersRight=isCurry?null:argsHolders,newPartials=isCurry?args:null,newPartialsRight=isCurry?null:args;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG);if(!isCurryBound){bitmask&=~(BIND_FLAG|BIND_KEY_FLAG)}var result=createHybridWrapper(func,bitmask,thisArg,newPartials,newsHolders,newPartialsRight,newHoldersRight,newArgPos,ary,newArity);result.placeholder=placeholder;return result}}var thisBinding=isBind?thisArg:this;if(isBindKey){func=thisBinding[key]}if(argPos){args=reorder(args,argPos)}if(isAry&&ary<args.length){args.length=ary}var fn=this&&this!==root&&this instanceof wrapper?Ctor||createCtorWrapper(func):func;return fn.apply(thisBinding,args)}return wrapper}function createPad(string,length,chars){var strLength=string.length;length=+length;if(strLength>=length||!nativeIsFinite(length)){return""}var padLength=length-strLength;
chars=chars==null?" ":chars+"";return repeat(chars,ceil(padLength/chars.length)).slice(0,padLength)}function createPartialWrapper(func,bitmask,thisArg,partials){var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(argsLength+leftLength);while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex]}while(argsLength--){args[leftIndex++]=arguments[++argsIndex]}var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,args)}return wrapper}function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var length=partials?partials.length:0;if(!length){bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG);partials=holders=null}length-=holders?holders.length:0;if(bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=null}var data=!isBindKey&&getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&data!==true){mergeData(newData,data);bitmask=newData[1];arity=newData[9]}newData[9]=arity==null?isBindKey?0:func.length:nativeMax(arity-length,0)||0;if(bitmask==BIND_FLAG){var result=createBindWrapper(newData[0],newData[2])}else if((bitmask==PARTIAL_FLAG||bitmask==(BIND_FLAG|PARTIAL_FLAG))&&!newData[4].length){result=createPartialWrapper.apply(undefined,newData)}else{result=createHybridWrapper.apply(undefined,newData)}var setter=data?baseSetData:setData;return setter(result,newData)}function equalArrays(array,other,equalFunc,customizer,isWhere,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length,result=true;if(arrLength!=othLength&&!(isWhere&&othLength>arrLength)){return false}while(result&&++index<arrLength){var arrValue=array[index],othValue=other[index];result=undefined;if(customizer){result=isWhere?customizer(othValue,arrValue,index):customizer(arrValue,othValue,index)}if(typeof result=="undefined"){if(isWhere){var othIndex=othLength;while(othIndex--){othValue=other[othIndex];result=arrValue&&arrValue===othValue||equalFunc(arrValue,othValue,customizer,isWhere,stackA,stackB);if(result){break}}}else{result=arrValue&&arrValue===othValue||equalFunc(arrValue,othValue,customizer,isWhere,stackA,stackB)}}}return!!result}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==0?1/object==1/other:object==+other;case regexpTag:case stringTag:return object==other+""}return false}function equalObjects(object,other,equalFunc,customizer,isWhere,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isWhere){return false}var hasCtor,index=-1;while(++index<objLength){var key=objProps[index],result=hasOwnProperty.call(other,key);if(result){var objValue=object[key],othValue=other[key];result=undefined;if(customizer){result=isWhere?customizer(othValue,objValue,key):customizer(objValue,othValue,key)}if(typeof result=="undefined"){result=objValue&&objValue===othValue||equalFunc(objValue,othValue,customizer,isWhere,stackA,stackB)}}if(!result){return false}hasCtor||(hasCtor=key=="constructor")}if(!hasCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){return false}}return true}function extremumBy(collection,iteratee,isMin){var exValue=isMin?POSITIVE_INFINITY:NEGATIVE_INFINITY,computed=exValue,result=computed;baseEach(collection,function(value,index,collection){var current=iteratee(value,index,collection);if((isMin?current<computed:current>computed)||current===exValue&&current===result){computed=current;result=value}});return result}function getCallback(func,thisArg,argCount){var result=lodash.callback||callback;result=result===callback?baseCallback:result;return argCount?result(func,thisArg,argCount):result}var getData=!metaMap?noop:function(func){return metaMap.get(func)};function getIndexOf(collection,target,fromIndex){var result=lodash.indexOf||indexOf;result=result===indexOf?baseIndexOf:result;return collection?result(collection,target,fromIndex):result}function getView(start,end,transforms){var index=-1,length=transforms?transforms.length:0;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size);break}}return{start:start,end:end}}function initCloneArray(array){var length=array.length,result=new array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){var Ctor=object.constructor;if(!(typeof Ctor=="function"&&Ctor instanceof Ctor)){Ctor=Object}return new Ctor}function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return bufferClone(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:var buffer=object.buffer;return new Ctor(isDeep?bufferClone(buffer):buffer,object.byteOffset,object.length);case numberTag:case stringTag:return new Ctor(object);case regexpTag:var result=new Ctor(object.source,reFlags.exec(object));result.lastIndex=object.lastIndex}return result}function isBindable(func){var support=lodash.support,result=!(support.funcNames?func.name:support.funcDecomp);if(!result){var source=fnToString.call(func);if(!support.funcNames){result=!reFuncName.test(source)}if(!result){result=reThis.test(source)||isNative(func);baseSetData(func,result)}}return result}function isIndex(value,length){value=+value;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"){var length=object.length,prereq=isLength(length)&&isIndex(index,length)}else{prereq=type=="string"&&index in object}if(prereq){var other=object[index];return value===value?value===other:other!==other}return false}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isStrictComparable(value){return value===value&&(value===0?1/value>0:!isObject(value))}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask;var arityFlags=ARY_FLAG|REARG_FLAG,bindFlags=BIND_FLAG|BIND_KEY_FLAG,comboFlags=arityFlags|bindFlags|CURRY_BOUND_FLAG|CURRY_RIGHT_FLAG;var isAry=bitmask&ARY_FLAG&&!(srcBitmask&ARY_FLAG),isRearg=bitmask&REARG_FLAG&&!(srcBitmask&REARG_FLAG),argPos=(isRearg?data:source)[7],ary=(isAry?data:source)[8];var isCommon=!(bitmask>=REARG_FLAG&&srcBitmask>bindFlags)&&!(bitmask>bindFlags&&srcBitmask>=REARG_FLAG);var isCombo=newBitmask>=arityFlags&&newBitmask<=comboFlags&&(bitmask<REARG_FLAG||(isRearg||isAry)&&argPos.length<=ary);if(!(isCommon||isCombo)){return data}if(srcBitmask&BIND_FLAG){data[2]=source[2];newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG}var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):arrayCopy(value);data[4]=partials?replaceHolders(data[3],PLACEHOLDER):arrayCopy(source[4])}value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):arrayCopy(value);data[6]=partials?replaceHolders(data[5],PLACEHOLDER):arrayCopy(source[6])}value=source[7];if(value){data[7]=arrayCopy(value)}if(srcBitmask&ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8])}if(data[9]==null){data[9]=source[9]}data[0]=source[0];data[1]=newBitmask;return data}function pickByArray(object,props){object=toObject(object);var index=-1,length=props.length,result={};while(++index<length){var key=props[index];if(key in object){result[key]=object[key]}}return result}function pickByCallback(object,predicate){var result={};baseForIn(object,function(value,key,object){if(predicate(value,key,object)){result[key]=value}});return result}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=arrayCopy(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}var setData=function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return key}}else{count=0}return baseSetData(key,value)}}();function shimIsPlainObject(value){var Ctor,support=lodash.support;if(!(isObjectLike(value)&&objToString.call(value)==objectTag)||!hasOwnProperty.call(value,"constructor")&&(Ctor=value.constructor,typeof Ctor=="function"&&!(Ctor instanceof Ctor))){return false}var result;baseForIn(value,function(subValue,key){result=key});return typeof result=="undefined"||hasOwnProperty.call(value,result)}function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length,support=lodash.support;var allowIndexes=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key)){result.push(key)}}return result}function toIterable(value){if(value==null){return[]}if(!isLength(value.length)){return values(value)}return isObject(value)?value:Object(value)}function toObject(value){return isObject(value)?value:Object(value)}function wrapperClone(wrapper){return wrapper instanceof LazyWrapper?wrapper.clone():new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__,arrayCopy(wrapper.__actions__))}function chunk(array,size,guard){if(guard?isIterateeCall(array,size,guard):size==null){size=1}else{size=nativeMax(+size||1,1)}var index=0,length=array?array.length:0,resIndex=-1,result=Array(ceil(length/size));while(index<length){result[++resIndex]=baseSlice(array,index,index+=size)}return result}function compact(array){var index=-1,length=array?array.length:0,resIndex=-1,result=[];while(++index<length){var value=array[index];if(value){result[++resIndex]=value}}return result}function difference(){var args=arguments,index=-1,length=args.length;while(++index<length){var value=args[index];if(isArray(value)||isArguments(value)){break}}return baseDifference(value,baseFlatten(args,false,true,++index))}function drop(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}return baseSlice(array,n<0?0:n)}function dropRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}n=length-(+n||0);return baseSlice(array,0,n<0?0:n)}function dropRightWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}predicate=getCallback(predicate,thisArg,3);while(length--&&predicate(array[length],length,array)){}return baseSlice(array,0,length+1)}function dropWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}var index=-1;predicate=getCallback(predicate,thisArg,3);while(++index<length&&predicate(array[index],index,array)){}return baseSlice(array,index)}function fill(array,value,start,end){var length=array?array.length:0;if(!length){return[]}if(start&&typeof start!="number"&&isIterateeCall(array,value,start)){start=0;end=length}return baseFill(array,value,start,end)}function findIndex(array,predicate,thisArg){var index=-1,length=array?array.length:0;predicate=getCallback(predicate,thisArg,3);while(++index<length){if(predicate(array[index],index,array)){return index}}return-1}function findLastIndex(array,predicate,thisArg){var length=array?array.length:0;predicate=getCallback(predicate,thisArg,3);while(length--){if(predicate(array[length],length,array)){return length}}return-1}function first(array){return array?array[0]:undefined}function flatten(array,isDeep,guard){var length=array?array.length:0;if(guard&&isIterateeCall(array,isDeep,guard)){isDeep=false}return length?baseFlatten(array,isDeep,false,0):[]}function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,true,false,0):[]}function indexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}if(typeof fromIndex=="number"){fromIndex=fromIndex<0?nativeMax(length+fromIndex,0):fromIndex}else if(fromIndex){var index=binaryIndex(array,value),other=array[index];if(value===value?value===other:other!==other){return index}return-1}return baseIndexOf(array,value,fromIndex||0)}function initial(array){return dropRight(array,1)}function intersection(){var args=[],argsIndex=-1,argsLength=arguments.length,caches=[],indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf;while(++argsIndex<argsLength){var value=arguments[argsIndex];if(isArray(value)||isArguments(value)){args.push(value);caches.push(isCommon&&value.length>=120?createCache(argsIndex&&value):null)}}argsLength=args.length;var array=args[0],index=-1,length=array?array.length:0,result=[],seen=caches[0];outer:while(++index<length){value=array[index];if((seen?cacheIndexOf(seen,value):indexOf(result,value,0))<0){argsIndex=argsLength;while(--argsIndex){var cache=caches[argsIndex];if((cache?cacheIndexOf(cache,value):indexOf(args[argsIndex],value,0))<0){continue outer}}if(seen){seen.push(value)}result.push(value)}}return result}function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=length;if(typeof fromIndex=="number"){index=(fromIndex<0?nativeMax(length+fromIndex,0):nativeMin(fromIndex||0,length-1))+1}else if(fromIndex){index=binaryIndex(array,value,true)-1;var other=array[index];if(value===value?value===other:other!==other){return index}return-1}if(value!==value){return indexOfNaN(array,index,true)}while(index--){if(array[index]===value){return index}}return-1}function pull(){var args=arguments,array=args[0];if(!(array&&array.length)){return array}var index=0,indexOf=getIndexOf(),length=args.length;while(++index<length){var fromIndex=0,value=args[index];while((fromIndex=indexOf(array,value,fromIndex))>-1){splice.call(array,fromIndex,1)}}return array}function pullAt(array){return basePullAt(array||[],baseFlatten(arguments,false,false,1))}function remove(array,predicate,thisArg){var index=-1,length=array?array.length:0,result=[];predicate=getCallback(predicate,thisArg,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);splice.call(array,index--,1);length--}}return result}function rest(array){return drop(array,1)}function slice(array,start,end){var length=array?array.length:0;if(!length){return[]}if(end&&typeof end!="number"&&isIterateeCall(array,start,end)){start=0;end=length}return baseSlice(array,start,end)}function sortedIndex(array,value,iteratee,thisArg){var func=getCallback(iteratee);return func===baseCallback&&iteratee==null?binaryIndex(array,value):binaryIndexBy(array,value,func(iteratee,thisArg,1))}function sortedLastIndex(array,value,iteratee,thisArg){var func=getCallback(iteratee);return func===baseCallback&&iteratee==null?binaryIndex(array,value,true):binaryIndexBy(array,value,func(iteratee,thisArg,1),true)}function take(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}return baseSlice(array,0,n<0?0:n)}function takeRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}n=length-(+n||0);return baseSlice(array,n<0?0:n)}function takeRightWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}predicate=getCallback(predicate,thisArg,3);while(length--&&predicate(array[length],length,array)){}return baseSlice(array,length+1)}function takeWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}var index=-1;predicate=getCallback(predicate,thisArg,3);while(++index<length&&predicate(array[index],index,array)){}return baseSlice(array,0,index)}function union(){return baseUniq(baseFlatten(arguments,false,true,0))}function uniq(array,isSorted,iteratee,thisArg){var length=array?array.length:0;if(!length){return[]}if(isSorted!=null&&typeof isSorted!="boolean"){thisArg=iteratee;iteratee=isIterateeCall(array,isSorted,thisArg)?null:isSorted;isSorted=false}var func=getCallback();if(!(func===baseCallback&&iteratee==null)){iteratee=func(iteratee,thisArg,3)}return isSorted&&getIndexOf()==baseIndexOf?sortedUniq(array,iteratee):baseUniq(array,iteratee)}function unzip(array){var index=-1,length=(array&&array.length&&arrayMax(arrayMap(array,getLength)))>>>0,result=Array(length);while(++index<length){result[index]=arrayMap(array,baseProperty(index))}return result}function without(array){return baseDifference(array,baseSlice(arguments,1))}function xor(){var index=-1,length=arguments.length;while(++index<length){var array=arguments[index];if(isArray(array)||isArguments(array)){var result=result?baseDifference(result,array).concat(baseDifference(array,result)):array}}return result?baseUniq(result):[]}function zip(){var length=arguments.length,array=Array(length);while(length--){array[length]=arguments[length]}return unzip(array)}function zipObject(props,values){var index=-1,length=props?props.length:0,result={};if(length&&!values&&!isArray(props[0])){values=[]}while(++index<length){var key=props[index];if(values){result[key]=values[index]}else if(key){result[key[0]]=key[1]}}return result}function chain(value){var result=lodash(value);result.__chain__=true;return result}function tap(value,interceptor,thisArg){interceptor.call(thisArg,value);return value}function thru(value,interceptor,thisArg){return interceptor.call(thisArg,value)}function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);if(result){previous.__wrapped__=clone}else{result=clone}var previous=clone;parent=parent.__wrapped__}previous.__wrapped__=value;return result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){if(this.__actions__.length){value=new LazyWrapper(this)}return new LodashWrapper(value.reverse(),this.__chain__)}return this.thru(function(value){return value.reverse()})}function wrapperToString(){return this.value()+""}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}function at(collection){var length=collection?collection.length:0;if(isLength(length)){collection=toIterable(collection)}return baseAt(collection,baseFlatten(arguments,false,false,1))}var countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:result[key]=1});function every(collection,predicate,thisArg){var func=isArray(collection)?arrayEvery:baseEvery;if(typeof predicate!="function"||typeof thisArg!="undefined"){predicate=getCallback(predicate,thisArg,3)}return func(collection,predicate)}function filter(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=getCallback(predicate,thisArg,3);return func(collection,predicate)}function find(collection,predicate,thisArg){if(isArray(collection)){var index=findIndex(collection,predicate,thisArg);return index>-1?collection[index]:undefined}predicate=getCallback(predicate,thisArg,3);return baseFind(collection,predicate,baseEach)}function findLast(collection,predicate,thisArg){predicate=getCallback(predicate,thisArg,3);return baseFind(collection,predicate,baseEachRight)}function findWhere(collection,source){return find(collection,baseMatches(source))}function forEach(collection,iteratee,thisArg){return typeof iteratee=="function"&&typeof thisArg=="undefined"&&isArray(collection)?arrayEach(collection,iteratee):baseEach(collection,bindCallback(iteratee,thisArg,3))}function forEachRight(collection,iteratee,thisArg){return typeof iteratee=="function"&&typeof thisArg=="undefined"&&isArray(collection)?arrayEachRight(collection,iteratee):baseEachRight(collection,bindCallback(iteratee,thisArg,3))}var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value)}else{result[key]=[value]}});function includes(collection,target,fromIndex){var length=collection?collection.length:0;if(!isLength(length)){collection=values(collection);length=collection.length}if(!length){return false}if(typeof fromIndex=="number"){fromIndex=fromIndex<0?nativeMax(length+fromIndex,0):fromIndex||0}else{fromIndex=0}return typeof collection=="string"||!isArray(collection)&&isString(collection)?fromIndex<length&&collection.indexOf(target,fromIndex)>-1:getIndexOf(collection,target,fromIndex)>-1}var indexBy=createAggregator(function(result,value,key){result[key]=value});function invoke(collection,methodName){return baseInvoke(collection,methodName,baseSlice(arguments,2))}function map(collection,iteratee,thisArg){var func=isArray(collection)?arrayMap:baseMap;iteratee=getCallback(iteratee,thisArg,3);return func(collection,iteratee)}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});function pluck(collection,key){return map(collection,baseProperty(key))}function reduce(collection,iteratee,accumulator,thisArg){var func=isArray(collection)?arrayReduce:baseReduce;return func(collection,getCallback(iteratee,thisArg,4),accumulator,arguments.length<3,baseEach)}function reduceRight(collection,iteratee,accumulator,thisArg){var func=isArray(collection)?arrayReduceRight:baseReduce;return func(collection,getCallback(iteratee,thisArg,4),accumulator,arguments.length<3,baseEachRight)}function reject(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=getCallback(predicate,thisArg,3);return func(collection,function(value,index,collection){return!predicate(value,index,collection)})}function sample(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):n==null){collection=toIterable(collection);var length=collection.length;return length>0?collection[baseRandom(0,length-1)]:undefined}var result=shuffle(collection);result.length=nativeMin(n<0?0:+n||0,result.length);return result}function shuffle(collection){collection=toIterable(collection);var index=-1,length=collection.length,result=Array(length);while(++index<length){var rand=baseRandom(0,index);if(index!=rand){result[index]=result[rand]}result[rand]=collection[index]}return result}function size(collection){var length=collection?collection.length:0;return isLength(length)?length:keys(collection).length}function some(collection,predicate,thisArg){var func=isArray(collection)?arraySome:baseSome;if(typeof predicate!="function"||typeof thisArg!="undefined"){predicate=getCallback(predicate,thisArg,3)}return func(collection,predicate)}function sortBy(collection,iteratee,thisArg){if(collection==null){return[]}var index=-1,length=collection.length,result=isLength(length)?Array(length):[];if(thisArg&&isIterateeCall(collection,iteratee,thisArg)){iteratee=null}iteratee=getCallback(iteratee,thisArg,3);baseEach(collection,function(value,key,collection){result[++index]={criteria:iteratee(value,key,collection),index:index,value:value}});return baseSortBy(result,compareAscending)}function sortByAll(collection){if(collection==null){return[]}var args=arguments,guard=args[3];if(guard&&isIterateeCall(args[1],args[2],guard)){args=[collection,args[1]]}return baseSortByOrder(collection,baseFlatten(args,false,false,1),[])}function sortByOrder(collection,props,orders,guard){if(collection==null){return[]}if(guard&&isIterateeCall(props,orders,guard)){orders=null}if(!isArray(props)){props=props==null?[]:[props]}if(!isArray(orders)){orders=orders==null?[]:[orders]}return baseSortByOrder(collection,props,orders)}function where(collection,source){return filter(collection,baseMatches(source))}var now=nativeNow||function(){return(new Date).getTime()};function after(n,func){if(typeof func!="function"){if(typeof n=="function"){var temp=n;n=func;func=temp}else{throw new TypeError(FUNC_ERROR_TEXT)}}n=nativeIsFinite(n=+n)?n:0;return function(){if(--n<1){return func.apply(this,arguments)}}}function ary(func,n,guard){if(guard&&isIterateeCall(func,n,guard)){n=null}n=func&&n==null?func.length:nativeMax(+n||0,0);return createWrapper(func,ARY_FLAG,null,null,null,null,n)}function before(n,func){var result;if(typeof func!="function"){if(typeof n=="function"){var temp=n;n=func;func=temp}else{throw new TypeError(FUNC_ERROR_TEXT)}}return function(){if(--n>0){result=func.apply(this,arguments)}else{func=null}return result}}function bind(func,thisArg){var bitmask=BIND_FLAG;if(arguments.length>2){var partials=baseSlice(arguments,2),holders=replaceHolders(partials,bind.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(func,bitmask,thisArg,partials,holders)}function bindAll(object){return baseBindAll(object,arguments.length>1?baseFlatten(arguments,false,false,1):functions(object))}function bindKey(object,key){var bitmask=BIND_FLAG|BIND_KEY_FLAG;if(arguments.length>2){var partials=baseSlice(arguments,2),holders=replaceHolders(partials,bindKey.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(key,bitmask,object,partials,holders)}function curry(func,arity,guard){if(guard&&isIterateeCall(func,arity,guard)){arity=null}var result=createWrapper(func,CURRY_FLAG,null,null,null,null,null,arity);result.placeholder=curry.placeholder;return result}function curryRight(func,arity,guard){if(guard&&isIterateeCall(func,arity,guard)){arity=null}var result=createWrapper(func,CURRY_RIGHT_FLAG,null,null,null,null,null,arity);result.placeholder=curryRight.placeholder;return result}function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=wait<0?0:+wait||0;if(options===true){var leading=true;trailing=false}else if(isObject(options)){leading=options.leading;maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait);trailing="trailing"in options?options.trailing:trailing}function cancel(){if(timeoutId){clearTimeout(timeoutId)}if(maxTimeoutId){clearTimeout(maxTimeoutId)}maxTimeoutId=timeoutId=trailingCall=undefined}function delayed(){var remaining=wait-(now()-stamp);if(remaining<=0||remaining>wait){if(maxTimeoutId){clearTimeout(maxTimeoutId)}var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}}else{timeoutId=setTimeout(delayed,remaining)}}function maxDelayed(){if(timeoutId){clearTimeout(timeoutId)}maxTimeoutId=timeoutId=trailingCall=undefined;if(trailing||maxWait!==wait){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}}function debounced(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId}else{if(!maxTimeoutId&&!leading){lastCalled=stamp}var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||remaining>maxWait;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId)}lastCalled=stamp;result=func.apply(thisArg,args)}else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining)}}if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId)}else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait)}if(leadingCall){isCalled=true;result=func.apply(thisArg,args)}if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=null}return result}debounced.cancel=cancel;return debounced}function defer(func){return baseDelay(func,1,arguments,1)}function delay(func,wait){return baseDelay(func,wait,arguments,2)}var flow=createComposer();var flowRight=createComposer(true);function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,cache=memoized.cache,key=resolver?resolver.apply(this,args):args[0];if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);cache.set(key,result);return result};memoized.cache=new memoize.Cache;return memoized}function negate(predicate){if(typeof predicate!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(){return!predicate.apply(this,arguments)}}function once(func){return before(func,2)}function partial(func){var partials=baseSlice(arguments,1),holders=replaceHolders(partials,partial.placeholder);return createWrapper(func,PARTIAL_FLAG,null,partials,holders)}function partialRight(func){var partials=baseSlice(arguments,1),holders=replaceHolders(partials,partialRight.placeholder);return createWrapper(func,PARTIAL_RIGHT_FLAG,null,partials,holders)}function rearg(func){var indexes=baseFlatten(arguments,false,false,1);return createWrapper(func,REARG_FLAG,null,null,null,indexes)}function spread(func){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(array){return func.apply(this,array)}}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(options===false){leading=false}else if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}debounceOptions.leading=leading;debounceOptions.maxWait=+wait;debounceOptions.trailing=trailing;return debounce(func,wait,debounceOptions)}function wrap(value,wrapper){wrapper=wrapper==null?identity:wrapper;return createWrapper(wrapper,PARTIAL_FLAG,null,[value],[])}function clone(value,isDeep,customizer,thisArg){if(isDeep&&typeof isDeep!="boolean"&&isIterateeCall(value,isDeep,customizer)){isDeep=false}else if(typeof isDeep=="function"){thisArg=customizer;customizer=isDeep;isDeep=false}customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,1);return baseClone(value,isDeep,customizer)}function cloneDeep(value,customizer,thisArg){customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,1);return baseClone(value,true,customizer)}function isArguments(value){var length=isObjectLike(value)?value.length:undefined;return isLength(length)&&objToString.call(value)==argsTag||false}var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag||false};function isBoolean(value){return value===true||value===false||isObjectLike(value)&&objToString.call(value)==boolTag||false}function isDate(value){return isObjectLike(value)&&objToString.call(value)==dateTag||false}function isElement(value){return value&&value.nodeType===1&&isObjectLike(value)&&objToString.call(value).indexOf("Element")>-1||false}if(!support.dom){isElement=function(value){return value&&value.nodeType===1&&isObjectLike(value)&&!isPlainObject(value)||false}}function isEmpty(value){if(value==null){return true}var length=value.length;if(isLength(length)&&(isArray(value)||isString(value)||isArguments(value)||isObjectLike(value)&&isFunction(value.splice))){return!length}return!keys(value).length}function isEqual(value,other,customizer,thisArg){customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,3);
if(!customizer&&isStrictComparable(value)&&isStrictComparable(other)){return value===other}var result=customizer?customizer(value,other):undefined;return typeof result=="undefined"?baseIsEqual(value,other,customizer):!!result}function isError(value){return isObjectLike(value)&&typeof value.message=="string"&&objToString.call(value)==errorTag||false}var isFinite=nativeNumIsFinite||function(value){return typeof value=="number"&&nativeIsFinite(value)};var isFunction=!(baseIsFunction(/x/)||Uint8Array&&!baseIsFunction(Uint8Array))?baseIsFunction:function(value){return objToString.call(value)==funcTag};function isObject(value){var type=typeof value;return type=="function"||value&&type=="object"||false}function isMatch(object,source,customizer,thisArg){var props=keys(source),length=props.length;customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,3);if(!customizer&&length==1){var key=props[0],value=source[key];if(isStrictComparable(value)){return object!=null&&value===object[key]&&hasOwnProperty.call(object,key)}}var values=Array(length),strictCompareFlags=Array(length);while(length--){value=values[length]=source[props[length]];strictCompareFlags[length]=isStrictComparable(value)}return baseIsMatch(object,props,values,strictCompareFlags,customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(value==null){return false}if(objToString.call(value)==funcTag){return reNative.test(fnToString.call(value))}return isObjectLike(value)&&reHostCtor.test(value)||false}function isNull(value){return value===null}function isNumber(value){return typeof value=="number"||isObjectLike(value)&&objToString.call(value)==numberTag||false}var isPlainObject=!getPrototypeOf?shimIsPlainObject:function(value){if(!(value&&objToString.call(value)==objectTag)){return false}var valueOf=value.valueOf,objProto=isNative(valueOf)&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?value==objProto||getPrototypeOf(value)==objProto:shimIsPlainObject(value)};function isRegExp(value){return isObjectLike(value)&&objToString.call(value)==regexpTag||false}function isString(value){return typeof value=="string"||isObjectLike(value)&&objToString.call(value)==stringTag||false}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&typedArrayTags[objToString.call(value)]||false}function isUndefined(value){return typeof value=="undefined"}function toArray(value){var length=value?value.length:0;if(!isLength(length)){return values(value)}if(!length){return[]}return arrayCopy(value)}function toPlainObject(value){return baseCopy(value,keysIn(value))}var assign=createAssigner(baseAssign);function create(prototype,properties,guard){var result=baseCreate(prototype);if(guard&&isIterateeCall(prototype,properties,guard)){properties=null}return properties?baseCopy(properties,result,keys(properties)):result}function defaults(object){if(object==null){return object}var args=arrayCopy(arguments);args.push(assignDefaults);return assign.apply(undefined,args)}function findKey(object,predicate,thisArg){predicate=getCallback(predicate,thisArg,3);return baseFind(object,predicate,baseForOwn,true)}function findLastKey(object,predicate,thisArg){predicate=getCallback(predicate,thisArg,3);return baseFind(object,predicate,baseForOwnRight,true)}function forIn(object,iteratee,thisArg){if(typeof iteratee!="function"||typeof thisArg!="undefined"){iteratee=bindCallback(iteratee,thisArg,3)}return baseFor(object,iteratee,keysIn)}function forInRight(object,iteratee,thisArg){iteratee=bindCallback(iteratee,thisArg,3);return baseForRight(object,iteratee,keysIn)}function forOwn(object,iteratee,thisArg){if(typeof iteratee!="function"||typeof thisArg!="undefined"){iteratee=bindCallback(iteratee,thisArg,3)}return baseForOwn(object,iteratee)}function forOwnRight(object,iteratee,thisArg){iteratee=bindCallback(iteratee,thisArg,3);return baseForRight(object,iteratee,keys)}function functions(object){return baseFunctions(object,keysIn(object))}function has(object,key){return object?hasOwnProperty.call(object,key):false}function invert(object,multiValue,guard){if(guard&&isIterateeCall(object,multiValue,guard)){multiValue=null}var index=-1,props=keys(object),length=props.length,result={};while(++index<length){var key=props[index],value=object[key];if(multiValue){if(hasOwnProperty.call(result,value)){result[value].push(key)}else{result[value]=[key]}}else{result[value]=key}}return result}var keys=!nativeKeys?shimKeys:function(object){if(object){var Ctor=object.constructor,length=object.length}if(typeof Ctor=="function"&&Ctor.prototype===object||typeof object!="function"&&(length&&isLength(length))){return shimKeys(object)}return isObject(object)?nativeKeys(object):[]};function keysIn(object){if(object==null){return[]}if(!isObject(object)){object=Object(object)}var length=object.length;length=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object))&&length||0;var Ctor=object.constructor,index=-1,isProto=typeof Ctor=="function"&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;while(++index<length){result[index]=index+""}for(var key in object){if(!(skipIndexes&&isIndex(key,length))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}function mapValues(object,iteratee,thisArg){var result={};iteratee=getCallback(iteratee,thisArg,3);baseForOwn(object,function(value,key,object){result[key]=iteratee(value,key,object)});return result}var merge=createAssigner(baseMerge);function omit(object,predicate,thisArg){if(object==null){return{}}if(typeof predicate!="function"){var props=arrayMap(baseFlatten(arguments,false,false,1),String);return pickByArray(object,baseDifference(keysIn(object),props))}predicate=bindCallback(predicate,thisArg,3);return pickByCallback(object,function(value,key,object){return!predicate(value,key,object)})}function pairs(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]]}return result}function pick(object,predicate,thisArg){if(object==null){return{}}return typeof predicate=="function"?pickByCallback(object,bindCallback(predicate,thisArg,3)):pickByArray(object,baseFlatten(arguments,false,false,1))}function result(object,key,defaultValue){var value=object==null?undefined:object[key];if(typeof value=="undefined"){value=defaultValue}return isFunction(value)?value.call(object):value}function transform(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);iteratee=getCallback(iteratee,thisArg,4);if(accumulator==null){if(isArr||isObject(object)){var Ctor=object.constructor;if(isArr){accumulator=isArray(object)?new Ctor:[]}else{accumulator=baseCreate(isFunction(Ctor)&&Ctor.prototype)}}else{accumulator={}}}(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}function values(object){return baseValues(object,keys(object))}function valuesIn(object){return baseValues(object,keysIn(object))}function inRange(value,start,end){start=+start||0;if(typeof end==="undefined"){end=start;start=0}else{end=+end||0}return value>=start&&value<end}function random(min,max,floating){if(floating&&isIterateeCall(min,max,floating)){max=floating=null}var noMin=min==null,noMax=max==null;if(floating==null){if(noMax&&typeof min=="boolean"){floating=min;min=1}else if(typeof max=="boolean"){floating=max;noMax=true}}if(noMin&&noMax){max=1;noMax=false}min=+min||0;if(noMax){max=min;min=0}else{max=+max||0}if(floating||min%1||max%1){var rand=nativeRandom();return nativeMin(min+rand*(max-min+parseFloat("1e-"+((rand+"").length-1))),max)}return baseRandom(min,max)}var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?word.charAt(0).toUpperCase()+word.slice(1):word)});function capitalize(string){string=baseToString(string);return string&&string.charAt(0).toUpperCase()+string.slice(1)}function deburr(string){string=baseToString(string);return string&&string.replace(reLatin1,deburrLetter)}function endsWith(string,target,position){string=baseToString(string);target=target+"";var length=string.length;position=typeof position=="undefined"?length:nativeMin(position<0?0:+position||0,length);position-=target.length;return position>=0&&string.indexOf(target,position)==position}function escape(string){string=baseToString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){string=baseToString(string);return string&&reHasRegExpChars.test(string)?string.replace(reRegExpChars,"\\$&"):string}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()});function pad(string,length,chars){string=baseToString(string);length=+length;var strLength=string.length;if(strLength>=length||!nativeIsFinite(length)){return string}var mid=(length-strLength)/2,leftLength=floor(mid),rightLength=ceil(mid);chars=createPad("",rightLength,chars);return chars.slice(0,leftLength)+string+chars}function padLeft(string,length,chars){string=baseToString(string);return string&&createPad(string,length,chars)+string}function padRight(string,length,chars){string=baseToString(string);return string&&string+createPad(string,length,chars)}function parseInt(string,radix,guard){if(guard&&isIterateeCall(string,radix,guard)){radix=0}return nativeParseInt(string,radix)}if(nativeParseInt(whitespace+"08")!=8){parseInt=function(string,radix,guard){if(guard?isIterateeCall(string,radix,guard):radix==null){radix=0}else if(radix){radix=+radix}string=trim(string);return nativeParseInt(string,radix||(reHexPrefix.test(string)?16:10))}}function repeat(string,n){var result="";string=baseToString(string);n=+n;if(n<1||!string||!nativeIsFinite(n)){return result}do{if(n%2){result+=string}n=floor(n/2);string+=string}while(n);return result}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()});var startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+(word.charAt(0).toUpperCase()+word.slice(1))});function startsWith(string,target,position){string=baseToString(string);position=position==null?0:nativeMin(position<0?0:+position||0,string.length);return string.lastIndexOf(target,position)==position}function template(string,options,otherOptions){var settings=lodash.templateSettings;if(otherOptions&&isIterateeCall(string,options,otherOptions)){options=otherOptions=null}string=baseToString(string);options=baseAssign(baseAssign({},otherOptions||options),settings,assignOwnDefaults);var imports=baseAssign(baseAssign({},options.imports),settings.imports,assignOwnDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");var sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){isEscaping=true;source+="' +\n__e("+escapeValue+") +\n'"}if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '"}if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"}index=offset+match.length;return match});source+="';\n";var variable=options.variable;if(!variable){source="with (obj) {\n"+source+"\n}\n"}source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});result.source=source;if(isError(result)){throw result}return result}function trim(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(trimmedLeftIndex(string),trimmedRightIndex(string)+1)}chars=chars+"";return string.slice(charsLeftIndex(string,chars),charsRightIndex(string,chars)+1)}function trimLeft(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(trimmedLeftIndex(string))}return string.slice(charsLeftIndex(string,chars+""))}function trimRight(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(0,trimmedRightIndex(string)+1)}return string.slice(0,charsRightIndex(string,chars+"")+1)}function trunc(string,options,guard){if(guard&&isIterateeCall(string,options,guard)){options=null}var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(options!=null){if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?+options.length||0:length;omission="omission"in options?baseToString(options.omission):omission}else{length=+options||0}}string=baseToString(string);if(length>=string.length){return string}var end=length-omission.length;if(end<1){return omission}var result=string.slice(0,end);if(separator==null){return result+omission}if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,newEnd,substring=string.slice(0,end);if(!separator.global){separator=RegExp(separator.source,(reFlags.exec(separator)||"")+"g")}separator.lastIndex=0;while(match=separator.exec(substring)){newEnd=match.index}result=result.slice(0,newEnd==null?end:newEnd)}}else if(string.indexOf(separator,end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index)}}return result+omission}function unescape(string){string=baseToString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}function words(string,pattern,guard){if(guard&&isIterateeCall(string,pattern,guard)){pattern=null}string=baseToString(string);return string.match(pattern||reWords)||[]}function attempt(){var func=arguments[0],length=arguments.length,args=Array(length?length-1:0);while(--length>0){args[length-1]=arguments[length]}try{return func.apply(undefined,args)}catch(e){return isError(e)?e:new Error(e)}}function callback(func,thisArg,guard){if(guard&&isIterateeCall(func,thisArg,guard)){thisArg=null}return isObjectLike(func)?matches(func):baseCallback(func,thisArg)}function constant(value){return function(){return value}}function identity(value){return value}function matches(source){return baseMatches(baseClone(source,true))}function matchesProperty(key,value){return baseMatchesProperty(key+"",baseClone(value,true))}function mixin(object,source,options){if(options==null){var isObj=isObject(source),props=isObj&&keys(source),methodNames=props&&props.length&&baseFunctions(source,props);if(!(methodNames?methodNames.length:isObj)){methodNames=false;options=source;source=object;object=this}}if(!methodNames){methodNames=baseFunctions(source,keys(source))}var chain=true,index=-1,isFunc=isFunction(object),length=methodNames.length;if(options===false){chain=false}else if(isObject(options)&&"chain"in options){chain=options.chain}while(++index<length){var methodName=methodNames[index],func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(func){return function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__);(result.__actions__=arrayCopy(this.__actions__)).push({func:func,args:arguments,thisArg:object});result.__chain__=chainAll;return result}var args=[this.value()];push.apply(args,arguments);return func.apply(object,args)}}(func)}}return object}function noConflict(){context._=oldDash;return this}function noop(){}function property(key){return baseProperty(key+"")}function propertyOf(object){return function(key){return object==null?undefined:object[key]}}function range(start,end,step){if(step&&isIterateeCall(start,end,step)){end=step=null}start=+start||0;step=step==null?1:+step||0;if(end==null){end=start;start=0}else{end=+end||0}var index=-1,length=nativeMax(ceil((end-start)/(step||1)),0),result=Array(length);while(++index<length){result[index]=start;start+=step}return result}function times(n,iteratee,thisArg){n=+n;if(n<1||!nativeIsFinite(n)){return[]}var index=-1,result=Array(nativeMin(n,MAX_ARRAY_LENGTH));iteratee=bindCallback(iteratee,thisArg,1);while(++index<n){if(index<MAX_ARRAY_LENGTH){result[index]=iteratee(index)}else{iteratee(index)}}return result}function uniqueId(prefix){var id=++idCounter;return baseToString(prefix)+id}function add(augend,addend){return augend+addend}var max=createExtremum(arrayMax);var min=createExtremum(arrayMin,true);function sum(collection){if(!isArray(collection)){collection=toIterable(collection)}var length=collection.length,result=0;while(length--){result+=+collection[length]||0}return result}lodash.prototype=baseLodash.prototype;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;MapCache.prototype["delete"]=mapDelete;MapCache.prototype.get=mapGet;MapCache.prototype.has=mapHas;MapCache.prototype.set=mapSet;SetCache.prototype.push=cachePush;memoize.Cache=MapCache;lodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.callback=callback;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;lodash.flow=flow;lodash.flowRight=flowRight;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.functions=functions;lodash.groupBy=groupBy;lodash.indexBy=indexBy;lodash.initial=initial;lodash.intersection=intersection;lodash.invert=invert;lodash.invoke=invoke;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.mixin=mixin;lodash.negate=negate;lodash.omit=omit;lodash.once=once;lodash.pairs=pairs;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pluck=pluck;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAt=pullAt;lodash.range=range;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortByAll=sortByAll;lodash.sortByOrder=sortByOrder;lodash.spread=spread;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.times=times;lodash.toArray=toArray;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.union=union;lodash.uniq=uniq;lodash.unzip=unzip;lodash.values=values;lodash.valuesIn=valuesIn;lodash.where=where;lodash.without=without;lodash.wrap=wrap;lodash.xor=xor;lodash.zip=zip;lodash.zipObject=zipObject;lodash.backflow=flowRight;lodash.collect=map;lodash.compose=flowRight;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.extend=assign;lodash.iteratee=callback;lodash.methods=functions;lodash.object=zipObject;lodash.select=filter;lodash.tail=rest;lodash.unique=uniq;mixin(lodash,lodash);lodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.deburr=deburr;lodash.endsWith=endsWith;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.findWhere=findWhere;lodash.first=first;lodash.has=has;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isBoolean=isBoolean;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isMatch=isMatch;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isString=isString;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.max=max;lodash.min=min;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padLeft=padLeft;lodash.padRight=padRight;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.result=result;lodash.runInContext=runInContext;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedLastIndex=sortedLastIndex;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.sum=sum;lodash.template=template;lodash.trim=trim;lodash.trimLeft=trimLeft;lodash.trimRight=trimRight;lodash.trunc=trunc;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.words=words;lodash.all=every;lodash.any=some;lodash.contains=includes;lodash.detect=find;lodash.foldl=reduce;lodash.foldr=reduceRight;lodash.head=first;lodash.include=includes;lodash.inject=reduce;mixin(lodash,function(){var source={};baseForOwn(lodash,function(func,methodName){if(!lodash.prototype[methodName]){source[methodName]=func}});return source}(),false);lodash.sample=sample;lodash.prototype.sample=function(n){if(!this.__chain__&&n==null){return sample(this.value())}return this.thru(function(value){return sample(value,n)})};lodash.VERSION=VERSION;arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash});arrayEach(["dropWhile","filter","map","takeWhile"],function(methodName,type){var isFilter=type!=LAZY_MAP_FLAG,isDropWhile=type==LAZY_DROP_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee,thisArg){var filtered=this.__filtered__,result=filtered&&isDropWhile?new LazyWrapper(this):this.clone(),iteratees=result.__iteratees__||(result.__iteratees__=[]);iteratees.push({done:false,count:0,index:0,iteratee:getCallback(iteratee,thisArg,1),limit:-1,type:type});result.__filtered__=filtered||isFilter;return result}});arrayEach(["drop","take"],function(methodName,index){var whileName=methodName+"While";LazyWrapper.prototype[methodName]=function(n){var filtered=this.__filtered__,result=filtered&&!index?this.dropWhile():this.clone();n=n==null?1:nativeMax(floor(n)||0,0);if(filtered){if(index){result.__takeCount__=nativeMin(result.__takeCount__,n)}else{last(result.__iteratees__).limit=n}}else{var views=result.__views__||(result.__views__=[]);views.push({size:n,type:methodName+(result.__dir__<0?"Right":"")})}return result};LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()};LazyWrapper.prototype[methodName+"RightWhile"]=function(predicate,thisArg){return this.reverse()[whileName](predicate,thisArg).reverse()}});arrayEach(["first","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}});arrayEach(["initial","rest"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this[dropName](1)}});arrayEach(["pluck","where"],function(methodName,index){var operationName=index?"filter":"map",createCallback=index?baseMatches:baseProperty;LazyWrapper.prototype[methodName]=function(value){return this[operationName](createCallback(value))}});LazyWrapper.prototype.compact=function(){return this.filter(identity)};LazyWrapper.prototype.reject=function(predicate,thisArg){predicate=getCallback(predicate,thisArg,1);return this.filter(function(value){return!predicate(value)})};LazyWrapper.prototype.slice=function(start,end){start=start==null?0:+start||0;var result=start<0?this.takeRight(-start):this.drop(start);if(typeof end!="undefined"){end=+end||0;result=end<0?result.dropRight(-end):result.take(end-start)}return result};LazyWrapper.prototype.toArray=function(){return this.drop(0)};baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName],checkIteratee=/^(?:filter|map|reject)|While$/.test(methodName),retUnwrapped=/^(?:first|last)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments,length=args.length,chainAll=this.__chain__,value=this.__wrapped__,isHybrid=!!this.__actions__.length,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);if(useLazy&&checkIteratee&&typeof iteratee=="function"&&iteratee.length!=1){isLazy=useLazy=false}var onlyLazy=isLazy&&!isHybrid;if(retUnwrapped&&!chainAll){return onlyLazy?func.call(value):lodashFunc.call(lodash,this.value())}var interceptor=function(value){var otherArgs=[value];push.apply(otherArgs,args);return lodashFunc.apply(lodash,otherArgs)};if(useLazy){var wrapper=onlyLazy?value:new LazyWrapper(this),result=func.apply(wrapper,args);if(!retUnwrapped&&(isHybrid||result.__actions__)){var actions=result.__actions__||(result.__actions__=[]);actions.push({func:thru,args:[interceptor],thisArg:lodash})}return new LodashWrapper(result,chainAll)}return this.thru(interceptor)}});arrayEach(["concat","join","pop","push","replace","shift","sort","splice","split","unshift"],function(methodName){var func=(/^(?:replace|split)$/.test(methodName)?stringProto:arrayProto)[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:join|pop|replace|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){return func.apply(this.value(),args)}return this[chainName](function(value){return func.apply(value,args)})}});LazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toString=wrapperToString;lodash.prototype.run=lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;lodash.prototype.collect=lodash.prototype.map;lodash.prototype.head=lodash.prototype.first;lodash.prototype.select=lodash.prototype.filter;lodash.prototype.tail=lodash.prototype.rest;return lodash}var _=runInContext();if(true){root._=_;!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return _}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else if(freeExports&&freeModule){if(moduleExports){(freeModule.exports=_)._=_}else{freeExports._=_}}else{root._=_}}).call(this)}).call(exports,__webpack_require__(140)(module),function(){return this}())},function(module,exports){module.exports=function(module){if(!module.webpackPolyfill){module.deprecate=function(){};module.paths=[];module.children=[];module.webpackPolyfill=1}return module}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _MapComponent=__webpack_require__(142);var _MapComponent2=_interopRequireDefault(_MapComponent);var _SearchComponent=__webpack_require__(149);var _SearchComponent2=_interopRequireDefault(_SearchComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const isArray=_writer.lodash.isArray;const isObject=_writer.lodash.isObject;const find=_writer.lodash.find;class LocationDetailComponent extends _substance.Component{constructor(...args){super(...args);this.handleActions({googleMapsLoaded:this.googleMapsLoaded,searchItemSelected:this.searchItemSelected,markerPositionChanged:this.markerPositionChanged})}dispose(){super.dispose()}createIdForObject(){this.state.location.concept.metadata.object["@id"]=(0,_writer.idGenerator)()}createLocation(){const location=this.state.location;this.createIdForObject();this.saveLocation(null,"POST").then(uuid=>{this.context.api.newsItem.addLocation(this.name,{title:location.concept.name,data:this.getGeometryObject(),uuid:uuid,type:this.getLocationType()});if(this.state.error){this.setState({error:false})}this.props.reload();this.send("close")}).catch(()=>this.setState({error:true}))}updateLocation(){const location=this.state.location;const uuid=location["@guid"]?location["@guid"]:null;if(!uuid){throw new Error("ConceptItem has no UUID to update")}this.saveLocation(uuid,"PUT").then(()=>{this.context.api.newsItem.updateLocation(this.name,{title:location.concept.name,data:this.getGeometryObject(),uuid:uuid,type:this.getLocationType()});if(this.state.error){this.setState({error:false})}this.props.reload();this.send("close")}).catch(()=>this.setState({error:true}))}getGeometryObject(){const geometry=findAttribute(this.state.location,"geometry");if(geometry){return{position:this.state.location.concept.metadata.object.data.geometry}}else{return{}}}setDescription(inputValue,role){const currentDescription=this.context.api.concept.getDefinitionForType(this.state.location.concept.definition,role);if(inputValue.length>0&&!currentDescription){const longDesc={"@role":role,keyValue:inputValue};this.state.location.concept.definition=this.context.api.concept.setDefinitionDependingOnArrayOrObject(this.state.location.concept.definition,longDesc)}else if(inputValue.length>=0&&currentDescription){currentDescription["keyValue"]=inputValue}}saveLocation(id,method){const location=this.state.location;location.concept.name=this.refs.locationNameInput.val().length>0?this.refs.locationNameInput.val():location.concept.name;const shortDescriptionInputValue=this.refs.locationShortDescInput.val();const longDescriptionInputValue=this.refs.locationLongDescText.val();if(!location.concept.definition){location.concept.definition=[]}this.setDescription(shortDescriptionInputValue,"drol:short");this.setDescription(longDescriptionInputValue,"drol:long");this.xmlDoc=_writer.jxon.unbuild(location,null,"conceptItem");const conceptItem=this.xmlDoc.documentElement.outerHTML;switch(method){case"PUT":return this.context.api.router.updateConceptItem(id,conceptItem);case"POST":return this.context.api.router.createConceptItem(conceptItem)}}searchItemSelected(googleLatLng){this.markerPositionChanged({lat:googleLatLng.lat(),lng:googleLatLng.lng()});this.refs.mapComponent.setProps({
googleLatLng:googleLatLng})}googleMapsLoaded(google){this.google=google;if(this.state.newLocation&&this.state.query){try{this.refs.searchComponent.setProps({google:google,query:this.state.query})}catch(e){}}else{this.refs.searchComponent.setProps({google:google})}this.extendState({googleMapsLoaded:true})}updateMapPosition(){const latlng=this.getLatLngFromLoadedLocation();this.refs.mapComponent.setProps({googleLatLng:new this.google.maps.LatLng(latlng.lat,latlng.lng)})}updateMapPositionPolygon(){const wktPolygon=this.state.location.concept.metadata.object.data.geometry;try{this.refs.mapComponent.setProps({isPolygon:true,wktString:wktPolygon})}catch(e){console.error("e",e)}}getLatLngFromLoadedLocation(){const geometry=findAttribute(this.state.location.concept,"geometry");if(!geometry){return{lat:0,lng:0}}const latLongString=/POINT\((\-?[0-9\.\s]+)\)/.exec(geometry)[1].split(" ");return{lat:latLongString[1],lng:latLongString[0]}}markerPositionChanged(latLng){if(!this.state.location.concept.metadata.object.data){this.state.location.concept.metadata.object.data={}}this.state.location.concept.metadata.object.data.geometry="POINT("+latLng.lng+" "+latLng.lat+")"}getDescription(descriptionType){const locationConcept=this.state.location.concept;if(!locationConcept.definition){return undefined}if(isArray(locationConcept.definition)){return find(locationConcept.definition,function(definition){return definition["@role"]===descriptionType})}else if(isObject(locationConcept.definition)){return locationConcept.definition["@role"]===descriptionType?locationConcept.definition:undefined}}willReceiveProps(props){this.extendState({query:props.query,newLocation:props.newLocation,location:props.location,editable:props.editable})}getNameForLocation(){if(this.state.query){return this.state.query}else{return this.state.location.concept.name}}render($$){let shortDesc="",longDesc="";const name=this.getNameForLocation();if(this.state.googleMapsLoaded){shortDesc=this.getDescription("drol:short");longDesc=this.getDescription("drol:long");shortDesc=shortDesc?shortDesc:"";longDesc=longDesc?longDesc:"";if(this.state.location.concept.metadata.object["@type"]==="x-im/polygon"){console.warn("Edit of polygons is not yet supported");this.searchDisabled=true;this.isPolygon=true;this.updateMapPositionPolygon()}else{this.updateMapPosition()}}const el=$$("div");const formContainer=$$("form").addClass("location-form__container container").ref("formContainer").on("submit",e=>{e.preventDefault();if(this.refs["locationNameInput"].val()!==""){this.onClose("save")}});const rowContainer=$$("div").addClass("row");const hiddenSubmitButtonToEnableEnterSubmit=$$("input").attr({type:"submit",style:"display:none"});rowContainer.append(hiddenSubmitButtonToEnableEnterSubmit);const formGroup=$$("fieldset").addClass("form-group col-6").ref("formGroupName");formGroup.append($$("label").attr("for","locationNameInput").append(this.getLabel("Name")));if(this.state.editable){const locationName=$$("input").attr({type:"text",id:"locationNameInput"}).addClass("form-control").val(name).ref("locationNameInput");locationName.on("change",function(){if(this.refs["locationNameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}}.bind(this));formGroup.append(locationName)}else{formGroup.append($$("p").append(name).ref("locationNameP"))}rowContainer.append(formGroup);const formGroupShortDesc=$$("fieldset").addClass("form-group col-6").ref("formGroupShortDesc");formGroupShortDesc.append($$("label").attr("for","locationShortDescInput").append(this.getLabel("Short description")));if(this.state.editable){formGroupShortDesc.append($$("input").attr({id:"locationShortDescInput"}).addClass("form-control").val(shortDesc["keyValue"]).ref("locationShortDescInput"))}else{formGroupShortDesc.append($$("p").append(shortDesc["keyValue"]).ref("locationShortDescP"))}rowContainer.append(formGroupShortDesc);const formGroupLongDesc=$$("fieldset").addClass("form-group col-12").ref("formGroupLongDesc");formGroupLongDesc.append($$("label").attr("for","locationLongDescText").append(this.getLabel("Long description")));if(this.state.editable){formGroupLongDesc.append($$("textarea").attr({id:"locationLongDescText"}).addClass("form-control").val(longDesc["keyValue"]).ref("locationLongDescText"))}else{formGroupLongDesc.append($$("p").append(longDesc["keyValue"]).ref("locationLongDescP"))}rowContainer.append(formGroupLongDesc);formContainer.append(rowContainer);el.append(formContainer);if(this.props.exists){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-info").append(this.getLabel("Please note that this name is already in use")+": "+this.state.query)))}if(!this.searchDisabled){const searchComponent=$$(_SearchComponent2.default).ref("searchComponent");el.append(searchComponent)}if(this.isPolygon){el.append($$("p").addClass("col-12 not-supported").append(this.getLabel("Edit of polygons is not currently supported")))}const mapComponent=$$(_MapComponent2.default,{pluginId:this.props.plugin.id}).ref("mapComponent");el.append(mapComponent);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.context.i18n.t("ximplace-error-save"))))}return el}onClose(status){if("cancel"===status||this.state.editable===false){return true}if(this.state.newLocation){this.createLocation()}else{this.updateLocation()}return false}getLocationType(){const useGeometryType=this.context.api.getConfigValue("se.infomaker.ximplace","useGeometryType");if(useGeometryType){let locationType="";try{if(typeof this.state.location.concept.metadata.object["@type"]!=="undefined"){locationType=this.state.location.concept.metadata.object["@type"]}}catch(ex){console.error(ex);throw new Error("Invalid conceptItem for location")}if(locationType){return locationType}else{throw new Error("Invalid conceptItem for location. Missing object type")}}else{return"x-im/place"}}}function findAttribute(object,attribute){let match;function iterateObject(target,name){Object.keys(target).forEach(function(key){if(isObject(target[key])){iterateObject(target[key],name)}else if(key===name){match=target[key]}})}iterateObject(object,attribute);return match?match:undefined}exports.default=LocationDetailComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _googleMapsApiLoader=__webpack_require__(143);var _googleMapsApiLoader2=_interopRequireDefault(_googleMapsApiLoader);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class MapComponent extends _substance.Component{constructor(...args){super(...args)}handleWKTPolygon(wktString){var ptsArray=[];function addPoints(google,data){var pointsData=data.split(",");var len=pointsData.length;for(var i=0;i<len;i++){var xy=pointsData[i].split(" ");var pt=new google.maps.LatLng(xy[1],xy[0]);ptsArray.push(pt)}}var regex=/\(([^()]+)\)/g;var wktRings=[];var results;wktString=wktString.replace(/ +(?= )/g,"");do{results=regex.exec(wktString);if(results){wktRings.push(results[1])}}while(results);for(var i=0;i<wktRings.length;i++){addPoints(this.google,wktRings[i])}var poly=new this.google.maps.Polygon({paths:ptsArray,strokeColor:"#3A99D9",strokeOpacity:.8,strokeWeight:2,fillColor:"#1E90FF",fillOpacity:.35});poly.setMap(this.map);this.map.setZoom(9)}dispose(){this.map.unbindAll()}getDefaultMapOptions(){var latlng=new google.maps.LatLng(56.683687,16.363279);return{zoom:14,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:false}}didMount(){var apiKey=this.context.api.getConfigValue(this.props.pluginId,"googleMapAPIKey");(0,_googleMapsApiLoader2.default)({libraries:["geometry","places"],apiKey:apiKey}).then(googleApi=>{this.googleMapsLoaded(googleApi)},err=>{console.error(err)})}googleMapsLoaded(google){this.google=google;let mapContaienr=document.getElementById("map-container");this.map=new google.maps.Map(mapContaienr,this.getDefaultMapOptions());this.send("googleMapsLoaded",google)}setMarker(googleLatLong){if(this.marker){this.marker.position=googleLatLong}else{this.marker=new google.maps.Marker({position:googleLatLong,icon:{path:google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,strokeColor:"#2a6f9e",strokeOpacity:1,strokeWeight:2,fillColor:"#3A99D9",fillOpacity:.35,scale:4},draggable:true});this.marker.addListener("dragend",function(event){this.send("markerPositionChanged",{lat:event.latLng.lat(),lng:event.latLng.lng()})}.bind(this))}this.marker.setMap(this.map)}updateMapLocation(googleLatLng){this.map.setCenter(googleLatLng);this.setMarker(googleLatLng)}willReceiveProps(props){if(props.googleLatLng){this.updateMapLocation(props.googleLatLng)}else if(props.isPolygon){this.handleWKTPolygon(props.wktString)}}shouldRerender(){return false}render($$){var el=$$("div").ref("mapComponent");var mapContainer=$$("div").attr("id","map-container").ref("mapContainer");el.append(mapContainer);return el}}exports.default=MapComponent},function(module,exports,__webpack_require__){module.exports=__webpack_require__(144)},function(module,exports,__webpack_require__){"use strict";var Promise=__webpack_require__(145).Promise;var urlBuilder=__webpack_require__(148);var googleApi;function loadAutoCompleteAPI(params){var script=document.createElement("script");script.type="text/javascript";script.src=urlBuilder({base:"https://maps.googleapis.com/maps/api/js",libraries:params.libraries||[],callback:"googleMapsAutoCompleteAPILoad",apiKey:params.apiKey,client:params.client});document.querySelector("head").appendChild(script)}function googleMapsApiLoader(params){if(googleApi){return Promise.resolve(googleApi)}var windowRef=window?window:{};var deferred=function(resolve,reject){loadAutoCompleteAPI(params);windowRef.googleMapsAutoCompleteAPILoad=function(){googleApi=windowRef.google;resolve(googleApi)};setTimeout(function(){if(!windowRef.google){reject(new Error("Loading took too long"))}},5e3)};return new Promise(deferred)}module.exports=googleMapsApiLoader},function(module,exports,__webpack_require__){var require;(function(process,global){(function(global,factory){true?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.ES6Promise=factory()})(this,function(){"use strict";function objectOrFunction(x){return typeof x==="function"||typeof x==="object"&&x!==null}function isFunction(x){return typeof x==="function"}var _isArray=undefined;if(!Array.isArray){_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}}else{_isArray=Array.isArray}var isArray=_isArray;var len=0;var vertxNext=undefined;var customSchedulerFn=undefined;var asap=function asap(callback,arg){queue[len]=callback;queue[len+1]=arg;len+=2;if(len===2){if(customSchedulerFn){customSchedulerFn(flush)}else{scheduleFlush()}}};function setScheduler(scheduleFn){customSchedulerFn=scheduleFn}function setAsap(asapFn){asap=asapFn}var browserWindow=typeof window!=="undefined"?window:undefined;var browserGlobal=browserWindow||{};var BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver;var isNode=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function useNextTick(){return function(){return process.nextTick(flush)}}function useVertxTimer(){if(typeof vertxNext!=="undefined"){return function(){vertxNext(flush)}}return useSetTimeout()}function useMutationObserver(){var iterations=0;var observer=new BrowserMutationObserver(flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=flush;return function(){return channel.port2.postMessage(0)}}function useSetTimeout(){var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1)}}var queue=new Array(1e3);function flush(){for(var i=0;i<len;i+=2){var callback=queue[i];var arg=queue[i+1];callback(arg);queue[i]=undefined;queue[i+1]=undefined}len=0}function attemptVertx(){try{var r=require;var vertx=__webpack_require__(147);vertxNext=vertx.runOnLoop||vertx.runOnContext;return useVertxTimer()}catch(e){return useSetTimeout()}}var scheduleFlush=undefined;if(isNode){scheduleFlush=useNextTick()}else if(BrowserMutationObserver){scheduleFlush=useMutationObserver()}else if(isWorker){scheduleFlush=useMessageChannel()}else if(browserWindow===undefined&&"function"==="function"){scheduleFlush=attemptVertx()}else{scheduleFlush=useSetTimeout()}function then(onFulfillment,onRejection){var _arguments=arguments;var parent=this;var child=new this.constructor(noop);if(child[PROMISE_ID]===undefined){makePromise(child)}var _state=parent._state;if(_state){(function(){var callback=_arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result)})})()}else{subscribe(parent,child,onFulfillment,onRejection)}return child}function resolve(object){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}var promise=new Constructor(noop);_resolve(promise,object);return promise}var PROMISE_ID=Math.random().toString(36).substring(16);function noop(){}var PENDING=void 0;var FULFILLED=1;var REJECTED=2;var GET_THEN_ERROR=new ErrorObject;function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function getThen(promise){try{return promise.then}catch(error){GET_THEN_ERROR.error=error;return GET_THEN_ERROR}}function tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function handleForeignThenable(promise,thenable,then){asap(function(promise){var sealed=false;var error=tryThen(then,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){_resolve(promise,value)}else{fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;_reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;_reject(promise,error)}},promise)}function handleOwnThenable(promise,thenable){if(thenable._state===FULFILLED){fulfill(promise,thenable._result)}else if(thenable._state===REJECTED){_reject(promise,thenable._result)}else{subscribe(thenable,undefined,function(value){return _resolve(promise,value)},function(reason){return _reject(promise,reason)})}}function handleMaybeThenable(promise,maybeThenable,then$$){if(maybeThenable.constructor===promise.constructor&&then$$===then&&maybeThenable.constructor.resolve===resolve){handleOwnThenable(promise,maybeThenable)}else{if(then$$===GET_THEN_ERROR){_reject(promise,GET_THEN_ERROR.error)}else if(then$$===undefined){fulfill(promise,maybeThenable)}else if(isFunction(then$$)){handleForeignThenable(promise,maybeThenable,then$$)}else{fulfill(promise,maybeThenable)}}}function _resolve(promise,value){if(promise===value){_reject(promise,selfFulfillment())}else if(objectOrFunction(value)){handleMaybeThenable(promise,value,getThen(value))}else{fulfill(promise,value)}}function publishRejection(promise){if(promise._onerror){promise._onerror(promise._result)}publish(promise)}function fulfill(promise,value){if(promise._state!==PENDING){return}promise._result=value;promise._state=FULFILLED;if(promise._subscribers.length!==0){asap(publish,promise)}}function _reject(promise,reason){if(promise._state!==PENDING){return}promise._state=REJECTED;promise._result=reason;asap(publishRejection,promise)}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers;var length=_subscribers.length;parent._onerror=null;_subscribers[length]=child;_subscribers[length+FULFILLED]=onFulfillment;_subscribers[length+REJECTED]=onRejection;if(length===0&&parent._state){asap(publish,parent)}}function publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return}var child=undefined,callback=undefined,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function ErrorObject(){this.error=null}var TRY_CATCH_ERROR=new ErrorObject;function tryCatch(callback,detail){try{return callback(detail)}catch(e){TRY_CATCH_ERROR.error=e;return TRY_CATCH_ERROR}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=undefined,error=undefined,succeeded=undefined,failed=undefined;if(hasCallback){value=tryCatch(callback,detail);if(value===TRY_CATCH_ERROR){failed=true;error=value.error;value=null}else{succeeded=true}if(promise===value){_reject(promise,cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==PENDING){}else if(hasCallback&&succeeded){_resolve(promise,value)}else if(failed){_reject(promise,error)}else if(settled===FULFILLED){fulfill(promise,value)}else if(settled===REJECTED){_reject(promise,value)}}function initializePromise(promise,resolver){try{resolver(function resolvePromise(value){_resolve(promise,value)},function rejectPromise(reason){_reject(promise,reason)})}catch(e){_reject(promise,e)}}var id=0;function nextId(){return id++}function makePromise(promise){promise[PROMISE_ID]=id++;promise._state=undefined;promise._result=undefined;promise._subscribers=[]}function Enumerator(Constructor,input){this._instanceConstructor=Constructor;this.promise=new Constructor(noop);if(!this.promise[PROMISE_ID]){makePromise(this.promise)}if(isArray(input)){this._input=input;this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0){fulfill(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){fulfill(this.promise,this._result)}}}else{_reject(this.promise,validationError())}}function validationError(){return new Error("Array Methods must be provided an Array")}Enumerator.prototype._enumerate=function(){var length=this.length;var _input=this._input;for(var i=0;this._state===PENDING&&i<length;i++){this._eachEntry(_input[i],i)}};Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor;var resolve$$=c.resolve;if(resolve$$===resolve){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING){this._settledAt(entry._state,i,entry._result)}else if(typeof _then!=="function"){this._remaining--;this._result[i]=entry}else if(c===Promise){var promise=new c(noop);handleMaybeThenable(promise,entry,_then);this._willSettleAt(promise,i)}else{this._willSettleAt(new c(function(resolve$$){return resolve$$(entry)}),i)}}else{this._willSettleAt(resolve$$(entry),i)}};Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;if(promise._state===PENDING){this._remaining--;if(state===REJECTED){_reject(promise,value)}else{this._result[i]=value}}if(this._remaining===0){fulfill(promise,this._result)}};Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;subscribe(promise,undefined,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})};function all(entries){return new Enumerator(this,entries).promise}function race(entries){var Constructor=this;if(!isArray(entries)){return new Constructor(function(_,reject){return reject(new TypeError("You must pass an array to race."))})}else{return new Constructor(function(resolve,reject){var length=entries.length;for(var i=0;i<length;i++){Constructor.resolve(entries[i]).then(resolve,reject)}})}}function reject(reason){var Constructor=this;var promise=new Constructor(noop);_reject(promise,reason);return promise}function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Promise(resolver){this[PROMISE_ID]=nextId();this._result=this._state=undefined;this._subscribers=[];if(noop!==resolver){typeof resolver!=="function"&&needsResolver();this instanceof Promise?initializePromise(this,resolver):needsNew()}}Promise.all=all;Promise.race=race;Promise.resolve=resolve;Promise.reject=reject;Promise._setScheduler=setScheduler;Promise._setAsap=setAsap;Promise._asap=asap;Promise.prototype={constructor:Promise,then:then,catch:function _catch(onRejection){return this.then(null,onRejection)}};function polyfill(){var local=undefined;if(typeof global!=="undefined"){local=global}else if(typeof self!=="undefined"){local=self}else{try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e){}if(promiseToString==="[object Promise]"&&!P.cast){return}}local.Promise=Promise}Promise.polyfill=polyfill;Promise.Promise=Promise;return Promise})}).call(exports,__webpack_require__(146),function(){return this}())},function(module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},function(module,exports){},function(module,exports){"use strict";function urlBuilder(params){var builtUrl=params.base;builtUrl+="?";if(params.apiKey){builtUrl+="key="+params.apiKey+"&"}if(params.client){builtUrl+="client="+params.client+"&"}if(params.libraries.length>0){builtUrl+="libraries=";params.libraries.forEach(function(library,index){builtUrl+=library;if(index!==params.libraries.length-1){builtUrl+=","}});builtUrl+="&"}builtUrl+="callback="+params.callback;return builtUrl}module.exports=urlBuilder},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class SearchComponent extends _substance.Component{constructor(...args){super(...args)}getInitialState(){return{searchResults:[],googleMapsLoaded:false}}didMount(){}willReceiveProps(props){let newState={};if(props.google){this.google=props.google;newState.googleMapsLoaded=true;if(props.query){newState.query=props.query;this.populateInitialQuery(props.query)}}if(Object.keys(newState).length>0){this.extendState(newState)}}populateInitialQuery(initialQuery){this.makeInitialSearch(initialQuery)}render($$){var el=$$("div").addClass("search-container").ref("searchContainer");var tmpSearch=$$("div").ref("tmpSearchContainer");el.append(tmpSearch);var container=$$("div").ref("searchContainer").addClass("search-component__main clearfix");if(this.state.googleMapsLoaded){var searchForm=$$("form").attr("style","display:flex").on("submit",this.search.bind(this)).ref("searchForm");var searchInput=$$("input").addClass("form-control search__query col-xs-9").ref("searchInput").val(this.state.query).attr("placeholder",this.getLabel("Address or place"));var searchButton=$$("button").addClass("btn btn-neutral col-xs-3").append(this.getLabel("Search")).on("click",this.search.bind(this)).ref("serchButton");searchForm.append([searchInput,searchButton]);container.append(searchForm);var searchList=$$("ul").ref("searchList");var items=this.state.searchResults.map(function(result){var lat=result.geometry.location.lat();var lng=result.geometry.location.lng();return $$("li").append(result.name).on("click",function(){this.send("searchItemSelected",new google.maps.LatLng(lat,lng))}.bind(this))}.bind(this));searchList.append(items);if(this.state.isSearching){container.append(searchList)}el.append(container)}else{el.append($$("span").append("Waiting for maps to load"))}return el}searchDone(results,status){if(status===this.google.maps.places.PlacesServiceStatus.OK&&results[0]){this.extendState({searchResults:results})}}search(e){this.extendState({isSearching:true});e.preventDefault();var request={query:this.refs.searchInput.val()};var service=new this.google.maps.places.PlacesService(this.refs.tmpSearchContainer.el.el);service.textSearch(request,this.searchDone.bind(this))}makeInitialSearch(query){var request={query:query};var service=new this.google.maps.places.PlacesService(this.refs.tmpSearchContainer.el.el);service.textSearch(request,function(results,status){if(status===this.google.maps.places.PlacesServiceStatus.OK&&results[0]){var lat=results[0].geometry.location.lat();var lng=results[0].geometry.location.lng();this.send("searchItemSelected",new google.maps.LatLng(lat,lng))}}.bind(this))}}exports.default=SearchComponent},function(module,exports){"use strict";module.exports={place:'<?xml version="1.0" encoding="UTF-8"?> '+'<conceptItem xmlns="http://iptc.org/std/nar/2006-10-01/" version="1" standard="NewsML-G2" standardversion="2.20" conformance="power"> '+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/> '+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/> '+"<itemMeta> "+'<itemClass qcode="cinat:concept"/> '+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/> '+'<itemMetaExtProperty type="imext:type" value="x-im/place"/> '+"</itemMeta> "+"<concept> "+'<conceptId uri="im://place/"/> '+'<type qcode="cpnat:poi"/>'+"<name></name>"+'<definition role="drol:long"></definition> '+'<definition role="drol:short"></definition> '+'<metadata xmlns="http://www.infomaker.se/newsml/1.0"> '+'<object id="" type="x-im/position"> '+"<data> "+"<geometry>POINT(14.55600 56.89921)</geometry> "+"</data> "+"</object> "+"</metadata> "+"</concept> "+"</conceptItem>"}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(133);var _XimPlacePackageConfigure=__webpack_require__(135);var _XimPlacePackageConfigure2=_interopRequireDefault(_XimPlacePackageConfigure);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const id="se.infomaker.ximplace-polygon";exports.default={id:id,name:"ximplace",configure:(0,_XimPlacePackageConfigure2.default)(id)}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(133);var _XimPlacePackageConfigure=__webpack_require__(135);var _XimPlacePackageConfigure2=_interopRequireDefault(_XimPlacePackageConfigure);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const id="se.infomaker.ximplace-position";exports.default={id:id,name:"ximplace",configure:(0,_XimPlacePackageConfigure2.default)(id)}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _AuthorPackage=__webpack_require__(154);var _AuthorPackage2=_interopRequireDefault(_AuthorPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_AuthorPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(155);__webpack_require__(157);var _AuthorMainComponent=__webpack_require__(159);var _AuthorMainComponent2=_interopRequireDefault(_AuthorMainComponent);var _AuthorValidation=__webpack_require__(163);var _AuthorValidation2=_interopRequireDefault(_AuthorValidation);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.ximauthor",name:"ximauthor",configure:function configure(config){config.addLabel("validation-no-author",{en:"No author specified",sv:"Ingen författare är vald"});config.addLabel("Search authors",{sv:"Sök författare"});config.addLabel("Authors",{sv:"Författare"});config.addLabel("Enter author",{sv:"Ange författare"});config.addLabel("Add",{sv:"Lägg till"});config.addLabel("Add new",{sv:"Lägg till ny"});config.addValidator(_AuthorValidation2.default);config.addComponentToSidebarWithTabId(this.id,"main",_AuthorMainComponent2.default)}}},function(module,exports){},,function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _AuthorListComponent=__webpack_require__(160);var _AuthorListComponent2=_interopRequireDefault(_AuthorListComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class AuthorMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximauthor"}didMount(){}getInitialState(){return{existingAuthors:_writer.api.newsItem.getAuthors()}}reloadAuthors(){this.extendState({existingAuthors:_writer.api.newsItem.getAuthors()})}render($$){const noSearch=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"noSearch");const el=$$("div").ref("authorContainer").addClass("authors").append($$("h2").append(this.getLabel("Authors")));
let searchComponent;if(noSearch){const AuthorAddComponent=this.context.componentRegistry.get("form-add");searchComponent=$$(AuthorAddComponent,{existingItems:this.state.existingAuthors,onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Enter author")}).ref("authorSearchComponent")}else{const AuthorSearchComponent=this.context.componentRegistry.get("form-search");searchComponent=$$(AuthorSearchComponent,{existingItems:this.state.existingAuthors,searchUrl:"/api/search/concepts/authors?q=",onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Search authors")}).ref("authorSearchComponent")}const existingAuthorsList=$$(_AuthorListComponent2.default,{existingAuthors:this.state.existingAuthors,removeAuthor:this.removeAuthor.bind(this)}).ref("existingAuthorList");el.append(existingAuthorsList);el.append(searchComponent);return el}removeAuthor(author){try{if(_writer.NilUUID.isNilUUID(author.uuid)){_writer.api.newsItem.removeAuthorByTitle(this.name,author.title)}else{_writer.api.newsItem.removeAuthorByUUID(this.name,author.uuid)}this.reloadAuthors()}catch(e){console.error(e)}}addAuthor(author){try{_writer.api.newsItem.addAuthor(this.name,author);this.reloadAuthors()}catch(e){console.error("e",e)}}createAuthor(authorTemp){_writer.api.newsItem.addSimpleAuthor(this.name,authorTemp.inputValue);this.reloadAuthors()}}exports.default=AuthorMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _AuthorItemComponent=__webpack_require__(161);var _AuthorItemComponent2=_interopRequireDefault(_AuthorItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class AuthorListComponent extends _substance.Component{getIdForRef(author){if(_writer.NilUUID.isNilUUID(author.uuid)){return"author-"+author.title.replace(" ","")}else if(author.uuid){return"author-"+author.uuid}else{console.warn("No UUID")}}render($$){var existingAuthors=this.props.existingAuthors;var authorList=$$("ul").addClass("authors__list");existingAuthors.forEach(author=>{authorList.append($$(_AuthorItemComponent2.default,{author:author,removeAuthor:this.deleteAuthorAndReference.bind(this)}).ref(this.getIdForRef(author)))});return authorList}deleteAuthorAndReference(author){this.refs[this.getIdForRef(author)].remove();delete this.refs[this.getIdForRef(author)];this.props.removeAuthor(author)}}exports.default=AuthorListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _lodash=__webpack_require__(139);var _AuthorInfoComponent=__webpack_require__(162);var _AuthorInfoComponent2=_interopRequireDefault(_AuthorInfoComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class AuthorItemComponent extends _substance.Component{constructor(...args){super(...args);this.handleActions({avatarLoaded:this.avatarLoaded})}didMount(){}getInitialState(){return{name:undefined,isLoaded:false,isSimpleAuthor:false,loadedAuthor:{}}}dispose(){super.dispose()}loadAuthor(){if(_writer.NilUUID.isNilUUID(this.props.author.uuid)&&this.props.author.title){setTimeout(function(){this.setState({name:this.props.author.title,isLoaded:true,isSimpleAuthor:true,loadedAuthor:{name:this.props.author.title}})}.bind(this),1)}else{this.context.api.router.getConceptItem(this.props.author.uuid,this.props.author.type).then(function(dom){var conceptXML=dom.querySelector("concept");var linksXML=dom.querySelector("itemMeta links");var jsonFormat=_writer.jxon.build(conceptXML);var authorLinks;if(linksXML){authorLinks=_writer.jxon.build(linksXML)}this.setState({name:jsonFormat.name,isLoaded:true,isSimpleAuthor:false,loadedAuthor:jsonFormat,loadedAuhtorLinks:authorLinks})}.bind(this)).catch(function(){this.setState({name:this.props.author.title,isLoaded:true,isSimpleAuthor:true,loadedAuthor:{name:this.props.author.title}})}.bind(this))}}render($$){var author=this.props.author,authorItem=$$("li").addClass("authors__list-item").addClass("clearfix").ref("authorItem"),displayTitle=this.state.name?this.state.name:author.title;var deleteButton=$$("button").addClass("author__button--delete").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"})).attr("title",this.getLabel("Remove from article")).on("click",function(){this.removeAuthor(author)}.bind(this));if(!this.state.isLoaded){this.loadAuthor()}else if(this.state.isSimpleAuthor){this.populateElementsForSimpleAuthor($$,authorItem,displayTitle,deleteButton)}else{this.populateElementForAuthor($$,authorItem,author,displayTitle,deleteButton)}authorItem.on("mouseenter",this.showHover);authorItem.on("mouseleave",this.hideHover);return authorItem}populateElementsForSimpleAuthor($$,authorItem,displayTitle,deleteButton){authorItem.append($$("div").addClass("avatar__container").append($$(_substance.FontAwesomeIcon,{icon:"fa-user"}))).append($$("div").addClass("metadata__container").append($$("span").append(displayTitle).addClass("author__name notClickable meta")).attr("title",this.getLabel("Not editable author"))).append($$("div").addClass("button__container").append(deleteButton))}populateElementForAuthor($$,authorItem,author,displayTitle,deleteButton){var displayNameEl=$$("span").append(displayTitle);displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");displayNameEl.on("mouseenter",this.toggleTooltip);displayNameEl.on("mouseout",this.hideTooltip);this.updateTagItemName(displayNameEl,this.state.loadedAuthor);var metaDataContainer=$$("div").addClass("metadata__container").append($$("span").append(displayNameEl).addClass("author__name meta").on("click",this.showInformation));var email=this.findAttribute(this.state.loadedAuthor,"email");if(email){metaDataContainer.append($$("span").append(email).addClass("author__email meta"))}authorItem.append($$("div").addClass("avatar__container").ref("avatarContainer").append($$(_substance.FontAwesomeIcon,{icon:"fa-user"}))).append(metaDataContainer).append($$("div").addClass("button__container").append(deleteButton))}toggleTooltip(){}hideTooltip(){}updateTagItemName(tagItem,loadedTag){if(loadedTag&&loadedTag.definition){var definition=(0,_lodash.isArray)(loadedTag.definition)?loadedTag.definition:[loadedTag.definition];for(var i=0;i<definition.length;i++){var item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}removeAuthor(author){this.props.removeAuthor(author)}avatarLoaded(avatar){var loadedAuthor=this.state.loadedAuthor;loadedAuthor.avatarSrc=avatar.url;if(loadedAuthor.avatarSrc!==avatar.url){this.extendState({loadedAuthor:loadedAuthor})}}showInformation(){this.context.api.ui.showDialog(_AuthorInfoComponent2.default,{author:this.state.loadedAuthor},{secondary:false,title:this.state.loadedAuthor.name,global:true})}showHover(){var delButton=this.el.find(".author__button--delete");delButton.addClass("active")}hideHover(){var delButton=this.el.find(".author__button--delete");delButton.removeClass("active")}findAttribute(object,attribute){var match;function iterateObject(target,name){Object.keys(target).forEach(function(key){if((0,_lodash.isObject)(target[key])){iterateObject(target[key],name)}else if(key===name){match=target[key]}})}iterateObject(object,attribute);return match?match:undefined}}exports.default=AuthorItemComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _lodash=__webpack_require__(139);class AuthorInfoComponent extends _substance.Component{constructor(...args){super(...args)}dispose(){super.dispose()}render($$){let el=$$("div").addClass("author__info");let description=(0,_lodash.find)(this.props.author.definition,function(def){return def["@role"]==="drol:long"});if(description){var descriptionEl=$$("p").append(description["keyValue"]);el.append(descriptionEl)}let email=this.findAttribute(this.props.author,"email");if(email){let emailEl=$$("a").append($$(_substance.FontAwesomeIcon,{icon:"fa-envelope-o"})).attr("href","mailto:"+email).append(email);el.append(emailEl)}let phone=this.findAttribute(this.props.author,"phone");if(phone){let phoneEl=$$("a").append($$(_substance.FontAwesomeIcon,{icon:"fa-phone"})).attr("href","tel:"+phone).append(phone);el.append(phoneEl)}return el}findAttribute(object,attribute){let match;function iterateObject(target,name){Object.keys(target).forEach(function(key){if((0,_lodash.isObject)(target[key])){iterateObject(target[key],name)}else if(key===name){match=target[key]}})}iterateObject(object,attribute);return match?match:undefined}onClose(){}}exports.default=AuthorInfoComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class AuthorValidation extends _writer.Validator{constructor(...args){super(...args)}validate(){if(_writer.api.newsItem.getAuthors().length===0){this.addWarning(_writer.api.getLabel("validation-no-author"))}}}exports.default=AuthorValidation},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(165);var _ContentrelationsPackage=__webpack_require__(167);var _ContentrelationsPackage2=_interopRequireDefault(_ContentrelationsPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_ContentrelationsPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ContentRelationsNode=__webpack_require__(168);var _ContentRelationsNode2=_interopRequireDefault(_ContentRelationsNode);var _ContentRelationsComponent=__webpack_require__(169);var _ContentRelationsComponent2=_interopRequireDefault(_ContentRelationsComponent);var _ContentRelationsConverter=__webpack_require__(170);var _ContentRelationsConverter2=_interopRequireDefault(_ContentRelationsConverter);var _ContentRelationsMainComponent=__webpack_require__(171);var _ContentRelationsMainComponent2=_interopRequireDefault(_ContentRelationsMainComponent);var _ContentRelationsDropHandler=__webpack_require__(175);var _ContentRelationsDropHandler2=_interopRequireDefault(_ContentRelationsDropHandler);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"contentrelations",id:"se.infomaker.contentrelations",configure:function configure(config){config.addSidebarTab("contentrelations","Relaterat innehåll");config.addComponentToSidebarWithTabId("contentrelations","contentrelations",_ContentRelationsMainComponent2.default);config.addDragAndDrop(_ContentRelationsDropHandler2.default);config.addComponent("contentrelations",_ContentRelationsComponent2.default);config.addNode(_ContentRelationsNode2.default);config.addConverter("newsml",_ContentRelationsConverter2.default);config.addLabel("ContentRelations",{sv:"Relaterat innehåll"});config.addLabel("Enter query",{sv:"Sökfråga"});config.addLabel("Search",{sv:"Sök"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class ContentRelationsNode extends _substance.BlockNode{}ContentRelationsNode.define({type:"contentrelations",uuid:{type:"string",optional:true},label:{type:"string",optional:true},products:{type:"string",optional:true},dataType:"string"});exports.default=ContentRelationsNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class ContentRelationsComponent extends _substance.Component{render($$){const el=$$("div").addClass("im-blocknode__container");el.append(this.renderHeader($$));el.append(this.renderContent($$));el.addClass("x-im-contentrelations");el.attr("contentEditable",false);return el}renderContent($$){const content=$$("div").addClass("im-blocknode__content");const link=$$("a").append(this.props.node.label).attr("href","#"+this.props.node.uuid).attr("target","_blank").on("click",function(evt){evt.stopPropagation()});content.append(link);return content}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-external-link"}),$$("strong").append(this.getLabel("External link")).attr("contenteditable",false)]).addClass("header").attr("contenteditable",false)}}exports.default=ContentRelationsComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ContentRelationsConverter={type:"contentrelations",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/link"},import:function _import(el,node){if(el.attr("uuid")){node.uuid=el.attr("uuid")}node.label=el.attr("title");node.dataType=el.attr("type")},export:function _export(node,el,converter){if(node.uuid){el.attr("uuid",node.uuid)}el.attr("title",node.label);el.attr("type",node.dataType);var links=converter.$$("links");var link=converter.$$("link");link.attr({rel:"self",type:"x-im/article"});if(node.uuid){link.attr("uuid",node.uuid)}links.append(link);el.append(links)}};exports.default=ContentRelationsConverter},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _ContentSearchComponent=__webpack_require__(172);var _ContentSearchComponent2=_interopRequireDefault(_ContentSearchComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentRelationsMainComponent extends _substance.Component{render($$){var el=$$("div").ref("relationsContainer").addClass("authors").append($$("h2").append(this.getLabel("ContentRelations")));el.append($$(_ContentSearchComponent2.default));return el}}exports.default=ContentRelationsMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ContentSearchResultComponent=__webpack_require__(173);var _ContentSearchResultComponent2=_interopRequireDefault(_ContentSearchResultComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentSearchComponent extends _substance.Component{getInitialState(){return{query:"",results:[]}}render($$){const el=$$("div").addClass("search__container");const searchForm=$$("form").addClass("clearfix").on("submit",this.search.bind(this)).ref("form");searchForm.append($$("input").attr({type:"submit",style:"display:none"}));const searchInput=$$("input").addClass("form-control search__query col-xs-9").ref("queryInput").attr("placeholder",this.getLabel("Enter query"));const searchButton=$$("button").addClass("sc-np-btn btn btn-neutral col-xs-3").append(this.getLabel("Search")).on("click",this.search.bind(this)).ref("serchButton");searchForm.append([searchInput,searchButton]);el.append(searchForm);const results=$$(_ContentSearchResultComponent2.default,{results:this.state.results,query:this.state.query});el.append(results);return el}search(e){e.preventDefault();const query=this.refs.queryInput.val();_writer.api.router.get("/api/search/concepts/articles?q="+query).then(reponse=>_writer.api.router.checkForOKStatus(reponse)).then(response=>response.json()).then(json=>{this.setState({query:query,results:json})}).catch(()=>{})}}exports.default=ContentSearchComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _SearchResultItem=__webpack_require__(174);var _SearchResultItem2=_interopRequireDefault(_SearchResultItem);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentSearchResultComponent extends _substance.Component{render($$){const el=$$("ul").addClass("search__results");const items=this.props.results.map(function(item){return $$(_SearchResultItem2.default,{item:item})});el.append(items);return el}}exports.default=ContentSearchResultComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class SearchResultItem extends _substance.Component{getInitialState(){return{imageLoaded:false,imageURL:""}}getDroplinkForItem(item){const imType=item.imType[0];const name=item.name[0];let data={uuid:item.uuid,imType:imType,name:name};let dropData=window.btoa(JSON.stringify(data));switch(imType){case"article":return"x-im-entity://x-im/article?data="+dropData;case"image":return"x-im-entity://x-im/image?data="+dropData;default:return"x-im-entity://x-im/article?data="+dropData}}getTitle($$,item){let name=item.name?item.name[0]:"Unidentified",products=item.type,productsType=item.typeCatalog?item.typeCatalog[0]:"text";if(!products){return name}if(productsType&&productsType==="icon"){const icons=products.map(function(product){return $$("img").attr("src",product).addClass("product-icon")});const result=$$("span").append(name);icons.forEach(function(icon){result.append(icon)});return result}else{return`${name} [${products.join(", ")}]`}}didMount(){this.dropLink=this.getDroplinkForItem(this.props.item)}_onDragStart(e){e.stopPropagation();e.dataTransfer.setData("text/uri-list",this.dropLink)}render($$){const item=this.props.item;return this.getItem($$,item)}getItem($$,item){const imType=item.imType?item.imType[0]:"article";switch(imType){case"article":return this.getArticleItem($$,item);case"image":return this.getImageItem($$,item);default:}}getArticleItem($$,item){const listItem=$$("li").addClass("article").attr("draggable",true).on("dragstart",this._onDragStart,this);const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-file-text-o"}).addClass("type-icon");const label=$$("span").addClass("title").append(this.getTitle($$,item));listItem.append([icon,label]);return listItem}getImageItem($$,item){const listItem=$$("li").addClass("image").attr("draggable",true).on("dragstart",this._onDragStart,this);let icon=$$(_substance.FontAwesomeIcon,{icon:"fa-picture-o"});const label=$$("span").addClass("title").append(this.getTitle($$,item));if(this.state.imageLoaded){icon=$$("img").attr("src",this.state.imageURL).addClass("image-icon")}else{this.fetchImageURLForUUID(item.uuid).then(url=>{this.setState({imageLoaded:true,imageURL:url})})}listItem.append([icon,label]);return listItem}fetchImageURLForUUID(uuid){return _writer.api.router.get("/api/binary/url/"+uuid+"/40?imType=x-im/image&height=40").then(response=>response.text()).catch(error=>{console.error(error)})}}exports.default=SearchResultItem},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _insertRelatedContentLink=__webpack_require__(176);var _insertRelatedContentLink2=_interopRequireDefault(_insertRelatedContentLink);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentRelationsDropHandler extends _substance.DragAndDropHandler{match(params){if(!params.uri){return false}if(this.isContentRelationsArticleDrop(params)||this.isNpDroplink(params)){if(params.isNpDroplink){this.data=this.getDataFromNpDroplink(params.uri)}else if(params.isContentRelations){this.data=this.getDataFromURL(params.uri)}else{return false}return true}}isNpDroplink(params){const npDropLinkRegex=_writer.api.getConfigValue("se.infomaker.contentrelations","npDropLinkMatcher");if(!npDropLinkRegex){return false}const re=new RegExp(npDropLinkRegex);const urlMatches=re.exec(params.uri);if(urlMatches&&urlMatches.length>=1){params.isNpDroplink=true;return true}}isContentRelationsArticleDrop(params){if(params.uri.indexOf("x-im-entity://x-im/article")>=0){params.isContentRelations=true;return true}}getDataFromNpDroplink(link){link=decodeURIComponent(link);function decodeLabel(xml){const reg=new RegExp(".*<name>([^<]+)");const result=reg.exec(xml);return result[1]}function decodeUuid(xml){const reg=new RegExp(".*?id=([^<]+)");const result=reg.exec(xml);return result[1]}const name=decodeLabel(link);const uuid=decodeUuid(link);return{name:name,uuid:uuid}}getDataFromURL(url){const queryParamKey="data=";const dataPosition=url.indexOf(queryParamKey);let encodedData=url.substr(dataPosition+queryParamKey.length,url.length);return JSON.parse(window.atob(encodedData))}drop(tx){(0,_insertRelatedContentLink2.default)(tx,this.data)}}exports.default=ContentRelationsDropHandler},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=insertRelatedContentLink;function insertRelatedContentLink(tx,data){tx.insertBlockNode({dataType:"x-im/link",type:"contentrelations",uuid:data.uuid,label:data.name})}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _Channelselector=__webpack_require__(178);var _Channelselector2=_interopRequireDefault(_Channelselector);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_Channelselector2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(179);var _ChannelSelectorComponent=__webpack_require__(181);var _ChannelSelectorComponent2=_interopRequireDefault(_ChannelSelectorComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.hdsds.channelselector",name:"channelselector",configure:function configure(config){config.addLabel("channelselector-Products",{en:"Products",sv:"Produkter"});config.addComponentToSidebarWithTabId("channelselector","main",_ChannelSelectorComponent2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);const sortBy=_writer.lodash.sortBy;const clone=_writer.lodash.clone;class ChannelselectorComponent extends _substance.Component{constructor(...args){super(...args)}getInitialState(){this.configProducts=this.context.api.getConfigValue("se.infomaker.hdsds.channelselector","products");var channels=this.context.api.newsItem.getChannels(),initialChannels=[];channels.forEach(function(channel){var compare=_writer.lodash.find(this.configProducts,function(o){if(o.qcode===channel["qcode"]){o.active=true;return true}});initialChannels.push(compare)}.bind(this));return{products:sortBy(this.configProducts,["active","name"]),selectedProducts:initialChannels}}sortProducts(){return sortBy(this.state.products,["active","name"])}selectProduct(product){var selectedProduct=this.state.selectedProducts,products=this.state.products;var productIndex=products.indexOf(product);if(_writer.lodash.includes(selectedProduct,product)){delete products[productIndex].active;selectedProduct.splice(selectedProduct.indexOf(product),1);this.context.api.newsItem.removeChannel("channelselector",product)}else{selectedProduct.push(product);products[productIndex].active=true;var productToSave=clone(product);delete productToSave.active;this.context.api.newsItem.addChannel("channelselector",productToSave)}this.extendState({selectedProducts:selectedProduct})}render($$){var el=$$("div").addClass("sc-channelselector"),listContainer=$$("div").addClass("sc-productlist-container").addClass("list-group"),list=$$("div").addClass("sc-productlist"),title=$$("h2").append(this.getLabel("channelselector-Products"));var products=this.sortProducts().map(function(product){var cssClass=product.active?"active":"";return $$("a").addClass("list-group-item").addClass(cssClass).append(product.name.toString()).on("click",()=>{this.selectProduct(product)})},this);el.append(title);list.append(products);listContainer.append(list);el.append(listContainer);return el}}exports.default=ChannelselectorComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(183);var _Publicationchannel=__webpack_require__(185);var _Publicationchannel2=_interopRequireDefault(_Publicationchannel);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_Publicationchannel2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublicationchannelComponent=__webpack_require__(186);var _PublicationchannelComponent2=_interopRequireDefault(_PublicationchannelComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.mitm.publicationchannel",name:"publicationchannel",configure:function configure(config){config.addLabel("publicationchannel-Channels",{en:"Channels",sv:"Publiceringskanaler"});config.addLabel("publicationchannel-Shared_with",{en:"Shared with",sv:"Delas med"});config.addLabel("publicationchannel-Choose_all",{en:"Choose all",sv:"Välj alla"});config.addLabel("publicationchannel-Choose_main_channel",{en:"Choose main channel",sv:"Välj huvudkanal"});config.addLabel("publicationchannel-mainChannel-warning",{en:"Please choose main publication channel before sharing with other channels",sv:"Vänligen välj huvudkanal innan delning med andra kanaler"});config.addComponentToSidebarWithTabId("publicationchannel","main",_PublicationchannelComponent2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class PublicationchannelComponent extends _substance.Component{constructor(...args){super(...args)}didMount(){this.context.api.events.on("publicationchannel","data:changed",event=>{if(event.data&&event.data.type==="channel"){this.synchronize(event)}});this.context.api.events.on("publicationchannel","data:duplicated",()=>{this.clearAllChannels()});this.refs.dropdownButton.el.el.addEventListener("blur",()=>{setTimeout(()=>{this.hideMenu()},50)})}getInitialState(){var activeChannelCount=0,currentChannels=this.context.api.newsItem.getChannels(),channels=this.context.api.getConfigValue("se.infomaker.mitm.publicationchannel","publicationchannels"),mainChannel=null;channels.forEach(channel=>{if(currentChannels.some(currentChannel=>channel.qcode===currentChannel["qcode"]&&currentChannel["@why"]==="imext:main")){channel.main=true;channel.active=true;mainChannel=channel;activeChannelCount++}else if(currentChannels.some(currentChannel=>channel.qcode===currentChannel["qcode"])){channel.active=true;channel.main=false;activeChannelCount++}else{channel.active=false;channel.main=false}});return{mainChannel:mainChannel,channels:_writer.lodash.sortBy(channels,["name"]),activeChannelCount:activeChannelCount}}render($$){var el=$$("div").addClass("sc-publicationchannel");el.append([$$("h2").append(this.getLabel("publicationchannel-Channels")),this.renderMainChannelSelect($$),$$("p").addClass("sc-sharedwith").append([this.getLabel("publicationchannel-Shared_with")])]);el.append(this.renderChannelButtons($$));return el}renderMainChannelSelect($$){var channels=[],mainChannel=null,dropdownButton=null;this.state.channels.forEach(channel=>{if(channel.main===true){mainChannel=channel}if(typeof channel.scope!=="undefined"&&channel.scope==="shared"){return}channels.push($$("button").addClass("dropdown-item").append([$$("img").attr({src:channel.icon}),channel.name]).on("focus",()=>{this.toggleChannel(channel,true)}))});if(!mainChannel){dropdownButton=$$("button").addClass("btn btn-secondary dropdown-toggle").attr({id:"w-sharedchannels-main-select",type:"button","data-toggle":"dropdown"}).append(this.getLabel("publicationchannel-Choose_main_channel"))}else{dropdownButton=$$("button").addClass("btn btn-secondary dropdown-toggle").attr({id:"w-sharedchannels-main-select",type:"button","data-toggle":"dropdown"}).append([$$("img").attr({src:mainChannel.icon}),mainChannel.name])}dropdownButton.on("click",()=>{this.toggleMenu();return false});dropdownButton.ref("dropdownButton");let components=[dropdownButton];if(this.state.showChannelButtons){components.push($$("div").addClass("dropdown-menu").append(channels))}return $$("div").attr({id:"w-sharedchannels-main"}).addClass("dropdown").attr({"aria-labelledby":"w-sharedchannels-main-select"}).append(components)}renderChannelButtons($$){var ul=$$("ul").addClass("tag-list sc-sharedchannels");this.state.channels.forEach(channel=>{if(typeof channel.scope!=="undefined"&&channel.scope==="main"){return}var channelClass="";if(channel.main){channelClass=" main"}else if(channel.active){channelClass=" active"}ul.append($$("li").addClass("tag-list__item "+channelClass).append($$("img").attr({src:channel.icon})).attr({title:channel.name,"data-toggle":"tooltip","data-placement":"bottom","data-trigger":"manual"}).on("click",()=>{if(!channel.main){this.toggleChannel(channel,false)}return false}))});return ul}clearAllChannels(){this.state.channels.forEach(channel=>{if(channel.active){this.context.api.newsItem.removeChannel("publicationchannel",channel)}});this.synchronize()}toggleMenu(){this.extendState({showChannelButtons:!this.state.showChannelButtons})}hideMenu(){this.extendState({showChannelButtons:false})}toggleAllChannels(target){var activate=true;if(target.classList.contains("checked")){activate=false}this.state.channels.forEach(channel=>{if(activate&&!channel.active&&!channel.main){this.context.api.newsItem.addChannel("publicationchannel",channel)}else if(!activate&&channel.active&&!channel.main){this.context.api.newsItem.removeChannel("publicationchannel",channel)}channel.active=activate});this.synchronize()}toggleChannel(channel,setAsMainChannel){var mainChannel=this.context.api.newsItem.getMainChannel();if(!mainChannel&&!setAsMainChannel){this.context.api.ui.showMessageDialog([{plugin:"publicationchannel",type:"error",message:this.getLabel("Please choose main publication channel before sharing with other channels")}]);return}if(channel.active&&!setAsMainChannel){this.context.api.newsItem.removeChannel("publicationchannel",channel);channel.active=false}else{if(mainChannel&&setAsMainChannel){this.context.api.newsItem.removeChannel("publicationchannel",mainChannel)}this.context.api.newsItem.addChannel("publicationchannel",channel,setAsMainChannel===true);channel.active=true}this.synchronize()}synchronize(){var currentChannels=this.context.api.newsItem.getChannels(),activeChannelCount=0,mainChannel=null;this.state.channels.forEach(channel=>{if(currentChannels.some(currentChannel=>channel.qcode===currentChannel["qcode"]&&currentChannel["@why"]==="imext:main")){channel.main=true;channel.active=true;mainChannel=channel;activeChannelCount++}else if(currentChannels.some(currentChannel=>channel.qcode===currentChannel["qcode"])){channel.active=true;channel.main=false;activeChannelCount++}else{channel.active=false;channel.main=false}});this.extendState({
activeChannelCount:activeChannelCount,mainChannel:mainChannel})}}exports.default=PublicationchannelComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(188);var _TagsPackage=__webpack_require__(190);var _TagsPackage2=_interopRequireDefault(_TagsPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_TagsPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(188);var _TagsMainComponent=__webpack_require__(191);var _TagsMainComponent2=_interopRequireDefault(_TagsMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.mitm.tags",name:"mmtags",vendor:"infomaker.se",configure:function configure(config){config.addLabel("mmtags-could_not_load_uuid",{en:"This item could not be loaded. UUID: ",sv:"Detta objekt kunde inte laddas in. UUID: "});config.addLabel("mmtags-title",{sv:"Organisationer/personer/ämnen",en:"Organizations/persons/topics"});config.addLabel("mmtags-search_placeholder",{sv:"Sök Organisationer/personer/ämnen",en:"Search Organizations/persons/topics"});config.addLabel("mmtags-create",{en:"Create",sv:"Skapa"});config.addLabel("mmtags-save",{en:"Save",sv:"Spara"});config.addLabel("mmtags-edit",{en:"Edit",sv:"Redigera"});config.addLabel("mmtags-Person",{en:"Person",sv:"Person"});config.addLabel("mmtags-Organization",{en:"Organization",sv:"Organisation"});config.addLabel("mmtags-Topic",{en:"Topic",sv:"Ämne"});config.addLabel("mmtags-type-question-label",{en:"What kind of tag do you want to create?",sv:"Vilken typ vill du skapa?"});config.addLabel("mmtags-name_already_in_use",{en:"Please note that this name is already in use",sv:"Observera att namnet redan används"});config.addLabel("mmtags-error-save",{en:"Error when saving tag",sv:"Fel vid sparande av tag"});config.addLabel("mmtags-Short_description",{en:"Short description",sv:"Kort beskrivning"});config.addLabel("mmtags-Long_description",{en:"Long description",sv:"Lång beskrivning"});config.addLabel("mmtags-Website_url",{en:"Website url",sv:"Länk till webbsida"});config.addLabel("mmtags-Twitter_url",{en:"Twitter url",sv:"Länk till Twitter"});config.addLabel("mmtags-Facebook_url",{en:"Facebook url",sv:"Länk till Facebook"});config.addLabel("mmtags-Remove_from_article",{en:"Remove from article",sv:"Ta bort från artikel"});config.addComponentToSidebarWithTabId(this.id,"main",_TagsMainComponent2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _TagsListComponent=__webpack_require__(192);var _TagsListComponent2=_interopRequireDefault(_TagsListComponent);var _TagEditBaseComponent=__webpack_require__(196);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _TagEditPersonComponent=__webpack_require__(198);var _TagEditPersonComponent2=_interopRequireDefault(_TagEditPersonComponent);var _TagEditCompanyComponent=__webpack_require__(197);var _TagEditCompanyComponent2=_interopRequireDefault(_TagEditCompanyComponent);var _TagEditTopicComponent=__webpack_require__(199);var _TagEditTopicComponent2=_interopRequireDefault(_TagEditTopicComponent);var _concept=__webpack_require__(200);var _concept2=_interopRequireDefault(_concept);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="mmtags"}getInitialState(){return{existingTags:this.context.api.newsItem.getTags(["x-im/organisation","x-im/person","x-im/topic"])}}reload(){this.extendState({existingTags:this.context.api.newsItem.getTags(["x-im/organisation","x-im/person","x-im/topic"])})}render($$){const el=$$("div").ref("tagContainer").addClass("authors").append($$("h2").append(this.getLabel("mmtags-title")));const SearchComponent=this.context.componentRegistry.get("form-search");const searchComponent=$$(SearchComponent,{existingItems:this.state.existingTags,searchUrl:"/api/search/concepts/tags?q=",onSelect:this.addTag.bind(this),onCreate:this.createTag.bind(this),placeholderText:this.getLabel("mmtags-search_placeholder"),createAllowed:true}).ref("searchComponent");const tagList=$$(_TagsListComponent2.default,{tags:this.state.existingTags,removeTag:this.removeTag.bind(this),reload:this.reload.bind(this)}).ref("tagList");el.append(tagList);el.append(searchComponent);return el}removeTag(tag){try{this.context.api.newsItem.removeLinkByUUIDAndRel(this.name,tag.uuid,"subject");this.reload()}catch(e){}}addTag(tag){try{this.context.api.newsItem.addTag(this.name,tag);this.reload()}catch(e){}}createTag(tag,exists){try{this.context.api.ui.showDialog(_TagEditBaseComponent2.default,{tag:tag,exists:exists,close:this.closeFromDialog.bind(this),createPerson:this.createPerson.bind(this),createOrganisation:this.createOrganisation.bind(this),createTopic:this.createTopic.bind(this)},{primary:false,title:this.getLabel("mmtags-create")+" "+tag.inputValue,global:true})}catch(e){}}createPerson(inputValue){const newName=inputValue.split(" ");const parser=new DOMParser;const tagXML=parser.parseFromString(_concept2.default.personTemplate,"text/xml").firstChild;tagXML.querySelector('itemMeta itemMetaExtProperty[type="imext:firstName"]').setAttribute("value",newName[0]);tagXML.querySelector('itemMeta itemMetaExtProperty[type="imext:lastName"]').setAttribute("value",newName[1]?newName[1]:"");const loadedTag=_writer.jxon.build(tagXML);this.context.api.ui.showDialog(_TagEditPersonComponent2.default,{tag:loadedTag,close:this.closeFromDialog.bind(this)},{primary:this.getLabel("mmtags-save"),title:this.getLabel("mmtags-create")+" "+inputValue,icon:"fa-user",global:true})}createOrganisation(inputValue){const parser=new DOMParser;const tagXML=parser.parseFromString(_concept2.default.organisationTemplate,"text/xml").firstChild;tagXML.querySelector("concept name").textContent=inputValue;const loadedTag=_writer.jxon.build(tagXML);this.context.api.ui.showDialog(_TagEditCompanyComponent2.default,{tag:loadedTag,close:this.closeFromDialog.bind(this)},{primary:this.getLabel("mmtags-save"),title:this.getLabel("mmtags-create")+" "+inputValue,icon:"fa-sitemap",global:true})}createTopic(inputValue){const parser=new DOMParser;const tagXML=parser.parseFromString(_concept2.default.topicTemplate,"text/xml").firstChild;tagXML.querySelector("concept name").textContent=inputValue;const loadedTag=_writer.jxon.build(tagXML);this.context.api.ui.showDialog(_TagEditTopicComponent2.default,{tag:loadedTag,close:this.closeFromDialog.bind(this)},{primary:this.getLabel("mmtags-save"),title:this.getLabel("mmtags-create")+" "+inputValue,icon:"fa-tags",global:true})}closeFromDialog(){this.reload()}}exports.default=TagsMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _TagItemComponent=__webpack_require__(193);var _TagItemComponent2=_interopRequireDefault(_TagItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsListComponent extends _substance.Component{constructor(...args){super(...args);this.name="mmtags"}render($$){const tags=this.props.tags,tagList=$$("ul").addClass("tag-list"),tagEls=tags.map(tag=>{return $$(_TagItemComponent2.default,{tag:tag,removeTag:this.removeTag.bind(this),reload:this.props.reload.bind(this)}).ref("tag-"+tag.uuid)},this);tagList.append(tagEls);return tagList}removeTag(tag){delete this.refs["tag-"+tag.uuid];this.props.removeTag(tag)}}exports.default=TagsListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _Config=__webpack_require__(194);var _Config2=_interopRequireDefault(_Config);var _TagInfoComponent=__webpack_require__(195);var _TagInfoComponent2=_interopRequireDefault(_TagInfoComponent);var _TagEditCompanyComponent=__webpack_require__(197);var _TagEditCompanyComponent2=_interopRequireDefault(_TagEditCompanyComponent);var _TagEditPersonComponent=__webpack_require__(198);var _TagEditPersonComponent2=_interopRequireDefault(_TagEditPersonComponent);var _TagEditTopicComponent=__webpack_require__(199);var _TagEditTopicComponent2=_interopRequireDefault(_TagEditTopicComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="mmtags"}getItemMetaExtPropertyByType(type){if(_writer.lodash.isArray(this.state.loadedTag.itemMeta.itemMetaExtProperty)){return _writer.lodash.find(this.state.loadedTag.itemMeta.itemMetaExtProperty,function(itemMeta){return itemMeta["@type"]===type})}else if(_writer.lodash.isObject(this.state.loadedTag.itemMeta.itemMetaExtProperty)){if(this.state.loadedTag.itemMeta.itemMetaExtProperty["@type"]===type){return this.state.loadedTag.itemMeta.itemMetaExtProperty}}}loadTag(){this.context.api.router.getConceptItem(this.props.tag.uuid,this.props.tag.type).then(xml=>{const conceptXML=xml.querySelector("conceptItem"),conceptItemJSON=_writer.jxon.build(conceptXML);this.extendState({loadedTag:conceptItemJSON,isLoaded:true});this.state.loadedTag.type=this.getItemMetaExtPropertyByType("imext:type")}).catch(()=>{this.extendState({isLoaded:true,couldNotLoad:true})})}render($$){const tag=this.props.tag,tagItem=$$("li").addClass("tag-list__item").ref("tagItem"),displayNameEl=$$("span");let displayName;displayNameEl.attr("title",TagsItemComponent.getNameForTag(tag));if(!this.state.isLoaded){this.loadTag()}else{if(this.state.couldNotLoad){displayNameEl.addClass("tag-item__title tag-item__title--no-avatar tag-item__title--notexisting").append(tag.title).attr("title",this.getLabel("mmtags-could_not_load_uuid")+tag.uuid);displayName=tag.title}else{displayName=this.state.loadedTag.concept.name;displayNameEl.addClass("tag-item__title tag-item__title--no-avatar").append(displayName);this.updateTagItemName(displayNameEl,this.state.loadedTag);displayNameEl.on("click",()=>{if(_Config2.default.isTagEditable(tag)){this.editTag(displayName)}else{this.showTag(displayName)}})}displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");tagItem.append(displayNameEl);const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("mmtags-Remove_from_article"))).on("click",()=>{this.removeTag(tag)});tagItem.append(deleteButton);const iconComponent=this.getIconForTag($$,tag);if(iconComponent){tagItem.append(iconComponent)}}return tagItem}showTag(title){this.context.api.ui.showDialog(_TagInfoComponent2.default,{tag:this.state.loadedTag,close:this.closeFromDialog.bind(this),couldNotLoad:this.state.couldNotLoad},{secondary:false,title:title,global:true})}editTag(title){let tagEdit;switch(this.state.loadedTag.type["@value"]){case"x-im/organisation":tagEdit=_TagEditCompanyComponent2.default;break;case"x-im/person":tagEdit=_TagEditPersonComponent2.default;break;case"x-im/topic":tagEdit=_TagEditTopicComponent2.default;break;default:break}this.context.api.ui.showDialog(tagEdit,{tag:this.state.loadedTag,close:this.closeFromDialog.bind(this),couldNotLoad:this.state.couldNotLoad},{primary:this.getLabel("mmtags-save"),title:this.getLabel("mmtags-edit")+" "+title,global:true})}closeFromDialog(){this.loadTag();this.props.reload()}removeTag(tag){this.props.removeTag(tag)}getIconForTag($$,tag){if(!tag.type){return this.getDefaultIconForTag($$)}const tagConfig=_Config2.default.types[tag.type];if(tagConfig){return $$(_substance.FontAwesomeIcon,{icon:tagConfig.icon}).addClass("tag-icon")}else{this.getDefaultIconForTag($$)}}static getNameForTag(tag){if(!tag.type){return undefined}const tagConfig=_Config2.default.types[tag.type];if(tagConfig){return tagConfig.name}}updateTagItemName(tagItem,loadedTag){if(loadedTag.concept&&loadedTag.concept.definition){const definition=_writer.lodash.isArray(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(let i=0;i<definition.length;i++){const item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}getDefaultIconForTag($$){return $$(_substance.FontAwesomeIcon,{icon:"fa-tag"}).addClass("tag-icon")}}exports.default=TagsItemComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={isTagEditable:function isTagEditable(tag){return Boolean(this.types[tag.type].editable)},types:{"x-im/person":{icon:"fa-user",name:"Person",editable:true},"x-im/organisation":{icon:"fa-sitemap",name:"Organisation",editable:true},"x-im/topic":{icon:"fa-tags",name:"Channel",editable:true}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(196);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagInfoComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args)}render($$){const el=$$("div").addClass("tag-edit-base");const shortDescription=this.getConceptDefinition("drol:short");if(shortDescription){const shortDescEl=$$("p").append(shortDescription.keyValue);el.append(shortDescEl)}const longDescription=this.getConceptDefinition("drol:long");if(longDescription){const longDescEl=$$("p").append(longDescription.keyValue);el.append(longDescEl)}return el}onClose(){}}exports.default=TagInfoComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);const find=_writer.lodash.find;class TagEditBaseComponent extends _substance.Component{constructor(...args){super(...args);this.name="mmtags"}saveConcept(uuid,newsItem){return this.context.api.router.updateConceptItem(uuid,newsItem)}createConcept(newsItem){return this.context.api.router.createConceptItem(newsItem)}updateFacebook(facebookInputValue){const facebookNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="x-im/social+facebook"]');if(facebookInputValue.length>0&&!facebookNode){this.createLinkNode(this.xmlDoc,{type:"x-im/social+facebook",rel:"irel:seeAlso",url:facebookInputValue})}else if(facebookNode&&facebookInputValue.length>0){facebookNode.setAttribute("url",facebookInputValue)}else if(facebookInputValue.length===0&&facebookNode){facebookNode.parentElement.removeChild(facebookNode)}}updateTwitter(twitterInputValue){const twitterNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="x-im/social+twitter"]');if(twitterInputValue.length>0&&!twitterNode){this.createLinkNode(this.xmlDoc,{type:"x-im/social+twitter",rel:"irel:seeAlso",url:twitterInputValue})}else if(twitterNode&&twitterInputValue.length>0){twitterNode.setAttribute("url",twitterInputValue)}else if(twitterInputValue.length===0&&twitterNode){twitterNode.parentElement.removeChild(twitterNode)}}updateWebsite(websiteInputValue){const websiteNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="text/html"]');if(websiteInputValue.length>0&&!websiteNode){this.createLinkNode(this.xmlDoc,{type:"text/html",rel:"irel:seeAlso",url:websiteInputValue})}else if(websiteNode&&websiteInputValue.length>0){websiteNode.setAttribute("url",websiteInputValue)}else if(websiteInputValue.length===0&&websiteNode){websiteNode.parentElement.removeChild(websiteNode)}}createLinkNode(xmlDoc,attributes){const linkNode=xmlDoc.createElement("link");for(let key in attributes){if(attributes.hasOwnProperty(key)){linkNode.setAttribute(key,attributes[key])}}xmlDoc.documentElement.querySelector("itemMeta links").appendChild(linkNode);return linkNode}getItemMetaExtProperty(key){return find(this.props.tag.itemMeta.itemMetaExtProperty,item=>item["@type"]===key)}getConceptDefinition(key){return find(this.props.tag.concept.definition,item=>item["@role"]===key)}getSeeAlsoLinkByType(type){return find(this.props.tag.itemMeta.links.link,link=>link["@type"]===type&&link["@rel"]==="irel:seeAlso")}render($$){const el=$$("div").addClass("tag-edit tag-edit-base");const personBtn=$$("button").append($$(_substance.FontAwesomeIcon,{icon:"fa-user"})).append($$("span").append(this.getLabel("mmtags-Person"))).on("click",this.createPerson);const organisationBtn=$$("button").append($$(_substance.FontAwesomeIcon,{icon:"fa-sitemap"})).append($$("span").append(this.getLabel("mmtags-Organization"))).on("click",this.createOrganisation);const topicBtn=$$("button").append($$(_substance.FontAwesomeIcon,{icon:"fa-tags"})).append($$("span").append(this.getLabel("mmtags-Topic"))).on("click",this.createTopic);el.append($$("small").addClass("text-muted").append(this.getLabel("mmtags-type-question-label")));el.append([personBtn,organisationBtn,topicBtn]);if(this.props.exists){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-info").append(this.getLabel("mmtags-name_already_in_use")+": "+this.props.tag.value)))}if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("mmtags-error-save"))))}return el}createPerson(){this.send("close");this.props.createPerson(this.props.tag.inputValue)}createOrganisation(){this.send("close");this.props.createOrganisation(this.props.tag.inputValue)}createTopic(){this.send("close");this.props.createTopic(this.props.tag.inputValue)}closeAndReload(){this.props.close();this.send("close")}renderElement($$,refName,label,inputValue,fullWidth,inputType){const cssClass=fullWidth?"col-xs-12":"col-xs-12 col-sm-6";let input;switch(inputType){case"textarea":input=this.getTextAreaElement($$);break;default:input=this.getTextInputElement($$);break}const formGroup=$$("fieldset").addClass("form-group").addClass(cssClass);formGroup.append($$("label").append(label));formGroup.append(input.val(inputValue).ref(refName));return formGroup}getTextInputElement($$){return $$("input").attr("type","text").addClass("form-control")}getTextAreaElement($$){return $$("textarea").attr("rows","4").addClass("form-control")}static getShortDescription(xmlTag){return xmlTag.documentElement.querySelector('concept definition[role="drol:short"]')}static getLongDescription(xmlTag){return xmlTag.documentElement.querySelector('concept definition[role="drol:long"]')}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditBaseComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(196);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagEditCompanyComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args);this.name="mmtags"}save(){const tag=this.props.tag,name=this.refs.nameInput.val(),shortDesc=this.refs.shortDescInput.val(),longDesc=this.refs.longDescTextarea.val(),uuid=tag["@guid"]?tag["@guid"]:null;tag.concept.name=name;const xmlTag=_writer.jxon.unbuild(tag,null,"conceptItem");this.xmlDoc=xmlTag;const shortDescNode=_TagEditBaseComponent2.default.getShortDescription(xmlTag),longDescNode=_TagEditBaseComponent2.default.getLongDescription(xmlTag);shortDescNode.textContent=shortDesc;longDescNode.textContent=longDesc;this.updateWebsite(this.refs.urlInput.val());this.updateTwitter(this.refs.twitterInput.val());this.updateFacebook(this.refs.facebookInput.val());if(uuid===null){this.createConcept(xmlTag.documentElement.outerHTML).then(uuid=>{this.xmlDoc.querySelector("conceptItem").setAttribute("guid",uuid);this.context.api.newsItem.addTag(this.name,{uuid:uuid,name:[name],type:["organisation"],imType:["x-im/organisation"]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}else{this.saveConcept(uuid,xmlTag.documentElement.outerHTML).then(()=>{this.context.api.newsItem.updateTag(this.name,uuid,{name:[name],imType:[tag.type["@value"]]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}}render($$){const tag=this.props.tag,el=$$("div").addClass("tag-edit tag-edit-person").addClass("row"),name=this.renderElement($$,"nameInput","Name",tag.concept.name,true,"input"),shortDesc=this.renderElement($$,"shortDescInput",this.getLabel("mmtags-Short_description"),this.getConceptDefinition("drol:short").keyValue,true,"input"),longDesc=this.renderElement($$,"longDescTextarea",this.getLabel("mmtags-Long_description"),this.getConceptDefinition("drol:long").keyValue,true,"textarea"),websiteUrl=this.getSeeAlsoLinkByType("text/html"),websiteUrlEl=this.renderElement($$,"urlInput",this.getLabel("mmtags-Website_url"),websiteUrl?websiteUrl["@url"]:"",true,"input"),twitterUrl=this.getSeeAlsoLinkByType("x-im/social+twitter"),twitterEl=this.renderElement($$,"twitterInput",this.getLabel("mmtags-Twitter_url"),twitterUrl?twitterUrl["@url"]:"",false,"input"),facebook=this.getSeeAlsoLinkByType("x-im/social+facebook"),facebookEl=this.renderElement($$,"facebookInput",this.getLabel("mmtags-Facebook_url"),facebook?facebook["@url"]:"",false,"input");name.on("change",()=>{if(this.refs["nameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}});el.append([name,shortDesc,longDesc,websiteUrlEl,twitterEl,facebookEl]);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("mmtags-error-save"))))}return el}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditCompanyComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(196);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagEditPersonComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args);this.name="mmtags"}save(){const tag=this.props.tag,firstName=this.refs.firstNameInput.val(),lastName=this.refs.lastNameInput.val(),shortDesc=this.refs.shortDescInput.val(),longDesc=this.refs.longDescTextarea.val(),uuid=tag["@guid"]?tag["@guid"]:null,fullName=firstName+" "+lastName;tag.concept.name=fullName;const xmlTag=_writer.jxon.unbuild(tag,null,"conceptItem");this.xmlDoc=xmlTag;const firstNameNode=xmlTag.documentElement.querySelector('itemMetaExtProperty[type="imext:firstName"]');const lastNameNode=xmlTag.documentElement.querySelector('itemMetaExtProperty[type="imext:lastName"]');firstNameNode.setAttribute("value",firstName);lastNameNode.setAttribute("value",lastName);const shortDescNode=_TagEditBaseComponent2.default.getShortDescription(xmlTag),longDescNode=_TagEditBaseComponent2.default.getLongDescription(xmlTag);shortDescNode.textContent=shortDesc;longDescNode.textContent=longDesc;this.updateWebsite(this.refs.urlInput.val());this.updateTwitter(this.refs.twitterInput.val());this.updateFacebook(this.refs.facebookInput.val());if(uuid===null){this.createConcept(xmlTag.documentElement.outerHTML).then(uuid=>{this.xmlDoc.querySelector("conceptItem").setAttribute("guid",uuid);this.context.api.newsItem.addTag(this.name,{uuid:uuid,name:[fullName],type:["person"],imType:["x-im/person"]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}else{this.saveConcept(uuid,xmlTag.documentElement.outerHTML).then(()=>{this.context.api.newsItem.updateTag(this.name,uuid,{name:[fullName],imType:[tag.type["@value"]]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}}render($$){const el=$$("div").addClass("tag-edit tag-edit-person").addClass("row"),firstName=this.renderElement($$,"firstNameInput","First name",this.getItemMetaExtProperty("imext:firstName")["@value"],false,"input"),lastName=this.renderElement($$,"lastNameInput","Last name",this.getItemMetaExtProperty("imext:lastName")["@value"],false,"input"),shortDesc=this.renderElement($$,"shortDescInput",this.getLabel("mmtags-Short_description"),this.getConceptDefinition("drol:short").keyValue,true,"input"),longDesc=this.renderElement($$,"longDescTextarea",this.getLabel("mmtags-Long_description"),this.getConceptDefinition("drol:long").keyValue,true,"textarea"),websiteUrl=this.getSeeAlsoLinkByType("text/html"),websiteUrlEl=this.renderElement($$,"urlInput",this.getLabel("mmtags-Website_url"),websiteUrl?websiteUrl["@url"]:"",true,"input"),twitterUrl=this.getSeeAlsoLinkByType("x-im/social+twitter"),twitterEl=this.renderElement($$,"twitterInput",this.getLabel("mmtags-Twitter_url"),twitterUrl?twitterUrl["@url"]:"",false,"input"),facebook=this.getSeeAlsoLinkByType("x-im/social+facebook"),facebookEl=this.renderElement($$,"facebookInput",this.getLabel("mmtags-Facebook_url"),facebook?facebook["@url"]:"",false,"input");firstName.on("change",()=>{if(this.refs["firstNameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}});el.append([firstName,lastName,shortDesc,longDesc,websiteUrlEl,twitterEl,facebookEl]);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("mmtags-error-save"))))}return el}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditPersonComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(196);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagEditTopicComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args);this.name="mmtags"}save(){const tag=this.props.tag,name=this.refs.nameInput.val(),shortDesc=this.refs.shortDescInput.val(),longDesc=this.refs.longDescTextarea.val(),uuid=tag["@guid"]?tag["@guid"]:null;tag.concept.name=name;const xmlTag=_writer.jxon.unbuild(tag,null,"conceptItem");this.xmlDoc=xmlTag;const shortDescNode=_TagEditBaseComponent2.default.getShortDescription(xmlTag),longDescNode=_TagEditBaseComponent2.default.getLongDescription(xmlTag);shortDescNode.textContent=shortDesc;longDescNode.textContent=longDesc;if(uuid===null){this.createConcept(xmlTag.documentElement.outerHTML).then(uuid=>{this.xmlDoc.querySelector("conceptItem").setAttribute("guid",uuid);this.context.api.newsItem.addTag(this.name,{uuid:uuid,name:[name],type:["organisation"],imType:["x-im/topic"]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}else{this.saveConcept(uuid,xmlTag.documentElement.outerHTML).then(()=>{this.context.api.newsItem.updateTag(this.name,uuid,{name:[name],imType:[tag.type["@value"]]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}}render($$){const tag=this.props.tag,el=$$("div").addClass("tag-edit tag-edit-person").addClass("row"),name=this.renderElement($$,"nameInput","Name",tag.concept.name,true,"input"),shortDesc=this.renderElement($$,"shortDescInput",this.getLabel("mmtags-Short_description"),this.getConceptDefinition("drol:short").keyValue,true,"input"),longDesc=this.renderElement($$,"longDescTextarea",this.getLabel("mmtags-Long_description"),this.getConceptDefinition("drol:long").keyValue,true,"textarea");name.on("change",()=>{if(this.refs["nameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}});el.append([name,shortDesc,longDesc]);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("mmtags-error-save"))))}return el}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditTopicComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={personTemplate:'<conceptItem conformance="power" standard="NewsML-G2" standardversion="2.20" version="1">'+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/>'+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/>'+"<itemMeta>"+'<itemClass qcode="cinat:concept"/>'+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/>'+"<edNote/>"+'<itemMetaExtProperty type="imext:type" value="x-im/person"/>'+'<itemMetaExtProperty type="imext:firstName" value=""/>'+'<itemMetaExtProperty type="imext:lastName" value=""/>'+'<links xmlns="http://www.infomaker.se/newsml/1.0"/>'+"</itemMeta>"+"<concept>"+'<conceptId uri="im://person/"/>'+'<type qcode="cpnat:person"/>'+"<name></name>"+'<definition role="drol:long"></definition>'+'<definition role="drol:short"></definition>'+"</concept>"+"</conceptItem>",organisationTemplate:'<conceptItem conformance="power" standard="NewsML-G2" standardversion="2.20" version="1">'+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/>'+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/>'+"<itemMeta>"+'<itemClass qcode="cinat:concept"/>'+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/>'+"<edNote/>"+'<itemMetaExtProperty type="imext:type" value="x-im/organisation"/>'+'<links xmlns="http://www.infomaker.se/newsml/1.0"/>'+"</itemMeta>"+"<concept>"+'<conceptId uri="im://organisation/"/>'+'<type qcode="cpnat:organisation"/>'+"<name></name>"+'<definition role="drol:long"></definition>'+'<definition role="drol:short"></definition>'+'<metadata xmlns="http://www.infomaker.se/newsml/1.0">'+'<object id="" type="x-im/contact-info">'+"<data>"+"<email></email>"+"<phone></phone>"+"<fax></fax>"+"<streetAddress></streetAddress>"+"<postalCode></postalCode>"+"<country></country>"+"</data>"+"</object>"+"</metadata>"+"</concept>"+"</conceptItem>",topicTemplate:'<conceptItem conformance="power" standard="NewsML-G2" standardversion="2.20" version="1">'+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/>'+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/>'+"<itemMeta>"+'<itemClass qcode="cinat:concept"/>'+'<provider literal=""/>'+'<pubStatus qcode="stat:usable"/>'+"<firstCreated />"+"<versionCreated/>"+"<edNote/>"+'<itemMetaExtProperty type="imext:type" value="x-im/topic"/>'+'<itemMetaExtProperty type="imext:firstName" value=""/>'+'<itemMetaExtProperty type="imext:lastName" value=""/>'+'<links xmlns="http://www.infomaker.se/newsml/1.0"/>'+"</itemMeta>"+"<concept>"+"<conceptId />"+'<type qcode="cpnat:object"/>'+"<name></name>"+'<definition role="drol:long"></definition>'+'<definition role="drol:short"></definition>'+"</concept>"+"</conceptItem>"
}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(202);var _TagsPackage=__webpack_require__(204);var _TagsPackage2=_interopRequireDefault(_TagsPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_TagsPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(202);var _TagsMainComponent=__webpack_require__(205);var _TagsMainComponent2=_interopRequireDefault(_TagsMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.tags",name:"ximtags",vendor:"infomaker.se",configure:function configure(config){config.addLabel("ximtags-could_not_load_uuid",{en:"This item could not be loaded. UUID: ",sv:"Detta objekt kunde inte laddas in. UUID: "});config.addLabel("ximtags-title",{sv:"Taggar",en:"Tags"});config.addLabel("ximtags-search_placeholder",{sv:"Sök taggar",en:"Search tags"});config.addLabel("ximtags-create",{en:"Create",sv:"Skapa"});config.addLabel("ximtags-save",{en:"Save",sv:"Spara"});config.addLabel("ximtags-edit",{en:"Edit",sv:"Redigera"});config.addLabel("ximtags-Person",{en:"Person",sv:"Person"});config.addLabel("ximtags-Organization",{en:"Organization",sv:"Organisation"});config.addLabel("ximtags-Topic",{en:"Topic",sv:"Ämne"});config.addLabel("ximtags-type-question-label",{en:"What kind of tag do you want to create?",sv:"Vilken typ vill du skapa?"});config.addLabel("ximtags-name_already_in_use",{en:"Please note that this name is already in use",sv:"Observera att namnet redan används"});config.addLabel("ximtags-error-save",{en:"Error when saving tag",sv:"Fel vid sparande av tag"});config.addLabel("ximtags-Short_description",{en:"Short description",sv:"Kort beskrivning"});config.addLabel("ximtags-Long_description",{en:"Long description",sv:"Lång beskrivning"});config.addLabel("ximtags-Website_url",{en:"Website url",sv:"Länk till webbsida"});config.addLabel("ximtags-Twitter_url",{en:"Twitter url",sv:"Länk till Twitter"});config.addLabel("ximtags-Facebook_url",{en:"Facebook url",sv:"Länk till Facebook"});config.addLabel("ximtags-Remove_from_article",{en:"Remove from article",sv:"Ta bort från artikel"});config.addComponentToSidebarWithTabId(this.id,"main",_TagsMainComponent2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _TagsListComponent=__webpack_require__(206);var _TagsListComponent2=_interopRequireDefault(_TagsListComponent);var _TagEditBaseComponent=__webpack_require__(210);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _TagEditPersonComponent=__webpack_require__(212);var _TagEditPersonComponent2=_interopRequireDefault(_TagEditPersonComponent);var _TagEditCompanyComponent=__webpack_require__(211);var _TagEditCompanyComponent2=_interopRequireDefault(_TagEditCompanyComponent);var _concept=__webpack_require__(213);var _concept2=_interopRequireDefault(_concept);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximtags"}getInitialState(){return{existingTags:this.context.api.newsItem.getTags(["x-im/person","x-im/organisation","x-cmbr/channel","x-im/channel","x-im/category"])}}reload(){this.extendState({existingTags:this.context.api.newsItem.getTags(["x-im/person","x-im/organisation","x-cmbr/channel","x-im/channel","x-im/category"])})}render($$){const el=$$("div").ref("tagContainer").addClass("authors").append($$("h2").append(this.getLabel("ximtags-title")));const SearchComponent=this.context.componentRegistry.get("form-search");const searchComponent=$$(SearchComponent,{existingItems:this.state.existingTags,searchUrl:"/api/search/concepts/tags?q=",onSelect:this.addTag.bind(this),onCreate:this.createTag.bind(this),placeholderText:this.getLabel("ximtags-search_placeholder"),createAllowed:true}).ref("searchComponent");const tagList=$$(_TagsListComponent2.default,{tags:this.state.existingTags,removeTag:this.removeTag.bind(this),reload:this.reload.bind(this)}).ref("tagList");el.append(tagList);el.append(searchComponent);return el}removeTag(tag){try{this.context.api.newsItem.removeLinkByUUIDAndRel(this.name,tag.uuid,"subject");this.reload()}catch(e){}}addTag(tag){try{this.context.api.newsItem.addTag(this.name,tag);this.reload()}catch(e){}}createTag(tag,exists){try{this.context.api.ui.showDialog(_TagEditBaseComponent2.default,{tag:tag,exists:exists,close:this.closeFromDialog.bind(this),createPerson:this.createPerson.bind(this),createOrganisation:this.createOrganisation.bind(this)},{primary:false,title:this.getLabel("ximtags-create")+" "+tag.inputValue,global:true})}catch(e){}}createPerson(inputValue){const newName=inputValue.split(" ");const parser=new DOMParser;const tagXML=parser.parseFromString(_concept2.default.personTemplate,"text/xml").firstChild;tagXML.querySelector('itemMeta itemMetaExtProperty[type="imext:firstName"]').setAttribute("value",newName[0]);tagXML.querySelector('itemMeta itemMetaExtProperty[type="imext:lastName"]').setAttribute("value",newName[1]?newName[1]:"");const loadedTag=_writer.jxon.build(tagXML);this.context.api.ui.showDialog(_TagEditPersonComponent2.default,{tag:loadedTag,close:this.closeFromDialog.bind(this)},{primary:this.getLabel("ximtags-save"),title:this.getLabel("ximtags-create")+" "+inputValue,icon:"fa-user",global:true})}createOrganisation(inputValue){const parser=new DOMParser;const tagXML=parser.parseFromString(_concept2.default.organisationTemplate,"text/xml").firstChild;tagXML.querySelector("concept name").textContent=inputValue;const loadedTag=_writer.jxon.build(tagXML);this.context.api.ui.showDialog(_TagEditCompanyComponent2.default,{tag:loadedTag,close:this.closeFromDialog.bind(this)},{primary:this.getLabel("ximtags-save"),title:this.getLabel("ximtags-create")+" "+inputValue,icon:"fa-sitemap",global:true})}closeFromDialog(){this.reload()}}exports.default=TagsMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _TagItemComponent=__webpack_require__(207);var _TagItemComponent2=_interopRequireDefault(_TagItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsListComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximtags"}render($$){const tags=this.props.tags,tagList=$$("ul").addClass("tag-list"),tagEls=tags.map(tag=>{return $$(_TagItemComponent2.default,{tag:tag,removeTag:this.removeTag.bind(this),reload:this.props.reload.bind(this)}).ref("tag-"+tag.uuid)},this);tagList.append(tagEls);return tagList}removeTag(tag){delete this.refs["tag-"+tag.uuid];this.props.removeTag(tag)}}exports.default=TagsListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _Config=__webpack_require__(208);var _Config2=_interopRequireDefault(_Config);var _TagInfoComponent=__webpack_require__(209);var _TagInfoComponent2=_interopRequireDefault(_TagInfoComponent);var _TagEditCompanyComponent=__webpack_require__(211);var _TagEditCompanyComponent2=_interopRequireDefault(_TagEditCompanyComponent);var _TagEditPersonComponent=__webpack_require__(212);var _TagEditPersonComponent2=_interopRequireDefault(_TagEditPersonComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximtags"}getItemMetaExtPropertyByType(type){if(_writer.lodash.isArray(this.state.loadedTag.itemMeta.itemMetaExtProperty)){return _writer.lodash.find(this.state.loadedTag.itemMeta.itemMetaExtProperty,function(itemMeta){return itemMeta["@type"]===type})}else if(_writer.lodash.isObject(this.state.loadedTag.itemMeta.itemMetaExtProperty)){if(this.state.loadedTag.itemMeta.itemMetaExtProperty["@type"]===type){return this.state.loadedTag.itemMeta.itemMetaExtProperty}}}loadTag(){this.context.api.router.getConceptItem(this.props.tag.uuid,this.props.tag.type).then(xml=>{const conceptXML=xml.querySelector("conceptItem"),conceptItemJSON=_writer.jxon.build(conceptXML);this.extendState({loadedTag:conceptItemJSON,isLoaded:true});this.state.loadedTag.type=this.getItemMetaExtPropertyByType("imext:type")}).catch(()=>{this.extendState({isLoaded:true,couldNotLoad:true})})}render($$){const tag=this.props.tag,tagItem=$$("li").addClass("tag-list__item").ref("tagItem"),displayNameEl=$$("span");let displayName;displayNameEl.attr("title",TagsItemComponent.getNameForTag(tag));if(!this.state.isLoaded){this.loadTag()}else{if(this.state.couldNotLoad){displayNameEl.addClass("tag-item__title tag-item__title--no-avatar tag-item__title--notexisting").append(tag.title).attr("title",this.getLabel("ximtags-could_not_load_uuid")+tag.uuid);displayName=tag.title}else{displayName=this.state.loadedTag.concept.name;displayNameEl.addClass("tag-item__title tag-item__title--no-avatar").append(displayName);this.updateTagItemName(displayNameEl,this.state.loadedTag);displayNameEl.on("click",()=>{if(_Config2.default.isTagEditable(tag)){this.editTag(displayName)}else{this.showTag(displayName)}})}displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");tagItem.append(displayNameEl);const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("ximtags-Remove_from_article"))).on("click",()=>{this.removeTag(tag)});tagItem.append(deleteButton);const iconComponent=this.getIconForTag($$,tag);if(iconComponent){tagItem.append(iconComponent)}}return tagItem}showTag(title){this.context.api.ui.showDialog(_TagInfoComponent2.default,{tag:this.state.loadedTag,close:this.closeFromDialog.bind(this),couldNotLoad:this.state.couldNotLoad},{secondary:false,title:title,global:true})}editTag(title){let tagEdit;switch(this.state.loadedTag.type["@value"]){case"x-im/organisation":tagEdit=_TagEditCompanyComponent2.default;break;case"x-im/person":tagEdit=_TagEditPersonComponent2.default;break;default:break}this.context.api.ui.showDialog(tagEdit,{tag:this.state.loadedTag,close:this.closeFromDialog.bind(this),couldNotLoad:this.state.couldNotLoad},{primary:this.getLabel("ximtags-save"),title:this.getLabel("ximtags-edit")+" "+title,global:true})}closeFromDialog(){this.loadTag();this.props.reload()}removeTag(tag){this.props.removeTag(tag)}getIconForTag($$,tag){if(!tag.type){return this.getDefaultIconForTag($$)}const tagConfig=_Config2.default.types[tag.type];if(tagConfig){return $$(_substance.FontAwesomeIcon,{icon:tagConfig.icon}).addClass("tag-icon")}else{this.getDefaultIconForTag($$)}}static getNameForTag(tag){if(!tag.type){return undefined}const tagConfig=_Config2.default.types[tag.type];if(tagConfig){return tagConfig.name}}updateTagItemName(tagItem,loadedTag){if(loadedTag.concept&&loadedTag.concept.definition){const definition=_writer.lodash.isArray(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(let i=0;i<definition.length;i++){const item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}getDefaultIconForTag($$){return $$(_substance.FontAwesomeIcon,{icon:"fa-tag"}).addClass("tag-icon")}}exports.default=TagsItemComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={isTagEditable:function isTagEditable(tag){return Boolean(this.types[tag.type].editable)},types:{"x-im/person":{icon:"fa-user",name:"Person",editable:true},"x-im/organisation":{icon:"fa-sitemap",name:"Organisation",editable:true},"x-im/channel":{icon:"fa-random",name:"Channel",editable:false},"x-cmbr/channel":{icon:"fa-random",name:"Channel",editable:false},"x-cmbr/category":{icon:"fa-tags",name:"Category",editable:false},"x-im/category":{icon:"fa-tags",name:"Category",editable:false}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(210);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagInfoComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args)}render($$){const el=$$("div").addClass("tag-edit-base");const shortDescription=this.getConceptDefinition("drol:short");if(shortDescription){const shortDescEl=$$("p").append(shortDescription.keyValue);el.append(shortDescEl)}const longDescription=this.getConceptDefinition("drol:long");if(longDescription){const longDescEl=$$("p").append(longDescription.keyValue);el.append(longDescEl)}return el}onClose(){}}exports.default=TagInfoComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);const find=_writer.lodash.find;class TagEditBaseComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximtags"}saveConcept(uuid,newsItem){return this.context.api.router.updateConceptItem(uuid,newsItem)}createConcept(newsItem){return this.context.api.router.createConceptItem(newsItem)}updateFacebook(facebookInputValue){const facebookNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="x-im/social+facebook"]');if(facebookInputValue.length>0&&!facebookNode){this.createLinkNode(this.xmlDoc,{type:"x-im/social+facebook",rel:"irel:seeAlso",url:facebookInputValue})}else if(facebookNode&&facebookInputValue.length>0){facebookNode.setAttribute("url",facebookInputValue)}else if(facebookInputValue.length===0&&facebookNode){facebookNode.parentElement.removeChild(facebookNode)}}updateTwitter(twitterInputValue){const twitterNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="x-im/social+twitter"]');if(twitterInputValue.length>0&&!twitterNode){this.createLinkNode(this.xmlDoc,{type:"x-im/social+twitter",rel:"irel:seeAlso",url:twitterInputValue})}else if(twitterNode&&twitterInputValue.length>0){twitterNode.setAttribute("url",twitterInputValue)}else if(twitterInputValue.length===0&&twitterNode){twitterNode.parentElement.removeChild(twitterNode)}}updateWebsite(websiteInputValue){const websiteNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="text/html"]');if(websiteInputValue.length>0&&!websiteNode){this.createLinkNode(this.xmlDoc,{type:"text/html",rel:"irel:seeAlso",url:websiteInputValue})}else if(websiteNode&&websiteInputValue.length>0){websiteNode.setAttribute("url",websiteInputValue)}else if(websiteInputValue.length===0&&websiteNode){websiteNode.parentElement.removeChild(websiteNode)}}createLinkNode(xmlDoc,attributes){const linkNode=xmlDoc.createElement("link");for(let key in attributes){if(attributes.hasOwnProperty(key)){linkNode.setAttribute(key,attributes[key])}}xmlDoc.documentElement.querySelector("itemMeta links").appendChild(linkNode);return linkNode}getItemMetaExtProperty(key){return find(this.props.tag.itemMeta.itemMetaExtProperty,item=>item["@type"]===key)}getConceptDefinition(key){return find(this.props.tag.concept.definition,item=>item["@role"]===key)}getSeeAlsoLinkByType(type){return find(this.props.tag.itemMeta.links.link,link=>link["@type"]===type&&link["@rel"]==="irel:seeAlso")}render($$){const el=$$("div").addClass("tag-edit tag-edit-base");const personBtn=$$("button").append($$(_substance.FontAwesomeIcon,{icon:"fa-user"})).append($$("span").append(this.getLabel("ximtags-Person"))).on("click",this.createPerson);const organisationBtn=$$("button").append($$(_substance.FontAwesomeIcon,{icon:"fa-sitemap"})).append($$("span").append(this.getLabel("ximtags-Organization"))).on("click",this.createOrganisation);el.append($$("small").addClass("text-muted").append(this.getLabel("ximtags-type-question-label")));el.append([personBtn,organisationBtn]);if(this.props.exists){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-info").append(this.getLabel("ximtags-name_already_in_use")+": "+this.props.tag.value)))}if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("ximtags-error-save"))))}return el}createPerson(){this.send("close");this.props.createPerson(this.props.tag.inputValue)}createOrganisation(){this.send("close");this.props.createOrganisation(this.props.tag.inputValue)}closeAndReload(){this.props.close();this.send("close")}renderElement($$,refName,label,inputValue,fullWidth,inputType){const cssClass=fullWidth?"col-xs-12":"col-xs-12 col-sm-6";let input;switch(inputType){case"textarea":input=this.getTextAreaElement($$);break;default:input=this.getTextInputElement($$);break}const formGroup=$$("fieldset").addClass("form-group").addClass(cssClass);formGroup.append($$("label").append(label));formGroup.append(input.val(inputValue).ref(refName));return formGroup}getTextInputElement($$){return $$("input").attr("type","text").addClass("form-control")}getTextAreaElement($$){return $$("textarea").attr("rows","4").addClass("form-control")}static getShortDescription(xmlTag){return xmlTag.documentElement.querySelector('concept definition[role="drol:short"]')}static getLongDescription(xmlTag){return xmlTag.documentElement.querySelector('concept definition[role="drol:long"]')}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditBaseComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(210);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagEditCompanyComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args);this.name="ximtags"}save(){const tag=this.props.tag,name=this.refs.nameInput.val(),shortDesc=this.refs.shortDescInput.val(),longDesc=this.refs.longDescTextarea.val(),uuid=tag["@guid"]?tag["@guid"]:null;tag.concept.name=name;const xmlTag=_writer.jxon.unbuild(tag,null,"conceptItem");this.xmlDoc=xmlTag;const shortDescNode=_TagEditBaseComponent2.default.getShortDescription(xmlTag),longDescNode=_TagEditBaseComponent2.default.getLongDescription(xmlTag);shortDescNode.textContent=shortDesc;longDescNode.textContent=longDesc;this.updateWebsite(this.refs.urlInput.val());this.updateTwitter(this.refs.twitterInput.val());this.updateFacebook(this.refs.facebookInput.val());if(uuid===null){this.createConcept(xmlTag.documentElement.outerHTML).then(uuid=>{this.xmlDoc.querySelector("conceptItem").setAttribute("guid",uuid);this.context.api.newsItem.addTag(this.name,{uuid:uuid,name:[name],type:["organisation"],imType:["x-im/organisation"]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}else{this.saveConcept(uuid,xmlTag.documentElement.outerHTML).then(()=>{this.context.api.newsItem.updateTag(this.name,uuid,{name:[name],imType:[tag.type["@value"]]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}}render($$){const tag=this.props.tag,el=$$("div").addClass("tag-edit tag-edit-person").addClass("row"),name=this.renderElement($$,"nameInput","Name",tag.concept.name,true,"input"),shortDesc=this.renderElement($$,"shortDescInput",this.getLabel("ximtags-Short_description"),this.getConceptDefinition("drol:short").keyValue,true,"input"),longDesc=this.renderElement($$,"longDescTextarea",this.getLabel("ximtags-Long_description"),this.getConceptDefinition("drol:long").keyValue,true,"textarea"),websiteUrl=this.getSeeAlsoLinkByType("text/html"),websiteUrlEl=this.renderElement($$,"urlInput",this.getLabel("ximtags-Website_url"),websiteUrl?websiteUrl["@url"]:"",true,"input"),twitterUrl=this.getSeeAlsoLinkByType("x-im/social+twitter"),twitterEl=this.renderElement($$,"twitterInput",this.getLabel("ximtags-Twitter_url"),twitterUrl?twitterUrl["@url"]:"",false,"input"),facebook=this.getSeeAlsoLinkByType("x-im/social+facebook"),facebookEl=this.renderElement($$,"facebookInput",this.getLabel("ximtags-Facebook_url"),facebook?facebook["@url"]:"",false,"input");name.on("change",()=>{if(this.refs["nameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}});el.append([name,shortDesc,longDesc,websiteUrlEl,twitterEl,facebookEl]);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("ximtags-error-save"))))}return el}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditCompanyComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(210);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagEditPersonComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args);this.name="ximtags"}save(){const tag=this.props.tag,firstName=this.refs.firstNameInput.val(),lastName=this.refs.lastNameInput.val(),shortDesc=this.refs.shortDescInput.val(),longDesc=this.refs.longDescTextarea.val(),uuid=tag["@guid"]?tag["@guid"]:null,fullName=firstName+" "+lastName;tag.concept.name=fullName;const xmlTag=_writer.jxon.unbuild(tag,null,"conceptItem");this.xmlDoc=xmlTag;const firstNameNode=xmlTag.documentElement.querySelector('itemMetaExtProperty[type="imext:firstName"]');const lastNameNode=xmlTag.documentElement.querySelector('itemMetaExtProperty[type="imext:lastName"]');firstNameNode.setAttribute("value",firstName);lastNameNode.setAttribute("value",lastName);const shortDescNode=_TagEditBaseComponent2.default.getShortDescription(xmlTag),longDescNode=_TagEditBaseComponent2.default.getLongDescription(xmlTag);shortDescNode.textContent=shortDesc;longDescNode.textContent=longDesc;this.updateWebsite(this.refs.urlInput.val());this.updateTwitter(this.refs.twitterInput.val());this.updateFacebook(this.refs.facebookInput.val());if(uuid===null){this.createConcept(xmlTag.documentElement.outerHTML).then(uuid=>{this.xmlDoc.querySelector("conceptItem").setAttribute("guid",uuid);this.context.api.newsItem.addTag(this.name,{uuid:uuid,name:[fullName],type:["person"],imType:["x-im/person"]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}else{this.saveConcept(uuid,xmlTag.documentElement.outerHTML).then(()=>{this.context.api.newsItem.updateTag(this.name,uuid,{name:[fullName],imType:[tag.type["@value"]]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}}render($$){const el=$$("div").addClass("tag-edit tag-edit-person").addClass("row"),firstName=this.renderElement($$,"firstNameInput","First name",this.getItemMetaExtProperty("imext:firstName")["@value"],false,"input"),lastName=this.renderElement($$,"lastNameInput","Last name",this.getItemMetaExtProperty("imext:lastName")["@value"],false,"input"),shortDesc=this.renderElement($$,"shortDescInput",this.getLabel("ximtags-Short_description"),this.getConceptDefinition("drol:short").keyValue,true,"input"),longDesc=this.renderElement($$,"longDescTextarea",this.getLabel("ximtags-Long_description"),this.getConceptDefinition("drol:long").keyValue,true,"textarea"),websiteUrl=this.getSeeAlsoLinkByType("text/html"),websiteUrlEl=this.renderElement($$,"urlInput",this.getLabel("ximtags-Website_url"),websiteUrl?websiteUrl["@url"]:"",true,"input"),twitterUrl=this.getSeeAlsoLinkByType("x-im/social+twitter"),twitterEl=this.renderElement($$,"twitterInput",this.getLabel("ximtags-Twitter_url"),twitterUrl?twitterUrl["@url"]:"",false,"input"),facebook=this.getSeeAlsoLinkByType("x-im/social+facebook"),facebookEl=this.renderElement($$,"facebookInput",this.getLabel("ximtags-Facebook_url"),facebook?facebook["@url"]:"",false,"input");firstName.on("change",()=>{if(this.refs["firstNameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}});el.append([firstName,lastName,shortDesc,longDesc,websiteUrlEl,twitterEl,facebookEl]);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("ximtags-error-save"))))}return el}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditPersonComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={personTemplate:'<conceptItem conformance="power" standard="NewsML-G2" standardversion="2.20" version="1">'+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/>'+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/>'+"<itemMeta>"+'<itemClass qcode="cinat:concept"/>'+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/>'+"<edNote/>"+'<itemMetaExtProperty type="imext:type" value="x-im/person"/>'+'<itemMetaExtProperty type="imext:firstName" value=""/>'+'<itemMetaExtProperty type="imext:lastName" value=""/>'+'<links xmlns="http://www.infomaker.se/newsml/1.0" />'+"</itemMeta>"+"<concept>"+'<conceptId uri="im://person/"/>'+'<type qcode="cpnat:person"/>'+"<name></name>"+'<definition role="drol:long"></definition>'+'<definition role="drol:short"></definition>'+"</concept>"+"</conceptItem>",organisationTemplate:'<conceptItem conformance="power" standard="NewsML-G2" standardversion="2.20" version="1">'+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/>'+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/>'+"<itemMeta>"+'<itemClass qcode="cinat:concept"/>'+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/>'+'<itemMetaExtProperty type="imext:type" value="x-im/organisation"/>'+'<links xmlns="http://www.infomaker.se/newsml/1.0" />'+"</itemMeta>"+"<concept>"+'<conceptId uri="im://organisation/"/>'+'<type qcode="cpnat:organisation"/>'+"<name></name>"+'<definition role="drol:long"></definition>'+'<definition role="drol:short"></definition>'+'<metadata xmlns="http://www.infomaker.se/newsml/1.0">'+'<object id="" type="x-im/contact-info">'+"<data>"+"<email></email>"+"<phone></phone>"+"<fax></fax>"+"<streetAddress></streetAddress>"+"<postalCode></postalCode>"+"<country></country>"+"</data>"+"</object>"+"</metadata>"+"</concept>"+"</conceptItem>"}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _DefaultValidation=__webpack_require__(215);var _DefaultValidation2=_interopRequireDefault(_DefaultValidation);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;const validationPackage={id:"se.infomaker.defaultvalidation",name:"defaultvalidation",configure:config=>{config.addValidator(_DefaultValidation2.default)}};exports.default=(()=>{if(registerPlugin){registerPlugin(validationPackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class DefaultValidation extends _writer.Validator{constructor(...args){super(...args)}validate(){var pubStatus=_writer.api.newsItem.getPubStatus(),headlines=this.newsItem.querySelectorAll('idf>group element[type="headline"]'),messageMethod;switch(pubStatus.qcode){case"imext:draft":case"stat:canceled":messageMethod=this.addWarning.bind(this);break;default:messageMethod=this.addError.bind(this)}if(headlines.length===0){messageMethod("The article is missing a headline which might make it hard to find.")}else if(headlines[0].childNodes.length===0||headlines[0].firstChild.nodeName!=="#text"||headlines[0].firstChild.textContent.trim()===""){messageMethod("The first headline in the article should not be empty.")}}}exports.default=DefaultValidation},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ContentprofilePackage=__webpack_require__(217);var _ContentprofilePackage2=_interopRequireDefault(_ContentprofilePackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_ContentprofilePackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ContentprofileMainComponent=__webpack_require__(218);var _ContentprofileMainComponent2=_interopRequireDefault(_ContentprofileMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.ximcontentprofile",name:"ximcontentprofile",configure:function configure(config){config.addComponentToSidebarWithTabId(this.id,"main",_ContentprofileMainComponent2.default);config.addLabel("Search content profile tags",{sv:"Sök Funktionstaggar"});config.addLabel("Content profile tags",{sv:"Funktionstaggar"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ContentprofileListComponent=__webpack_require__(219);var _ContentprofileListComponent2=_interopRequireDefault(_ContentprofileListComponent);var _ContentprofileDetailComponent=__webpack_require__(221);var _ContentprofileDetailComponent2=_interopRequireDefault(_ContentprofileDetailComponent);var _contentprofile=__webpack_require__(222);var _contentprofile2=_interopRequireDefault(_contentprofile);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentprofileMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximcontentprofile"}getInitialState(){return{existingContentProfiles:_writer.api.newsItem.getContentProfiles()}}reloadContentProfiles(){this.extendState({existingContentProfiles:_writer.api.newsItem.getContentProfiles()})}render($$){const el=$$("div").ref("contentProfileContainer").addClass("contentProfiles").append($$("h2").append(this.getLabel("Content profile tags")));const ContentProfileSearchComponent=this.context.componentRegistry.get("form-search");const searchComponent=$$(ContentProfileSearchComponent,{existingItems:this.state.existingContentProfiles,searchUrl:"/api/search/concepts/contentprofiles?q=",onSelect:this.addContentProfile.bind(this),onCreate:this.saveContentProfile.bind(this),createAllowed:true,placeholderText:this.getLabel("Search content profile tags")}).ref("contentProfileSearchComponent");var existingContentProfilesList=$$(_ContentprofileListComponent2.default,{
existingContentProfiles:this.state.existingContentProfiles,openContentProfile:this.openContentProfile.bind(this),removeContentProfile:this.removeContentProfile.bind(this)}).ref("existingContentProfileList");el.append(existingContentProfilesList);el.append(searchComponent);return el}removeContentProfile(contentProfile){try{_writer.api.newsItem.removeLinkByUUID(this.name,contentProfile.uuid);this.reloadContentProfiles()}catch(e){console.error(e)}}addContentProfile(item){try{let contentProfile={title:item.name[0],uuid:item.uuid};_writer.api.newsItem.addConceptProfile(this.name,contentProfile);this.reloadContentProfiles()}catch(e){console.error(e)}}saveContentProfile(item){const parser=new DOMParser;const contentProfileXML=parser.parseFromString(_contentprofile2.default.contentprofile,"text/xml").firstChild;var contentProfile=_writer.jxon.build(contentProfileXML);contentProfile.concept.name=item.inputValue;this._open(contentProfile,false)}openContentProfile(item){this._open(item,true)}_open(item,exists){var editable=true;var properties={exists:exists,contentProfile:item,reload:this.reloadContentProfiles.bind(this),editable:editable};_writer.api.ui.showDialog(_ContentprofileDetailComponent2.default,properties,{title:this.getLabel("Content profile")+" "+item.concept.name,global:true,primary:editable?this.getLabel("Save"):this.getLabel("Close"),secondary:editable?this.getLabel("Cancel"):false})}}exports.default=ContentprofileMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _ContentprofileItemComponent=__webpack_require__(220);var _ContentprofileItemComponent2=_interopRequireDefault(_ContentprofileItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentprofileListComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximcontentprofile"}render($$){const existingContentProfiles=this.props.existingContentProfiles;const contentProfilesList=$$("ul").addClass("tag-list");existingContentProfiles.forEach(contentProfile=>{contentProfilesList.append($$(_ContentprofileItemComponent2.default,{contentProfile:contentProfile,openContentProfile:this.props.openContentProfile.bind(this),removeContentProfile:this.deleteContentProfileAndReference.bind(this)}).ref(contentProfile.uuid))});return contentProfilesList}deleteContentProfileAndReference(contentProfile){this.refs[contentProfile.uuid].remove();delete this.refs[contentProfile.uuid];this.props.removeContentProfile(contentProfile)}}exports.default=ContentprofileListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _lodash=__webpack_require__(139);class ContentprofileItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximcontentprofile"}dispose(){super.dispose()}loadContentProfile(){var api=this.context.api;api.router.getConceptItem(this.props.contentProfile.uuid,this.props.contentProfile.type).then(xml=>{var conceptXML=xml.querySelector("conceptItem");try{this.setState({loadedContentProfile:_writer.jxon.build(conceptXML),isLoaded:true})}catch(e){this.setState({isLoaded:true,couldNotLoad:true})}}).catch(()=>{this.setState({isLoaded:true,couldNotLoad:true})})}render($$){let contentProfile=this.props.contentProfile;const contentProfileListItem=$$("li").addClass("tag-list__item");const displayNameElement=$$("span");if(!this.state.isLoaded){displayNameElement.addClass("tag-item__title tag-item__title--loading").append(contentProfile.title);this.loadContentProfile()}else{if(this.state.couldNotLoad){displayNameElement.addClass("tag-item__title tag-item__title--no-avatar tag-item__title--notexisting").append(contentProfile.title).attr("title",this.getLabel("This item could not be loaded. UUID: ")+contentProfile.uuid)}else{displayNameElement.addClass("tag-item__title tag-item__title--no-avatar").append(this.state.loadedContentProfile.concept.name);displayNameElement.attr("title",contentProfile.title);this.updateTagItemName(displayNameElement,this.state.loadedContentProfile);displayNameElement.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");if(this.state.loadedContentProfile.concept.name!==contentProfile.title){this.setState({isLoaded:false})}displayNameElement.on("click",function(){this.props.openContentProfile(this.state.loadedContentProfile)}.bind(this))}contentProfileListItem.append(displayNameElement);const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("Remove from article"))).on("click",function(){this.removeContentProfile(contentProfile)}.bind(this));contentProfileListItem.append(deleteButton);const icon="fa-cogs";contentProfileListItem.append($$(_substance.FontAwesomeIcon,{icon:icon}).addClass("tag-icon"))}return contentProfileListItem}updateTagItemName(tagItem,loadedTag){if(loadedTag&&loadedTag.definition){var definition=(0,_lodash.isArray)(loadedTag.definition)?loadedTag.definition:[loadedTag.definition];for(var i=0;i<definition.length;i++){var item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}removeContentProfile(contentProfile){this.props.removeContentProfile(contentProfile)}}exports.default=ContentprofileItemComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);const isArray=_writer.lodash.isArray;const isObject=_writer.lodash.isObject;const find=_writer.lodash.find;class ContentprofileDetailComponent extends _substance.Component{constructor(...args){super(...args)}dispose(){super.dispose()}createContentProfile(){const contentProfile=this.props.contentProfile;this.saveContentProfile(null,"POST").then(uuid=>{this.context.api.newsItem.addConceptProfile(this.name,{title:contentProfile.concept.name,uuid:uuid});if(this.state.error){this.setState({error:false})}this.props.reload();this.send("close")}).catch(()=>{this.setState({error:true})})}updateContentProfile(){const contentProfile=this.props.contentProfile;const uuid=contentProfile["@guid"]?contentProfile["@guid"]:null;if(!uuid){throw new Error("ConceptItem has no UUID to update")}const shouldUpdateNewsItem=this.refs.contentProfileNameInput.val()!==contentProfile.concept.name;this.saveContentProfile(uuid,"PUT").then(()=>{if(shouldUpdateNewsItem){this.context.api.newsItem.updateConceptProfile(this.name,{title:contentProfile.concept.name,uuid:uuid})}if(this.state.error){this.setState({error:false})}this.props.reload();this.send("close")}).catch(()=>{this.setState({error:true})})}setDescription(inputValue,role){let currentDescription=this.context.api.concept.getDefinitionForType(this.props.contentProfile.concept.definition,role);if(inputValue.length>0&&!currentDescription){const longDesc={"@role":role,keyValue:inputValue};this.props.contentProfile.concept.definition=this.conceptUtil.setDefinitionDependingOnArrayOrObject(this.props.contentProfile.concept.definition,longDesc)}else if(inputValue.length>=0&&currentDescription){currentDescription["keyValue"]=inputValue}}saveContentProfile(id,method){let contentProfile=this.props.contentProfile;contentProfile.concept.name=this.refs.contentProfileNameInput.val().length>0?this.refs.contentProfileNameInput.val():contentProfile.concept.name;var shortDescriptionInputValue=this.refs.contentProfileShortDescInput.val();var longDescriptionInputValue=this.refs.contentProfileLongDescText.val();if(!contentProfile.concept.definition){contentProfile.concept.definition=[]}this.setDescription(shortDescriptionInputValue,"drol:short");this.setDescription(longDescriptionInputValue,"drol:long");this.xmlDoc=_writer.jxon.unbuild(contentProfile,null,"conceptItem");const conceptItem=this.xmlDoc.documentElement.outerHTML;switch(method){case"PUT":return this.context.api.router.updateConceptItem(id,conceptItem);case"POST":return this.context.api.router.createConceptItem(conceptItem)}}getDescription(descriptionType){const contentProfile=this.props.contentProfile.concept;if(!contentProfile.definition){return undefined}if(isArray(contentProfile.definition)){return find(contentProfile.definition,function(definition){return definition["@role"]===descriptionType})}else if(isObject(contentProfile.definition)){return contentProfile.definition["@role"]===descriptionType?contentProfile.definition:undefined}}getNameForContentProfile(){return this.props.contentProfile.concept.name}render($$){const name=this.getNameForContentProfile();let shortDesc=this.getDescription("drol:short");let longDesc=this.getDescription("drol:long");const el=$$("div");const formContainer=$$("form").addClass("location-form__container clearfix").ref("formContainer").on("submit",e=>{e.preventDefault();if(this.refs["contentProfileNameInput"].val()!==""){this.onClose("save")}});const hiddenSubmitButtonToEnableEnterSubmit=$$("input").attr({type:"submit",style:"display:none"});formContainer.append(hiddenSubmitButtonToEnableEnterSubmit);const formGroup=$$("fieldset").addClass("form-group col-xs-6").ref("formGroupName");formGroup.append($$("label").attr("for","contentProfileNameInput").append(this.getLabel("Name")));if(this.props.editable){const contentProfileName=$$("input").attr({type:"text",id:"contentProfileNameInput"}).addClass("form-control").val(name).ref("contentProfileNameInput");contentProfileName.on("change",function(){if(this.refs["contentProfileNameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}}.bind(this));formGroup.append(contentProfileName)}else{formGroup.append($$("p").append(name).ref("contentProfileNameP"))}formContainer.append(formGroup);const formGroupShortDesc=$$("fieldset").addClass("form-group col-xs-6").ref("formGroupShortDesc");formGroupShortDesc.append($$("label").attr("for","contentProfileShortDescInput").append(this.getLabel("Short description")));if(this.props.editable){formGroupShortDesc.append($$("input").attr({id:"contentProfileShortDescInput"}).addClass("form-control").val(shortDesc["keyValue"]).ref("contentProfileShortDescInput"))}else{formGroupShortDesc.append($$("p").append(shortDesc["keyValue"]).ref("contentProfileShortDescP"))}formContainer.append(formGroupShortDesc);const formGroupLongDesc=$$("fieldset").addClass("form-group col-xs-12").ref("formGroupLongDesc");formGroupLongDesc.append($$("label").attr("for","contentProfileLongDescText").append(this.getLabel("Long description")));if(this.props.editable){formGroupLongDesc.append($$("textarea").attr({id:"contentProfileLongDescText"}).addClass("form-control").val(longDesc["keyValue"]).ref("contentProfileLongDescText"))}else{formGroupLongDesc.append($$("p").append(longDesc["keyValue"]).ref("contentProfileLongDescP"))}formContainer.append(formGroupLongDesc);el.append(formContainer);return el}onClose(status){if("cancel"===status||this.props.editable===false){return true}if(this.props.exists){this.updateContentProfile()}else{this.createContentProfile()}return false}}exports.default=ContentprofileDetailComponent},function(module,exports){"use strict";module.exports={contentprofile:'<?xml version="1.0" encoding="UTF-8"?> '+'<conceptItem xmlns="http://iptc.org/std/nar/2006-10-01/" version="1" standard="NewsML-G2" standardversion="2.20" conformance="power"> '+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/> '+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/> '+"<itemMeta> "+'    <itemClass qcode="cinat:concept"/> '+'    <provider literal=""/> '+"    <firstCreated />"+"    <versionCreated/>"+'    <pubStatus qcode="stat:usable"/> '+'    <itemMetaExtProperty type="imext:type" value="x-im/content-profile"/> '+"</itemMeta> "+"<concept> "+'    <conceptId uri="im://content-profile/"/> '+'    <type qcode="cpnat:object"/> '+"    <name></name> "+'    <definition role="drol:long"></definition> '+'    <definition role="drol:short"></definition> '+"</concept> "+"</conceptItem>"}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimstoryPackage=__webpack_require__(224);var _XimstoryPackage2=_interopRequireDefault(_XimstoryPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_XimstoryPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(225);var _StoryMainComponent=__webpack_require__(227);var _StoryMainComponent2=_interopRequireDefault(_StoryMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.ximstory",name:"ximstory",configure:function configure(config){config.addLabel("ximstory-could_not_load_uuid",{en:"This item could not be loaded. UUID: ",sv:"Detta objekt kunde inte laddas in. UUID: "});config.addLabel("ximstory-search_stories",{en:"Search stories",sv:"Sök stories"});config.addLabel("ximstory-Save",{en:"Save",sv:"Spara"});config.addLabel("ximstory-create",{en:"Create ",sv:"Skapa "});config.addLabel("ximstory-remove_from_article",{en:"Remove from article",sv:"Ta bort från artikel"});config.addLabel("ximstory-name_already_in_use",{en:"Please note that this name is already in use",sv:"Observera att namnet redan används"});config.addLabel("ximstory-error-save",{en:"Error when saving story",sv:"Fel vid sparande av story"});config.addLabel("ximstory-Name",{en:"Name",sv:"Namn"});config.addLabel("ximstory-short_description",{en:"Short description",sv:"Kort beskrivning"});config.addLabel("ximstory-long_description",{en:"Long description",sv:"Lång beskrivning"});config.addLabel("ximstory-story",{en:"Story",sv:"Story"});config.addComponentToSidebarWithTabId(this.id,"main",_StoryMainComponent2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _StoryListComponent=__webpack_require__(228);var _StoryListComponent2=_interopRequireDefault(_StoryListComponent);var _StoryEditComponent=__webpack_require__(230);var _StoryEditComponent2=_interopRequireDefault(_StoryEditComponent);var _concept=__webpack_require__(231);var _concept2=_interopRequireDefault(_concept);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class StoryMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximstory"}getInitialState(){return{existingItems:this.context.api.newsItem.getStories(this.name)}}reload(){this.extendState({existingItems:this.context.api.newsItem.getStories(this.name)})}render($$){const el=$$("div").ref("tagContainer").addClass("stories").append($$("h2").append(this.getLabel("ximstory-story")));const SearchComponent=this.context.componentRegistry.get("form-search");const searchComponent=$$(SearchComponent,{existingItems:this.state.existingItems,searchUrl:"/api/search/concepts/stories?q=",onSelect:this.addStory.bind(this),onCreate:this.createStory.bind(this),placeholderText:this.getLabel("ximstory-search_stories"),createAllowed:true}).ref("searchComponent");const list=$$(_StoryListComponent2.default,{items:this.state.existingItems,removeItem:this.removeItem.bind(this),reload:this.reload.bind(this)}).ref("tagList");el.append(list);el.append(searchComponent);return el}removeItem(tag){try{this.context.api.newsItem.removeLinkByUUIDAndRel(this.name,tag.uuid,"subject");this.reload()}catch(e){}}addStory(story){try{this.context.api.newsItem.addStory(this.name,{uuid:story.uuid,title:story.name[0]});this.reload()}catch(e){}}createStory(searchItem,exists){const parser=new DOMParser;const storyXML=parser.parseFromString(_concept2.default.story,"text/xml").firstChild;const item=_writer.jxon.build(storyXML);item.concept.name=searchItem.inputValue;this.context.api.ui.showDialog(_StoryEditComponent2.default,{item:item,exists:exists,newLocation:true,close:this.closeFromDialog.bind(this),reload:this.reload.bind(this)},{primary:this.getLabel("ximstory-Save"),title:this.getLabel("ximstory-create")+" "+searchItem.inputValue,global:true})}closeFromDialog(){this.reload()}}exports.default=StoryMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _StoryItemComponent=__webpack_require__(229);var _StoryItemComponent2=_interopRequireDefault(_StoryItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class StoryListComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximstory"}render($$){const items=this.props.items,tagList=$$("ul").addClass("tag-list"),tagEls=items.map(item=>{return $$(_StoryItemComponent2.default,{item:item,removeItem:this.removeItem.bind(this),reload:this.props.reload.bind(this)}).ref("tag-"+item.uuid)},this);tagList.append(tagEls);return tagList}removeItem(tag){delete this.refs["tag-"+tag.uuid];this.props.removeItem(tag)}}exports.default=StoryListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _StoryEditComponent=__webpack_require__(230);var _StoryEditComponent2=_interopRequireDefault(_StoryEditComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class StoryItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximstory"}loadTag(){this.context.api.router.getConceptItem(this.props.item.uuid,this.props.item.type).then(xml=>{const conceptXML=xml.querySelector("conceptItem"),conceptItemJSON=_writer.jxon.build(conceptXML);this.extendState({loadedItem:conceptItemJSON,isLoaded:true})}).catch(()=>{this.extendState({isLoaded:true,couldNotLoad:true})})}render($$){const item=this.props.item,tagItem=$$("li").addClass("tag-list__item").ref("tagItem").attr("title","Story"),displayNameEl=$$("span");let displayName;if(!this.state.isLoaded){this.loadTag()}else{if(this.state.couldNotLoad){displayNameEl.addClass("tag-item__title tag-item__title--no-avatar tag-item__title--notexisting").append(item.title).attr("title",this.getLabel("ximstory-could_not_load_uuid")+item.uuid);displayName=item.title}else{displayName=this.state.loadedItem.concept.name;displayNameEl.addClass("tag-item__title tag-item__title--no-avatar").append(displayName);displayNameEl.on("click",()=>{this.showStory(displayName)})}displayNameEl.attr("title",displayName);this.updateTagItemName(displayNameEl,this.state.loadedItem);displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");tagItem.append(displayNameEl);const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("ximstory-remove_from_article"))).on("click",()=>{this.removeTag(item)});tagItem.append(deleteButton);tagItem.append($$(_substance.FontAwesomeIcon,{icon:"fa-circle"}).addClass("tag-icon"))}return tagItem}updateTagItemName(tagItem,loadedTag){if(loadedTag.concept&&loadedTag.concept.definition){const definition=_writer.lodash.isArray(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(let i=0;i<definition.length;i++){const item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}showStory(title){this.context.api.ui.showDialog(_StoryEditComponent2.default,{item:this.state.loadedItem,reload:this.closeFromDialog.bind(this)},{title:title,global:true})}closeFromDialog(){this.loadTag();this.props.reload()}removeTag(tag){this.props.removeItem(tag)}}exports.default=StoryItemComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class StoryEditComponent extends _substance.Component{constructor(...args){super(...args)}createLocation(){const story=this.props.item;this.saveLocation(null,"POST").then(data=>{this.context.api.newsItem.addStory(this.name,{title:story.concept.name,uuid:data});if(this.state.error){this.extendState({error:false})}this.props.reload();this.send("close")}).catch(()=>{this.extendState({error:true})})}updateLocation(){const story=this.props.item,uuid=story["@guid"]?story["@guid"]:null;if(!uuid){throw new Error("ConceptItem has no UUID to update")}this.saveLocation(uuid,"PUT").then(()=>{this.context.api.newsItem.updateStory(this.name,{title:story.concept.name,uuid:uuid});if(this.state.error){this.extendState({error:false})}this.props.reload();this.send("close")}).catch(()=>{this.extendState({error:true})})}setDescription(inputValue,role){const currentDescription=this.context.api.concept.getDefinitionForType(this.props.item.concept.definition,role);if(inputValue.length>0&&!currentDescription){const longDesc={"@role":role,keyValue:inputValue};this.props.item.concept.definition=this.context.api.concept.setDefinitionDependingOnArrayOrObject(this.props.item.concept.definition,longDesc)}else if(inputValue.length>=0&&currentDescription){currentDescription["keyValue"]=inputValue}}saveLocation(id,method){const location=this.props.item;location.concept.name=this.refs.storyNameInput.val().length>0?this.refs.storyNameInput.val():location.concept.name;const shortDescriptionInputValue=this.refs.storyShortDescInput.val();const longDescriptionInputValue=this.refs.storyLongDescText.val();if(!location.concept.definition){location.concept.definition=[]}this.setDescription(shortDescriptionInputValue,"drol:short");this.setDescription(longDescriptionInputValue,"drol:long");this.xmlDoc=_writer.jxon.unbuild(location,null,"conceptItem");const conceptItem=this.xmlDoc.documentElement.outerHTML;switch(method){case"PUT":return this.context.api.router.updateConceptItem(id,conceptItem);case"POST":return this.context.api.router.createConceptItem(conceptItem)}}render($$){const el=$$("div").addClass("tag-edit-base");const formContainer=$$("form").addClass("concept-story__container clearfix").ref("formContainer").on("submit",e=>{e.preventDefault();if(this.refs["storyNameInput"].val()!==""){this.onClose("save")}});const hiddenSubmitButtonToEnableEnterSubmit=$$("input").attr({type:"submit",style:"display:none"});formContainer.append(hiddenSubmitButtonToEnableEnterSubmit);formContainer.append(this.renderNameInput($$));formContainer.append(this.renderShortDescription($$));formContainer.append(this.renderLongDescription($$));el.append(formContainer);if(this.props.exists){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-info").append(this.addLabel("ximstory-name_already_in_use")+": "+this.props.item.concept.name)))}if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("ximstory-error-save"))))}return el}renderNameInput($$){const nameInput=$$("input").attr({type:"text",id:"storyNameInput"}).addClass("form-control").val(this.props.item.concept.name).ref("storyNameInput");nameInput.on("change",function(){if(this.refs["storyNameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}}.bind(this));const formGroup=$$("fieldset").addClass("form-group col-xs-6").ref("formGroupName");formGroup.append($$("label").attr("for","storyNameInput").append(this.getLabel("ximstory-Name")));formGroup.append(nameInput);return formGroup}renderShortDescription($$){const shortDescription=this.context.api.concept.getDefinitionForType(this.props.item.concept.definition,"drol:short");let shortDescriptionValue="";if(shortDescription){shortDescriptionValue=shortDescription["keyValue"]}const shortDescInput=$$("input").attr({id:"storyShortDescInput"}).addClass("form-control").val(shortDescriptionValue).ref("storyShortDescInput");const formGroupShortDesc=$$("fieldset").addClass("form-group col-xs-6").ref("formGroupShortDesc");formGroupShortDesc.append($$("label").attr("for","storyShortDescInput").append(this.getLabel("ximstory-short_description")));formGroupShortDesc.append(shortDescInput);return formGroupShortDesc}renderLongDescription($$){const longDescription=this.context.api.concept.getDefinitionForType(this.props.item.concept.definition,"drol:long");let longDescriptionValue="";if(longDescription){longDescriptionValue=longDescription.keyValue}const longDescText=$$("textarea").attr({id:"storyLongDescText"}).addClass("form-control").val(longDescriptionValue).ref("storyLongDescText");const formGroupLongDesc=$$("fieldset").addClass("form-group col-xs-12").ref("formGroupLongDesc");formGroupLongDesc.append($$("label").attr("for","storyLongDescText").append(this.getLabel("ximstory-long_description")));formGroupLongDesc.append(longDescText);return formGroupLongDesc}onClose(status){if("cancel"===status){return true}if(this.props.newLocation){this.createLocation()}else{this.updateLocation()}return false}}exports.default=StoryEditComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={story:'<?xml version="1.0" encoding="UTF-8"?> '+'<conceptItem xmlns="http://iptc.org/std/nar/2006-10-01/" version="1" standard="NewsML-G2" standardversion="2.20" conformance="power"> '+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/> '+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/> '+"<itemMeta> "+'<itemClass qcode="cinat:concept"/> '+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/> '+'<itemMetaExtProperty type="imext:type" value="x-im/story"/> '+"</itemMeta> "+"<concept> "+'<conceptId uri="im://story/"/> '+'<type qcode="cpnat:abstract"/>'+"<name></name>"+'<definition role="drol:long"></definition> '+'<definition role="drol:short"></definition> '+"</concept> "+"</conceptItem>"}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimcategoryPackage=__webpack_require__(233);var _XimcategoryPackage2=_interopRequireDefault(_XimcategoryPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_XimcategoryPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _CategoryMainComponent=__webpack_require__(234);var _CategoryMainComponent2=_interopRequireDefault(_CategoryMainComponent);__webpack_require__(238);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.ximcategory",name:"ximcategory",configure:function configure(config){config.addComponentToSidebarWithTabId(this.id,"main",_CategoryMainComponent2.default);config.addLabel("Categories",{sv:"Kategorier"});config.addLabel("Name",{sv:"Namn"});config.addLabel("Short description",{sv:"Kort beskrivning"});config.addLabel("Long description",{sv:"Lång beskrivning"});config.addLabel("Search categories",{sv:"Sök kategorier"});config.addLabel("Remove from article",{sv:"Ta bort från artikel"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _CategoryListComponent=__webpack_require__(235);var _CategoryListComponent2=_interopRequireDefault(_CategoryListComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class CategoryMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="conceptcategory"}getInitialState(){return{existingItems:_writer.api.newsItem.getCategories(this.name)}}reload(){this.extendState({existingItems:_writer.api.newsItem.getCategories(this.name)})}render($$){const el=$$("div").ref("tagContainer").append($$("h2").append(this.getLabel("Categories")));const SearchComponent=this.context.componentRegistry.get("form-search");const searchComponent=$$(SearchComponent,{existingItems:this.state.existingItems,searchUrl:"/api/search/concepts/categories?q=",onSelect:this.addItem.bind(this),placeholderText:"Search categories",createAllowed:false}).ref("searchComponent");const list=$$(_CategoryListComponent2.default,{items:this.state.existingItems,removeItem:this.removeItem.bind(this),reload:this.reload.bind(this)}).ref("tagList");el.append(list);el.append(searchComponent);return el}removeItem(tag){try{_writer.api.newsItem.removeLinkByUUID(this.name,tag.uuid);this.reload()}catch(e){}}addItem(item){try{_writer.api.newsItem.addCategory(this.name,{uuid:item.uuid,title:item.name[0]});this.reload()}catch(e){}}closeFromDialog(){this.reload()}}exports.default=CategoryMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _CategoryItemComponent=__webpack_require__(236);var _CategoryItemComponent2=_interopRequireDefault(_CategoryItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class CategoryListComponent extends _substance.Component{constructor(...args){super(...args);this.name="conceptcategory"}render($$){var items=this.props.items;var tagList=$$("ul").addClass("tag-list");var tagEls=items.map(function(item){return $$(_CategoryItemComponent2.default,{item:item,removeItem:this.removeItem.bind(this),reload:this.props.reload.bind(this)}).ref("tag-"+item.uuid)},this);tagList.append(tagEls);return tagList}removeItem(tag){delete this.refs["tag-"+tag.uuid];this.props.removeItem(tag)}}exports.default=CategoryListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _CategoryInfoComponent=__webpack_require__(237);var _CategoryInfoComponent2=_interopRequireDefault(_CategoryInfoComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class CategoryItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="conceptcategory"}loadTag(item){_writer.api.router.getConceptItem(item.uuid,item.type).then(xml=>{const conceptXML=xml.querySelector("conceptItem"),conceptItemJSON=_writer.jxon.build(conceptXML);this.extendState({loadedItem:conceptItemJSON,isLoaded:true})}).catch(()=>{this.extendState({isLoaded:true,couldNotLoad:true})})}render($$){const tagItem=$$("li").addClass("tag-list__item").ref("tagItem"),displayNameEl=$$("span").addClass("tag-item__title tag-item__title--no-avatar").attr("title",this.getLabel("Category"));if(!this.state.isLoaded){this.loadTag(this.props.item);return tagItem.append(displayNameEl.addClass("tag-item__title--notexisting").append(this.props.item.title))}if(this.state.couldNotLoad){displayNameEl.addClass("tag-item__title--notexisting").append(this.props.item.title)}else{let displayName=this.props.item.title;displayNameEl.append(displayName).attr("title",displayName);this.updateTagItemName(displayNameEl,this.state.loadedItem);
displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual").on("click",()=>{this.showInfo(displayName)})}tagItem.append([displayNameEl,$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("Remove from article"))).on("click",()=>{this.removeTag(this.props.item)}),$$(_substance.FontAwesomeIcon,{icon:"fa-folder"}).addClass("tag-icon")]);return tagItem}updateTagItemName(tagItem,loadedTag){if(!loadedTag.concept||loadedTag.concept.definition){return}var definition=_writer.lodash.isArray(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(var i=0;i<definition.length;i++){var item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}showInfo(title){_writer.api.ui.showDialog(_CategoryInfoComponent2.default,{item:this.state.loadedItem,reload:this.closeFromDialog.bind(this)},{title:title,global:true,secondary:false})}closeFromDialog(){this.loadTag(this.props.item);this.props.reload()}removeTag(tag){this.props.removeItem(tag)}}exports.default=CategoryItemComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class ContentProfileInfoComponent extends _substance.Component{constructor(...args){super(...args)}saveContentProfile(url,method){var contentProfile=this.props.item;var shortDescriptionInputValue=this.refs.storyShortDescInput.val();var longDescriptionInputValue=this.refs.storyLongDescText.val();if(!contentProfile.concept.definition){contentProfile.concept.definition=[]}this.setDescription(shortDescriptionInputValue,"drol:short");this.setDescription(longDescriptionInputValue,"drol:long");this.xmlDoc=_writer.jxon.unbuild(contentProfile,null,"conceptItem");var conceptItem=this.xmlDoc.documentElement.outerHTML;switch(method){case"PUT":return this.context.api.router.put(url,conceptItem);case"POST":return this.context.api.router.post(url,conceptItem)}}render($$){var el=$$("div").addClass("tag-edit-base");var formContainer=$$("form").addClass("concept-story__container clearfix").ref("formContainer").on("submit",e=>{e.preventDefault();this.onClose("save")});formContainer.append($$("input").attr({type:"submit",style:"display:none"}));formContainer.append(this.renderNameInput($$));formContainer.append(this.renderShortDescription($$));formContainer.append(this.renderLongDescription($$));return el.append(formContainer)}renderNameInput($$){var nameInput=$$("input").attr({type:"text",id:"storyNameInput"}).addClass("form-control").val(this.props.item.concept.name).ref("nameInput").on("change",()=>{if(this.refs["nameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}});var formGroup=$$("fieldset").addClass("form-group col-xs-6").ref("formGroupName");formGroup.append($$("label").attr("for","nameInput").append(this.getLabel("Name")));return formGroup.append(nameInput)}renderShortDescription($$){var shortDescription=_writer.api.concept.getDefinitionForType(this.props.item.concept.definition,"drol:short");var shortDescriptionValue="";if(shortDescription){shortDescriptionValue=shortDescription["keyValue"]}var shortDescInput=$$("input").attr({id:"storyShortDescInput"}).addClass("form-control").val(shortDescriptionValue).ref("storyShortDescInput");var formGroupShortDesc=$$("fieldset").addClass("form-group col-xs-6").ref("formGroupShortDesc");formGroupShortDesc.append($$("label").attr("for","storyShortDescInput").append(this.getLabel("Short description")));formGroupShortDesc.append(shortDescInput);return formGroupShortDesc}renderLongDescription($$){var longDescription=_writer.api.concept.getDefinitionForType(this.props.item.concept.definition,"drol:long"),longDescriptionValue="";if(longDescription){longDescriptionValue=longDescription.keyValue}var longDescText=$$("textarea").attr({id:"storyLongDescText"}).addClass("form-control").val(longDescriptionValue).ref("storyLongDescText");var formGroupLongDesc=$$("fieldset").addClass("form-group col-xs-12").ref("formGroupLongDesc");formGroupLongDesc.append($$("label").attr("for","storyLongDescText").append(this.getLabel("Long description")));formGroupLongDesc.append(longDescText);return formGroupLongDesc}onClose(){return true}}exports.default=ContentProfileInfoComponent},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimchannelPackage=__webpack_require__(241);var _XimchannelPackage2=_interopRequireDefault(_XimchannelPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_XimchannelPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ConceptChannelMainComponent=__webpack_require__(242);var _ConceptChannelMainComponent2=_interopRequireDefault(_ConceptChannelMainComponent);__webpack_require__(245);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.ximchannel",name:"concept-channel",configure:function configure(config){config.addComponentToSidebarWithTabId(this.id,"main",_ConceptChannelMainComponent2.default);config.addLabel("Main channel",{sv:"Huvudkanal"});config.addLabel("Remove from article",{sv:"Ta bort från artikel"});config.addLabel("Search channels",{sv:"Sök kanaler"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _ChannelItemComponent=__webpack_require__(243);var _ChannelItemComponent2=_interopRequireDefault(_ChannelItemComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ConceptMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="concept-channel"}reload(){this.setState({existingChannel:_writer.api.newsItem.getLinkByTypeAndRel(this.name,"x-im/channel","channel")})}getInitialState(){return{existingChannel:_writer.api.newsItem.getLinkByTypeAndRel(this.name,"x-im/channel","channel")}}render($$){var el=$$("ul").ref("conceptChannelList").addClass("concept-channel tag-list").append($$("h2").append(this.getLabel("Main channel")));if(this.state.existingChannel[0]){el.append($$(_ChannelItemComponent2.default,{channel:this.state.existingChannel[0],removeChannel:this.removeChannel.bind(this)}).ref("channelItem"))}else{const SearchComponent=this.context.componentRegistry.get("form-search");el.append($$(SearchComponent,{existingItems:this.state.existingTags,searchUrl:"/api/search/concepts/channels?q=",onSelect:this.addChannel.bind(this),placeholderText:"Search channels"}).ref("searchComponent"))}return el}addChannel(item){_writer.api.newsItem.addLink(this.name,{"@rel":"channel","@title":item.name[0],"@type":item.imType[0],"@uuid":item.uuid});this.reload()}removeChannel(channel){_writer.api.newsItem.removeLinkByUUIDAndRel(this.name,channel["@uuid"],"channel");this.reload()}}exports.default=ConceptMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ConceptChannelInfoComponent=__webpack_require__(244);var _ConceptChannelInfoComponent2=_interopRequireDefault(_ConceptChannelInfoComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ChannelItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="concept-channel"}getInitialState(){return{isLoaded:false,loadedChannel:{}}}loadChannel(item){_writer.api.router.getConceptItem(item["@uuid"],item["@type"]).then(xml=>{const conceptXML=xml.querySelector("conceptItem"),conceptItemJSON=_writer.jxon.build(conceptXML);this.extendState({loadedChannel:conceptItemJSON,isLoaded:true})}).catch(()=>{this.extendState({isLoaded:true,couldNotLoad:true})})}render($$){var channel=this.props.channel;if(!channel){return $$("div")}var channelItem=$$("li").addClass("tag-list__item tag-item__title--no-avatar").addClass("clearfix").ref("channelItem"),displayTitle=$$("span").append(this.state.loadedItem?this.state.loadedItem.concept.name:channel["@title"]);displayTitle.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");var deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("Remove from article"))).on("click",()=>{this.props.removeChannel(channel)});if(!this.state.isLoaded){this.loadChannel(this.props.channel)}else{channelItem.append($$("span").addClass("concept-channel__name tag-item__title tag-item__title--no-avatar ").append(displayTitle).on("click",this.showInformation)).append(deleteButton).append($$(_substance.FontAwesomeIcon,{icon:"fa-random"}).addClass("tag-icon"))}if(this.state.loadedItem){this.updateTagItemName(displayTitle,this.state.loadedItem)}return channelItem}updateTagItemName(tagItem,loadedTag){if(!loadedTag.concept||!loadedTag.concept.definition){tagItem.attr("title",loadedTag.concept.name)}let definition=_writer.lodash.isArray(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(var i=0;i<definition.length;i++){let item=definition[i];if(item["@role"]!=="drol:short"){continue}if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}showInformation(){_writer.api.ui.showDialog(_ConceptChannelInfoComponent2.default,{channel:this.state.loadedChannel},{secondary:false,title:this.state.loadedChannel.concept.name,global:true})}}exports.default=ChannelItemComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var find=_writer.lodash.find;var isArray=_writer.lodash.isArray;class ConceptChannelInfoComponent extends _substance.Component{constructor(...args){super(...args)}getConceptDefinition(key){if(!this.props.channel.concept.definition){return null}var definition=this.props.channel.concept.definition;if(!isArray(definition)){definition=[definition]}return find(definition,function(item){return item["@role"]===key})}render($$){var el=$$("div").addClass("tag-edit-base");var shortDescription=this.getConceptDefinition("drol:short");if(shortDescription){el.append($$("p").append(shortDescription.keyValue))}var longDescription=this.getConceptDefinition("drol:long");if(longDescription){el.append($$("p").append(longDescription.keyValue))}return el}onClose(){}}exports.default=ConceptChannelInfoComponent},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(248);var _Ximsection=__webpack_require__(250);var _Ximsection2=_interopRequireDefault(_Ximsection);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_Ximsection2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimsectionComponent=__webpack_require__(251);var _XimsectionComponent2=_interopRequireDefault(_XimsectionComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.ximsection",name:"ximsection",configure:function configure(config){config.addLabel("ximsection-Sections",{en:"Section",sv:"Avdelning"});config.addLabel("ximsection-Choose_section",{en:"Choose Section",sv:"Välj Avdelning"});config.addComponentToSidebarWithTabId("ximsection","main",_XimsectionComponent2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimsectionComponent extends _substance.Component{constructor(...args){super(...args)}didMount(){_writer.api.events.on("ximsection",_writer.event.DOCUMENT_CHANGED,event=>{if(event.data&&event.data.type==="section"){this.synchronize(event)}});this.refs.dropdownButton.el.el.addEventListener("blur",()=>{setTimeout(()=>{this.hideMenu()},30)})}getInitialState(){let currentSection=_writer.api.newsItem.getSection(),sections=_writer.api.getConfigValue("se.infomaker.ximsection","sections");sections.forEach(section=>{section.active=this.isActive(currentSection,section)});return{showSectionMenu:false,sections:sections}}render($$){let el=$$("div").addClass("sc-ximsection");el.append([$$("h2").append(this.getLabel("ximsection-Sections")),this.renderSectionDropDown($$)]);return el}renderSectionDropDown($$){let activeSection=null,dropdownButton=null;this.state.sections.forEach(section=>{if(section.active){activeSection=section}});if(!activeSection){dropdownButton=$$("button").addClass("btn btn-secondary dropdown-toggle").attr({id:"w-sections-main-select",type:"button","data-toggle":"dropdown"}).append(this.getLabel("ximsection-Choose_section"))}else{dropdownButton=$$("button").addClass("btn btn-secondary dropdown-toggle").attr({id:"w-sections-main-select",type:"button","data-toggle":"dropdown"}).append([this.getSectionName(activeSection)])}dropdownButton.on("click",()=>{this.toggleMenu();return false});dropdownButton.ref("dropdownButton");let components=[dropdownButton];if(this.state.showSectionMenu){const sectionElements=this.state.sections.map(section=>{return $$("button").addClass("dropdown-item").append(this.getSectionName(section)).on("focus",()=>{this.selectSection(section)})});const sectionMenu=$$("div").addClass("dropdown-menu").append(sectionElements);components=[...components,sectionMenu]}return $$("div").attr({id:"w-sections-main"}).addClass("dropdown").attr({"aria-labelledby":"w-sections-main-select"}).append(components)}getSectionName(section){let sectionName=section.name;if(section.product){let qcodePrefixIndex=section.product.lastIndexOf(":");let productName=section.product.substr(qcodePrefixIndex+1);sectionName=productName+" / "+sectionName}return sectionName}selectSection(section){_writer.api.newsItem.updateSection("ximsection",section);this.synchronize()}toggleMenu(){this.extendState({showSectionMenu:!this.state.showSectionMenu})}hideMenu(){this.extendState({showSectionMenu:false})}synchronize(){let currentSection=_writer.api.newsItem.getSection(),sections=_writer.api.getConfigValue("se.infomaker.ximsection","sections");sections.forEach(section=>{section.active=this.isActive(currentSection,section)});this.extendState({showSectionMenu:false,sections:this.state.sections})}isActive(currentSection,configSection){if(currentSection&&currentSection.qcode===configSection.qcode){const pubconstraint=currentSection.pubconstraint?currentSection.pubconstraint:"";const product=configSection.product?configSection.product:"";return pubconstraint===product}return false}}exports.default=XimsectionComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(253);var _DropheadPackage=__webpack_require__(255);var _DropheadPackage2=_interopRequireDefault(_DropheadPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_DropheadPackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _DropheadComponent=__webpack_require__(256);var _DropheadComponent2=_interopRequireDefault(_DropheadComponent);var _DropheadConverter=__webpack_require__(257);var _DropheadConverter2=_interopRequireDefault(_DropheadConverter);var _DropheadNode=__webpack_require__(258);var _DropheadNode2=_interopRequireDefault(_DropheadNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"drophead",id:"se.infomaker.drophead",configure:function configure(config){_DropheadNode2.default.type=this.name;_DropheadConverter2.default.type=_DropheadNode2.default.type;_DropheadConverter2.default.element=_DropheadNode2.default.type;config.addNode(_DropheadNode2.default);config.addComponent(_DropheadNode2.default.type,_DropheadComponent2.default);config.addConverter("newsml",_DropheadConverter2.default);config.addTextType({name:this.name,data:{type:_DropheadNode2.default.type}});config.addLabel("drophead",{en:"Drophead",sv:"Nedryckare"});config.addLabel("drophead.content",{en:"Drophead",sv:"Nedryckare"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class DropheadComponent extends Component{render($$){return $$("div").addClass("sc-drophead").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=DropheadComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="drophead"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","drophead").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class DropheadNode extends TextBlock{}DropheadNode.define({id:{type:"string"}});exports.default=DropheadNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(260);var _PagedatelinePackage=__webpack_require__(262);var _PagedatelinePackage2=_interopRequireDefault(_PagedatelinePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PagedatelinePackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PagedatelineComponent=__webpack_require__(263);var _PagedatelineComponent2=_interopRequireDefault(_PagedatelineComponent);var _PagedatelineConverter=__webpack_require__(264);var _PagedatelineConverter2=_interopRequireDefault(_PagedatelineConverter);var _PagedatelineNode=__webpack_require__(265);var _PagedatelineNode2=_interopRequireDefault(_PagedatelineNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"pagedateline",id:"se.infomaker.pagedateline",configure:function configure(config){_PagedatelineNode2.default.type=this.name;_PagedatelineConverter2.default.type=_PagedatelineNode2.default.type;_PagedatelineConverter2.default.element=_PagedatelineNode2.default.type;config.addNode(_PagedatelineNode2.default);config.addComponent(_PagedatelineNode2.default.type,_PagedatelineComponent2.default);config.addConverter("newsml",_PagedatelineConverter2.default);config.addTextType({name:this.name,data:{type:_PagedatelineNode2.default.type}});config.addLabel("pagedateline",{en:"Pagedateline",sv:"Vinjett"});config.addLabel("pagedateline.content",{en:"Pagedateline",sv:"Vinjett"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class PagedatelineComponent extends Component{render($$){return $$("div").addClass("sc-pagedateline").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=PagedatelineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="pagedateline"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","pagedateline").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class PagedatelineNode extends TextBlock{}PagedatelineNode.define({id:{type:"string"}});exports.default=PagedatelineNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(267);var _DatelinePackage=__webpack_require__(269);var _DatelinePackage2=_interopRequireDefault(_DatelinePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_DatelinePackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _DatelineComponent=__webpack_require__(270);var _DatelineComponent2=_interopRequireDefault(_DatelineComponent);var _DatelineConverter=__webpack_require__(271);var _DatelineConverter2=_interopRequireDefault(_DatelineConverter);var _DatelineNode=__webpack_require__(272);var _DatelineNode2=_interopRequireDefault(_DatelineNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"dateline",id:"se.infomaker.dateline",configure:function configure(config){_DatelineNode2.default.type=this.name;_DatelineConverter2.default.type=_DatelineNode2.default.type;_DatelineConverter2.default.element=_DatelineNode2.default.type;config.addNode(_DatelineNode2.default);config.addComponent(_DatelineNode2.default.type,_DatelineComponent2.default);config.addConverter("newsml",_DatelineConverter2.default);config.addTextType({name:this.name,data:{type:_DatelineNode2.default.type}});config.addLabel("dateline",{en:"Dateline",sv:"Ortdatering"});config.addLabel("dateline.content",{en:"Dateline",sv:"Ortdatering"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class DatelineComponent extends Component{render($$){return $$("div").addClass("sc-dateline").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=DatelineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="dateline"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","dateline").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class DatelineNode extends TextBlock{}DatelineNode.define({id:{type:"string"}});exports.default=DatelineNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(274);var _PreleadinPackage=__webpack_require__(276);var _PreleadinPackage2=_interopRequireDefault(_PreleadinPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PreleadinPackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PreleadinComponent=__webpack_require__(277);var _PreleadinComponent2=_interopRequireDefault(_PreleadinComponent);var _PreleadinConverter=__webpack_require__(278);var _PreleadinConverter2=_interopRequireDefault(_PreleadinConverter);var _PreleadinNode=__webpack_require__(279);var _PreleadinNode2=_interopRequireDefault(_PreleadinNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"preleadin",id:"se.infomaker.preleadin",configure:function configure(config){_PreleadinNode2.default.type=this.name;_PreleadinConverter2.default.type=_PreleadinNode2.default.type;_PreleadinConverter2.default.element=_PreleadinNode2.default.type;config.addNode(_PreleadinNode2.default);config.addComponent(_PreleadinNode2.default.type,_PreleadinComponent2.default);config.addConverter("newsml",_PreleadinConverter2.default);config.addTextType({name:this.name,data:{type:_PreleadinNode2.default.type}});config.addLabel("preleadin",{en:"Preleadin",sv:"Överingress"});config.addLabel("preleadin.content",{en:"Preleadin",sv:"Överingress"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class PreleadinComponent extends Component{render($$){return $$("div").addClass("sc-preleadin").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=PreleadinComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="preleadin"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","preleadin").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class PreleadinNode extends TextBlock{}PreleadinNode.define({id:{type:"string"}});exports.default=PreleadinNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(281);var _MadmansrowPackage=__webpack_require__(283);var _MadmansrowPackage2=_interopRequireDefault(_MadmansrowPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_MadmansrowPackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _MadmansrowComponent=__webpack_require__(284);var _MadmansrowComponent2=_interopRequireDefault(_MadmansrowComponent);var _MadmansrowConverter=__webpack_require__(285);var _MadmansrowConverter2=_interopRequireDefault(_MadmansrowConverter);var _MadmansrowNode=__webpack_require__(286);var _MadmansrowNode2=_interopRequireDefault(_MadmansrowNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"madmansrow",id:"se.infomaker.madmansrow",configure:function configure(config){_MadmansrowNode2.default.type=this.name;_MadmansrowConverter2.default.type=_MadmansrowNode2.default.type;_MadmansrowConverter2.default.element=_MadmansrowNode2.default.type;config.addNode(_MadmansrowNode2.default);config.addComponent(_MadmansrowNode2.default.type,_MadmansrowComponent2.default);config.addConverter("newsml",_MadmansrowConverter2.default);config.addTextType({name:this.name,data:{type:_MadmansrowNode2.default.type}});config.addLabel("madmansrow",{en:"Madmansrow",sv:"Dårrad"});config.addLabel("madmansrow.content",{en:"Madmansrow",sv:"Dårrad"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class MadmansrowComponent extends Component{render($$){return $$("div").addClass("sc-madmansrow").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=MadmansrowComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="madmansrow"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","madmansrow").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class MadmansrowNode extends TextBlock{}MadmansrowNode.define({id:{type:"string"}});exports.default=MadmansrowNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _Blockquote=__webpack_require__(288);var _Blockquote2=_interopRequireDefault(_Blockquote);var _BlockquoteComponent=__webpack_require__(291);var _BlockquoteComponent2=_interopRequireDefault(_BlockquoteComponent);var _BlockquoteConverter=__webpack_require__(292);var _BlockquoteConverter2=_interopRequireDefault(_BlockquoteConverter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const blockquotePackage={id:"se.infomaker.blockquote",name:"blockquote",configure:function configure(config){config.addNode(_Blockquote2.default);config.addComponent(_Blockquote2.default.type,_BlockquoteComponent2.default);config.addConverter("newsml",_BlockquoteConverter2.default);config.addTextType({name:"blockquote",data:{type:"blockquote"}});config.addLabel("blockquote",{en:"Blockquote",de:"Blockequote",sv:"Citat"});config.addLabel("blockquote.content",{en:"Blockequote",de:"Blockequote",sv:"Citat"})}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(blockquotePackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(289);var _substance=__webpack_require__(14);class Blockquote extends _substance.TextBlock{}Blockquote.type="blockquote";exports.default=Blockquote},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class BlockquoteComponent extends _substance.Component{render($$){return $$("div").addClass("sc-paragraph sc-blockquote").attr("data-id",this.props.node.id).append($$(_substance.TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=BlockquoteComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"blockquote",tagName:"element",matchElement:function matchElement(el){return el.is('element[type="blockquote"]')},import:function _import(el,node,converter){var state=converter.state;var oldValue=state.trimWhitespaces;state.trimWhitespaces=true;node.content=converter.annotatedText(el,[node.id,"content"]);
state.trimWhitespaces=oldValue},export:function _export(node,el,converter){el.attr("type","blockquote").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _substance=__webpack_require__(14);__webpack_require__(294);var _HtmlembedNode=__webpack_require__(296);var _HtmlembedNode2=_interopRequireDefault(_HtmlembedNode);var _HtmlembedConverter=__webpack_require__(297);var _HtmlembedConverter2=_interopRequireDefault(_HtmlembedConverter);var _HtmlembedComponent=__webpack_require__(298);var _HtmlembedComponent2=_interopRequireDefault(_HtmlembedComponent);var _HtmlembedTool=__webpack_require__(301);var _HtmlembedTool2=_interopRequireDefault(_HtmlembedTool);var _HtmlembedCommand=__webpack_require__(302);var _HtmlembedCommand2=_interopRequireDefault(_HtmlembedCommand);var _HtmlembedEditCommand=__webpack_require__(303);var _HtmlembedEditCommand2=_interopRequireDefault(_HtmlembedEditCommand);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const htmlEmbedPackage={id:"se.infomaker.htmlembed",name:"htmlembed",configure:config=>{config.addContentMenuTopTool(htmlEmbedPackage.name,_HtmlembedTool2.default);config.addCommand(htmlEmbedPackage.name,_HtmlembedCommand2.default);config.addCommand("htmlembededit",_HtmlembedEditCommand2.default);config.addNode(_HtmlembedNode2.default);config.addComponent(htmlEmbedPackage.name,_HtmlembedComponent2.default);config.addConverter("newsml",_HtmlembedConverter2.default);config.addLabel("Edit embed code",{sv:"Redigera embedkod"});if(_substance.platform.isMac){config.addKeyboardShortcut("cmd+alt+h",{command:"htmlembed"})}else{config.addKeyboardShortcut("ctrl+alt+h",{command:"htmlembed"})}}};exports.default=(()=>{(0,_writer.registerPlugin)(htmlEmbedPackage)})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class HtmlembedNode extends _substance.BlockNode{}HtmlembedNode.define({type:"htmlembed",id:{type:"string"},dataType:"string",format:"string",text:{type:"string",optional:true}});exports.default=HtmlembedNode},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const HtmlembedConverter={type:"htmlembed",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/htmlembed"},import:function _import(el,node){if(el.attr("uuid")){node.uuid=el.attr("uuid")}node.id=el.attr("id");node.dataType=el.attr("type");const dataEl=el.find("data");dataEl.children.forEach(function(child){if(child.tagName==="text"){node.text=child.text()}if(child.tagName==="format"){node.format=child.text()}})},export:function _export(node,el,converter){const $$=converter.$$;if(node.uuid){el.attr("uuid",node.uuid)}el.attr("type",node.dataType);el.attr("id",node.id);el.removeAttr("data-id");const data=$$("data");const text=$$("text");const html="<![CDATA["+node.text.replace("]]>","]]&gt;")+"]]>";text.innerHTML=html;const format=$$("format");format.append(converter.annotatedText([node.id,"format"]));data.append([text,format]);el.append(data)}};exports.default=HtmlembedConverter},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _openEmbedDialog=__webpack_require__(299);var _openEmbedDialog2=_interopRequireDefault(_openEmbedDialog);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class HtmlembedComponent extends _substance.Component{render($$){const el=$$("div").addClass("im-blocknode__container im-htmlembed");el.append(this.renderHeader($$));el.append(this.renderContent($$));return el}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-code"}),$$("strong").append(this.getLabel("HTML Embed")).attr("contenteditable",false),$$("span").addClass("edit-button").append($$(_substance.FontAwesomeIcon,{icon:"fa-pencil-square-o"})).on("click",this.editEmbedhtml).attr("title",this.getLabel("Edit embed code"))]).addClass("header").attr("contenteditable",false)}renderContent($$){const content=$$("div").ref("embedContent").addClass("im-blocknode__content");const textarea=$$(_substance.TextPropertyComponent,{tagName:"div",path:[this.props.node.id,"text"]});textarea.ref("htmlarea");textarea.append(this.props.node.text);textarea.on("dblclick",()=>{this.editEmbedhtml()});content.append(textarea);return content}editEmbedhtml(){const props={text:this.props.node.text,update:this.updateHTMLOnNode.bind(this)};(0,_openEmbedDialog2.default)(props)}updateHTMLOnNode(html){_writer.api.editorSession.transaction(tx=>{tx.set([this.props.node.id,"text"],html)});this.rerender()}}exports.default=HtmlembedComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _HtmlembedEditTool=__webpack_require__(300);var _HtmlembedEditTool2=_interopRequireDefault(_HtmlembedEditTool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(props=>{_writer.api.ui.showDialog(_HtmlembedEditTool2.default,props,{title:"Embed HTML",cssClass:"im-htmlembed-modal"})})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class HtmlembedEditTool extends _substance.Tool{didMount(){this.resize();const textarea=this.refs.embedcode;textarea.el.el.focus();textarea.el.on("keydown",()=>{this.resize()});textarea.el.el.addEventListener("paste",()=>{this.resize()});textarea.el.el.addEventListener("cut",()=>{this.resize()})}insertEmbed(){_writer.api.editorSession.executeCommand("htmlembededit",{text:this.refs.embedcode.val()})}resize(){const htmlTexarea=this.refs.embedcode.el.el;setTimeout(()=>{htmlTexarea.style.height="auto";htmlTexarea.style.height=htmlTexarea.scrollHeight+20+"px"},100)}render($$){const el=$$("div").addClass("embed-dialog");const embed=$$("textarea").addClass("textarea").attr("spellcheck",false).ref("embedcode");if(this.props.text){embed.append(this.props.text)}el.append(embed);return el}onClose(status){if(status==="cancel"){}else if(status==="save"){if(typeof this.props.text!=="undefined"){this.props.update(this.refs.embedcode.val())}else{this.insertEmbed()}return true}}}exports.default=HtmlembedEditTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class HtmlembedTool extends _substance.Tool{insertEmbedhtml(){_writer.api.editorSession.executeCommand("htmlembed",{})}render($$){const el=$$("button").attr("title",this.getLabel("Insert HTML embed")).addClass("se-tool").append($$("i").addClass("fa fa-code")).on("click",this.insertEmbedhtml);return el}}exports.default=HtmlembedTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _openEmbedDialog=__webpack_require__(299);var _openEmbedDialog2=_interopRequireDefault(_openEmbedDialog);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class HtmlembedCommand extends _writer.WriterCommand{execute(){(0,_openEmbedDialog2.default)({})}}exports.default=HtmlembedCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class HtmlembedEditCommand extends _writer.WriterCommand{execute(params){const data={type:"htmlembed",dataType:"x-im/htmlembed",text:params.text,format:"html"};return _writer.api.document.insertBlockNode(data.type,data)}}exports.default=HtmlembedEditCommand}]);(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)})([function(module,exports,__webpack_require__){"use strict";var _index=__webpack_require__(121);var _index2=_interopRequireDefault(_index);var _Preamble=__webpack_require__(102);var _Preamble2=_interopRequireDefault(_Preamble);var _index3=__webpack_require__(1);var _index4=_interopRequireDefault(_index3);var _index5=__webpack_require__(9);var _index6=_interopRequireDefault(_index5);var _index7=__webpack_require__(126);var _index8=_interopRequireDefault(_index7);var _index9=__webpack_require__(23);var _index10=_interopRequireDefault(_index9);var _index11=__webpack_require__(34);var _index12=_interopRequireDefault(_index11);var _index13=__webpack_require__(131);var _index14=_interopRequireDefault(_index13);var _index15=__webpack_require__(153);var _index16=_interopRequireDefault(_index15);var _Madmansrow=__webpack_require__(280);var _Madmansrow2=_interopRequireDefault(_Madmansrow);var _Drophead=__webpack_require__(252);var _Drophead2=_interopRequireDefault(_Drophead);var _Pagedateline=__webpack_require__(259);var _Pagedateline2=_interopRequireDefault(_Pagedateline);var _Dateline=__webpack_require__(266);var _Dateline2=_interopRequireDefault(_Dateline);var _Preleadin=__webpack_require__(273);var _Preleadin2=_interopRequireDefault(_Preleadin);var _index17=__webpack_require__(56);var _index18=_interopRequireDefault(_index17);var _index19=__webpack_require__(164);var _index20=_interopRequireDefault(_index19);var _index21=__webpack_require__(67);var _index22=_interopRequireDefault(_index21);var _index23=__webpack_require__(177);var _index24=_interopRequireDefault(_index23);var _index25=__webpack_require__(182);var _index26=_interopRequireDefault(_index25);var _DefaultvalidationPackage=__webpack_require__(214);var _DefaultvalidationPackage2=_interopRequireDefault(_DefaultvalidationPackage);var _HeaderEditorPackage=__webpack_require__(75);var _HeaderEditorPackage2=_interopRequireDefault(_HeaderEditorPackage);var _seInfomakerMitm=__webpack_require__(187);var _seInfomakerMitm2=_interopRequireDefault(_seInfomakerMitm);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(()=>{(0,_index14.default)("position");(0,_index14.default)("polygon");(0,_index2.default)();(0,_Preleadin2.default)();(0,_Preamble2.default)();(0,_Dateline2.default)();(0,_Pagedateline2.default)();(0,_Drophead2.default)();(0,_Madmansrow2.default)();(0,_index12.default)();(0,_index6.default)();(0,_index10.default)();(0,_index4.default)();(0,_index8.default)();(0,_HeaderEditorPackage2.default)();(0,_index16.default)();(0,_index18.default)();(0,_index20.default)();(0,_index22.default)();(0,_DefaultvalidationPackage2.default)();(0,_index24.default)();(0,_index26.default)();(0,_seInfomakerMitm2.default)()})()},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowPackage=__webpack_require__(2);var _PublishFlowPackage2=_interopRequireDefault(_PublishFlowPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PublishFlowPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowComponent=__webpack_require__(3);var _PublishFlowComponent2=_interopRequireDefault(_PublishFlowComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"publishflow",id:"se.infomaker.publishflow",index:100,configure:function configure(config){config.addPopover(this.id+"_1",{icon:"fa-ellipsis-h",button:"Save",align:"right"},_PublishFlowComponent2.default);config.addLabel("Save",{sv:"Spara"});config.addLabel("Save *",{sv:"Spara *"});config.addLabel("Cancel",{sv:"Avbryt"});config.addLabel("Publish article?",{sv:"Publicera artikeln?"});config.addLabel("This article is currently an unpublished draft",{sv:"Den här artikeln är ett ej publicerat utkast"});config.addLabel("Article is currently pending approval",{sv:"Artikeln väntar på godkännande"});config.addLabel("Scheduled",{sv:"Schemalagd"});config.addLabel("Article is scheduled to be published",{sv:"Artiklen är schemalagd för publicering"});config.addLabel("From",{sv:"Från"});config.addLabel("To",{sv:"Till"});config.addLabel("Republish article?",{sv:"Ompublicera artikeln?"});config.addLabel("Article was published",{sv:"Artikeln publicerades"});config.addLabel("Publish article again?",{sv:"Publicera artikeln igen?"});config.addLabel("Article has been canceled and is no longer published",{sv:"Artikeln har blivit avpublicerad och är ej längre publicerad"});config.addLabel("Unknown state",{sv:"Okänd status"});config.addLabel("This article has an unknown, unsupported, status",{sv:"Artikeln har en okänd eller felaktig status"});config.addLabel("Save as draft",{sv:"Spara som utkast"});config.addLabel("Ready for approval",{sv:"Klar för godkännande"});config.addLabel("Schedule for publish",{sv:"Schemalägg publicering"});config.addLabel("Republish article",{sv:"Ompublicera artikeln"});config.addLabel("Publish article",{sv:"Publicera artikeln"});config.addLabel("Unpublish article",{sv:"Avpublicera artikeln"});config.addLabel("imext:draft",{en:"Draft",sv:"Utkast"});config.addLabel("imext:done",{en:"Ready for approval",sv:"Klar för godkännande"});config.addLabel("stat:withheld",{en:"Scheduled for publication",sv:"Schemalagd för publicering"});config.addLabel("stat:usable",{en:"Published",sv:"Publicerad"});config.addLabel("stat:canceled",{en:"Unpublished",sv:"Avpublicerad"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowManager=__webpack_require__(4);var _PublishFlowManager2=_interopRequireDefault(_PublishFlowManager);__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{Component}=substance;const{api,moment,event}=writer;const pluginId="se.infomaker.publishflow";class PublishFlowComponent extends Component{constructor(...args){super(...args);api.events.on(pluginId,event.DOCUMENT_CHANGED,()=>{this.props.popover.setButtonText(this.getLabel("Save *"))});api.events.on(pluginId,event.DOCUMENT_SAVED,()=>{this._onDocumentSaved()});api.events.on(pluginId,event.DOCUMENT_SAVE_FAILED,()=>{this._onDocumentSaveFailed()});api.events.on(pluginId,event.USERACTION_CANCEL_SAVE,()=>{this._onDocumentSaveFailed()});api.events.on(pluginId,event.USERACTION_SAVE,()=>{this.defaultAction()})}dispose(){api.events.off(pluginId,"document:changed");api.events.off(pluginId,"document:saved")}getInitialState(){let status=api.newsItem.getPubStatus();this.publishFlowMgr=new _PublishFlowManager2.default(pluginId);return{status:status,pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop(),allowed:this.publishFlowMgr.getAllowedActions(status.qcode)}}didMount(){this.props.popover.setButtonText(this.getLabel("Save"));this._updateStatus();if(!api.browser.isSupported()){this.props.popover.disable()}}render($$){var el=$$("div").addClass("sc-np-publishflow").append(this.renderBody($$));return el}renderBody($$){let el=$$("div").addClass("sc-np-publish-body"),actions=this.renderAllowedActions($$);switch(this.state.status.qcode){case"imext:draft":el.append([$$("h2").append(this.getLabel("Publish article?")),$$("p").append(this.getLabel("This article is currently an unpublished draft"))]);break;case"imext:done":el.append([$$("h2").append(this.getLabel("Publish article?")),$$("p").append(this.getLabel("Article is currently pending approval"))]);break;case"stat:withheld":el.append([$$("h2").append(this.getLabel("Scheduled")),$$("p").append(this.getLabel("Article is scheduled to be published")+" "+moment(this.state.pubStart.value).fromNow())]);var specEl=$$("p").addClass("dates").append([$$("span").append(this.getLabel("From")+": "),$$("strong").append(moment(this.state.pubStart.value).format("YYYY-MM-DD HH:mm"))]);if(this.state.pubStop){let toObj=moment(this.state.pubStop.value);if(toObj.isValid()){specEl.append([$$("br"),$$("span").append(this.getLabel("To")+": "),$$("strong").append(moment(this.state.pubStop.value).format("YYYY-MM-DD HH:mm"))])}}el.append(specEl);break;case"stat:usable":el.append([$$("h2").append(this.getLabel("Republish article?")),$$("p").append(this.getLabel("Article was published")+" "+moment(this.state.pubStart.value).fromNow())]);break;case"stat:canceled":el.append([$$("h2").append(this.getLabel("Publish article again?")),$$("p").append(this.getLabel("Article has been canceled and is no longer published"))]);break;default:el.append([$$("h2").append(this.getLabel("Unknown state")),$$("p").append(this.getLabel("This article has an unknown, unsupported, status"))]);break}el.append(actions);el.append($$("div").css({"text-align":"right"}).append($$("button").addClass("sc-np-btn btn-secondary").append(this.getLabel("Cancel")).on("click",()=>{this.props.popover.close()})));return el}renderAllowedActions($$){let actionsEl=$$("div").addClass("sc-np-publish-actions");this.publishFlowMgr.getAllowedActions(this.state.status.qcode).forEach(action=>{switch(action){case"imext:draft":actionsEl.append(this.renderActionDraft($$));break;case"imext:done":actionsEl.append(this.renderActionDone($$));break;case"stat:withheld":actionsEl.append(this.renderActionWithheld($$));break;case"stat:usable":actionsEl.append(this.renderActionUsable($$));break;case"stat:canceled":actionsEl.append(this.renderActionCanceled($$));break}});return actionsEl}renderActionDraft($$){return $$("a").append([$$("i").addClass("fa fa-pencil"),$$("span").append(this.getLabel("Save as draft"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToDraft()})})}renderActionDone($$){return $$("a").append([$$("i").addClass("fa fa-check-circle-o"),$$("span").append(this.getLabel("Ready for approval"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToDone()})})}renderActionWithheld($$){let el=$$("div").addClass("sc-np-publish-action-section").ref("pfc-withheld");el.append($$("a").append([$$("i").addClass("fa fa-clock-o"),$$("span").append(this.getLabel("Schedule for publish"))]).addClass("more").on("click",()=>{if(this.refs["pfc-withheld"].hasClass("active")){this.refs["pfc-withheld"].removeClass("active")}else{this.refs["pfc-withheld"].addClass("active")}}));let fromVal="",toVal="";if(this.state.pubStart){fromVal=moment(this.state.pubStart.value).format("YYYY-MM-DDTHH:mm")}if(this.state.pubStop){toVal=moment(this.state.pubStop.value).format("YYYY-MM-DDTHH:mm")}el.append($$("div").addClass("sc-np-publish-action-section-content sc-np-date-time").append([$$("label").attr("for","pfc-lbl-withheld-from").append(this.getLabel("From")),$$("input").attr({id:"pfc-lbl-withheld-from",type:"datetime-local",required:true}).addClass("form-control").ref("pfc-lbl-withheld-from").val(fromVal),$$("label").attr("for","pfc-lbl-withheld-to").append(this.getLabel("To")),$$("input").attr({id:"pfc-lbl-withheld-to",type:"datetime-local"}).addClass("form-control").ref("pfc-lbl-withheld-to").val(toVal),$$("div").addClass("sc-np-publish-action-section-content-actions").append($$("button").addClass("sc-np-btn btn-secondary").append(this.getLabel("Save"))).on("click",()=>{try{var fromVal=this.refs["pfc-lbl-withheld-from"].val(),toVal=this.refs["pfc-lbl-withheld-to"].val();this._save(()=>{this.publishFlowMgr.setToWithheld(fromVal,toVal)})}catch(ex){this.refs["pfc-lbl-withheld-from"].addClass("imc-flash");window.setTimeout(()=>{this.refs["pfc-lbl-withheld-from"].removeClass("imc-flash")},500);return false}})]));return el}renderActionUsable($$){let el=$$("a");if(this.state.status.qcode==="stat:usable"){el.append([$$("i").addClass("fa fa-retweet"),$$("span").append(this.getLabel("Republish article"))])}else{el.append([$$("i").addClass("fa fa-send"),$$("span").append(this.getLabel("Publish article"))])}el.on("click",()=>{this._save(()=>{this.publishFlowMgr.setToUsable()})});return el}renderActionCanceled($$){return $$("a").append([$$("span").append($$("i").addClass("fa fa-ban"),this.getLabel("Unpublish article"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToCanceled()})})}defaultAction(){api.newsItem.save();this.props.popover.disable();this.props.popover.setIcon("fa-refresh fa-spin fa-fw")}_save(beforeSaveFunc){this._saveState();if(beforeSaveFunc){beforeSaveFunc()}this.defaultAction()}_saveState(){this.extendState({previousState:{pubStatus:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop()}})}_onDocumentSaveFailed(){this.props.popover.setIcon("fa-ellipsis-h");this.props.popover.enable();if(!this.state.previousState){this._updateStatus(false);return}api.newsItem.setPubStatus(pluginId,this.state.previousState.pubStatus);if(this.state.previousState.pubStart){api.newsItem.setPubStart(pluginId,this.state.previousState.pubStart)}else{api.newsItem.removePubStart(pluginId)}if(this.state.previousState.pubStop){api.newsItem.setPubStop(pluginId,this.state.previousState.pubStop)}else{api.newsItem.removePubStop(pluginId)}this.extendState({status:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop(),previousState:null});this._updateStatus(false)}_onDocumentSaved(){this.props.popover.setIcon("fa-ellipsis-h");this.props.popover.enable();this.extendState({status:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop()});this._updateStatus(true)}_updateStatus(updateButtonSavedLabel){if(updateButtonSavedLabel){this.props.popover.setButtonText(this.getLabel("Save"))}if(this.state.status.qcode==="stat:usable"){this.props.popover.setStatusText(this.getLabel(this.state.status.qcode)+" "+moment(this.state.pubStart.value).fromNow())}else if(this.state.status.qcode==="stat:withheld"){this.props.popover.setStatusText(this.getLabel(this.state.status.qcode)+" "+moment(this.state.pubStart.value).fromNow())}else{this.props.popover.setStatusText(this.getLabel(this.state.status.qcode))}}}exports.default=PublishFlowComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{api,moment}=writer;class PublishFlowConfiguration{constructor(pluginId){this.pluginId=pluginId;this.status={"imext:draft":{allowed:["imext:done","stat:usable","stat:withheld"]},"imext:done":{allowed:["stat:usable","imext:draft","stat:withheld"]},"stat:withheld":{allowed:["stat:withheld","stat:usable","stat:canceled","imext:draft"]},"stat:usable":{allowed:["stat:usable","stat:canceled"]},"stat:canceled":{allowed:["imext:draft","imext:done","stat:usable","stat:withheld"]}}}getAllowedActions(status){if(this.status[status]){return this.status[status].allowed}return[]}setToDraft(){this.setStatus("imext:draft",null,null)}setToDone(){this.setStatus("imext:done",null,null)}setToWithheld(from,to){let fromObj=moment(from),toObj=moment(to);if(!fromObj.isValid()){throw new Error("Invalid from date and time")}this.setStatus("stat:withheld",{value:fromObj.format("YYYY-MM-DDTHH:mm:ssZ")},!toObj.isValid()?null:{value:toObj.format("YYYY-MM-DDTHH:mm:ssZ")})}setToUsable(){this.setStatus("stat:usable",{value:moment().format("YYYY-MM-DDTHH:mm:ssZ")},null)}setToCanceled(){this.setStatus("stat:canceled",null,null)}setStatus(qcode,pubStart,pubStop){if(qcode){api.newsItem.setPubStatus(this.pluginId,{qcode:qcode})}if(pubStart===null){api.newsItem.removePubStart(this.pluginId)}else if(typeof pubStart!=="undefined"){api.newsItem.setPubStart(this.pluginId,pubStart)}if(pubStop===null){api.newsItem.removePubStop(this.pluginId)}else if(typeof pubStop!=="undefined"){api.newsItem.setPubStop(this.pluginId,pubStop)}}}exports.default=PublishFlowConfiguration},function(module,exports){},,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(10);var _SocialembedPackage=__webpack_require__(12);var _SocialembedPackage2=_interopRequireDefault(_SocialembedPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_SocialembedPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _SocialembedComponent=__webpack_require__(13);var _SocialembedComponent2=_interopRequireDefault(_SocialembedComponent);var _SocialembedCommand=__webpack_require__(15);var _SocialembedCommand2=_interopRequireDefault(_SocialembedCommand);var _SocialembedConverter=__webpack_require__(18);var _SocialembedConverter2=_interopRequireDefault(_SocialembedConverter);var _SocialembedMacro=__webpack_require__(19);var _SocialembedMacro2=_interopRequireDefault(_SocialembedMacro);var _SocialembedNode=__webpack_require__(20);var _SocialembedNode2=_interopRequireDefault(_SocialembedNode);var _DropSocialEmbed=__webpack_require__(22);var _DropSocialEmbed2=_interopRequireDefault(_DropSocialEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"socialembed",id:"se.infomaker.socialembed",configure:function configure(config){config.addNode(_SocialembedNode2.default);config.addCommand("socialembed",_SocialembedCommand2.default);config.addComponent(_SocialembedNode2.default.type,_SocialembedComponent2.default);config.addConverter("newsml",_SocialembedConverter2.default);config.addMacro(_SocialembedMacro2.default);config.addDragAndDrop(_DropSocialEmbed2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class SocialembedComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this.rerender,this,{path:[this.props.node.id]});this.context.api.document.triggerFetchResourceNode(this.props.node,{history:false})}dispose(){this.context.editorSession.off(this)}render($$){const node=this.props.node;const el=$$("div").addClass("im-blocknode__container").addClass(node.socialChannel).attr("contenteditable",false);if(node.hasPayload()){const innerEl=$$("div").ref("embed-container");const headerEl=this.renderHeader($$,node);const contentEl=this.renderContent($$,node);innerEl.append([headerEl,contentEl]);el.append(innerEl)}else if(node.errorMessage){el.append($$("div").addClass("se-error").append(node.errorMessage))}else{el.append($$(_substance.FontAwesomeIcon,{icon:"fa-spin fa-refresh"}))}return el}renderContent($$,node){return $$("div").ref("embedContent").addClass("im-blocknode__content full-width").html(node.html)}renderHeader($$,node){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:node.socialChannelIcon}),$$("strong").append(node.socialChannel).attr("contenteditable",false)]).addClass("header").attr("contenteditable",false)}removeEmbed(){this.context.api.document.deleteNode("socialembed",this.props.node)}}SocialembedComponent.noStyle=true;exports.default=SocialembedComponent},function(module,exports){module.exports=substance},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertEmbed=__webpack_require__(17);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class SocialembedCommand extends _writer.WriterCommand{execute(params){if(params.isPaste){const currentNode=params.selection.getPath();if(!currentNode){return false}const currentNodeId=currentNode[0];const previousNode=_writer.api.document.getPreviousNode(currentNodeId);_writer.api.document.deleteNode("socialembed",previousNode)}params.editorSession.transaction(tx=>{(0,_insertEmbed2.default)(tx,params.url)});return true}}exports.default=SocialembedCommand},function(module,exports){module.exports=writer},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=insertEmbed;function insertEmbed(tx,embedUrl){tx.insertBlockNode({type:"socialembed",dataType:"x-im/socialembed",url:embedUrl})}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"socialembed",tagName:"object",matchElement:function matchElement(el){return el.is('object[type="x-im/socialembed"]')},import:function _import(el,node){node.dataType=el.attr("type");const linkEl=el.find("links>link");node.url=linkEl.attr("url");node.uri=linkEl.attr("uri");node.linkType=linkEl.attr("type")},export:function _export(node,el,converter){const $$=converter.$$;el.attr({id:node.id,type:node.dataType});el.removeAttr("data-id");const links=$$("links");const link=$$("link");link.attr({rel:"self",type:node.linkType,url:node.url,uri:node.uri});links.append(link);el.append(links)}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={execute:function execute(params,context){const editorSession=context.editorSession;const text=params.text;if(params.action!=="break"){return}let match=/^\s*(https?:\/\/([^\s]+))\s*$/.exec(text);if(!match)return;let url=match[1];let hasMatch=false;if(url.indexOf("twitter")>0){hasMatch=true}else if(url.indexOf("instagram")>0){hasMatch=true}else if(url.indexOf("facebook")>0){hasMatch=true}else if(url.indexOf("vimeo")>0){hasMatch=true}else if(url.indexOf("soundcloud")>0){hasMatch=true}if(hasMatch){editorSession.executeCommand("socialembed",{url:url,isPaste:true});return true}return false}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _embedInfoFromURL=__webpack_require__(21);var _embedInfoFromURL2=_interopRequireDefault(_embedInfoFromURL);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class SocialembedNode extends _substance.BlockNode{fetchPayload(context,cb){let url=this.url;let embedInfo=(0,_embedInfoFromURL2.default)(url);switch(embedInfo.socialChannel){case"twitter":this._loadTwitter(url,context,cb);break;case"instagram":this._loadInstagram(url,context,cb);break;case"facebook":this._loadFacebook(url,context,cb);break;case"vimeo":this._loadVimeo(url,context,cb);break;case"soundcloud":this._loadSoundcloud(url,context,cb);break;default:cb(new Error("Could not resolve an embed for this url"))}}hasPayload(){return Boolean(this.html)}_loadInstagram(url,context,cb){const instagramBase=`https://api.instagram.com/oembed?url=${encodeURIComponent(url)}&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:instagramBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{let tplNode=document.createElement("template"),parentNode,oldImgNode,newImgNode;try{tplNode.innerHTML=json.html;parentNode=tplNode.content.childNodes[0].querySelector("blockquote>div");oldImgNode=tplNode.content.childNodes[0].querySelector("blockquote>div>div");newImgNode=document.createElement("img");newImgNode.setAttribute("src",json.thumbnail_url);newImgNode.style.width="100%";newImgNode.style.textAlign="center";tplNode.content.childNodes[0].style.boxShadow=null;
parentNode.style.padding=0;parentNode.removeChild(oldImgNode);parentNode.insertBefore(newImgNode,parentNode.firstChild);json.html=tplNode.innerHTML}catch(ex){}cb(null,{author:json.author_url,html:json.html,uri:`im://instagram/${json.media_id}`,url:url,title:json.title,linkType:"x-im/instagram",socialChannel:"Instagram",socialChannelIcon:"fa-instagram"},{history:false})}).catch(error=>{cb(error)})}_loadFacebook(url,context,cb){const apiBase=`https://www.facebook.com/plugins/post/oembed.json?url=${encodeURIComponent(url)}&omitscript=true`;let postId=(0,_writer.uuidv5)("url","https://facebook.com");const matches=/.*[\/=](\d+)/.exec(url);if(matches&&matches.length===2){postId=matches[1]}_writer.api.router.get("/api/resourceproxy",{url:apiBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://facebook-post/${postId}`,url:json.url,linkType:"x-im/facebook-post",socialChannel:"Facebook",socialChannelIcon:"fa-facebook"},{history:false})}).catch(error=>{cb(error)})}_loadTwitter(url,context,cb){const twitterBase=`https://api.twitter.com/1/statuses/oembed.json?url=${encodeURIComponent(url)}&hide_media=false&omit_script=true`;const twitterPostId=/status*\/(\d+)/.exec(url);_writer.api.router.get("/api/resourceproxy",{url:twitterBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://tweet/${twitterPostId[1]}`,url:json.url,linkType:"x-im/tweet",socialChannel:"Twitter",socialChannelIcon:"fa-twitter"},{history:false})}).catch(error=>{cb(error)})}_loadVimeo(url,context,cb){const vimeoBase=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(url)}&format=json&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:vimeoBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://vimeo/${json.video_id}`,url:url,title:json.title,linkType:"x-im/vimeo",socialChannel:"Vimeo",socialChannelIcon:"fa-vimeo"},{history:false})}).catch(error=>{cb(error)})}_loadSoundcloud(url,context,cb){const soundcloudBase=`https://soundcloud.com/oembed?format=json&url=${encodeURIComponent(url)}&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:soundcloudBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://soundcloud/${encodeURIComponent(json.author_name+"."+json.title)}`,url:url,title:json.title,linkType:"x-im/soundcloud",socialChannel:"Soundcloud",socialChannelIcon:"fa-soundcloud"},{history:false})}).catch(error=>{cb(error)})}}SocialembedNode.isResource=true;SocialembedNode.define({type:"socialembed",dataType:"string",url:"string",data:{type:"string",optional:true},errorMessage:{type:"string",optional:true},html:{type:"string",optional:true},uri:{type:"string",optional:true},linkType:{type:"string",optional:true},author:{type:"string",optional:true},socialChannel:{type:"string",optional:true},socialChannelIcon:{type:"string",optional:true}});exports.default=SocialembedNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=embedInfoFromURL;var _writer=__webpack_require__(16);function embedInfoFromURL(url){if(!_writer.lodash.isString(url)){return{isEmbed:false}}let result={isEmbed:true};if(url.indexOf("twitter")>0){result.socialChannel="twitter"}else if(url.indexOf("instagram")>0){result.socialChannel="instagram"}else if(url.indexOf("facebook")>0){result.socialChannel="facebook"}else if(url.indexOf("vimeo")>0){result.socialChannel="vimeo"}else if(url.indexOf("soundcloud")>0){result.socialChannel="soundcloud"}else{result.isEmbed=false}return result}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _embedInfoFromURL=__webpack_require__(21);var _embedInfoFromURL2=_interopRequireDefault(_embedInfoFromURL);var _insertEmbed=__webpack_require__(17);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropSocialEmbed extends _substance.DragAndDropHandler{match(params){if(params.type==="uri"){let embedInfo=(0,_embedInfoFromURL2.default)(params.uri);return embedInfo.isEmbed}}drop(tx,params){(0,_insertEmbed2.default)(tx,params.uri)}}exports.default=DropSocialEmbed},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(24);var _XimteaserPackage=__webpack_require__(26);var _XimteaserPackage2=_interopRequireDefault(_XimteaserPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_XimteaserPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(24);var _XimteaserComponent=__webpack_require__(27);var _XimteaserComponent2=_interopRequireDefault(_XimteaserComponent);var _XimteaserConverter=__webpack_require__(29);var _XimteaserConverter2=_interopRequireDefault(_XimteaserConverter);var _Ximteaser=__webpack_require__(30);var _Ximteaser2=_interopRequireDefault(_Ximteaser);var _XimteaserTool=__webpack_require__(31);var _XimteaserTool2=_interopRequireDefault(_XimteaserTool);var _XimteaserCommand=__webpack_require__(32);var _XimteaserCommand2=_interopRequireDefault(_XimteaserCommand);var _XimteaserInsertImageCommand=__webpack_require__(33);var _XimteaserInsertImageCommand2=_interopRequireDefault(_XimteaserInsertImageCommand);var _substance=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"ximteaser",id:"se.infomaker.ximteaser",configure:function configure(config,pluginConfig){config.addNode(_Ximteaser2.default);config.addComponent(_Ximteaser2.default.type,_XimteaserComponent2.default);config.addConverter("newsml",_XimteaserConverter2.default);config.addContentMenuTopTool("ximteaser",_XimteaserTool2.default);config.addCommand("ximteaser",_XimteaserCommand2.default,pluginConfig);config.addCommand("ximteaserinsertimage",_XimteaserInsertImageCommand2.default,pluginConfig);config.addIcon("ximteaser",{fontawesome:" fa-newspaper-o"});if(_substance.platform.isMac){config.addKeyboardShortcut("cmd+alt+t",{command:"ximteaser"})}else{config.addKeyboardShortcut("ctrl+alt+t",{command:"ximteaser"})}config.addLabel("Insert Teaser",{en:"Insert Teaser",sv:"Infoga puff"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _FileInputComponent=__webpack_require__(28);var _FileInputComponent2=_interopRequireDefault(_FileInputComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class XimteaserComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this._onDocumentChange,this);this.parent.parent.attr("draggable",false);this.parent.attr("draggable",false);this.attr("draggable",false)}dispose(){this.context.editorSession.off(this)}_onDocumentChange(change){if(change.isAffected(this.props.node.id)||change.isAffected(this.props.node.imageFile)){this.rerender()}}render($$){const node=this.props.node;const el=$$("div").addClass("sc-ximteaser im-blocknode__container");const teaserFields=_writer.api.getConfigValue("se.infomaker.ximteaser","fields",[]);el.append(this.renderHeader($$));const ImageDisplay=_writer.api.ui.getComponent("imageDisplay");if(this.props.node.imageFile){el.append($$(ImageDisplay,{parentId:"se.infomaker.ximteaser",node:node,isolatedNodeState:this.props.isolatedNodeState,removeImage:this.removeImage.bind(this)}).ref("image"))}el.append(this.renderContent($$,teaserFields));return el}removeImage(){_writer.api.editorSession.transaction(tx=>{const node=this.props.node;tx.set([node.id,"imageFile"],null);tx.set([node.id,"subject"],"")})}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-newspaper-o"}),$$("strong").append(this.getLabel("Teaser")),$$(_FileInputComponent2.default,{onChange:this.triggerFileUpload.bind(this)})]).addClass("header")}triggerFileUpload(ev){const editorSession=_writer.api.editorSession;editorSession.executeCommand("ximteaserinsertimage",{type:"file",data:ev.target.files,context:{node:this.props.node}})}renderContent($$,teaserFields){const content=$$("div").addClass("im-blocknode__content full-width");if(teaserFields.indexOf("subject")>=0){content.append(this.renderSubjectEditor($$))}content.append(this.renderTitleEditor($$));if(teaserFields.indexOf("text")>=0){content.append(this.renderTextEditor($$))}return content}renderSubjectEditor($$){if(this.props.node.imageFile){const subjectContainer=$$("div");const subjectEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"subject"],doc:this.props.doc}).ref("subject").addClass("x-im-teaser-subject");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-flag"});subjectContainer.append([icon,subjectEditor]);return subjectContainer}}renderTitleEditor($$){const titleContainer=$$("div");const titleEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"title"],doc:this.props.doc}).ref("title").addClass("x-im-teaser-title");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-header"});titleContainer.append([icon,titleEditor]);return titleContainer}renderTextEditor($$){const textContainer=$$("div");const textEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"text"],doc:this.props.doc}).ref("text").addClass("x-im-teaser-text");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-paragraph"});textContainer.append([icon,textEditor]);return textContainer}}exports.default=XimteaserComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class FileInputComponent extends _substance.Component{render($$){const uploadbutton=$$("span").addClass("upload-button").append($$(_substance.FontAwesomeIcon,{icon:"fa-upload"})).on("click",this.triggerFileDialog).attr("title",this.getLabel("Upload image"));const fileInput=$$("input").attr("type","file").attr("multiple","multiple").ref("fileInput").on("change",this.props.onChange);return $$("span").addClass("fileinput").append([uploadbutton,fileInput])}triggerFileDialog(){const evt=document.createEvent("MouseEvents");evt.initEvent("click",true,false);this.refs.fileInput.el.el.dispatchEvent(evt)}}exports.default=FileInputComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"ximteaser",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/teaser"},import:function _import(el,node,converter){const nodeId=el.attr("id");node.title=el.attr("title");node.dataType=el.attr("type");const linkEl=el.find("links>link");if(linkEl){node.imageType=linkEl.attr("type");let imageFile={id:(0,_writer.idGenerator)(),type:"npfile",imType:"x-im/image",parentNodeId:nodeId};if(linkEl.attr("uuid")){imageFile.uuid=linkEl.attr("uuid")}if(linkEl.attr("uri")){node.uri=linkEl.attr("uri")}if(linkEl.attr("url")){imageFile.url=linkEl.attr("url")}converter.createNode(imageFile);node.imageFile=imageFile.id;node.uuid=linkEl.attr("uuid")}const dataEl=el.find("data");node.crops={};if(dataEl){dataEl.children.forEach(function(child){if(child.tagName==="text"){node.text=converter.annotatedText(child,[node.id,"text"])}if(child.tagName==="subject"){node.subject=converter.annotatedText(child,[node.id,"subject"])}if(child.tagName==="width"){node.width=parseInt(child.text(),10)}if(child.tagName==="height"){node.height=parseInt(child.text(),10)}if(child.tagName==="crops"&&child.children.length>0){let crops={crops:[]};child.children.forEach(function(crop){if(crop.children.length===0){return}if(crop.tagName==="width"){crops.width=crop.text()}else if(crop.tagName==="height"){crops.height=crop.text()}else{var x=crop.find("x"),y=crop.find("y"),width=crop.find("width"),height=crop.find("height");crops.crops.push({name:crop.attr("name"),x:x.text(),y:y.text(),width:width.text(),height:height.text()})}});if(crops.crops.length){node.crops=crops}}})}},export:function _export(node,el,converter){const $$=converter.$$;el.removeAttr("data-id");el.attr({id:node.id,type:"x-im/teaser"});if(node.title){el.attr("title",converter.annotatedText([node.id,"title"]))}const data=$$("data");if(node.width){data.append($$("width").append(String(node.width)))}if(node.height){data.append($$("height").append(String(node.width)))}if(node.text){data.append($$("text").append(converter.annotatedText([node.id,"text"])))}if(node.subject){data.append($$("subject").append(converter.annotatedText([node.id,"subject"])))}if(node.crops){let crops=$$("crops");for(var x in node.crops.crops){var origCrop=node.crops.crops[x];crops.append($$("crop").attr("name",origCrop.name).append([$$("x").append(origCrop.x),$$("y").append(origCrop.y),$$("width").append(origCrop.width),$$("height").append(origCrop.height)]))}data.append(crops)}el.append(data);let fileNode=node.document.get(node.imageFile);if(fileNode&&fileNode.uuid!==""&&node.uri){const link=$$("link").attr({rel:"image",type:"x-im/image",uri:node.uri,uuid:fileNode.uuid});el.append($$("links").append(link))}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class Ximteaser extends _substance.BlockNode{getImageFile(){if(this.imageFile){return this.document.get(this.imageFile)}}getUrl(){let imageFile=this.getImageFile();if(imageFile){return imageFile.getUrl()}}setSoftcropData(data){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"crops"],data)})}handleDOMDocument(newsItemDOMDocument){const dom=newsItemDOMDocument.documentElement,uuid=dom.getAttribute("guid"),uri=dom.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]').getAttribute("value"),width=dom.querySelector("contentMeta > metadata > object > data > width"),height=dom.querySelector("contentMeta > metadata > object > data > height");_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"uuid"],uuid);tx.set([this.id,"uri"],uri);tx.set([this.id,"width"],width?width.textContent:"");tx.set([this.id,"height"],height?height.textContent:"")},{history:false})}}Ximteaser.define({type:"ximteaser",dataType:{type:"string",optional:false},imageFile:{type:"file",optional:true},uuid:{type:"string",optional:true},uri:{type:"string",optional:true},title:{type:"string",optional:false,default:""},subject:{type:"string",optional:false,default:""},text:{type:"string",optional:false,default:""},width:{type:"number",optional:true},height:{type:"number",optional:true},crops:{type:"object",default:[]}});exports.default=Ximteaser},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimteaserTool extends _substance.Tool{render($$){const el=$$("div");el.attr("title",this.getLabel("Insert Teaser"));el.append($$("button").addClass("se-tool").append($$("i").addClass("fa fa-newspaper-o")).on("click",this.insertTeaser));return el}insertTeaser(){const commandName=this.getCommandName();_writer.api.editorSession.executeCommand(commandName,{test:"hello"})}}exports.default=XimteaserTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimteaserCommand extends _writer.WriterCommand{execute(params,context){const teaserPosition=context.api.getConfigValue(this.config.id,"teaserPosition","bottom");const nodes=_writer.api.document.getDocumentNodes();const existingTeaser=nodes.filter(node=>{return node.dataType==="x-im/teaser"});if(existingTeaser.length>0){_writer.api.ui.showNotification("se.infomaker.ximteaser",_writer.api.getLabel("A teaser already exist"),_writer.api.getLabel("There is already a teaser in this document"));return false}switch(teaserPosition){case"top":this.insertTeaserAtTop(params);break;default:this.insertTeaserAtBottom(params);break}}insertTeaserAtTop(params){const editorSession=params.editorSession;const doc=editorSession.getDocument();editorSession.transaction(tx=>{const firstNodeId=doc.getNodes()["body"].nodes[0];tx.selection=doc.createSelection({type:"property",containerId:"body",path:[firstNodeId,"content"],startOffset:0});tx.insertBlockNode(this.getEmptyTeaserNode())})}insertTeaserAtBottom(params){const editorSession=params.editorSession;editorSession.transaction(tx=>{const body=tx.get("body");const node=tx.create(this.getEmptyTeaserNode());body.show(node.id)})}getEmptyTeaserNode(){return{type:"ximteaser",dataType:"x-im/teaser",id:(0,_writer.idGenerator)(),uuid:"",url:"",imageType:"x-im/image",title:"",text:"",crops:[]}}}exports.default=XimteaserCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimteaserInsertImageCommand extends _writer.WriterCommand{constructor(...args){super(...args);this.name="ximteaserinsertimage"}execute(params,context){const teaserNode=params.context.node;const editorSession=context.editorSession;const file=params.data[0];editorSession.transaction(tx=>{let imageFile=tx.create({parentNodeId:teaserNode.id,type:"npfile",imType:"x-im/image",mimeType:file.type,sourceFile:file});tx.set([teaserNode.id,"imageFile"],imageFile.id)});_writer.api.editorSession.fileManager.sync()}}exports.default=XimteaserInsertImageCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(35);__webpack_require__(37);__webpack_require__(39);var _XimimagePackage=__webpack_require__(41);var _XimimagePackage2=_interopRequireDefault(_XimimagePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_XimimagePackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports){},,function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimimageComponent=__webpack_require__(42);var _XimimageComponent2=_interopRequireDefault(_XimimageComponent);var _XimimageConverter=__webpack_require__(46);var _XimimageConverter2=_interopRequireDefault(_XimimageConverter);var _Ximimage=__webpack_require__(47);var _Ximimage2=_interopRequireDefault(_Ximimage);var _InsertImagesTool=__webpack_require__(48);var _InsertImagesTool2=_interopRequireDefault(_InsertImagesTool);var _InsertImagesCommand=__webpack_require__(49);var _InsertImagesCommand2=_interopRequireDefault(_InsertImagesCommand);var _DropImageFile=__webpack_require__(51);var _DropImageFile2=_interopRequireDefault(_DropImageFile);var _DropImageUri=__webpack_require__(52);var _DropImageUri2=_interopRequireDefault(_DropImageUri);var _DropImageUUID=__webpack_require__(53);var _DropImageUUID2=_interopRequireDefault(_DropImageUUID);var _XimimageFileProxy=__webpack_require__(54);var _XimimageFileProxy2=_interopRequireDefault(_XimimageFileProxy);var _InsertImageUrlCommand=__webpack_require__(55);var _InsertImageUrlCommand2=_interopRequireDefault(_InsertImageUrlCommand);var _ImageDisplay=__webpack_require__(43);var _ImageDisplay2=_interopRequireDefault(_ImageDisplay);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"ximimage",id:"se.infomaker.ximimage",configure:function configure(config){config.addNode(_Ximimage2.default);config.addComponent(_Ximimage2.default.type,_XimimageComponent2.default);config.addConverter("newsml",_XimimageConverter2.default);config.addContentMenuTopTool("insert-images",_InsertImagesTool2.default);config.addCommand("insert-images",_InsertImagesCommand2.default);config.addCommand("ximimage-insert-image-url",_InsertImageUrlCommand2.default);config.addComponent("imageDisplay",_ImageDisplay2.default);config.addConverter("newsml",_XimimageConverter2.default);config.addDragAndDrop(_DropImageFile2.default);config.addDragAndDrop(_DropImageUri2.default);config.addDragAndDrop(_DropImageUUID2.default);config.addIcon("image",{fontawesome:"fa-image"});config.addIcon("crop",{fontawesome:"fa-crop"});config.addIcon("user-plus",{fontawesome:"fa-user-plus"});config.addIcon("upload",{fontawesome:"fa-upload"});config.addIcon("remove",{fontawesome:"fa-times"});config.addFileProxy(_XimimageFileProxy2.default);config.addLabel("Upload image",{en:"Upload image",sv:"Ladda upp bild"});config.addLabel("remove-image-button-title",{en:"Remove image",sv:"Ta bort bild"});config.addLabel("Image archive information",{sv:"Arkivinformation om bild"});config.addLabel("Add to image byline",{sv:"Lägg till byline till bild"});config.addLabel("Add to byline",{sv:"Lägg till byline"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ImageDisplay=__webpack_require__(43);var _ImageDisplay2=_interopRequireDefault(_ImageDisplay);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{api}=writer;class XimimageComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){this.context.editorSession.off(this)}_onDocumentChange(change){if(change.isAffected(this.props.node.id)||change.isAffected(this.props.node.imageFile)){this.rerender()}}render($$){let node=this.props.node;let el=$$("div").addClass("sc-ximimage");let fields=api.getConfigValue("se.infomaker.ximimage","fields");el.append($$(_ImageDisplay2.default,{parentId:"se.infomaker.ximimage",node:node,isolatedNodeState:this.props.isolatedNodeState}).ref("image"));this.renderAuthors($$,el);fields.forEach(obj=>{if(obj.type==="option"){el.append(this.renderOptionField($$,obj))}else{el.append(this.renderTextField($$,obj))}});return el}renderAuthors($$,el){if(api.getConfigValue("se.infomaker.ximimage","byline")){const authorList=$$("ul").addClass("dialog-image-authorlist").attr("contenteditable",false);this.props.node.authors.forEach(item=>{const authorItem=this.renderAuthor($$,item);if(authorItem){authorList.append(authorItem)}});el.append($$("div").attr("contenteditable",false).addClass("x-im-image-authors").append(authorList))}}renderAuthor($$,author){const avatar=$$("span").addClass("x-im-image-author-token");const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;return $$("li").append($$("div").append([avatar,$$("div").append([$$("strong").append(author.name)]),$$("span").append($$("a").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"})).attr("title",this.getLabel("Remove")).on("click",()=>{this.removeAuthor(author)}))])).ref("item-"+refid)}removeAuthor(author){const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;delete this.refs["item-"+refid];const authors=this.props.node.authors;for(let n=0;n<authors.length;n++){if(!_writer.NilUUID.isNilUUID(author.uuid)&&authors[n].uuid===author.uuid){authors.splice(n,1);break}else if(_writer.NilUUID.isNilUUID(author.uuid)&&authors[n].name===author.name){authors.splice(n,1);break}}this.props.node.setAuthors(authors)}renderTextField($$,obj){return $$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,obj.name],doc:this.props.doc}).ref(obj.name).attr("title",obj.label).addClass("x-im-image-dynamic x-im-image-"+obj.name)}renderOptionField($$,obj){let options=[],currentOption=null;if(!this.props.node.alignment){currentOption=obj.options[0].name}else{currentOption=this.props.node.alignment}obj.options.forEach(option=>{let selectedClass=currentOption===option.name?" selected":"";options.push($$("em").addClass("fa "+option.icon+selectedClass).attr({contenteditable:"false",title:option.label}).on("click",()=>{if(option.name!==this.props.node.alignment){this.props.node.setAlignment(option.name);this.rerender()}return false}))});return $$("div").addClass("x-im-image-dynamic x-im-image-alignment").attr({contenteditable:"false"}).append(options)}}exports.default=XimimageComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ImageCropper=__webpack_require__(44);var _ImageCropper2=_interopRequireDefault(_ImageCropper);var _XimimageAddToBylineComponent=__webpack_require__(45);var _XimimageAddToBylineComponent2=_interopRequireDefault(_XimimageAddToBylineComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ImageDisplay extends _substance.Component{constructor(...args){super(...args)}_onDragStart(e){e.preventDefault();e.stopPropagation()}render($$){let imgContainer=$$("div").addClass("se-image-container").ref("imageContainer");let imgSrc;try{this.hasLoadingErrors=false;imgSrc=this.props.node.getUrl()}catch(e){this.hasLoadingErrors=e}let contentElement=$$(_substance.FontAwesomeIcon,{icon:"fa-picture-o"}).attr("style","font-size:25rem;color:#efefef");if(imgSrc){if(this.props.removeImage){const deleteButton=$$(_substance.Button,{icon:"remove"}).addClass("remove-image__button").attr("title",this.getLabel("remove-image-button-title")).on("click",()=>{this.props.removeImage()});imgContainer.append(deleteButton)}contentElement=$$("img",{src:imgSrc}).ref("img")}else if(this.hasLoadingErrors){contentElement=$$(_substance.FontAwesomeIcon,{icon:"fa-chain-broken"}).attr("style","font-size:4rem;").addClass("broken-image").attr("title",this.getLabel("Image could not be found"))}imgContainer.append(contentElement);const imageFile=this.context.doc.get(this.props.node.imageFile);const actionsEl=$$("div").addClass("se-actions");if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"byline")){actionsEl.append($$(_substance.Button,{icon:"user-plus"}).on("click",this._openAddToByline))}if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"imageinfo")){actionsEl.append($$(_substance.Button,{icon:"image"}).on("click",this._openMetaData))}if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"softcrop")){actionsEl.append($$(_substance.Button,{icon:"crop"}).on("click",this._openCropper))}imgContainer.append(actionsEl);let el=$$("div").addClass("sc-image-display");el.addClass("sm-"+this.props.isolatedNodeState);el.append(imgContainer);return el}_openMetaData(){_writer.api.router.getNewsItem(this.props.node.uuid,"x-im/image").then(response=>{_writer.api.ui.showDialog(this.getComponent("dialog-image"),{node:this.props.node,newsItem:response,disablebylinesearch:!_writer.api.getConfigValue(this.props.parentId,"bylinesearch")},{title:this.getLabel("Image archive information"),global:true,primary:this.getLabel("Save"),secondary:this.getLabel("Cancel")})})}_openAddToByline(){_writer.api.ui.showDialog(_XimimageAddToBylineComponent2.default,{authors:this.props.node.authors,removeAuthor:()=>author=>{this.props.node.removeAuthor(author)},addAuthor:(author,cbDone)=>{const authors=this.props.node.authors;authors.push(author);this.props.node.setAuthors(authors);cbDone()}},{title:this.getLabel("Add to image byline"),global:true,primary:this.getLabel("Close"),secondary:false})}_openCropper(){let tertiary=false;if(this.props.node.crops){tertiary=[{caption:this.getLabel("Remove"),callback:()=>{this.props.node.setSoftcropData([]);return true}}]}_writer.api.ui.showDialog(_ImageCropper2.default,{parentId:this.props.parentId,src:this.props.node.getUrl(),width:this.props.node.width,height:this.props.node.height,crops:this.props.node.crops.crops||[],callback:crops=>{this.props.node.setSoftcropData(crops)}},{tertiary:tertiary})}}exports.default=ImageDisplay},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);const{api}=writer;class ImageCropper extends _substance.Component{didMount(){this.cropEditor=new IMSoftcrop.Editor("ximimage__softcrop",{autocrop:false,debug:false});let definedCrops=api.getConfigValue(this.props.parentId,"crops",[]),encodedSrc=encodeURIComponent(this.props.src);this.cropEditor.addImage("/api/resourceproxy?url="+encodedSrc,()=>{let selected=true;for(var name in definedCrops){if(this.props.crops){this.addCrop(name,selected,definedCrops[name],this.props.crops)}else{this.createCrop(name,selected,definedCrops[name])}selected=false}})}createCrop(name,selected,definedCrop){this.cropEditor.addSoftcrop(name,selected,definedCrop[0],definedCrop[1])}addCrop(name,selected,definedCrop,existingCrops){var existingCrop=null;for(var n=0;n<existingCrops.length;n++){if(existingCrops[n].name===name){existingCrop=existingCrops[n];break}}if(!existingCrop){this.createCrop(name,selected,definedCrop);return}let imageWidth=this.props.width;let imageHeight=this.props.height;let matches=this.props.src.match(/&w=([0-9]*)/);if(Array.isArray(matches)&&matches.length===2){imageWidth=matches[1];imageHeight=Math.round(imageWidth/this.props.width*this.props.height)}this.cropEditor.addSoftcrop(name,selected,Math.round(existingCrop.width*imageWidth),Math.round(existingCrop.height*imageHeight),Math.round(existingCrop.x*imageWidth),Math.round(existingCrop.y*imageHeight))}render($$){return $$("div").attr("id","ximimage__softcrop").addClass("sc-image-cropper").ref("cropper")}onClose(status){if(status==="cancel"){return}let data=this.cropEditor.getSoftcropData(),crops=[];data.crops.forEach(crop=>{crops.push({name:crop.id,x:crop.x/data.width,y:crop.y/data.height,width:crop.width/data.width,height:crop.height/data.height})});this.props.callback({crops:crops})}}exports.default=ImageCropper},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimimageAddToBylineComponent extends _substance.Component{constructor(...args){super(...args)}render($$){const el=$$("div").ref("authorContainer").addClass("authors dialog-image-info clearfix");const bylinesearch=this.context.api.getConfigValue("se.infomaker.ximimage","bylinesearch");let searchComponent;if(bylinesearch){const AuthorSearchComponent=this.context.componentRegistry.get("form-search");searchComponent=$$(AuthorSearchComponent,{existingItems:this.props.authors,searchUrl:"/api/search/concepts/authors?q=",onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Add to byline")}).ref("authorSearchComponent")}else{const AuthorAddComponent=this.context.componentRegistry.get("form-add");searchComponent=$$(AuthorAddComponent,{existingItems:this.props.authors,onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Add to byline")}).ref("authorSearchComponent");
}return el.append([searchComponent,this.renderAuthors($$)])}renderAuthors($$){const authorList=$$("ul").addClass("dialog-image-authorlist").attr("contenteditable",false);for(let n=0;n<this.props.authors.length;n++){const authorItem=this.renderAuthor($$,this.props.authors[n]);if(authorItem){authorList.append(authorItem)}}return $$("div").addClass("dialog-image-authors").append(authorList)}renderAuthor($$,author){let avatar;avatar=$$("span");const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;return $$("li").append($$("div").append([avatar,$$("div").append([$$("strong").append(author.name),$$("em").append(author.data?author.data.email?author.data.email:"":"")]),$$("span").append($$("a").append($$(_substance.FontAwesomeIcon,{icon:"remove"})).attr("title",this.getLabel("Remove")).on("click",function(){this.removeAuthor(author)}.bind(this)))])).ref("item-"+refid)}createAuthor(authorItem){const author={uuid:_writer.NilUUID.getNilUUID(),name:authorItem.inputValue};this.props.addAuthor(author,function(){this.rerender()}.bind(this))}addAuthor(authorItem){const author={uuid:authorItem.uuid,name:authorItem.name[0]};this.props.addAuthor(author,function(){this.rerender()}.bind(this))}removeAuthor(author){const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;delete this.refs["item-"+refid];this.props.removeAuthor(author)}onClose(){return true}}exports.default=XimimageAddToBylineComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"ximimage",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/image"},import:function _import(el,node,converter,newsItemConversion){const objectElementId=el.attr("id");var linkEl=el.find("links>link");let imageFile={id:(0,_writer.idGenerator)(),type:"npfile",imType:"x-im/image",parentNodeId:objectElementId};if(el.attr("uuid")){imageFile.uuid=el.attr("uuid")}if(linkEl&&linkEl.attr("uri")){node.uri=linkEl.attr("uri")}if(linkEl&&linkEl.attr("url")){imageFile.url=linkEl.attr("url")}converter.createNode(imageFile);node.imageFile=imageFile.id;node.uuid=el.attr("uuid");let dataEl;if(newsItemConversion){dataEl=el.find("data")}else{dataEl=linkEl.find("data")}node.caption="";node.alttext="";node.credit="";node.alignment="";if(dataEl){dataEl.children.forEach(function(child){if(child.tagName==="text"){node.caption=converter.annotatedText(child,[node.id,"caption"])}if(child.tagName==="alttext"){node.alttext=converter.annotatedText(child,[node.id,"alttext"])}if(child.tagName==="credit"){node.credit=converter.annotatedText(child,[node.id,"credit"])}if(child.tagName==="alignment"){node.alignment=child.text()}if(child.tagName==="width"){node.width=parseInt(child.text(),10)}if(child.tagName==="height"){node.height=parseInt(child.text(),10)}if(child.tagName==="crops"&&child.children.length>0){var crops={crops:[]};child.children.forEach(function(crop){if(crop.children.length===0){return}if(crop.tagName==="width"){crops.width=crop.text()}else if(crop.tagName==="height"){crops.height=crop.text()}else{var x=crop.find("x"),y=crop.find("y"),width=crop.find("width"),height=crop.find("height");crops.crops.push({name:crop.attr("name"),x:x.text(),y:y.text(),width:width.text(),height:height.text()})}});if(crops.crops.length){node.crops=crops}}})}node.authors=[];let authorLinks;if(newsItemConversion){authorLinks=el.find("links")}else{authorLinks=linkEl.find("links")}if(authorLinks){authorLinks.children.forEach(function(authorLinkEl){if("author"===authorLinkEl.getAttribute("rel")){node.authors.push({uuid:authorLinkEl.getAttribute("uuid"),name:authorLinkEl.getAttribute("title")})}else{console.warn("Unhandled link in image object",authorLinkEl)}})}},export:function _export(node,el,converter){var $$=converter.$$;let fileNode=node.document.get(node.imageFile);el.removeAttr("data-id");el.attr({id:node.id,type:"x-im/image",uuid:fileNode.uuid?fileNode.uuid:_writer.NilUUID.getNilUUID()});var data=$$("data").append([$$("width").append(String(node.width)),$$("height").append(String(node.height))]);let fields=_writer.api.getConfigValue("se.infomaker.ximimage","fields")||[];fields.forEach(obj=>{let name=obj.name==="caption"?"text":obj.name;if(!node[obj.name]){data.append($$(name).append(""))}else if(obj.type==="option"){data.append($$(name).append(node[obj.name]))}else{data.append($$(name).append(converter.annotatedText([node.id,obj.name])))}});if(node.crops){let crops=$$("crops");for(var x in node.crops.crops){if(node.crops.crops.hasOwnProperty(x)){var origCrop=node.crops.crops[x];crops.append($$("crop").attr("name",origCrop.name).append([$$("x").append(origCrop.x),$$("y").append(origCrop.y),$$("width").append(origCrop.width),$$("height").append(origCrop.height)]))}}data.append(crops)}var link=$$("link").attr({rel:"self",type:"x-im/image",uri:node.uri?node.uri:"",uuid:fileNode.uuid?fileNode.uuid:_writer.NilUUID.getNilUUID()}).append(data);if(node.authors.length){var authorLinks=$$("links");for(var n in node.authors){if(node.authors.hasOwnProperty(n)){var authorLink=$$("link").attr({rel:"author",uuid:node.authors[n].uuid,title:node.authors[n].name});if(!_writer.NilUUID.isNilUUID(node.authors[n].uuid)){authorLink.attr("type","x-im/author")}authorLinks.append(authorLink)}}link.append(authorLinks)}el.append($$("links").append(link))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _substance=__webpack_require__(14);const{BlockNode}=substance;class Ximimage extends BlockNode{getImageFile(){if(this.imageFile){return this.document.get(this.imageFile)}}getUrl(){let imageFile=this.getImageFile();if(imageFile){return imageFile.getUrl()}}setAlignment(alignment){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"alignment"],alignment)})}setSoftcropData(data){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"crops"],data)})}setAuthors(authors){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"authors"],authors)})}handleDOMDocument(newsItemDOMDocument){const dom=newsItemDOMDocument.documentElement,uuid=dom.getAttribute("guid"),uri=dom.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]'),text=dom.querySelector("contentMeta > metadata > object > data > text"),credit=dom.querySelector("contentMeta > metadata > object > data > credit"),width=dom.querySelector("contentMeta > metadata > object > data > width"),height=dom.querySelector("contentMeta > metadata > object > data > height");_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"uuid"],uuid?uuid:"");tx.set([this.id,"uri"],uri?uri.attributes["value"].value:"");tx.set([this.id,"caption"],text?text.textContent:"");tx.set([this.id,"credit"],credit?credit.textContent:"");tx.set([this.id,"width"],width?width.textContent:"");tx.set([this.id,"height"],height?height.textContent:"")},{history:false})}fetchPayload(context,cb){const fileNode=this.getImageFile();if(fileNode.sourceUUID){_writer.api.router.get("/api/newsitem/"+fileNode.uuid,{imType:"x-im/article"}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>response.text()).then(xmlString=>{const newsMLImporter=_writer.api.configurator.createImporter("newsml",{api:_writer.api});const newsMLConverters=context.converterRegistry.get("newsml");const ximImageConverter=newsMLConverters.get("ximimage");const imageNewsItemDocument=_substance.DefaultDOMElement.parseXML(xmlString);const imageNewsItem=imageNewsItemDocument[0];let imageObjectElement=imageNewsItem.find('contentMeta > metadata > object[type="x-im/image"]');let node={};const defaultDOMImageNewsitem=_substance.DefaultDOMElement.parseXML(imageObjectElement.outerHTML);ximImageConverter.import(defaultDOMImageNewsitem,node,newsMLImporter,true);const uri=imageNewsItem.find('itemMetaExtProperty[type="imext:uri"]').attr("value");const uuid=imageNewsItem.attr("guid");node.uri=uri;node.uuid=uuid;node.imageFile=fileNode.id;cb(null,node)}).catch(e=>{cb(e)})}}}Ximimage.isResource=true;Ximimage.define({type:"ximimage",uuid:{type:"string",optional:true},uri:{type:"string",optional:true},imageFile:{type:"file"},width:{type:"number",optional:true},height:{type:"number",optional:true},errorMessage:{type:"string",optional:true},crops:{type:"object",default:[]},authors:{type:"array",default:[]},caption:{type:"string",default:""},alttext:{type:"string",optional:true},credit:{type:"string",optional:true},alignment:{type:"string",optional:true}});exports.default=Ximimage},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class XimimageTool extends _substance.Tool{render($$){var el=$$("div");el.attr("title",this.getLabel("Upload image"));el.append($$("button").addClass("se-tool").append($$("i").addClass("fa fa-image")).on("click",this.triggerFileDialog));el.append($$("input").attr("type","file").attr("multiple","multiple").attr("id","x-im-image-fileupload").ref("x-im-image-fileupload").on("change",this.triggerFileUpload));return el}triggerFileDialog(){var evt=document.createEvent("MouseEvents");evt.initEvent("click",true,false);this.refs["x-im-image-fileupload"].el.el.dispatchEvent(evt)}triggerFileUpload(ev){this.context.editorSession.executeCommand("insert-images",{files:ev.target.files})}}exports.default=XimimageTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class XimimageCommand extends _writer.WriterCommand{execute(params){params.editorSession.transaction(tx=>{Array.prototype.forEach.call(params.files,file=>{(0,_insertImage2.default)(tx,file)})});_writer.api.editorSession.fileManager.sync();return true}}exports.default=XimimageCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(tx,data){let isFile=data instanceof File,nodeId=(0,_writer.idGenerator)();if(!typeof data==="string"&&!isFile){throw new Error("Unsupported data. Must be File or String")}const imageFileNode={parentNodeId:nodeId,type:"npfile",imType:"x-im/image"};if(isFile){imageFileNode["sourceFile"]=data}else if(typeof data==="string"){imageFileNode["sourceUrl"]=data}let imageFile=tx.create(imageFileNode);tx.insertBlockNode({id:nodeId,type:"ximimage",imageFile:imageFile.id,caption:"",alttext:"",credit:"",alignment:"",width:0,height:0})};var _writer=__webpack_require__(16)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _substance=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropImageFile extends _substance.DragAndDropHandler{match(params){return params.type==="file"&&_writer.lodash.startsWith(params.file.type,"image")}drop(tx,params){(0,_insertImage2.default)(tx,params.file);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}exports.default=DropImageFile},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropImageUri extends _substance.DragAndDropHandler{match(params){return params.type==="uri"&&_isImage(params.uri)}drop(tx,params){(0,_insertImage2.default)(tx,params.uri);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}function _isImage(uri){return uri.indexOf(".jpg")>0||uri.indexOf(".png")>0||uri.indexOf(".gif")>0}exports.default=DropImageUri},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class DropImageUUID extends _substance.DragAndDropHandler{match(params){if(this.isExistingImageDrop(params)){console.info("Implement support for handle existing image drop",this.getDataFromURL(params.uri));return true}return false}isExistingImageDrop(params){if(params.uri&&params.uri.indexOf("x-im-entity://x-im/image")>=0){return true}}drop(tx,params){const dropData=this.getDataFromURL(params.uri);const uuid=dropData.uuid;const nodeId=(0,_writer.idGenerator)();if(!dropData.uuid){throw new Error("Unsupported data. UUID must exist")}const imageFileNode={parentNodeId:nodeId,type:"npfile",imType:"x-im/image",uuid:uuid,sourceUUID:uuid};let imageFile=tx.create(imageFileNode);tx.insertBlockNode({id:nodeId,type:"ximimage",imageFile:imageFile.id,caption:dropData.name,alttext:"",credit:"",alignment:""})}getDataFromURL(url){const queryParamKey="data=";const dataPosition=url.indexOf(queryParamKey);let encodedData=url.substr(dataPosition+queryParamKey.length,url.length);return JSON.parse(window.atob(encodedData))}}exports.default=DropImageUUID},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimimageFileProxy extends _writer.NPFileProxy{}XimimageFileProxy.match=function(fileNode){return fileNode.imType==="x-im/image"};exports.default=XimimageFileProxy},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class InsertImageUrlCommand extends _writer.WriterCommand{execute(params){_writer.api.editorSession.transaction(tx=>{(0,_insertImage2.default)(tx,params.imageUrl)});_writer.api.editorSession.fileManager.sync()}}exports.default=InsertImageUrlCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _YoutubeEmbedPackage=__webpack_require__(57);var _YoutubeEmbedPackage2=_interopRequireDefault(_YoutubeEmbedPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_YoutubeEmbedPackage2.default)}else{console.error("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(58);var _YoutubeEmbedCommand=__webpack_require__(60);var _YoutubeEmbedCommand2=_interopRequireDefault(_YoutubeEmbedCommand);var _YoutubeEmbedNode=__webpack_require__(62);var _YoutubeEmbedNode2=_interopRequireDefault(_YoutubeEmbedNode);var _YoutubeEmbedComponent=__webpack_require__(63);var _YoutubeEmbedComponent2=_interopRequireDefault(_YoutubeEmbedComponent);var _YoutubeEmbedConverter=__webpack_require__(64);var _YoutubeEmbedConverter2=_interopRequireDefault(_YoutubeEmbedConverter);var _YoutubeEmbedMacro=__webpack_require__(65);var _YoutubeEmbedMacro2=_interopRequireDefault(_YoutubeEmbedMacro);var _YoutubeEmbedValidation=__webpack_require__(66);var _YoutubeEmbedValidation2=_interopRequireDefault(_YoutubeEmbedValidation);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.youtubeembed",name:"youtubeembed",configure:function configure(config){config.addConverter("newsml",_YoutubeEmbedConverter2.default);config.addComponent("youtubeembed",_YoutubeEmbedComponent2.default);config.addValidator(_YoutubeEmbedValidation2.default);config.addCommand("youtubeembed",_YoutubeEmbedCommand2.default);config.addNode(_YoutubeEmbedNode2.default);config.addMacro(_YoutubeEmbedMacro2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertEmbed=__webpack_require__(61);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class YoutubeEmbedCommand extends _writer.WriterCommand{execute(params){if(params.isPaste){const currentNode=params.selection.getPath();if(!currentNode){return false}const currentNodeId=currentNode[0];const previousNode=_writer.api.document.getPreviousNode(currentNodeId);_writer.api.document.deleteNode("youtubeembed",previousNode)}params.editorSession.transaction(tx=>{(0,_insertEmbed2.default)(tx,params.url)});return true}}exports.default=YoutubeEmbedCommand},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=insertEmbed;function insertEmbed(tx,embedUrl){tx.insertBlockNode({type:"youtubeembed",dataType:"x-im/youtube",url:embedUrl})}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class YoutubeEmbedNode extends _substance.BlockNode{fetchPayload(context,cb){let url=this.url;var baseUrl="https://youtube.com/oembed?url=";var apiUrl=baseUrl+this.url;_writer.api.router.get("/api/resourceproxy/",{url:apiUrl}).then(response=>response.json()).then(json=>{cb(null,{html:json.html,uri:url,thumbnail_url:json.thumbnail_url,title:json.title},{history:false})}).catch(e=>{cb(e)})}hasPayload(){return Boolean(this.html)}}YoutubeEmbedNode.isResource=true;YoutubeEmbedNode.define({type:"youtubeembed",dataType:"string",url:"string",start:{type:"string",default:"00:00"},errorMessage:{type:"string",optional:true},html:{type:"string",optional:true},thumbnail_url:{type:"string",default:""},uri:{type:"string",optional:true},linkType:{type:"string",optional:true},title:{type:"string",default:""}});exports.default=YoutubeEmbedNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class YoutubeEmbedComponent extends _substance.Component{constructor(...args){super(...args);_writer.api.document.triggerFetchResourceNode(this.props.node,{history:false})}didMount(){_writer.api.editorSession.onRender("document",this.rerender,this,{path:[this.props.node.id]})}dispose(){_writer.api.editorSession.off(this)}render($$){const el=$$("div").addClass("im-blocknode__container im-youtube");el.append(this.renderHeader($$));el.append(this.renderContent($$));return el}renderContent($$){const content=$$("div").addClass("im-blocknode__content full-width");const thumbnail=$$("img").attr("src",this.props.node.thumbnail_url).attr("style","width:100%");const startTimeEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"start"],doc:this.props.doc}).ref("startTime").addClass("start-time-editor");content.append(thumbnail);content.append($$(_substance.FontAwesomeIcon,{icon:"fa-clock-o"}));content.append(startTimeEditor);return content}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-youtube"}),$$("strong").append(this.getLabel("Youtube video")+" - "+this.props.node.title)]).addClass("header")}}exports.default=YoutubeEmbedComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"youtubeembed",tagName:"object",matchElement:function matchElement(el){return el.is('object[type="x-im/youtube"]')},import:function _import(el,node){node.dataType=el.attr("type");node.url=el.attr("url");node.uri=el.attr("uri");const startTimeEl=el.find("data > start");let startTimeFromEl=0;if(startTimeEl){startTimeFromEl=startTimeEl.text()}const startTime=_writer.moment.duration(parseInt(startTimeFromEl,10),"seconds");node.start=startTime.minutes()+":"+startTime.seconds()},export:function _export(node,el,converter){const $$=converter.$$;el.attr({id:node.id,type:node.dataType,url:node.url,uri:node.uri});let seconds;if(node.start&&node.start.indexOf(":")>-1){const startTime=node.start.split(":");seconds=parseInt(startTime[0],10)*60+parseInt(startTime[1],10)}else{seconds=node.start}const data=$$("data");data.append($$("start").append(seconds));el.removeAttr("data-id");el.append(data)}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={execute:function execute(params,context){let editorSession=context.editorSession;let text=params.text;if(!params.action==="break")return;let match=/^\s*(https?:\/\/([^\s]+))\s*$/.exec(text);if(!match)return;let url=match[1];if(url.indexOf("youtube")>0){editorSession.executeCommand("youtubeembed",{url:url,isPaste:true});return true}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class YoutubeEmbedValidation extends _writer.Validator{constructor(...args){super(...args)}validate(){const youtubeItems=this.newsItem.querySelectorAll('object[type="x-im/youtube"]');Array.prototype.forEach.call(youtubeItems,item=>{const startEl=item.querySelector("start");const time=parseInt(startEl.textContent,10);if(!Number.isInteger(time)){this.addWarning(_writer.api.getLabel("Youtube video has a invalid start time"))}})}}exports.default=YoutubeEmbedValidation},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _HistoryPackage=__webpack_require__(68);var _HistoryPackage2=_interopRequireDefault(_HistoryPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_HistoryPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(69);var _HistoryMainComponent=__webpack_require__(71);var _HistoryMainComponent2=_interopRequireDefault(_HistoryMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.history",name:"history",configure:function configure(config){config.addLabel("history-popover-headline",{en:"Changes since last successful save",sv:"Senaste ändringar"});config.addLabel("history-popover-description",{en:"Changes since last successful save",sv:"Ändringar sedan senast lyckade uppdatering till servern."});config.addPopover("historymaincomponent",{icon:"fa-history",align:"right"},_HistoryMainComponent2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _VersionSelectorDialog=__webpack_require__(72);var _VersionSelectorDialog2=_interopRequireDefault(_VersionSelectorDialog);var _HistoryItemComponent=__webpack_require__(74);var _HistoryItemComponent2=_interopRequireDefault(_HistoryItemComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class HistoryMainComponent extends _substance.Component{constructor(...args){super(...args);_writer.api.events.on("history",_writer.event.DOCUMENT_SAVED,()=>{_writer.api.history.deleteHistory(_writer.api.newsItem.getIdForArticle())});_writer.api.events.on("history",_writer.event.HISTORY_SAVED,()=>{this.updateHistoryState()});_writer.api.events.on("history",_writer.event.HISTORY_CLEARED,()=>{this.updateHistoryState()})}dispose(){_writer.api.events.off("history","document:saved");_writer.api.events.off("history","history:added");_writer.api.events.off("history","history:saved")}didMount(){var historyArticles=_writer.api.history.getHistory();var unsavedArticles=historyArticles.filter(function(history){return history.unsavedArticle===true});let buttonText="No thanks, create a new article";let description="We've found some unsaved articles. Click on the version you would like to restore";let title="Unsaved articles found";let historyForArticle=_writer.api.history.get(_writer.api.newsItem.getIdForArticle());if(historyForArticle&&historyForArticle.versions&&historyForArticle.versions.length>0&&_writer.api.newsItem.hasTemporaryId()){return}else if(!_writer.api.newsItem.hasTemporaryId()&&historyForArticle.versions.length>0){unsavedArticles=[historyForArticle];buttonText="Continue with last saved version";description="We found some unsaved changes for this article.";title="Unsaved changes found for this article"}else if(!_writer.api.newsItem.hasTemporaryId()&&historyForArticle.versions.length===0){return}else if(unsavedArticles.length===0){return}if(_writer.api.document.getDocumentStatus()==="writerHasNoDocument"){_writer.api.ui.showDialog(_VersionSelectorDialog2.default,{unsavedArticles:unsavedArticles,descriptionText:description,applyVersion:this.applyVersion.bind(this)},{global:true,secondary:false,primary:this.getLabel(buttonText),title:this.getLabel(title)})}}updateHistoryState(){let id=this.context.api.newsItem.getIdForArticle();this.setState({historyForArticle:this.context.api.history.get(id)})}getInitialState(){let id=this.context.api.newsItem.getIdForArticle();return{historyForArticle:this.context.api.history.get(id)}}render($$){var el=$$("div").addClass("imc-history light").append($$("h2").append(this.getLabel("history-popover-headline")));el.append($$("p").append(this.getLabel("history-popover-description")));if(this.state.historyForArticle===false){return el}const scrollpane=_writer.api.ui.getComponent("scroll-pane");const scroll=$$(scrollpane,{scrollbarType:"native"});let versions=this.state.historyForArticle.versions.reverse().slice(0,100).map(function(version){return this.renderHistoryItem($$,version,this.state.historyForArticle)}.bind(this));scroll.append(versions);el.append(scroll);var historyArticles=this.context.api.history.getHistory();var unsavedArticles=historyArticles.filter(function(history){return history.unsavedArticle===true});if(this.context.api.newsItem.hasTemporaryId()){el.append(this.renderSeeAllUnsavedLink($$,unsavedArticles))}return el}renderSeeAllUnsavedLink($$,unsavedArticles){return $$("a").addClass("all-unsaved-articles").append(this.getLabel("See all other unsaved articles")).on("click",()=>{this.context.api.ui.showDialog(_VersionSelectorDialog2.default,{unsavedArticles:unsavedArticles,descriptionText:this.getLabel("We've found some unsaved articles. Click on the version you would like to restore"),applyVersion:this.applyVersion.bind(this)},{global:true,secondary:false,title:this.getLabel("Following unsaved articles found")})})}renderHistoryItem($$,version,article){return $$(_HistoryItemComponent2.default,{version:version,article:article,applyVersion:this.applyVersion.bind(this)})}applyVersion(version,article){_writer.api.newsItem.setTemporaryId(article.id);_writer.api.events.documentIsUnsaved();_writer.api.newsItem.setSource(version.src,null,true)}}exports.default=HistoryMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _ArticleItem=__webpack_require__(73);var _ArticleItem2=_interopRequireDefault(_ArticleItem);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class VersionSelectorDialog extends _substance.Component{render($$){const el=$$("div").addClass("restore-history-dialog");const unsavedArticles=this.props.unsavedArticles;el.append($$("p").append(this.getLabel(this.props.descriptionText)));let versions=unsavedArticles.map(article=>{return $$(_ArticleItem2.default,{article:article,applyVersion:this.applyVersion.bind(this)})});el.append(versions);return el}applyVersion(version,article){this.props.applyVersion(version,article)}onClose(status){if("cancel"===status){return true}return true}}exports.default=VersionSelectorDialog},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _HistoryItemComponent=__webpack_require__(74);var _HistoryItemComponent2=_interopRequireDefault(_HistoryItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ArticleItem extends _substance.Component{render($$){let el=$$("div").addClass("history-article");let article=this.props.article;const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("icon-delete").attr("title",this.getLabel("Ignore and clear history"))).on("click",function(){this.context.api.history.deleteHistory(article.id);this.remove()}.bind(this));el.append(deleteButton);let title=article.id;el.append($$("h4").append(title));let versions=article.versions.slice(0,100).map(function(version){return this.renderHistoryItem($$,version,article)}.bind(this));el.append(versions);return el}renderHistoryItem($$,version,article){return $$(_HistoryItemComponent2.default,{version:version,article:article,applyVersion:this.props.applyVersion.bind(this)})}}exports.default=ArticleItem},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class HistoryItemComponent extends _substance.Component{render($$){var version=this.props.version;var icon,title;if(this.context.api.newsItemArticle.firstElementChild.outerHTML===version.src){icon="fa fa-check";title=this.getLabel("Identical with the active version")}else{icon="fa fa-file-text-o"}var outer=$$("div").addClass("history-version-item light").append($$("i").addClass(icon).attr("title",title)).on("click",()=>{this.props.applyVersion(version,this.props.article)});var inner=$$("div");inner.append($$("span").append((0,_writer.moment)(version.time).from()));if(version.action==="saved"){inner.addClass("saved")}outer.append(inner);return outer}}exports.default=HistoryItemComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(76);var _HeaderEditorNode=__webpack_require__(78);var _HeaderEditorNode2=_interopRequireDefault(_HeaderEditorNode);var _HeaderEditorComponent=__webpack_require__(79);var _HeaderEditorComponent2=_interopRequireDefault(_HeaderEditorComponent);var _HeaderEditorConverter=__webpack_require__(80);var _HeaderEditorConverter2=_interopRequireDefault(_HeaderEditorConverter);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const HeaderEditorPackage={id:"se.infomaker.headereditor",name:"headereditor",configure:config=>{config.addNode(_HeaderEditorNode2.default);config.addConverter("newsml",_HeaderEditorConverter2.default);config.addTextEditComponent(_HeaderEditorNode2.default.type,_HeaderEditorComponent2.default,{display:"top"});config.addLabel("leadin",{en:"Leadin",sv:"Ingress"})}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(HeaderEditorPackage)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class HeaderEditorNode extends _substance.DocumentNode{}
HeaderEditorNode.type="headereditor";HeaderEditorNode.define({headline:"text",dateline:"text",leadin:"text"});exports.default=HeaderEditorNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class HeaderEditorComponent extends _substance.Component{constructor(...args){super(...args);this.context.editorSession.onUpdate(editorSession=>{const surface=editorSession.getFocusedSurface();if(surface){const icons=this.el.findAll(".fa");if(surface.name!=="body"){icons.forEach(icons=>{icons.addClass("active")})}else{icons.forEach(icons=>{icons.removeClass("active")})}}},this)}render($$){const el=$$("div").addClass("sc-np-headereditor");const headerGroupFields=_writer.api.getConfigValue("se.infomaker.headereditor","elements")||["headline","leadin"];const fields=headerGroupFields.map(function(field){return this.getElement($$,field)}.bind(this));el.append(fields);return el}getElement($$,field){switch(field){case"headline":return this.getElementForField($$,field,"fa-header");case"leadin":return this.getElementForField($$,field,"fa-paragraph");default:return this.getElementForField($$,field,"fa-paragraph")}}getElementForField($$,field,fieldIcon){const el=$$("span").addClass("sc-metdata-text__container").attr({contenteditable:false,title:_writer.api.getLabel(field)});el.append($$(_substance.FontAwesomeIcon,{icon:fieldIcon}).attr({contenteditable:false}));el.append($$(_substance.TextPropertyEditor,{name:field,tagName:"div",commands:this.props.headlineCommands,withoutBreak:false,path:[this.props.node.id,field]}).addClass("se-"+field));return el}}exports.default=HeaderEditorComponent},function(module,exports){"use strict";module.exports={type:"headereditor",tagName:"group",matchElement:function matchElement(el){const headlineElement=el.find('group[type="header"] > element[type="headline"]');const leadinElement=el.find('group[type="header"] > element[type="leadin"]');if(headlineElement||leadinElement){return true}},findElementForType:function findElementForType(el,type){return el.find('element[type="'+type+'"]')},getDefaultFields:function getDefaultFields(){return["headline","leadin"]},import:function _import(el,node,converter){let oldPreserveValue;oldPreserveValue=converter.state.preserveWhitespace;node.id="headereditor";const api=converter.context.api;const headerFields=api.getConfigValue("se.infomaker.headereditor","elements")||this.getDefaultFields();headerFields.forEach(field=>{var element=this.findElementForType(el,field);if(element){converter.state.preserveWhitespace=true;node[field]=converter.annotatedText(element,["headereditor",field])}});converter.state.preserveWhitespace=oldPreserveValue},export:function _export(node,el,converter){const $$=converter.$$;el.attr("type","header");const api=converter.context.api;const headerFields=api.getConfigValue("se.infomaker.headereditor","elements")||this.getDefaultFields();const elements=headerFields.map(function(field){if(node.hasOwnProperty(field)){return $$("element").attr("type",field).attr("id","group-header-"+field).append(converter.annotatedText([node.id,field]))}else{console.error("Field "+field+" not supported");return null}});el.append(elements)}}},,,,,,,,,,,,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(103);var _PreamblePackage=__webpack_require__(105);var _PreamblePackage2=_interopRequireDefault(_PreamblePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PreamblePackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PreambleComponent=__webpack_require__(106);var _PreambleComponent2=_interopRequireDefault(_PreambleComponent);var _PreambleConverter=__webpack_require__(107);var _PreambleConverter2=_interopRequireDefault(_PreambleConverter);var _PreambleNode=__webpack_require__(108);var _PreambleNode2=_interopRequireDefault(_PreambleNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"preamble",id:"se.infomaker.preamble",configure:function configure(config){_PreambleNode2.default.type=this.name;_PreambleConverter2.default.type=_PreambleNode2.default.type;_PreambleConverter2.default.element=_PreambleNode2.default.type;config.addNode(_PreambleNode2.default);config.addComponent(_PreambleNode2.default.type,_PreambleComponent2.default);config.addConverter("newsml",_PreambleConverter2.default);config.addTextType({name:this.name,data:{type:_PreambleNode2.default.type}});config.addLabel("preamble",{en:"Preamble",sv:"Ingress"});config.addLabel("preamble.content",{en:"Preamble",sv:"Ingress"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class PreambleComponent extends Component{render($$){return $$("div").addClass("sc-preamble").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=PreambleComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="preamble"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","preamble").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class PreambleNode extends TextBlock{}PreambleNode.define({id:{type:"string"}});exports.default=PreambleNode},,,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TextAnalyzerPackage=__webpack_require__(122);var _TextAnalyzerPackage2=_interopRequireDefault(_TextAnalyzerPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_TextAnalyzerPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TextAnalyzerComponent=__webpack_require__(123);var _TextAnalyzerComponent2=_interopRequireDefault(_TextAnalyzerComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"textanalyzer",id:"se.infomaker.textanalyzer",index:5e3,configure:function configure(config){config.addLabel("Characters",{sv:"Antal tecken"});config.addLabel("Words",{sv:"Antal ord"});config.addPopover("textanalyzer",{icon:"fa-info",align:"right"},_TextAnalyzerComponent2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(124);const{Component}=substance;const{api,event}=writer;class TextanalyzerComponent extends Component{dispose(){api.events.off("textanalyzer",event.DOCUMENT_CHANGED)}constructor(...args){super(...args);api.events.on("textanalyzer",event.DOCUMENT_CHANGED,()=>{this.calculateText()})}calculateText(){var count=this.getCount();this.setState({textLength:count.textLength,words:count.words})}didMount(){}render($$){var el=$$("div").addClass("textanalyzer plugin");var numberContainer=$$("div").addClass("number__container clearfix");var textlengthEl=$$("div").addClass("count-info").append($$("span").append(this.state.textLength.toString())).append($$("p").append(this.getLabel("Characters"))).attr("title",this.getLabel("Characters"));var wordsEl=$$("div").addClass("count-info").append($$("span").append(this.state.words.toString())).append($$("p").append(this.getLabel("Words"))).attr("title",this.getLabel("Words"));numberContainer.append([textlengthEl,wordsEl]);el.append(numberContainer);return el}getInitialState(){var count=this.getCount();return{textLength:count.textLength,words:count.words}}getCount(){var nodes=api.document.getDocumentNodes();var textContent="";nodes.forEach(function(node){if(node.content){textContent+=node.content.trim()}});var words=textContent.split(/\s+/);var textLength=textContent.length;return{words:words.length,textLength:textLength}}}exports.default=TextanalyzerComponent},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _NewsPriority=__webpack_require__(127);var _NewsPriority2=_interopRequireDefault(_NewsPriority);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_NewsPriority2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(128);var _NewsPriorityComponent=__webpack_require__(130);var _NewsPriorityComponent2=_interopRequireDefault(_NewsPriorityComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"newspriority",id:"se.infomaker.newspriority",configure:function configure(config){config.addComponentToSidebarWithTabId(this.id,"main",_NewsPriorityComponent2.default);config.addLabel("newsvalue",{en:"Newsvalue",sv:"Nyhetsvärde"});config.addLabel("Lifetime",{en:"Lifetime",sv:"Livslängd"});config.addLabel("enter-date-and-time",{en:"Enter date and time",sv:"Ange datum och tid"})}}},function(module,exports){},,function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component}=substance;const{api,moment,idGenerator}=writer;const{isObject,isEmpty}=writer.lodash;const pluginId="se.infomaker.newspriority";class NewsPriorityComponent extends Component{constructor(...args){super(...args);api.events.on("newspriority","data:duplicated",()=>{api.clearNewsPriority("newspriority");this.rerender()})}getInitialState(){this.scores=api.getConfigValue(pluginId,"scores");this.lifetimes=api.getConfigValue(pluginId,"lifetimes");this.durationKey=api.getConfigValue(pluginId,"durationKey");this.defaultScoreIndex=api.getConfigValue(pluginId,"defaultScoresIndex");this.defaultLifetimeIndex=api.getConfigValue(pluginId,"defaultLifetimesIndex");var newsValue={score:this.scores[this.defaultScoreIndex].value,description:this.lifetimes[this.defaultLifetimeIndex].label,format:"lifetimecode"};newsValue[this.durationKey]=this.lifetimes[this.defaultLifetimeIndex].value;return newsValue}updateState(){var newsPriority=api.newsItem.getNewsPriority(pluginId);if(!newsPriority){var template={$id:idGenerator(),$type:"x-im/newsvalue",data:{description:this.lifetimes[this.defaultLifetimeIndex].label,end:"",format:"lifetimecode",score:this.scores[this.defaultScoreIndex].value}};template.data[this.durationKey]=this.lifetimes[this.defaultLifetimeIndex].value;api.newsItem.setNewsPriority("newspriority",template);newsPriority=api.newsItem.getNewsPriority(pluginId);if(isObject(newsPriority.data[this.durationKey])){newsPriority.data[this.durationKey]=template.data[this.durationKey]}}else{if(newsPriority.data.end&&!this.extendedState){this.extendedState={end:newsPriority.data.end}}}if(Number(newsPriority.data.score)===Number(this.state.score)){return}var newState={score:newsPriority.data.score,description:newsPriority.data.description,format:newsPriority.data.format,end:newsPriority.data.end};newState[this.durationKey]=newsPriority.data[this.durationKey];this.setState(newState)}render($$){this.updateState();var el=$$("div");var prioTitle=$$("h2").text(this.getLabel("newsvalue"));el.append(prioTitle);el.append(this._renderPriority($$));var lifetimeTitle=$$("h2").text(this.getLabel("Lifetime"));el.append(lifetimeTitle);if(this.lifetimes.length>1){el.append(this._renderLifeTime($$))}el.append(this._renderDatetimeInput($$).ref("datePickerComponent"));return el}_renderPriority($$){var prio=$$("div").addClass("btn-group");var buttons=this.scores.map(function(score){return $$("button").addClass("btn btn-secondary sc-np-btn").text(String(score.value)).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual").attr("title",score.text).addClass(parseInt(this.state.score,10)===score.value?"active":"").on("click",function(){this.setNewsPriority(score.value)}.bind(this))}.bind(this));prio.append(buttons);return prio}_renderLifeTime($$){var lifetime=$$("div").addClass("btn-group lifetime");var buttons=this.lifetimes.map(function(lifetime){return $$("button").addClass("btn btn-secondary sc-np-btn").text(lifetime.label).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual").attr("title",lifetime.text).addClass(this.state[this.durationKey]===lifetime.value?"active":"").on("click",function(e){this.setLifetime(e,lifetime)}.bind(this))}.bind(this));lifetime.append(buttons);return lifetime}_renderDatetimeInput($$){var form=$$("form").attr("id","npLifetimeForm");var fieldset=$$("fieldset").addClass("form-group").ref("datePickerFieldset");var text=this.getLabel("enter-date-and-time");var endTime=api.newsItem.getNewsPriority("newspriority").data.end;if(endTime!==""&&!isEmpty(endTime)){text="✓ "+text}var small=$$("div").append($$("small").addClass("text-muted").text(text)).addClass("hidden").ref("datePickerInstructionText");var input=$$("input").attr("type","datetime-local").addClass("form-control").attr("id","npLifetimeInput").on("change",this.setLifetimeDatetime).ref("datePickerInput");input.on("focus",()=>{this.refs.datePickerInstructionText.el.removeClass("hidden")});input.on("blur",()=>{this.refs.datePickerInstructionText.el.addClass("hidden")});if(this.state.end&&this.state.end.length>0){input.val(this.state.end.substring(0,16))}if(this.state[this.durationKey]!=="custom"&&this.lifetimes.length>1){form.attr("style","display: none;")}form.append(fieldset.append(input).append(small));return form}setNewsPriority(score){var newsPriority=api.newsItem.getNewsPriority(pluginId);newsPriority.data.score=score;api.newsItem.setNewsPriority(pluginId,newsPriority);this.extendState({score:newsPriority.data.score})}setLifetime(ev,lifetime){var newsPriority=api.newsItem.getNewsPriority(pluginId);for(var n=0;n<this.lifetimes.length;n++){if(ev.target.textContent===this.lifetimes[n].label){newsPriority.data.description=this.lifetimes[n].label;newsPriority.data[this.durationKey]=this.lifetimes[n].value;break}}var extendedState={};if(this.extendedState&&this.extendedState.end){extendedState.end=this.extendedState.end}if(lifetime.value==="custom"&&this.extendedState&&this.extendedState.end){newsPriority.data.end=this.extendedState.end}else{newsPriority.data.end=""}api.newsItem.setNewsPriority("newspriority",newsPriority);extendedState["description"]=newsPriority.data.description;extendedState[this.durationKey]=newsPriority.data[this.durationKey];this.extendState(extendedState)}setLifetimeDatetime(ev){var newsPriority=api.newsItem.getNewsPriority(pluginId);if(ev.target.value===""){newsPriority.data.end={}}else{newsPriority.data.end=moment(ev.target.value).format("YYYY-MM-DDTHH:mm:ssZ")}api.newsItem.setNewsPriority("newspriority",newsPriority);this.extendState({end:newsPriority.data.end})}}exports.default=NewsPriorityComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XImPlacePackage=__webpack_require__(132);var _XImPlacePackage2=_interopRequireDefault(_XImPlacePackage);var _XImPlacePackagePolygon=__webpack_require__(151);var _XImPlacePackagePolygon2=_interopRequireDefault(_XImPlacePackagePolygon);var _XImPlacePackagePosition=__webpack_require__(152);var _XImPlacePackagePosition2=_interopRequireDefault(_XImPlacePackagePosition);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(placeType=>{if(_writer.registerPlugin){switch(placeType){case"position":(0,_writer.registerPlugin)(_XImPlacePackagePosition2.default);break;case"polygon":(0,_writer.registerPlugin)(_XImPlacePackagePolygon2.default);break;default:(0,_writer.registerPlugin)(_XImPlacePackage2.default)}}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(133);var _XimPlacePackageConfigure=__webpack_require__(135);var _XimPlacePackageConfigure2=_interopRequireDefault(_XimPlacePackageConfigure);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const id="se.infomaker.ximplace";exports.default={id:id,name:"ximplace",configure:(0,_XimPlacePackageConfigure2.default)(id)}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _LocationMainComponent=__webpack_require__(136);var _LocationMainComponent2=_interopRequireDefault(_LocationMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(pluginId=>{return(config,pluginConfigObject)=>{config.addComponentToSidebarWithTabId(pluginId,"main",_LocationMainComponent2.default,pluginConfigObject);config.addLabel("Locations",{en:"Locations",sv:"Platser och områden"});config.addLabel("Areas",{en:"Areas",sv:"Län/Kommuner/Områden"});config.addLabel("Positions",{en:"Positions",sv:"Platser"});config.addLabel("Search locations",{en:"Search locations",sv:"Sök platser/områden"});config.addLabel("Search positions",{en:"Search positions",sv:"Sök platser"});config.addLabel("Search areas",{en:"Search areas",sv:"Sök områden"});config.addLabel("ximplace-error-save",{en:"Error saving place",sv:"Fel vid sparande av plats"});config.addLabel("Place",{en:"Place",sv:"Plats"});config.addLabel("Edit of polygons is not currently supported",{en:"Edit of polygons is not currently supported",sv:"Redigering av polygoner är för närvarande inte möjlig"})}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _LocationListComponent=__webpack_require__(137);var _LocationListComponent2=_interopRequireDefault(_LocationListComponent);var _LocationDetailComponent=__webpack_require__(141);var _LocationDetailComponent2=_interopRequireDefault(_LocationDetailComponent);var _concept=__webpack_require__(150);var _concept2=_interopRequireDefault(_concept);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class LocationMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximplace"}configureFeatures(){const features=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"features");switch(features){case"position":this.features="position";this.t={title:this.getLabel("Positions"),placeholder:this.getLabel("Search positions")};break;case"polygon":this.features="polygon";this.t={title:this.getLabel("Areas"),placeholder:this.getLabel("Search areas")};break;default:this.features="all";this.t={title:this.getLabel("Locations"),placeholder:this.getLabel("Search locations")}}this.polygonIsEditable=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"polygon.editable",true)}getInitialState(){this.configureFeatures();return{existingLocations:_writer.api.newsItem.getLocations(this.features)}}reload(){this.setState({existingLocations:_writer.api.newsItem.getLocations(this.features)})}render($$){const el=$$("div").addClass("location-main").append($$("h2").append(this.t.title));const locationList=$$(_LocationListComponent2.default,{locations:this.state.existingLocations,openMap:this.openMap.bind(this),removeLocation:this.removeLocation.bind(this)}).ref("locationList");let query="q=";if(this.features!=="all"){query="f="+this.features+"&q="}const LocationSearchComponent=this.context.componentRegistry.get("form-search");const searchComponent=$$(LocationSearchComponent,{existingItems:this.state.existingLocations,searchUrl:"/api/search/concepts/locations?"+query,onSelect:this.addLocation.bind(this),onCreate:this.createMap.bind(this),createAllowed:this.features!=="polygon",placeholderText:this.t.placeholder}).ref("authorSearchComponent");el.append(locationList);el.append(searchComponent);return el}createMap(selectedItem,exists){const parser=new DOMParser;const placeXML=parser.parseFromString(_concept2.default.place,"text/xml").firstChild;const location=_writer.jxon.build(placeXML);const properties={newLocation:true,exists:exists,query:selectedItem.inputValue,reload:this.reload.bind(this),editable:true,plugin:this.props.pluginConfigObject,location:location};_writer.api.ui.showDialog(_LocationDetailComponent2.default,properties,{title:this.getLabel("Place"),global:true,primary:this.getLabel("Save")})}addLocation(item){const useGeometryType=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"useGeometryType");if(useGeometryType===true&&!item.hasOwnProperty("geometryType")){throw new Error("Writer configured to use geometry type for locations but no geometry type provided by concept backend")}const location={title:item.name[0],uuid:item.uuid,data:item.location?{position:item.location[0]}:{},type:useGeometryType?item.geometryType[0]:"x-im/place"};_writer.api.newsItem.addLocation(this.name,location);this.reload()}removeLocation(location){_writer.api.newsItem.removeLinkByUUID(this.name,location.uuid);this.reload()}openMap(item){let editable=true;if(item.concept.metadata.object["@type"]==="x-im/polygon"&&false===this.polygonIsEditable){editable=false}const properties={newLocation:false,query:item.inputValue,location:item,reload:this.reload.bind(this),editable:editable,plugin:this.props.pluginConfigObject};_writer.api.ui.showDialog(_LocationDetailComponent2.default,properties,{title:this.getLabel("Place")+" "+item.concept.name,global:true,primary:editable?this.getLabel("Save"):this.getLabel("Close"),secondary:editable?this.getLabel("Cancel"):false})}}exports.default=LocationMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _LocationItemComponent=__webpack_require__(138);var _LocationItemComponent2=_interopRequireDefault(_LocationItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class LocationListComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximplace"}render($$){const el=$$("ul").addClass("tag-list").ref("locationItemList");const locations=this.props.locations.map(location=>{return $$(_LocationItemComponent2.default,{location:location,openMap:this.props.openMap.bind(this),removeLocation:this.props.removeLocation.bind(this)}).ref(location.uuid)});el.append(locations);return el}}exports.default=LocationListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _lodash=__webpack_require__(139);class LocationItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximplace"}loadLocation(){const api=this.context.api;api.router.getConceptItem(this.props.location.uuid,this.props.location.type).then(xml=>{const conceptXML=xml.querySelector("conceptItem");try{this.setState({loadedLocation:_writer.jxon.build(conceptXML),isLoaded:true})}catch(e){this.setState({isLoaded:true,couldNotLoad:true})}}).catch(()=>{this.setState({isLoaded:true,couldNotLoad:true})})}render($$){const location=this.props.location;const locItem=$$("li").addClass("tag-list__item");const displayNameEl=$$("span");let locationType="position";if(!this.state.isLoaded){displayNameEl.addClass("tag-item__title tag-item__title--loading").append(location.title);this.loadLocation()}else{if(this.state.couldNotLoad){displayNameEl.addClass("tag-item__title tag-item__title--no-avatar tag-item__title--notexisting").append(location.title).attr("title",this.getLabel("This item could not be loaded. UUID: ")+location.uuid)}else{locationType=this.state.loadedLocation.concept.metadata.object["@type"];displayNameEl.addClass("tag-item__title tag-item__title--no-avatar").append(this.state.loadedLocation.concept.name);displayNameEl.attr("title",location.title);LocationItemComponent.updateTagItemName(displayNameEl,this.state.loadedLocation);displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");if(this.state.loadedLocation.concept.name!==location.title){this.setState({isLoaded:false})}displayNameEl.on("click",function(){this.props.openMap(this.state.loadedLocation)}.bind(this))}locItem.append(displayNameEl);const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("Remove from article"))).on("click",function(){this.removeTag(location)}.bind(this));locItem.append(deleteButton);let icon="fa-map-marker";if(locationType==="x-im/polygon"){icon="fa-map"}locItem.append($$(_substance.FontAwesomeIcon,{icon:icon}).addClass("tag-icon"))}return locItem}removeTag(location){this.props.removeLocation(location)}static updateTagItemName(tagItem,loadedTag){if(loadedTag.concept&&loadedTag.concept.definition){const definition=(0,_lodash.isArray)(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(let i=0;i<definition.length;i++){const item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}}exports.default=LocationItemComponent},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(module,global){(function(){var undefined;var VERSION="3.5.0";var BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,REARG_FLAG=128,ARY_FLAG=256;var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...";var HOT_COUNT=150,HOT_SPAN=16;var LAZY_DROP_WHILE_FLAG=0,LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2;var FUNC_ERROR_TEXT="Expected a function";var PLACEHOLDER="__lodash_placeholder__";var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reUnescapedHtml=/[&<>"'`]/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reFuncName=/^\s*function[ \n\r\t]+\w/;var reHexPrefix=/^0[xX]/;var reHostCtor=/^\[object .+?Constructor\]$/;var reLatin1=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g;var reNoMatch=/($^)/;var reRegExpChars=/[.*+?^${}()|[\]\/\\]/g,reHasRegExpChars=RegExp(reRegExpChars.source);var reThis=/\bthis\b/;var reUnescapedString=/['\n\r\u2028\u2029\\]/g;var reWords=function(){var upper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",lower="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(upper+"+(?="+upper+lower+")|"+upper+"?"+lower+"|"+upper+"+|[0-9]+","g")}();var whitespace=" \t\v\f \ufeff"+"\n\r\u2028\u2029"+" ᠎             　";var contextProps=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window","WinRTError"];var templateCounter=-1;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[stringTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[mapTag]=cloneableTags[setTag]=cloneableTags[weakMapTag]=false;var debounceOptions={leading:false,maxWait:0,trailing:false};var deburredLetters={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"};var objectTypes={function:true,object:true};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module;var freeGlobal=freeExports&&freeModule&&typeof global=="object"&&global;var freeWindow=objectTypes[typeof window]&&window;var moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports;var root=freeGlobal||freeWindow!==(this&&this.window)&&freeWindow||this;function baseCompareAscending(value,other){if(value!==other){var valIsReflexive=value===value,othIsReflexive=other===other;if(value>other||!valIsReflexive||typeof value=="undefined"&&othIsReflexive){return 1}if(value<other||!othIsReflexive||typeof other=="undefined"&&valIsReflexive){return-1}}return 0}function baseIndexOf(array,value,fromIndex){if(value!==value){return indexOfNaN(array,fromIndex)}var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1;
}function baseIsFunction(value){return typeof value=="function"||false}function baseToString(value){if(typeof value=="string"){return value}return value==null?"":value+""}function charAtCallback(string){return string.charCodeAt(0)}function charsLeftIndex(string,chars){var index=-1,length=string.length;while(++index<length&&chars.indexOf(string.charAt(index))>-1){}return index}function charsRightIndex(string,chars){var index=string.length;while(index--&&chars.indexOf(string.charAt(index))>-1){}return index}function compareAscending(object,other){return baseCompareAscending(object.criteria,other.criteria)||object.index-other.index}function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=baseCompareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result}return result*(orders[index]?1:-1)}}return object.index-other.index}function deburrLetter(letter){return deburredLetters[letter]}function escapeHtmlChar(chr){return htmlEscapes[chr]}function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function indexOfNaN(array,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?0:-1);while(fromRight?index--:++index<length){var other=array[index];if(other!==other){return index}}return-1}function isObjectLike(value){return value&&typeof value=="object"||false}function isSpace(charCode){return charCode<=160&&(charCode>=9&&charCode<=13)||charCode==32||charCode==160||charCode==5760||charCode==6158||charCode>=8192&&(charCode<=8202||charCode==8232||charCode==8233||charCode==8239||charCode==8287||charCode==12288||charCode==65279)}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){if(array[index]===placeholder){array[index]=PLACEHOLDER;result[++resIndex]=index}}return result}function sortedUniq(array,iteratee){var seen,index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(!index||seen!==computed){seen=computed;result[++resIndex]=value}}return result}function trimmedLeftIndex(string){var index=-1,length=string.length;while(++index<length&&isSpace(string.charCodeAt(index))){}return index}function trimmedRightIndex(string){var index=string.length;while(index--&&isSpace(string.charCodeAt(index))){}return index}function unescapeHtmlChar(chr){return htmlUnescapes[chr]}function runInContext(context){context=context?_.defaults(root.Object(),context,_.pick(root,contextProps)):root;var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayProto=Array.prototype,objectProto=Object.prototype,stringProto=String.prototype;var document=(document=context.window)&&document.document;var fnToString=Function.prototype.toString;var getLength=baseProperty("length");var hasOwnProperty=objectProto.hasOwnProperty;var idCounter=0;var objToString=objectProto.toString;var oldDash=context._;var reNative=RegExp("^"+escapeRegExp(objToString).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ArrayBuffer=isNative(ArrayBuffer=context.ArrayBuffer)&&ArrayBuffer,bufferSlice=isNative(bufferSlice=ArrayBuffer&&new ArrayBuffer(0).slice)&&bufferSlice,ceil=Math.ceil,clearTimeout=context.clearTimeout,floor=Math.floor,getPrototypeOf=isNative(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf,push=arrayProto.push,propertyIsEnumerable=objectProto.propertyIsEnumerable,Set=isNative(Set=context.Set)&&Set,setTimeout=context.setTimeout,splice=arrayProto.splice,Uint8Array=isNative(Uint8Array=context.Uint8Array)&&Uint8Array,WeakMap=isNative(WeakMap=context.WeakMap)&&WeakMap;var Float64Array=function(){try{var func=isNative(func=context.Float64Array)&&func,result=new func(new ArrayBuffer(10),0,1)&&func}catch(e){}return result}();var nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeCreate=isNative(nativeCreate=Object.create)&&nativeCreate,nativeIsFinite=context.isFinite,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeNow=isNative(nativeNow=Date.now)&&nativeNow,nativeNumIsFinite=isNative(nativeNumIsFinite=Number.isFinite)&&nativeNumIsFinite,nativeParseInt=context.parseInt,nativeRandom=Math.random;var NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,POSITIVE_INFINITY=Number.POSITIVE_INFINITY;var MAX_ARRAY_LENGTH=Math.pow(2,32)-1,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;var FLOAT64_BYTES_PER_ELEMENT=Float64Array?Float64Array.BYTES_PER_ELEMENT:0;var MAX_SAFE_INTEGER=Math.pow(2,53)-1;var metaMap=WeakMap&&new WeakMap;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value}if(hasOwnProperty.call(value,"__chain__")&&hasOwnProperty.call(value,"__wrapped__")){return wrapperClone(value)}}return new LodashWrapper(value)}function baseLodash(){}function LodashWrapper(value,chainAll,actions){this.__wrapped__=value;this.__actions__=actions||[];this.__chain__=!!chainAll}var support=lodash.support={};(function(x){support.funcDecomp=!isNative(context.WinRTError)&&reThis.test(runInContext);support.funcNames=typeof Function.name=="string";try{support.dom=document.createDocumentFragment().nodeType===11}catch(e){support.dom=false}try{support.nonEnumArgs=!propertyIsEnumerable.call(arguments,1)}catch(e){support.nonEnumArgs=true}})(0,0);lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};function LazyWrapper(value){this.__wrapped__=value;this.__actions__=null;this.__dir__=1;this.__dropCount__=0;this.__filtered__=false;this.__iteratees__=null;this.__takeCount__=POSITIVE_INFINITY;this.__views__=null}function lazyClone(){var actions=this.__actions__,iteratees=this.__iteratees__,views=this.__views__,result=new LazyWrapper(this.__wrapped__);result.__actions__=actions?arrayCopy(actions):null;result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=iteratees?arrayCopy(iteratees):null;result.__takeCount__=this.__takeCount__;result.__views__=views?arrayCopy(views):null;return result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true}else{result=this.clone();result.__dir__*=-1}return result}function lazyValue(){var array=this.__wrapped__.value();if(!isArray(array)){return baseWrapperValue(array,this.__actions__)}var dir=this.__dir__,isRight=dir<0,view=getView(0,array.length,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,takeCount=nativeMin(length,this.__takeCount__),iteratees=this.__iteratees__,iterLength=iteratees?iteratees.length:0,resIndex=0,result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type;if(type==LAZY_DROP_WHILE_FLAG){if(data.done&&(isRight?index>data.index:index<data.index)){data.count=0;data.done=false}data.index=index;if(!data.done){var limit=data.limit;if(!(data.done=limit>-1?data.count++>=limit:!iteratee(value))){continue outer}}}else{var computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer}else{break outer}}}}result[resIndex++]=value}return result}function MapCache(){this.__data__={}}function mapDelete(key){return this.has(key)&&delete this.__data__[key]}function mapGet(key){return key=="__proto__"?undefined:this.__data__[key]}function mapHas(key){return key!="__proto__"&&hasOwnProperty.call(this.__data__,key)}function mapSet(key,value){if(key!="__proto__"){this.__data__[key]=value}return this}function SetCache(values){var length=values?values.length:0;this.data={hash:nativeCreate(null),set:new Set};while(length--){this.push(values[length])}}function cacheIndexOf(cache,value){var data=cache.data,result=typeof value=="string"||isObject(value)?data.set.has(value):data.hash[value];return result?0:-1}function cachePush(value){var data=this.data;if(typeof value=="string"||isObject(value)){data.set.add(value)}else{data.hash[value]=true}}function arrayCopy(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayEachRight(array,iteratee){var length=array.length;while(length--){if(iteratee(array[length],length,array)===false){break}}return array}function arrayEvery(array,predicate){var index=-1,length=array.length;while(++index<length){if(!predicate(array[index],index,array)){return false}}return true}function arrayFilter(array,predicate){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[++resIndex]=value}}return result}function arrayMap(array,iteratee){var index=-1,length=array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function arrayMax(array){var index=-1,length=array.length,result=NEGATIVE_INFINITY;while(++index<length){var value=array[index];if(value>result){result=value}}return result}function arrayMin(array){var index=-1,length=array.length,result=POSITIVE_INFINITY;while(++index<length){var value=array[index];if(value<result){result=value}}return result}function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;if(initFromArray&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function arrayReduceRight(array,iteratee,accumulator,initFromArray){var length=array.length;if(initFromArray&&length){accumulator=array[--length]}while(length--){accumulator=iteratee(accumulator,array[length],length,array)}return accumulator}function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function assignDefaults(objectValue,sourceValue){return typeof objectValue=="undefined"?sourceValue:objectValue}function assignOwnDefaults(objectValue,sourceValue,key,object){return typeof objectValue=="undefined"||!hasOwnProperty.call(object,key)?sourceValue:objectValue}function baseAssign(object,source,customizer){var props=keys(source);if(!customizer){return baseCopy(source,object,props)}var index=-1,length=props.length;while(++index<length){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);if((result===result?result!==value:value===value)||typeof value=="undefined"&&!(key in object)){object[key]=result}}return object}function baseAt(collection,props){var index=-1,length=collection.length,isArr=isLength(length),propsLength=props.length,result=Array(propsLength);while(++index<propsLength){var key=props[index];if(isArr){key=parseFloat(key);result[index]=isIndex(key,length)?collection[key]:undefined}else{result[index]=collection[key]}}return result}function baseCopy(source,object,props){if(!props){props=object;object={}}var index=-1,length=props.length;while(++index<length){var key=props[index];object[key]=source[key]}return object}function baseBindAll(object,methodNames){var index=-1,length=methodNames.length;while(++index<length){var key=methodNames[index];object[key]=createWrapper(object[key],BIND_FLAG,object)}return object}function baseCallback(func,thisArg,argCount){var type=typeof func;if(type=="function"){return typeof thisArg!="undefined"&&isBindable(func)?bindCallback(func,thisArg,argCount):func}if(func==null){return identity}if(type=="object"){return baseMatches(func)}return typeof thisArg=="undefined"?baseProperty(func+""):baseMatchesProperty(func+"",thisArg)}function baseClone(value,isDeep,customizer,key,object,stackA,stackB){var result;if(customizer){result=object?customizer(value,key,object):customizer(value)}if(typeof result!="undefined"){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return arrayCopy(value,result)}}else{var tag=objToString.call(value),isFunc=tag==funcTag;if(tag==objectTag||tag==argsTag||isFunc&&!object){result=initCloneObject(isFunc?{}:value);if(!isDeep){return baseCopy(value,result,keys(value))}}else{return cloneableTags[tag]?initCloneByTag(value,tag,isDeep):object?value:{}}}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==value){return stackB[length]}}stackA.push(value);stackB.push(result);(isArr?arrayEach:baseForOwn)(value,function(subValue,key){result[key]=baseClone(subValue,isDeep,customizer,key,value,stackA,stackB)});return result}var baseCreate=function(){function Object(){}return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null}return result||context.Object()}}();function baseDelay(func,wait,args,fromIndex){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return setTimeout(function(){func.apply(undefined,baseSlice(args,fromIndex))},wait)}function baseDifference(array,values){var length=array?array.length:0,result=[];if(!length){return result}var index=-1,indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf,cache=isCommon&&values.length>=200?createCache(values):null,valuesLength=values.length;if(cache){indexOf=cacheIndexOf;isCommon=false;values=cache}outer:while(++index<length){var value=array[index];if(isCommon&&value===value){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===value){continue outer}}result.push(value)}else if(indexOf(values,value,0)<0){result.push(value)}}return result}function baseEach(collection,iteratee){var length=collection?collection.length:0;if(!isLength(length)){return baseForOwn(collection,iteratee)}var index=-1,iterable=toObject(collection);while(++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}function baseEachRight(collection,iteratee){var length=collection?collection.length:0;if(!isLength(length)){return baseForOwnRight(collection,iteratee)}var iterable=toObject(collection);while(length--){if(iteratee(iterable[length],length,iterable)===false){break}}return collection}function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result});return result}function baseFill(array,value,start,end){var length=array.length;start=start==null?0:+start||0;if(start<0){start=-start>length?0:length+start}end=typeof end=="undefined"||end>length?length:+end||0;if(end<0){end+=length}length=start>end?0:end>>>0;start>>>=0;while(start<length){array[start++]=value}return array}function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}function baseFind(collection,predicate,eachFunc,retKey){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=retKey?key:value;return false}});return result}function baseFlatten(array,isDeep,isStrict,fromIndex){var index=fromIndex-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(isObjectLike(value)&&isLength(value.length)&&(isArray(value)||isArguments(value))){if(isDeep){value=baseFlatten(value,isDeep,isStrict,0)}var valIndex=-1,valLength=value.length;result.length+=valLength;while(++valIndex<valLength){result[++resIndex]=value[valIndex]}}else if(!isStrict){result[++resIndex]=value}}return result}function baseFor(object,iteratee,keysFunc){var index=-1,iterable=toObject(object),props=keysFunc(object),length=props.length;while(++index<length){var key=props[index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}function baseForRight(object,iteratee,keysFunc){var iterable=toObject(object),props=keysFunc(object),length=props.length;while(length--){var key=props[length];if(iteratee(iterable[key],key,iterable)===false){break}}return object}function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn)}function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return baseForRight(object,iteratee,keys)}function baseFunctions(object,props){var index=-1,length=props.length,resIndex=-1,result=[];while(++index<length){var key=props[index];if(isFunction(object[key])){result[++resIndex]=key}}return result}function baseInvoke(collection,methodName,args){var index=-1,isFunc=typeof methodName=="function",length=collection?collection.length:0,result=isLength(length)?Array(length):[];baseEach(collection,function(value){var func=isFunc?methodName:value!=null&&value[methodName];result[++index]=func?func.apply(value,args):undefined});return result}function baseIsEqual(value,other,customizer,isWhere,stackA,stackB){if(value===other){return value!==0||1/value==1/other}var valType=typeof value,othType=typeof other;if(valType!="function"&&valType!="object"&&othType!="function"&&othType!="object"||value==null||other==null){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,customizer,isWhere,stackA,stackB)}function baseIsEqualDeep(object,other,equalFunc,customizer,isWhere,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=objToString.call(object);if(objTag==argsTag){objTag=objectTag}else if(objTag!=objectTag){objIsArr=isTypedArray(object)}}if(!othIsArr){othTag=objToString.call(other);if(othTag==argsTag){othTag=objectTag}else if(othTag!=objectTag){othIsArr=isTypedArray(other)}}var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!(objIsArr||objIsObj)){return equalByTag(object,other,objTag)}var valWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(valWrapped||othWrapped){return equalFunc(valWrapped?object.value():object,othWrapped?other.value():other,customizer,isWhere,stackA,stackB)}if(!isSameTag){return false}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==object){return stackB[length]==other}}stackA.push(object);stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isWhere,stackA,stackB);stackA.pop();stackB.pop();return result}function baseIsMatch(object,props,values,strictCompareFlags,customizer){var length=props.length;if(object==null){return!length}var index=-1,noCustomizer=!customizer;while(++index<length){if(noCustomizer&&strictCompareFlags[index]?values[index]!==object[props[index]]:!hasOwnProperty.call(object,props[index])){return false}}index=-1;while(++index<length){var key=props[index];if(noCustomizer&&strictCompareFlags[index]){var result=hasOwnProperty.call(object,key)}else{var objValue=object[key],srcValue=values[index];result=customizer?customizer(objValue,srcValue,key):undefined;if(typeof result=="undefined"){result=baseIsEqual(srcValue,objValue,customizer,true)}}if(!result){return false}}return true}function baseMap(collection,iteratee){var result=[];baseEach(collection,function(value,key,collection){result.push(iteratee(value,key,collection))});return result}function baseMatches(source){var props=keys(source),length=props.length;if(length==1){var key=props[0],value=source[key];if(isStrictComparable(value)){return function(object){return object!=null&&object[key]===value&&hasOwnProperty.call(object,key)}}}var values=Array(length),strictCompareFlags=Array(length);while(length--){value=source[props[length]];values[length]=value;strictCompareFlags[length]=isStrictComparable(value)}return function(object){return baseIsMatch(object,props,values,strictCompareFlags)}}function baseMatchesProperty(key,value){if(isStrictComparable(value)){return function(object){return object!=null&&object[key]===value}}return function(object){return object!=null&&baseIsEqual(value,object[key],null,true)}}function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object)){return object}var isSrcArr=isLength(source.length)&&(isArray(source)||isTypedArray(source));(isSrcArr?arrayEach:baseForOwn)(source,function(srcValue,key,source){if(isObjectLike(srcValue)){stackA||(stackA=[]);stackB||(stackB=[]);return baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB)}var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=typeof result=="undefined";if(isCommon){result=srcValue}if((isSrcArr||typeof result!="undefined")&&(isCommon||(result===result?result!==value:value===value))){object[key]=result}});return object}function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){var length=stackA.length,srcValue=source[key];while(length--){if(stackA[length]==srcValue){object[key]=stackB[length];return}}var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=typeof result=="undefined";if(isCommon){result=srcValue;if(isLength(srcValue.length)&&(isArray(srcValue)||isTypedArray(srcValue))){result=isArray(value)?value:value?arrayCopy(value):[]}else if(isPlainObject(srcValue)||isArguments(srcValue)){result=isArguments(value)?toPlainObject(value):isPlainObject(value)?value:{}}else{isCommon=false}}stackA.push(srcValue);stackB.push(result);if(isCommon){object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB)}else if(result===result?result!==value:value===value){object[key]=result}}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePullAt(array,indexes){var length=indexes.length,result=baseAt(array,indexes);indexes.sort(baseCompareAscending);while(length--){var index=parseFloat(indexes[length]);if(index!=previous&&isIndex(index)){var previous=index;splice.call(array,index,1)}}return result}function baseRandom(min,max){return min+floor(nativeRandom()*(max-min+1))}function baseReduce(collection,iteratee,accumulator,initFromCollection,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initFromCollection?(initFromCollection=false,value):iteratee(accumulator,value,index,collection)});return accumulator}var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func};function baseSlice(array,start,end){var index=-1,length=array.length;start=start==null?0:+start||0;if(start<0){start=-start>length?0:length+start}end=typeof end=="undefined"||end>length?length:+end||0;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result});return!!result}function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value}return array}function baseSortByOrder(collection,props,orders){var index=-1,length=collection.length,result=isLength(length)?Array(length):[];baseEach(collection,function(value){var length=props.length,criteria=Array(length);while(length--){criteria[length]=value==null?undefined:value[props[length]]}result[++index]={criteria:criteria,index:index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function baseUniq(array,iteratee){var index=-1,indexOf=getIndexOf(),length=array.length,isCommon=indexOf==baseIndexOf,isLarge=isCommon&&length>=200,seen=isLarge?createCache():null,result=[];if(seen){indexOf=cacheIndexOf;isCommon=false}else{isLarge=false;seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(isCommon&&value===value){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(indexOf(seen,computed,0)<0){if(iteratee||isLarge){seen.push(computed)}result.push(value)}}return result}function baseValues(object,props){var index=-1,length=props.length,result=Array(length);while(++index<length){result[index]=object[props[index]]}return result}function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value()}var index=-1,length=actions.length;while(++index<length){var args=[result],action=actions[index];push.apply(args,action.args);result=action.func.apply(action.thisArg,args)}return result}function binaryIndex(array,value,retHighest){var low=0,high=array?array.length:low;if(typeof value=="number"&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];if(retHighest?computed<=value:computed<value){low=mid+1}else{high=mid}}return high}return binaryIndexBy(array,value,identity,retHighest)}function binaryIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=array?array.length:0,valIsNaN=value!==value,valIsUndef=typeof value=="undefined";while(low<high){var mid=floor((low+high)/2),computed=iteratee(array[mid]),isReflexive=computed===computed;if(valIsNaN){var setLow=isReflexive||retHighest}else if(valIsUndef){setLow=isReflexive&&(retHighest||typeof computed!="undefined")}else{setLow=retHighest?computed<=value:computed<value}if(setLow){low=mid+1}else{high=mid}}return nativeMin(high,MAX_ARRAY_INDEX)}function bindCallback(func,thisArg,argCount){if(typeof func!="function"){return identity}if(typeof thisArg=="undefined"){return func}switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function bufferClone(buffer){return bufferSlice.call(buffer,0)}if(!bufferSlice){bufferClone=!(ArrayBuffer&&Uint8Array)?constant(null):function(buffer){var byteLength=buffer.byteLength,floatLength=Float64Array?floor(byteLength/FLOAT64_BYTES_PER_ELEMENT):0,offset=floatLength*FLOAT64_BYTES_PER_ELEMENT,result=new ArrayBuffer(byteLength);if(floatLength){var view=new Float64Array(result,0,floatLength);view.set(new Float64Array(buffer,0,floatLength))}if(byteLength!=offset){view=new Uint8Array(result,offset);view.set(new Uint8Array(buffer,offset))}return result}}function composeArgs(args,partials,holders){var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(argsLength+leftLength);while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex]}while(++argsIndex<holdersLength){result[holders[argsIndex]]=args[argsIndex]}while(argsLength--){result[leftIndex++]=args[argsIndex++]}return result}function composeArgsRight(args,partials,holders){var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);while(++argsIndex<argsLength){result[argsIndex]=args[argsIndex]}var pad=argsIndex;while(++rightIndex<rightLength){result[pad+rightIndex]=partials[rightIndex]}while(++holdersIndex<holdersLength){result[pad+holders[holdersIndex]]=args[argsIndex++]}return result}function createAggregator(setter,initializer){return function(collection,iteratee,thisArg){var result=initializer?initializer():{};iteratee=getCallback(iteratee,thisArg,3);if(isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];setter(result,value,iteratee(value,index,collection),collection)}}else{baseEach(collection,function(value,key,collection){setter(result,value,iteratee(value,key,collection),collection)})}return result}}function createAssigner(assigner){return function(){var args=arguments,length=args.length,object=args[0];if(length<2||object==null){return object}var customizer=args[length-2],thisArg=args[length-1],guard=args[3];if(length>3&&typeof customizer=="function"){customizer=bindCallback(customizer,thisArg,5);length-=2}else{customizer=length>2&&typeof thisArg=="function"?thisArg:null;length-=customizer?1:0}if(guard&&isIterateeCall(args[1],args[2],guard)){customizer=length==3?null:customizer;length=2}var index=0;while(++index<length){var source=args[index];if(source){assigner(object,source,customizer)}}return object}}function createBindWrapper(func,thisArg){var Ctor=createCtorWrapper(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(thisArg,arguments)}return wrapper}var createCache=!(nativeCreate&&Set)?constant(null):function(values){return new SetCache(values)};function createComposer(fromRight){return function(){var length=arguments.length,index=length,fromIndex=fromRight?length-1:0;if(!length){return function(){return arguments[0]}}var funcs=Array(length);while(index--){funcs[index]=arguments[index];if(typeof funcs[index]!="function"){throw new TypeError(FUNC_ERROR_TEXT)}}return function(){var index=fromIndex,result=funcs[index].apply(this,arguments);while(fromRight?index--:++index<length){result=funcs[index].call(this,result)}return result}}}function createCompounder(callback){return function(string){var index=-1,array=words(deburr(string)),length=array.length,result="";while(++index<length){result=callback(result,array[index],index)}return result}}function createCtorWrapper(Ctor){return function(){var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,arguments);return isObject(result)?result:thisBinding}}function createExtremum(arrayFunc,isMin){return function(collection,iteratee,thisArg){if(thisArg&&isIterateeCall(collection,iteratee,thisArg)){iteratee=null}var func=getCallback(),noIteratee=iteratee==null;if(!(func===baseCallback&&noIteratee)){noIteratee=false;iteratee=func(iteratee,thisArg,3)}if(noIteratee){var isArr=isArray(collection);if(!isArr&&isString(collection)){iteratee=charAtCallback}else{return arrayFunc(isArr?collection:toIterable(collection))}}return extremumBy(collection,iteratee,isMin)}}function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryBound=bitmask&CURRY_BOUND_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG;var Ctor=!isBindKey&&createCtorWrapper(func),key=func;function wrapper(){var length=arguments.length,index=length,args=Array(length);while(index--){args[index]=arguments[index]}if(partials){args=composeArgs(args,partials,holders)}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight)}if(isCurry||isCurryRight){var placeholder=wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);length-=argsHolders.length;if(length<arity){var newArgPos=argPos?arrayCopy(argPos):null,newArity=nativeMax(arity-length,0),newsHolders=isCurry?argsHolders:null,newHoldersRight=isCurry?null:argsHolders,newPartials=isCurry?args:null,newPartialsRight=isCurry?null:args;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG);if(!isCurryBound){bitmask&=~(BIND_FLAG|BIND_KEY_FLAG);
}var result=createHybridWrapper(func,bitmask,thisArg,newPartials,newsHolders,newPartialsRight,newHoldersRight,newArgPos,ary,newArity);result.placeholder=placeholder;return result}}var thisBinding=isBind?thisArg:this;if(isBindKey){func=thisBinding[key]}if(argPos){args=reorder(args,argPos)}if(isAry&&ary<args.length){args.length=ary}var fn=this&&this!==root&&this instanceof wrapper?Ctor||createCtorWrapper(func):func;return fn.apply(thisBinding,args)}return wrapper}function createPad(string,length,chars){var strLength=string.length;length=+length;if(strLength>=length||!nativeIsFinite(length)){return""}var padLength=length-strLength;chars=chars==null?" ":chars+"";return repeat(chars,ceil(padLength/chars.length)).slice(0,padLength)}function createPartialWrapper(func,bitmask,thisArg,partials){var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(argsLength+leftLength);while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex]}while(argsLength--){args[leftIndex++]=arguments[++argsIndex]}var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,args)}return wrapper}function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var length=partials?partials.length:0;if(!length){bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG);partials=holders=null}length-=holders?holders.length:0;if(bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=null}var data=!isBindKey&&getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&data!==true){mergeData(newData,data);bitmask=newData[1];arity=newData[9]}newData[9]=arity==null?isBindKey?0:func.length:nativeMax(arity-length,0)||0;if(bitmask==BIND_FLAG){var result=createBindWrapper(newData[0],newData[2])}else if((bitmask==PARTIAL_FLAG||bitmask==(BIND_FLAG|PARTIAL_FLAG))&&!newData[4].length){result=createPartialWrapper.apply(undefined,newData)}else{result=createHybridWrapper.apply(undefined,newData)}var setter=data?baseSetData:setData;return setter(result,newData)}function equalArrays(array,other,equalFunc,customizer,isWhere,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length,result=true;if(arrLength!=othLength&&!(isWhere&&othLength>arrLength)){return false}while(result&&++index<arrLength){var arrValue=array[index],othValue=other[index];result=undefined;if(customizer){result=isWhere?customizer(othValue,arrValue,index):customizer(arrValue,othValue,index)}if(typeof result=="undefined"){if(isWhere){var othIndex=othLength;while(othIndex--){othValue=other[othIndex];result=arrValue&&arrValue===othValue||equalFunc(arrValue,othValue,customizer,isWhere,stackA,stackB);if(result){break}}}else{result=arrValue&&arrValue===othValue||equalFunc(arrValue,othValue,customizer,isWhere,stackA,stackB)}}}return!!result}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==0?1/object==1/other:object==+other;case regexpTag:case stringTag:return object==other+""}return false}function equalObjects(object,other,equalFunc,customizer,isWhere,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isWhere){return false}var hasCtor,index=-1;while(++index<objLength){var key=objProps[index],result=hasOwnProperty.call(other,key);if(result){var objValue=object[key],othValue=other[key];result=undefined;if(customizer){result=isWhere?customizer(othValue,objValue,key):customizer(objValue,othValue,key)}if(typeof result=="undefined"){result=objValue&&objValue===othValue||equalFunc(objValue,othValue,customizer,isWhere,stackA,stackB)}}if(!result){return false}hasCtor||(hasCtor=key=="constructor")}if(!hasCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){return false}}return true}function extremumBy(collection,iteratee,isMin){var exValue=isMin?POSITIVE_INFINITY:NEGATIVE_INFINITY,computed=exValue,result=computed;baseEach(collection,function(value,index,collection){var current=iteratee(value,index,collection);if((isMin?current<computed:current>computed)||current===exValue&&current===result){computed=current;result=value}});return result}function getCallback(func,thisArg,argCount){var result=lodash.callback||callback;result=result===callback?baseCallback:result;return argCount?result(func,thisArg,argCount):result}var getData=!metaMap?noop:function(func){return metaMap.get(func)};function getIndexOf(collection,target,fromIndex){var result=lodash.indexOf||indexOf;result=result===indexOf?baseIndexOf:result;return collection?result(collection,target,fromIndex):result}function getView(start,end,transforms){var index=-1,length=transforms?transforms.length:0;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size);break}}return{start:start,end:end}}function initCloneArray(array){var length=array.length,result=new array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){var Ctor=object.constructor;if(!(typeof Ctor=="function"&&Ctor instanceof Ctor)){Ctor=Object}return new Ctor}function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return bufferClone(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:var buffer=object.buffer;return new Ctor(isDeep?bufferClone(buffer):buffer,object.byteOffset,object.length);case numberTag:case stringTag:return new Ctor(object);case regexpTag:var result=new Ctor(object.source,reFlags.exec(object));result.lastIndex=object.lastIndex}return result}function isBindable(func){var support=lodash.support,result=!(support.funcNames?func.name:support.funcDecomp);if(!result){var source=fnToString.call(func);if(!support.funcNames){result=!reFuncName.test(source)}if(!result){result=reThis.test(source)||isNative(func);baseSetData(func,result)}}return result}function isIndex(value,length){value=+value;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"){var length=object.length,prereq=isLength(length)&&isIndex(index,length)}else{prereq=type=="string"&&index in object}if(prereq){var other=object[index];return value===value?value===other:other!==other}return false}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isStrictComparable(value){return value===value&&(value===0?1/value>0:!isObject(value))}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask;var arityFlags=ARY_FLAG|REARG_FLAG,bindFlags=BIND_FLAG|BIND_KEY_FLAG,comboFlags=arityFlags|bindFlags|CURRY_BOUND_FLAG|CURRY_RIGHT_FLAG;var isAry=bitmask&ARY_FLAG&&!(srcBitmask&ARY_FLAG),isRearg=bitmask&REARG_FLAG&&!(srcBitmask&REARG_FLAG),argPos=(isRearg?data:source)[7],ary=(isAry?data:source)[8];var isCommon=!(bitmask>=REARG_FLAG&&srcBitmask>bindFlags)&&!(bitmask>bindFlags&&srcBitmask>=REARG_FLAG);var isCombo=newBitmask>=arityFlags&&newBitmask<=comboFlags&&(bitmask<REARG_FLAG||(isRearg||isAry)&&argPos.length<=ary);if(!(isCommon||isCombo)){return data}if(srcBitmask&BIND_FLAG){data[2]=source[2];newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG}var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):arrayCopy(value);data[4]=partials?replaceHolders(data[3],PLACEHOLDER):arrayCopy(source[4])}value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):arrayCopy(value);data[6]=partials?replaceHolders(data[5],PLACEHOLDER):arrayCopy(source[6])}value=source[7];if(value){data[7]=arrayCopy(value)}if(srcBitmask&ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8])}if(data[9]==null){data[9]=source[9]}data[0]=source[0];data[1]=newBitmask;return data}function pickByArray(object,props){object=toObject(object);var index=-1,length=props.length,result={};while(++index<length){var key=props[index];if(key in object){result[key]=object[key]}}return result}function pickByCallback(object,predicate){var result={};baseForIn(object,function(value,key,object){if(predicate(value,key,object)){result[key]=value}});return result}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=arrayCopy(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}var setData=function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return key}}else{count=0}return baseSetData(key,value)}}();function shimIsPlainObject(value){var Ctor,support=lodash.support;if(!(isObjectLike(value)&&objToString.call(value)==objectTag)||!hasOwnProperty.call(value,"constructor")&&(Ctor=value.constructor,typeof Ctor=="function"&&!(Ctor instanceof Ctor))){return false}var result;baseForIn(value,function(subValue,key){result=key});return typeof result=="undefined"||hasOwnProperty.call(value,result)}function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length,support=lodash.support;var allowIndexes=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key)){result.push(key)}}return result}function toIterable(value){if(value==null){return[]}if(!isLength(value.length)){return values(value)}return isObject(value)?value:Object(value)}function toObject(value){return isObject(value)?value:Object(value)}function wrapperClone(wrapper){return wrapper instanceof LazyWrapper?wrapper.clone():new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__,arrayCopy(wrapper.__actions__))}function chunk(array,size,guard){if(guard?isIterateeCall(array,size,guard):size==null){size=1}else{size=nativeMax(+size||1,1)}var index=0,length=array?array.length:0,resIndex=-1,result=Array(ceil(length/size));while(index<length){result[++resIndex]=baseSlice(array,index,index+=size)}return result}function compact(array){var index=-1,length=array?array.length:0,resIndex=-1,result=[];while(++index<length){var value=array[index];if(value){result[++resIndex]=value}}return result}function difference(){var args=arguments,index=-1,length=args.length;while(++index<length){var value=args[index];if(isArray(value)||isArguments(value)){break}}return baseDifference(value,baseFlatten(args,false,true,++index))}function drop(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}return baseSlice(array,n<0?0:n)}function dropRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}n=length-(+n||0);return baseSlice(array,0,n<0?0:n)}function dropRightWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}predicate=getCallback(predicate,thisArg,3);while(length--&&predicate(array[length],length,array)){}return baseSlice(array,0,length+1)}function dropWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}var index=-1;predicate=getCallback(predicate,thisArg,3);while(++index<length&&predicate(array[index],index,array)){}return baseSlice(array,index)}function fill(array,value,start,end){var length=array?array.length:0;if(!length){return[]}if(start&&typeof start!="number"&&isIterateeCall(array,value,start)){start=0;end=length}return baseFill(array,value,start,end)}function findIndex(array,predicate,thisArg){var index=-1,length=array?array.length:0;predicate=getCallback(predicate,thisArg,3);while(++index<length){if(predicate(array[index],index,array)){return index}}return-1}function findLastIndex(array,predicate,thisArg){var length=array?array.length:0;predicate=getCallback(predicate,thisArg,3);while(length--){if(predicate(array[length],length,array)){return length}}return-1}function first(array){return array?array[0]:undefined}function flatten(array,isDeep,guard){var length=array?array.length:0;if(guard&&isIterateeCall(array,isDeep,guard)){isDeep=false}return length?baseFlatten(array,isDeep,false,0):[]}function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,true,false,0):[]}function indexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}if(typeof fromIndex=="number"){fromIndex=fromIndex<0?nativeMax(length+fromIndex,0):fromIndex}else if(fromIndex){var index=binaryIndex(array,value),other=array[index];if(value===value?value===other:other!==other){return index}return-1}return baseIndexOf(array,value,fromIndex||0)}function initial(array){return dropRight(array,1)}function intersection(){var args=[],argsIndex=-1,argsLength=arguments.length,caches=[],indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf;while(++argsIndex<argsLength){var value=arguments[argsIndex];if(isArray(value)||isArguments(value)){args.push(value);caches.push(isCommon&&value.length>=120?createCache(argsIndex&&value):null)}}argsLength=args.length;var array=args[0],index=-1,length=array?array.length:0,result=[],seen=caches[0];outer:while(++index<length){value=array[index];if((seen?cacheIndexOf(seen,value):indexOf(result,value,0))<0){argsIndex=argsLength;while(--argsIndex){var cache=caches[argsIndex];if((cache?cacheIndexOf(cache,value):indexOf(args[argsIndex],value,0))<0){continue outer}}if(seen){seen.push(value)}result.push(value)}}return result}function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=length;if(typeof fromIndex=="number"){index=(fromIndex<0?nativeMax(length+fromIndex,0):nativeMin(fromIndex||0,length-1))+1}else if(fromIndex){index=binaryIndex(array,value,true)-1;var other=array[index];if(value===value?value===other:other!==other){return index}return-1}if(value!==value){return indexOfNaN(array,index,true)}while(index--){if(array[index]===value){return index}}return-1}function pull(){var args=arguments,array=args[0];if(!(array&&array.length)){return array}var index=0,indexOf=getIndexOf(),length=args.length;while(++index<length){var fromIndex=0,value=args[index];while((fromIndex=indexOf(array,value,fromIndex))>-1){splice.call(array,fromIndex,1)}}return array}function pullAt(array){return basePullAt(array||[],baseFlatten(arguments,false,false,1))}function remove(array,predicate,thisArg){var index=-1,length=array?array.length:0,result=[];predicate=getCallback(predicate,thisArg,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);splice.call(array,index--,1);length--}}return result}function rest(array){return drop(array,1)}function slice(array,start,end){var length=array?array.length:0;if(!length){return[]}if(end&&typeof end!="number"&&isIterateeCall(array,start,end)){start=0;end=length}return baseSlice(array,start,end)}function sortedIndex(array,value,iteratee,thisArg){var func=getCallback(iteratee);return func===baseCallback&&iteratee==null?binaryIndex(array,value):binaryIndexBy(array,value,func(iteratee,thisArg,1))}function sortedLastIndex(array,value,iteratee,thisArg){var func=getCallback(iteratee);return func===baseCallback&&iteratee==null?binaryIndex(array,value,true):binaryIndexBy(array,value,func(iteratee,thisArg,1),true)}function take(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}return baseSlice(array,0,n<0?0:n)}function takeRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}n=length-(+n||0);return baseSlice(array,n<0?0:n)}function takeRightWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}predicate=getCallback(predicate,thisArg,3);while(length--&&predicate(array[length],length,array)){}return baseSlice(array,length+1)}function takeWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}var index=-1;predicate=getCallback(predicate,thisArg,3);while(++index<length&&predicate(array[index],index,array)){}return baseSlice(array,0,index)}function union(){return baseUniq(baseFlatten(arguments,false,true,0))}function uniq(array,isSorted,iteratee,thisArg){var length=array?array.length:0;if(!length){return[]}if(isSorted!=null&&typeof isSorted!="boolean"){thisArg=iteratee;iteratee=isIterateeCall(array,isSorted,thisArg)?null:isSorted;isSorted=false}var func=getCallback();if(!(func===baseCallback&&iteratee==null)){iteratee=func(iteratee,thisArg,3)}return isSorted&&getIndexOf()==baseIndexOf?sortedUniq(array,iteratee):baseUniq(array,iteratee)}function unzip(array){var index=-1,length=(array&&array.length&&arrayMax(arrayMap(array,getLength)))>>>0,result=Array(length);while(++index<length){result[index]=arrayMap(array,baseProperty(index))}return result}function without(array){return baseDifference(array,baseSlice(arguments,1))}function xor(){var index=-1,length=arguments.length;while(++index<length){var array=arguments[index];if(isArray(array)||isArguments(array)){var result=result?baseDifference(result,array).concat(baseDifference(array,result)):array}}return result?baseUniq(result):[]}function zip(){var length=arguments.length,array=Array(length);while(length--){array[length]=arguments[length]}return unzip(array)}function zipObject(props,values){var index=-1,length=props?props.length:0,result={};if(length&&!values&&!isArray(props[0])){values=[]}while(++index<length){var key=props[index];if(values){result[key]=values[index]}else if(key){result[key[0]]=key[1]}}return result}function chain(value){var result=lodash(value);result.__chain__=true;return result}function tap(value,interceptor,thisArg){interceptor.call(thisArg,value);return value}function thru(value,interceptor,thisArg){return interceptor.call(thisArg,value)}function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);if(result){previous.__wrapped__=clone}else{result=clone}var previous=clone;parent=parent.__wrapped__}previous.__wrapped__=value;return result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){if(this.__actions__.length){value=new LazyWrapper(this)}return new LodashWrapper(value.reverse(),this.__chain__)}return this.thru(function(value){return value.reverse()})}function wrapperToString(){return this.value()+""}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}function at(collection){var length=collection?collection.length:0;if(isLength(length)){collection=toIterable(collection)}return baseAt(collection,baseFlatten(arguments,false,false,1))}var countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:result[key]=1});function every(collection,predicate,thisArg){var func=isArray(collection)?arrayEvery:baseEvery;if(typeof predicate!="function"||typeof thisArg!="undefined"){predicate=getCallback(predicate,thisArg,3)}return func(collection,predicate)}function filter(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=getCallback(predicate,thisArg,3);return func(collection,predicate)}function find(collection,predicate,thisArg){if(isArray(collection)){var index=findIndex(collection,predicate,thisArg);return index>-1?collection[index]:undefined}predicate=getCallback(predicate,thisArg,3);return baseFind(collection,predicate,baseEach)}function findLast(collection,predicate,thisArg){predicate=getCallback(predicate,thisArg,3);return baseFind(collection,predicate,baseEachRight)}function findWhere(collection,source){return find(collection,baseMatches(source))}function forEach(collection,iteratee,thisArg){return typeof iteratee=="function"&&typeof thisArg=="undefined"&&isArray(collection)?arrayEach(collection,iteratee):baseEach(collection,bindCallback(iteratee,thisArg,3))}function forEachRight(collection,iteratee,thisArg){return typeof iteratee=="function"&&typeof thisArg=="undefined"&&isArray(collection)?arrayEachRight(collection,iteratee):baseEachRight(collection,bindCallback(iteratee,thisArg,3))}var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value)}else{result[key]=[value]}});function includes(collection,target,fromIndex){var length=collection?collection.length:0;if(!isLength(length)){collection=values(collection);length=collection.length}if(!length){return false}if(typeof fromIndex=="number"){fromIndex=fromIndex<0?nativeMax(length+fromIndex,0):fromIndex||0}else{fromIndex=0}return typeof collection=="string"||!isArray(collection)&&isString(collection)?fromIndex<length&&collection.indexOf(target,fromIndex)>-1:getIndexOf(collection,target,fromIndex)>-1}var indexBy=createAggregator(function(result,value,key){result[key]=value});function invoke(collection,methodName){return baseInvoke(collection,methodName,baseSlice(arguments,2))}function map(collection,iteratee,thisArg){var func=isArray(collection)?arrayMap:baseMap;iteratee=getCallback(iteratee,thisArg,3);return func(collection,iteratee)}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});function pluck(collection,key){return map(collection,baseProperty(key))}function reduce(collection,iteratee,accumulator,thisArg){var func=isArray(collection)?arrayReduce:baseReduce;return func(collection,getCallback(iteratee,thisArg,4),accumulator,arguments.length<3,baseEach)}function reduceRight(collection,iteratee,accumulator,thisArg){var func=isArray(collection)?arrayReduceRight:baseReduce;return func(collection,getCallback(iteratee,thisArg,4),accumulator,arguments.length<3,baseEachRight)}function reject(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=getCallback(predicate,thisArg,3);return func(collection,function(value,index,collection){return!predicate(value,index,collection)})}function sample(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):n==null){collection=toIterable(collection);var length=collection.length;return length>0?collection[baseRandom(0,length-1)]:undefined}var result=shuffle(collection);result.length=nativeMin(n<0?0:+n||0,result.length);return result}function shuffle(collection){collection=toIterable(collection);var index=-1,length=collection.length,result=Array(length);while(++index<length){var rand=baseRandom(0,index);if(index!=rand){result[index]=result[rand]}result[rand]=collection[index]}return result}function size(collection){var length=collection?collection.length:0;return isLength(length)?length:keys(collection).length}function some(collection,predicate,thisArg){var func=isArray(collection)?arraySome:baseSome;if(typeof predicate!="function"||typeof thisArg!="undefined"){predicate=getCallback(predicate,thisArg,3)}return func(collection,predicate)}function sortBy(collection,iteratee,thisArg){if(collection==null){return[]}var index=-1,length=collection.length,result=isLength(length)?Array(length):[];if(thisArg&&isIterateeCall(collection,iteratee,thisArg)){iteratee=null}iteratee=getCallback(iteratee,thisArg,3);baseEach(collection,function(value,key,collection){result[++index]={criteria:iteratee(value,key,collection),index:index,value:value}});return baseSortBy(result,compareAscending)}function sortByAll(collection){if(collection==null){return[]}var args=arguments,guard=args[3];if(guard&&isIterateeCall(args[1],args[2],guard)){args=[collection,args[1]]}return baseSortByOrder(collection,baseFlatten(args,false,false,1),[])}function sortByOrder(collection,props,orders,guard){if(collection==null){return[]}if(guard&&isIterateeCall(props,orders,guard)){orders=null}if(!isArray(props)){props=props==null?[]:[props]}if(!isArray(orders)){orders=orders==null?[]:[orders]}return baseSortByOrder(collection,props,orders)}function where(collection,source){return filter(collection,baseMatches(source))}var now=nativeNow||function(){return(new Date).getTime()};function after(n,func){if(typeof func!="function"){if(typeof n=="function"){var temp=n;n=func;func=temp}else{throw new TypeError(FUNC_ERROR_TEXT)}}n=nativeIsFinite(n=+n)?n:0;return function(){if(--n<1){return func.apply(this,arguments)}}}function ary(func,n,guard){if(guard&&isIterateeCall(func,n,guard)){n=null}n=func&&n==null?func.length:nativeMax(+n||0,0);return createWrapper(func,ARY_FLAG,null,null,null,null,n)}function before(n,func){var result;if(typeof func!="function"){if(typeof n=="function"){var temp=n;n=func;func=temp}else{throw new TypeError(FUNC_ERROR_TEXT)}}return function(){if(--n>0){result=func.apply(this,arguments)}else{func=null}return result}}function bind(func,thisArg){var bitmask=BIND_FLAG;if(arguments.length>2){var partials=baseSlice(arguments,2),holders=replaceHolders(partials,bind.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(func,bitmask,thisArg,partials,holders)}function bindAll(object){return baseBindAll(object,arguments.length>1?baseFlatten(arguments,false,false,1):functions(object))}function bindKey(object,key){var bitmask=BIND_FLAG|BIND_KEY_FLAG;if(arguments.length>2){var partials=baseSlice(arguments,2),holders=replaceHolders(partials,bindKey.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(key,bitmask,object,partials,holders)}function curry(func,arity,guard){if(guard&&isIterateeCall(func,arity,guard)){arity=null}var result=createWrapper(func,CURRY_FLAG,null,null,null,null,null,arity);result.placeholder=curry.placeholder;return result}function curryRight(func,arity,guard){if(guard&&isIterateeCall(func,arity,guard)){arity=null}var result=createWrapper(func,CURRY_RIGHT_FLAG,null,null,null,null,null,arity);result.placeholder=curryRight.placeholder;return result}function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=wait<0?0:+wait||0;if(options===true){var leading=true;trailing=false}else if(isObject(options)){leading=options.leading;maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait);trailing="trailing"in options?options.trailing:trailing}function cancel(){if(timeoutId){clearTimeout(timeoutId)}if(maxTimeoutId){clearTimeout(maxTimeoutId)}maxTimeoutId=timeoutId=trailingCall=undefined}function delayed(){var remaining=wait-(now()-stamp);if(remaining<=0||remaining>wait){if(maxTimeoutId){clearTimeout(maxTimeoutId)}var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}}else{timeoutId=setTimeout(delayed,remaining)}}function maxDelayed(){if(timeoutId){clearTimeout(timeoutId)}maxTimeoutId=timeoutId=trailingCall=undefined;if(trailing||maxWait!==wait){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}}function debounced(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId}else{if(!maxTimeoutId&&!leading){lastCalled=stamp}var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||remaining>maxWait;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId)}lastCalled=stamp;result=func.apply(thisArg,args)}else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining)}}if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId)}else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait)}if(leadingCall){isCalled=true;result=func.apply(thisArg,args)}if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=null}return result}debounced.cancel=cancel;return debounced}function defer(func){return baseDelay(func,1,arguments,1)}function delay(func,wait){return baseDelay(func,wait,arguments,2)}var flow=createComposer();var flowRight=createComposer(true);function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,cache=memoized.cache,key=resolver?resolver.apply(this,args):args[0];if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);cache.set(key,result);return result};memoized.cache=new memoize.Cache;return memoized}function negate(predicate){if(typeof predicate!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(){return!predicate.apply(this,arguments)}}function once(func){return before(func,2)}function partial(func){var partials=baseSlice(arguments,1),holders=replaceHolders(partials,partial.placeholder);return createWrapper(func,PARTIAL_FLAG,null,partials,holders)}function partialRight(func){var partials=baseSlice(arguments,1),holders=replaceHolders(partials,partialRight.placeholder);return createWrapper(func,PARTIAL_RIGHT_FLAG,null,partials,holders)}function rearg(func){var indexes=baseFlatten(arguments,false,false,1);return createWrapper(func,REARG_FLAG,null,null,null,indexes)}function spread(func){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(array){return func.apply(this,array)}}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(options===false){leading=false}else if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}debounceOptions.leading=leading;debounceOptions.maxWait=+wait;debounceOptions.trailing=trailing;return debounce(func,wait,debounceOptions)}function wrap(value,wrapper){wrapper=wrapper==null?identity:wrapper;return createWrapper(wrapper,PARTIAL_FLAG,null,[value],[])}function clone(value,isDeep,customizer,thisArg){if(isDeep&&typeof isDeep!="boolean"&&isIterateeCall(value,isDeep,customizer)){isDeep=false}else if(typeof isDeep=="function"){thisArg=customizer;customizer=isDeep;isDeep=false}customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,1);return baseClone(value,isDeep,customizer)}function cloneDeep(value,customizer,thisArg){customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,1);return baseClone(value,true,customizer)}function isArguments(value){var length=isObjectLike(value)?value.length:undefined;return isLength(length)&&objToString.call(value)==argsTag||false}var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag||false};function isBoolean(value){return value===true||value===false||isObjectLike(value)&&objToString.call(value)==boolTag||false}function isDate(value){return isObjectLike(value)&&objToString.call(value)==dateTag||false;
}function isElement(value){return value&&value.nodeType===1&&isObjectLike(value)&&objToString.call(value).indexOf("Element")>-1||false}if(!support.dom){isElement=function(value){return value&&value.nodeType===1&&isObjectLike(value)&&!isPlainObject(value)||false}}function isEmpty(value){if(value==null){return true}var length=value.length;if(isLength(length)&&(isArray(value)||isString(value)||isArguments(value)||isObjectLike(value)&&isFunction(value.splice))){return!length}return!keys(value).length}function isEqual(value,other,customizer,thisArg){customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,3);if(!customizer&&isStrictComparable(value)&&isStrictComparable(other)){return value===other}var result=customizer?customizer(value,other):undefined;return typeof result=="undefined"?baseIsEqual(value,other,customizer):!!result}function isError(value){return isObjectLike(value)&&typeof value.message=="string"&&objToString.call(value)==errorTag||false}var isFinite=nativeNumIsFinite||function(value){return typeof value=="number"&&nativeIsFinite(value)};var isFunction=!(baseIsFunction(/x/)||Uint8Array&&!baseIsFunction(Uint8Array))?baseIsFunction:function(value){return objToString.call(value)==funcTag};function isObject(value){var type=typeof value;return type=="function"||value&&type=="object"||false}function isMatch(object,source,customizer,thisArg){var props=keys(source),length=props.length;customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,3);if(!customizer&&length==1){var key=props[0],value=source[key];if(isStrictComparable(value)){return object!=null&&value===object[key]&&hasOwnProperty.call(object,key)}}var values=Array(length),strictCompareFlags=Array(length);while(length--){value=values[length]=source[props[length]];strictCompareFlags[length]=isStrictComparable(value)}return baseIsMatch(object,props,values,strictCompareFlags,customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(value==null){return false}if(objToString.call(value)==funcTag){return reNative.test(fnToString.call(value))}return isObjectLike(value)&&reHostCtor.test(value)||false}function isNull(value){return value===null}function isNumber(value){return typeof value=="number"||isObjectLike(value)&&objToString.call(value)==numberTag||false}var isPlainObject=!getPrototypeOf?shimIsPlainObject:function(value){if(!(value&&objToString.call(value)==objectTag)){return false}var valueOf=value.valueOf,objProto=isNative(valueOf)&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?value==objProto||getPrototypeOf(value)==objProto:shimIsPlainObject(value)};function isRegExp(value){return isObjectLike(value)&&objToString.call(value)==regexpTag||false}function isString(value){return typeof value=="string"||isObjectLike(value)&&objToString.call(value)==stringTag||false}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&typedArrayTags[objToString.call(value)]||false}function isUndefined(value){return typeof value=="undefined"}function toArray(value){var length=value?value.length:0;if(!isLength(length)){return values(value)}if(!length){return[]}return arrayCopy(value)}function toPlainObject(value){return baseCopy(value,keysIn(value))}var assign=createAssigner(baseAssign);function create(prototype,properties,guard){var result=baseCreate(prototype);if(guard&&isIterateeCall(prototype,properties,guard)){properties=null}return properties?baseCopy(properties,result,keys(properties)):result}function defaults(object){if(object==null){return object}var args=arrayCopy(arguments);args.push(assignDefaults);return assign.apply(undefined,args)}function findKey(object,predicate,thisArg){predicate=getCallback(predicate,thisArg,3);return baseFind(object,predicate,baseForOwn,true)}function findLastKey(object,predicate,thisArg){predicate=getCallback(predicate,thisArg,3);return baseFind(object,predicate,baseForOwnRight,true)}function forIn(object,iteratee,thisArg){if(typeof iteratee!="function"||typeof thisArg!="undefined"){iteratee=bindCallback(iteratee,thisArg,3)}return baseFor(object,iteratee,keysIn)}function forInRight(object,iteratee,thisArg){iteratee=bindCallback(iteratee,thisArg,3);return baseForRight(object,iteratee,keysIn)}function forOwn(object,iteratee,thisArg){if(typeof iteratee!="function"||typeof thisArg!="undefined"){iteratee=bindCallback(iteratee,thisArg,3)}return baseForOwn(object,iteratee)}function forOwnRight(object,iteratee,thisArg){iteratee=bindCallback(iteratee,thisArg,3);return baseForRight(object,iteratee,keys)}function functions(object){return baseFunctions(object,keysIn(object))}function has(object,key){return object?hasOwnProperty.call(object,key):false}function invert(object,multiValue,guard){if(guard&&isIterateeCall(object,multiValue,guard)){multiValue=null}var index=-1,props=keys(object),length=props.length,result={};while(++index<length){var key=props[index],value=object[key];if(multiValue){if(hasOwnProperty.call(result,value)){result[value].push(key)}else{result[value]=[key]}}else{result[value]=key}}return result}var keys=!nativeKeys?shimKeys:function(object){if(object){var Ctor=object.constructor,length=object.length}if(typeof Ctor=="function"&&Ctor.prototype===object||typeof object!="function"&&(length&&isLength(length))){return shimKeys(object)}return isObject(object)?nativeKeys(object):[]};function keysIn(object){if(object==null){return[]}if(!isObject(object)){object=Object(object)}var length=object.length;length=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object))&&length||0;var Ctor=object.constructor,index=-1,isProto=typeof Ctor=="function"&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;while(++index<length){result[index]=index+""}for(var key in object){if(!(skipIndexes&&isIndex(key,length))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}function mapValues(object,iteratee,thisArg){var result={};iteratee=getCallback(iteratee,thisArg,3);baseForOwn(object,function(value,key,object){result[key]=iteratee(value,key,object)});return result}var merge=createAssigner(baseMerge);function omit(object,predicate,thisArg){if(object==null){return{}}if(typeof predicate!="function"){var props=arrayMap(baseFlatten(arguments,false,false,1),String);return pickByArray(object,baseDifference(keysIn(object),props))}predicate=bindCallback(predicate,thisArg,3);return pickByCallback(object,function(value,key,object){return!predicate(value,key,object)})}function pairs(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]]}return result}function pick(object,predicate,thisArg){if(object==null){return{}}return typeof predicate=="function"?pickByCallback(object,bindCallback(predicate,thisArg,3)):pickByArray(object,baseFlatten(arguments,false,false,1))}function result(object,key,defaultValue){var value=object==null?undefined:object[key];if(typeof value=="undefined"){value=defaultValue}return isFunction(value)?value.call(object):value}function transform(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);iteratee=getCallback(iteratee,thisArg,4);if(accumulator==null){if(isArr||isObject(object)){var Ctor=object.constructor;if(isArr){accumulator=isArray(object)?new Ctor:[]}else{accumulator=baseCreate(isFunction(Ctor)&&Ctor.prototype)}}else{accumulator={}}}(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}function values(object){return baseValues(object,keys(object))}function valuesIn(object){return baseValues(object,keysIn(object))}function inRange(value,start,end){start=+start||0;if(typeof end==="undefined"){end=start;start=0}else{end=+end||0}return value>=start&&value<end}function random(min,max,floating){if(floating&&isIterateeCall(min,max,floating)){max=floating=null}var noMin=min==null,noMax=max==null;if(floating==null){if(noMax&&typeof min=="boolean"){floating=min;min=1}else if(typeof max=="boolean"){floating=max;noMax=true}}if(noMin&&noMax){max=1;noMax=false}min=+min||0;if(noMax){max=min;min=0}else{max=+max||0}if(floating||min%1||max%1){var rand=nativeRandom();return nativeMin(min+rand*(max-min+parseFloat("1e-"+((rand+"").length-1))),max)}return baseRandom(min,max)}var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?word.charAt(0).toUpperCase()+word.slice(1):word)});function capitalize(string){string=baseToString(string);return string&&string.charAt(0).toUpperCase()+string.slice(1)}function deburr(string){string=baseToString(string);return string&&string.replace(reLatin1,deburrLetter)}function endsWith(string,target,position){string=baseToString(string);target=target+"";var length=string.length;position=typeof position=="undefined"?length:nativeMin(position<0?0:+position||0,length);position-=target.length;return position>=0&&string.indexOf(target,position)==position}function escape(string){string=baseToString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){string=baseToString(string);return string&&reHasRegExpChars.test(string)?string.replace(reRegExpChars,"\\$&"):string}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()});function pad(string,length,chars){string=baseToString(string);length=+length;var strLength=string.length;if(strLength>=length||!nativeIsFinite(length)){return string}var mid=(length-strLength)/2,leftLength=floor(mid),rightLength=ceil(mid);chars=createPad("",rightLength,chars);return chars.slice(0,leftLength)+string+chars}function padLeft(string,length,chars){string=baseToString(string);return string&&createPad(string,length,chars)+string}function padRight(string,length,chars){string=baseToString(string);return string&&string+createPad(string,length,chars)}function parseInt(string,radix,guard){if(guard&&isIterateeCall(string,radix,guard)){radix=0}return nativeParseInt(string,radix)}if(nativeParseInt(whitespace+"08")!=8){parseInt=function(string,radix,guard){if(guard?isIterateeCall(string,radix,guard):radix==null){radix=0}else if(radix){radix=+radix}string=trim(string);return nativeParseInt(string,radix||(reHexPrefix.test(string)?16:10))}}function repeat(string,n){var result="";string=baseToString(string);n=+n;if(n<1||!string||!nativeIsFinite(n)){return result}do{if(n%2){result+=string}n=floor(n/2);string+=string}while(n);return result}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()});var startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+(word.charAt(0).toUpperCase()+word.slice(1))});function startsWith(string,target,position){string=baseToString(string);position=position==null?0:nativeMin(position<0?0:+position||0,string.length);return string.lastIndexOf(target,position)==position}function template(string,options,otherOptions){var settings=lodash.templateSettings;if(otherOptions&&isIterateeCall(string,options,otherOptions)){options=otherOptions=null}string=baseToString(string);options=baseAssign(baseAssign({},otherOptions||options),settings,assignOwnDefaults);var imports=baseAssign(baseAssign({},options.imports),settings.imports,assignOwnDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");var sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){isEscaping=true;source+="' +\n__e("+escapeValue+") +\n'"}if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '"}if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"}index=offset+match.length;return match});source+="';\n";var variable=options.variable;if(!variable){source="with (obj) {\n"+source+"\n}\n"}source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});result.source=source;if(isError(result)){throw result}return result}function trim(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(trimmedLeftIndex(string),trimmedRightIndex(string)+1)}chars=chars+"";return string.slice(charsLeftIndex(string,chars),charsRightIndex(string,chars)+1)}function trimLeft(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(trimmedLeftIndex(string))}return string.slice(charsLeftIndex(string,chars+""))}function trimRight(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(0,trimmedRightIndex(string)+1)}return string.slice(0,charsRightIndex(string,chars+"")+1)}function trunc(string,options,guard){if(guard&&isIterateeCall(string,options,guard)){options=null}var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(options!=null){if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?+options.length||0:length;omission="omission"in options?baseToString(options.omission):omission}else{length=+options||0}}string=baseToString(string);if(length>=string.length){return string}var end=length-omission.length;if(end<1){return omission}var result=string.slice(0,end);if(separator==null){return result+omission}if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,newEnd,substring=string.slice(0,end);if(!separator.global){separator=RegExp(separator.source,(reFlags.exec(separator)||"")+"g")}separator.lastIndex=0;while(match=separator.exec(substring)){newEnd=match.index}result=result.slice(0,newEnd==null?end:newEnd)}}else if(string.indexOf(separator,end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index)}}return result+omission}function unescape(string){string=baseToString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}function words(string,pattern,guard){if(guard&&isIterateeCall(string,pattern,guard)){pattern=null}string=baseToString(string);return string.match(pattern||reWords)||[]}function attempt(){var func=arguments[0],length=arguments.length,args=Array(length?length-1:0);while(--length>0){args[length-1]=arguments[length]}try{return func.apply(undefined,args)}catch(e){return isError(e)?e:new Error(e)}}function callback(func,thisArg,guard){if(guard&&isIterateeCall(func,thisArg,guard)){thisArg=null}return isObjectLike(func)?matches(func):baseCallback(func,thisArg)}function constant(value){return function(){return value}}function identity(value){return value}function matches(source){return baseMatches(baseClone(source,true))}function matchesProperty(key,value){return baseMatchesProperty(key+"",baseClone(value,true))}function mixin(object,source,options){if(options==null){var isObj=isObject(source),props=isObj&&keys(source),methodNames=props&&props.length&&baseFunctions(source,props);if(!(methodNames?methodNames.length:isObj)){methodNames=false;options=source;source=object;object=this}}if(!methodNames){methodNames=baseFunctions(source,keys(source))}var chain=true,index=-1,isFunc=isFunction(object),length=methodNames.length;if(options===false){chain=false}else if(isObject(options)&&"chain"in options){chain=options.chain}while(++index<length){var methodName=methodNames[index],func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(func){return function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__);(result.__actions__=arrayCopy(this.__actions__)).push({func:func,args:arguments,thisArg:object});result.__chain__=chainAll;return result}var args=[this.value()];push.apply(args,arguments);return func.apply(object,args)}}(func)}}return object}function noConflict(){context._=oldDash;return this}function noop(){}function property(key){return baseProperty(key+"")}function propertyOf(object){return function(key){return object==null?undefined:object[key]}}function range(start,end,step){if(step&&isIterateeCall(start,end,step)){end=step=null}start=+start||0;step=step==null?1:+step||0;if(end==null){end=start;start=0}else{end=+end||0}var index=-1,length=nativeMax(ceil((end-start)/(step||1)),0),result=Array(length);while(++index<length){result[index]=start;start+=step}return result}function times(n,iteratee,thisArg){n=+n;if(n<1||!nativeIsFinite(n)){return[]}var index=-1,result=Array(nativeMin(n,MAX_ARRAY_LENGTH));iteratee=bindCallback(iteratee,thisArg,1);while(++index<n){if(index<MAX_ARRAY_LENGTH){result[index]=iteratee(index)}else{iteratee(index)}}return result}function uniqueId(prefix){var id=++idCounter;return baseToString(prefix)+id}function add(augend,addend){return augend+addend}var max=createExtremum(arrayMax);var min=createExtremum(arrayMin,true);function sum(collection){if(!isArray(collection)){collection=toIterable(collection)}var length=collection.length,result=0;while(length--){result+=+collection[length]||0}return result}lodash.prototype=baseLodash.prototype;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;MapCache.prototype["delete"]=mapDelete;MapCache.prototype.get=mapGet;MapCache.prototype.has=mapHas;MapCache.prototype.set=mapSet;SetCache.prototype.push=cachePush;memoize.Cache=MapCache;lodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.callback=callback;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;lodash.flow=flow;lodash.flowRight=flowRight;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.functions=functions;lodash.groupBy=groupBy;lodash.indexBy=indexBy;lodash.initial=initial;lodash.intersection=intersection;lodash.invert=invert;lodash.invoke=invoke;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.mixin=mixin;lodash.negate=negate;lodash.omit=omit;lodash.once=once;lodash.pairs=pairs;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pluck=pluck;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAt=pullAt;lodash.range=range;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortByAll=sortByAll;lodash.sortByOrder=sortByOrder;lodash.spread=spread;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.times=times;lodash.toArray=toArray;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.union=union;lodash.uniq=uniq;lodash.unzip=unzip;lodash.values=values;lodash.valuesIn=valuesIn;lodash.where=where;lodash.without=without;lodash.wrap=wrap;lodash.xor=xor;lodash.zip=zip;lodash.zipObject=zipObject;lodash.backflow=flowRight;lodash.collect=map;lodash.compose=flowRight;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.extend=assign;lodash.iteratee=callback;lodash.methods=functions;lodash.object=zipObject;lodash.select=filter;lodash.tail=rest;lodash.unique=uniq;mixin(lodash,lodash);lodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.deburr=deburr;lodash.endsWith=endsWith;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.findWhere=findWhere;lodash.first=first;lodash.has=has;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isBoolean=isBoolean;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isMatch=isMatch;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isString=isString;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.max=max;lodash.min=min;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padLeft=padLeft;lodash.padRight=padRight;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.result=result;lodash.runInContext=runInContext;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedLastIndex=sortedLastIndex;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.sum=sum;lodash.template=template;lodash.trim=trim;lodash.trimLeft=trimLeft;lodash.trimRight=trimRight;lodash.trunc=trunc;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.words=words;lodash.all=every;lodash.any=some;lodash.contains=includes;lodash.detect=find;lodash.foldl=reduce;lodash.foldr=reduceRight;lodash.head=first;lodash.include=includes;lodash.inject=reduce;mixin(lodash,function(){var source={};baseForOwn(lodash,function(func,methodName){if(!lodash.prototype[methodName]){source[methodName]=func}});return source}(),false);lodash.sample=sample;lodash.prototype.sample=function(n){if(!this.__chain__&&n==null){return sample(this.value())}return this.thru(function(value){return sample(value,n)})};lodash.VERSION=VERSION;arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash});arrayEach(["dropWhile","filter","map","takeWhile"],function(methodName,type){var isFilter=type!=LAZY_MAP_FLAG,isDropWhile=type==LAZY_DROP_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee,thisArg){var filtered=this.__filtered__,result=filtered&&isDropWhile?new LazyWrapper(this):this.clone(),iteratees=result.__iteratees__||(result.__iteratees__=[]);iteratees.push({done:false,count:0,index:0,iteratee:getCallback(iteratee,thisArg,1),limit:-1,type:type});result.__filtered__=filtered||isFilter;return result}});arrayEach(["drop","take"],function(methodName,index){var whileName=methodName+"While";LazyWrapper.prototype[methodName]=function(n){var filtered=this.__filtered__,result=filtered&&!index?this.dropWhile():this.clone();n=n==null?1:nativeMax(floor(n)||0,0);if(filtered){if(index){result.__takeCount__=nativeMin(result.__takeCount__,n)}else{last(result.__iteratees__).limit=n}}else{var views=result.__views__||(result.__views__=[]);views.push({size:n,type:methodName+(result.__dir__<0?"Right":"")})}return result};LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()};LazyWrapper.prototype[methodName+"RightWhile"]=function(predicate,thisArg){return this.reverse()[whileName](predicate,thisArg).reverse()}});arrayEach(["first","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}});arrayEach(["initial","rest"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this[dropName](1)}});arrayEach(["pluck","where"],function(methodName,index){var operationName=index?"filter":"map",createCallback=index?baseMatches:baseProperty;LazyWrapper.prototype[methodName]=function(value){return this[operationName](createCallback(value))}});LazyWrapper.prototype.compact=function(){return this.filter(identity)};LazyWrapper.prototype.reject=function(predicate,thisArg){predicate=getCallback(predicate,thisArg,1);return this.filter(function(value){return!predicate(value)})};LazyWrapper.prototype.slice=function(start,end){start=start==null?0:+start||0;var result=start<0?this.takeRight(-start):this.drop(start);if(typeof end!="undefined"){end=+end||0;result=end<0?result.dropRight(-end):result.take(end-start)}return result};LazyWrapper.prototype.toArray=function(){return this.drop(0)};baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName],checkIteratee=/^(?:filter|map|reject)|While$/.test(methodName),retUnwrapped=/^(?:first|last)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments,length=args.length,chainAll=this.__chain__,value=this.__wrapped__,isHybrid=!!this.__actions__.length,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);if(useLazy&&checkIteratee&&typeof iteratee=="function"&&iteratee.length!=1){isLazy=useLazy=false}var onlyLazy=isLazy&&!isHybrid;if(retUnwrapped&&!chainAll){return onlyLazy?func.call(value):lodashFunc.call(lodash,this.value())}var interceptor=function(value){var otherArgs=[value];push.apply(otherArgs,args);return lodashFunc.apply(lodash,otherArgs)};if(useLazy){var wrapper=onlyLazy?value:new LazyWrapper(this),result=func.apply(wrapper,args);if(!retUnwrapped&&(isHybrid||result.__actions__)){var actions=result.__actions__||(result.__actions__=[]);actions.push({func:thru,args:[interceptor],thisArg:lodash})}return new LodashWrapper(result,chainAll)}return this.thru(interceptor)}});arrayEach(["concat","join","pop","push","replace","shift","sort","splice","split","unshift"],function(methodName){var func=(/^(?:replace|split)$/.test(methodName)?stringProto:arrayProto)[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:join|pop|replace|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){return func.apply(this.value(),args)}return this[chainName](function(value){return func.apply(value,args)})}});LazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toString=wrapperToString;lodash.prototype.run=lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;lodash.prototype.collect=lodash.prototype.map;lodash.prototype.head=lodash.prototype.first;lodash.prototype.select=lodash.prototype.filter;lodash.prototype.tail=lodash.prototype.rest;return lodash}var _=runInContext();if(true){root._=_;!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return _}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else if(freeExports&&freeModule){if(moduleExports){(freeModule.exports=_)._=_}else{freeExports._=_}}else{root._=_}}).call(this)}).call(exports,__webpack_require__(140)(module),function(){return this}())},function(module,exports){module.exports=function(module){if(!module.webpackPolyfill){module.deprecate=function(){};module.paths=[];module.children=[];module.webpackPolyfill=1}return module}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _MapComponent=__webpack_require__(142);var _MapComponent2=_interopRequireDefault(_MapComponent);var _SearchComponent=__webpack_require__(149);var _SearchComponent2=_interopRequireDefault(_SearchComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const isArray=_writer.lodash.isArray;const isObject=_writer.lodash.isObject;const find=_writer.lodash.find;class LocationDetailComponent extends _substance.Component{constructor(...args){super(...args);this.handleActions({googleMapsLoaded:this.googleMapsLoaded,searchItemSelected:this.searchItemSelected,markerPositionChanged:this.markerPositionChanged})}dispose(){super.dispose()}createIdForObject(){this.state.location.concept.metadata.object["@id"]=(0,_writer.idGenerator)()}createLocation(){const location=this.state.location;this.createIdForObject();this.saveLocation(null,"POST").then(uuid=>{this.context.api.newsItem.addLocation(this.name,{title:location.concept.name,data:this.getGeometryObject(),uuid:uuid,type:this.getLocationType()});if(this.state.error){this.setState({error:false})}this.props.reload();this.send("close")}).catch(()=>this.setState({error:true}))}updateLocation(){const location=this.state.location;const uuid=location["@guid"]?location["@guid"]:null;if(!uuid){throw new Error("ConceptItem has no UUID to update")}this.saveLocation(uuid,"PUT").then(()=>{this.context.api.newsItem.updateLocation(this.name,{title:location.concept.name,data:this.getGeometryObject(),uuid:uuid,type:this.getLocationType()});if(this.state.error){this.setState({error:false})}this.props.reload();this.send("close")}).catch(()=>this.setState({error:true}))}getGeometryObject(){const geometry=findAttribute(this.state.location,"geometry");if(geometry){return{position:this.state.location.concept.metadata.object.data.geometry}}else{return{}}}setDescription(inputValue,role){const currentDescription=this.context.api.concept.getDefinitionForType(this.state.location.concept.definition,role);if(inputValue.length>0&&!currentDescription){const longDesc={"@role":role,keyValue:inputValue};this.state.location.concept.definition=this.context.api.concept.setDefinitionDependingOnArrayOrObject(this.state.location.concept.definition,longDesc)}else if(inputValue.length>=0&&currentDescription){currentDescription["keyValue"]=inputValue}}saveLocation(id,method){const location=this.state.location;location.concept.name=this.refs.locationNameInput.val().length>0?this.refs.locationNameInput.val():location.concept.name;const shortDescriptionInputValue=this.refs.locationShortDescInput.val();const longDescriptionInputValue=this.refs.locationLongDescText.val();
if(!location.concept.definition){location.concept.definition=[]}this.setDescription(shortDescriptionInputValue,"drol:short");this.setDescription(longDescriptionInputValue,"drol:long");this.xmlDoc=_writer.jxon.unbuild(location,null,"conceptItem");const conceptItem=this.xmlDoc.documentElement.outerHTML;switch(method){case"PUT":return this.context.api.router.updateConceptItem(id,conceptItem);case"POST":return this.context.api.router.createConceptItem(conceptItem)}}searchItemSelected(googleLatLng){this.markerPositionChanged({lat:googleLatLng.lat(),lng:googleLatLng.lng()});this.refs.mapComponent.setProps({googleLatLng:googleLatLng})}googleMapsLoaded(google){this.google=google;if(this.state.newLocation&&this.state.query){try{this.refs.searchComponent.setProps({google:google,query:this.state.query})}catch(e){}}else{this.refs.searchComponent.setProps({google:google})}this.extendState({googleMapsLoaded:true})}updateMapPosition(){const latlng=this.getLatLngFromLoadedLocation();this.refs.mapComponent.setProps({googleLatLng:new this.google.maps.LatLng(latlng.lat,latlng.lng)})}updateMapPositionPolygon(){const wktPolygon=this.state.location.concept.metadata.object.data.geometry;try{this.refs.mapComponent.setProps({isPolygon:true,wktString:wktPolygon})}catch(e){console.error("e",e)}}getLatLngFromLoadedLocation(){const geometry=findAttribute(this.state.location.concept,"geometry");if(!geometry){return{lat:0,lng:0}}const latLongString=/POINT\((\-?[0-9\.\s]+)\)/.exec(geometry)[1].split(" ");return{lat:latLongString[1],lng:latLongString[0]}}markerPositionChanged(latLng){if(!this.state.location.concept.metadata.object.data){this.state.location.concept.metadata.object.data={}}this.state.location.concept.metadata.object.data.geometry="POINT("+latLng.lng+" "+latLng.lat+")"}getDescription(descriptionType){const locationConcept=this.state.location.concept;if(!locationConcept.definition){return undefined}if(isArray(locationConcept.definition)){return find(locationConcept.definition,function(definition){return definition["@role"]===descriptionType})}else if(isObject(locationConcept.definition)){return locationConcept.definition["@role"]===descriptionType?locationConcept.definition:undefined}}willReceiveProps(props){this.extendState({query:props.query,newLocation:props.newLocation,location:props.location,editable:props.editable})}getNameForLocation(){if(this.state.query){return this.state.query}else{return this.state.location.concept.name}}render($$){let shortDesc="",longDesc="";const name=this.getNameForLocation();if(this.state.googleMapsLoaded){shortDesc=this.getDescription("drol:short");longDesc=this.getDescription("drol:long");shortDesc=shortDesc?shortDesc:"";longDesc=longDesc?longDesc:"";if(this.state.location.concept.metadata.object["@type"]==="x-im/polygon"){console.warn("Edit of polygons is not yet supported");this.searchDisabled=true;this.isPolygon=true;this.updateMapPositionPolygon()}else{this.updateMapPosition()}}const el=$$("div");const formContainer=$$("form").addClass("location-form__container container").ref("formContainer").on("submit",e=>{e.preventDefault();if(this.refs["locationNameInput"].val()!==""){this.onClose("save")}});const rowContainer=$$("div").addClass("row");const hiddenSubmitButtonToEnableEnterSubmit=$$("input").attr({type:"submit",style:"display:none"});rowContainer.append(hiddenSubmitButtonToEnableEnterSubmit);const formGroup=$$("fieldset").addClass("form-group col-6").ref("formGroupName");formGroup.append($$("label").attr("for","locationNameInput").append(this.getLabel("Name")));if(this.state.editable){const locationName=$$("input").attr({type:"text",id:"locationNameInput"}).addClass("form-control").val(name).ref("locationNameInput");locationName.on("change",function(){if(this.refs["locationNameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}}.bind(this));formGroup.append(locationName)}else{formGroup.append($$("p").append(name).ref("locationNameP"))}rowContainer.append(formGroup);const formGroupShortDesc=$$("fieldset").addClass("form-group col-6").ref("formGroupShortDesc");formGroupShortDesc.append($$("label").attr("for","locationShortDescInput").append(this.getLabel("Short description")));if(this.state.editable){formGroupShortDesc.append($$("input").attr({id:"locationShortDescInput"}).addClass("form-control").val(shortDesc["keyValue"]).ref("locationShortDescInput"))}else{formGroupShortDesc.append($$("p").append(shortDesc["keyValue"]).ref("locationShortDescP"))}rowContainer.append(formGroupShortDesc);const formGroupLongDesc=$$("fieldset").addClass("form-group col-12").ref("formGroupLongDesc");formGroupLongDesc.append($$("label").attr("for","locationLongDescText").append(this.getLabel("Long description")));if(this.state.editable){formGroupLongDesc.append($$("textarea").attr({id:"locationLongDescText"}).addClass("form-control").val(longDesc["keyValue"]).ref("locationLongDescText"))}else{formGroupLongDesc.append($$("p").append(longDesc["keyValue"]).ref("locationLongDescP"))}rowContainer.append(formGroupLongDesc);formContainer.append(rowContainer);el.append(formContainer);if(this.props.exists){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-info").append(this.getLabel("Please note that this name is already in use")+": "+this.state.query)))}if(!this.searchDisabled){const searchComponent=$$(_SearchComponent2.default).ref("searchComponent");el.append(searchComponent)}if(this.isPolygon){el.append($$("p").addClass("col-12 not-supported").append(this.getLabel("Edit of polygons is not currently supported")))}const mapComponent=$$(_MapComponent2.default,{pluginId:this.props.plugin.id}).ref("mapComponent");el.append(mapComponent);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.context.i18n.t("ximplace-error-save"))))}return el}onClose(status){if("cancel"===status||this.state.editable===false){return true}if(this.state.newLocation){this.createLocation()}else{this.updateLocation()}return false}getLocationType(){const useGeometryType=this.context.api.getConfigValue("se.infomaker.ximplace","useGeometryType");if(useGeometryType){let locationType="";try{if(typeof this.state.location.concept.metadata.object["@type"]!=="undefined"){locationType=this.state.location.concept.metadata.object["@type"]}}catch(ex){console.error(ex);throw new Error("Invalid conceptItem for location")}if(locationType){return locationType}else{throw new Error("Invalid conceptItem for location. Missing object type")}}else{return"x-im/place"}}}function findAttribute(object,attribute){let match;function iterateObject(target,name){Object.keys(target).forEach(function(key){if(isObject(target[key])){iterateObject(target[key],name)}else if(key===name){match=target[key]}})}iterateObject(object,attribute);return match?match:undefined}exports.default=LocationDetailComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _googleMapsApiLoader=__webpack_require__(143);var _googleMapsApiLoader2=_interopRequireDefault(_googleMapsApiLoader);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class MapComponent extends _substance.Component{constructor(...args){super(...args)}handleWKTPolygon(wktString){var ptsArray=[];function addPoints(google,data){var pointsData=data.split(",");var len=pointsData.length;for(var i=0;i<len;i++){var xy=pointsData[i].split(" ");var pt=new google.maps.LatLng(xy[1],xy[0]);ptsArray.push(pt)}}var regex=/\(([^()]+)\)/g;var wktRings=[];var results;wktString=wktString.replace(/ +(?= )/g,"");do{results=regex.exec(wktString);if(results){wktRings.push(results[1])}}while(results);for(var i=0;i<wktRings.length;i++){addPoints(this.google,wktRings[i])}var poly=new this.google.maps.Polygon({paths:ptsArray,strokeColor:"#3A99D9",strokeOpacity:.8,strokeWeight:2,fillColor:"#1E90FF",fillOpacity:.35});poly.setMap(this.map);this.map.setZoom(9)}dispose(){this.map.unbindAll()}getDefaultMapOptions(){var latlng=new google.maps.LatLng(56.683687,16.363279);return{zoom:14,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:false}}didMount(){var apiKey=this.context.api.getConfigValue(this.props.pluginId,"googleMapAPIKey");(0,_googleMapsApiLoader2.default)({libraries:["geometry","places"],apiKey:apiKey}).then(googleApi=>{this.googleMapsLoaded(googleApi)},err=>{console.error(err)})}googleMapsLoaded(google){this.google=google;let mapContaienr=document.getElementById("map-container");this.map=new google.maps.Map(mapContaienr,this.getDefaultMapOptions());this.send("googleMapsLoaded",google)}setMarker(googleLatLong){if(this.marker){this.marker.position=googleLatLong}else{this.marker=new google.maps.Marker({position:googleLatLong,icon:{path:google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,strokeColor:"#2a6f9e",strokeOpacity:1,strokeWeight:2,fillColor:"#3A99D9",fillOpacity:.35,scale:4},draggable:true});this.marker.addListener("dragend",function(event){this.send("markerPositionChanged",{lat:event.latLng.lat(),lng:event.latLng.lng()})}.bind(this))}this.marker.setMap(this.map)}updateMapLocation(googleLatLng){this.map.setCenter(googleLatLng);this.setMarker(googleLatLng)}willReceiveProps(props){if(props.googleLatLng){this.updateMapLocation(props.googleLatLng)}else if(props.isPolygon){this.handleWKTPolygon(props.wktString)}}shouldRerender(){return false}render($$){var el=$$("div").ref("mapComponent");var mapContainer=$$("div").attr("id","map-container").ref("mapContainer");el.append(mapContainer);return el}}exports.default=MapComponent},function(module,exports,__webpack_require__){module.exports=__webpack_require__(144)},function(module,exports,__webpack_require__){"use strict";var Promise=__webpack_require__(145).Promise;var urlBuilder=__webpack_require__(148);var googleApi;function loadAutoCompleteAPI(params){var script=document.createElement("script");script.type="text/javascript";script.src=urlBuilder({base:"https://maps.googleapis.com/maps/api/js",libraries:params.libraries||[],callback:"googleMapsAutoCompleteAPILoad",apiKey:params.apiKey,client:params.client});document.querySelector("head").appendChild(script)}function googleMapsApiLoader(params){if(googleApi){return Promise.resolve(googleApi)}var windowRef=window?window:{};var deferred=function(resolve,reject){loadAutoCompleteAPI(params);windowRef.googleMapsAutoCompleteAPILoad=function(){googleApi=windowRef.google;resolve(googleApi)};setTimeout(function(){if(!windowRef.google){reject(new Error("Loading took too long"))}},5e3)};return new Promise(deferred)}module.exports=googleMapsApiLoader},function(module,exports,__webpack_require__){var require;(function(process,global){(function(global,factory){true?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.ES6Promise=factory()})(this,function(){"use strict";function objectOrFunction(x){return typeof x==="function"||typeof x==="object"&&x!==null}function isFunction(x){return typeof x==="function"}var _isArray=undefined;if(!Array.isArray){_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}}else{_isArray=Array.isArray}var isArray=_isArray;var len=0;var vertxNext=undefined;var customSchedulerFn=undefined;var asap=function asap(callback,arg){queue[len]=callback;queue[len+1]=arg;len+=2;if(len===2){if(customSchedulerFn){customSchedulerFn(flush)}else{scheduleFlush()}}};function setScheduler(scheduleFn){customSchedulerFn=scheduleFn}function setAsap(asapFn){asap=asapFn}var browserWindow=typeof window!=="undefined"?window:undefined;var browserGlobal=browserWindow||{};var BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver;var isNode=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function useNextTick(){return function(){return process.nextTick(flush)}}function useVertxTimer(){if(typeof vertxNext!=="undefined"){return function(){vertxNext(flush)}}return useSetTimeout()}function useMutationObserver(){var iterations=0;var observer=new BrowserMutationObserver(flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=flush;return function(){return channel.port2.postMessage(0)}}function useSetTimeout(){var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1)}}var queue=new Array(1e3);function flush(){for(var i=0;i<len;i+=2){var callback=queue[i];var arg=queue[i+1];callback(arg);queue[i]=undefined;queue[i+1]=undefined}len=0}function attemptVertx(){try{var r=require;var vertx=__webpack_require__(147);vertxNext=vertx.runOnLoop||vertx.runOnContext;return useVertxTimer()}catch(e){return useSetTimeout()}}var scheduleFlush=undefined;if(isNode){scheduleFlush=useNextTick()}else if(BrowserMutationObserver){scheduleFlush=useMutationObserver()}else if(isWorker){scheduleFlush=useMessageChannel()}else if(browserWindow===undefined&&"function"==="function"){scheduleFlush=attemptVertx()}else{scheduleFlush=useSetTimeout()}function then(onFulfillment,onRejection){var _arguments=arguments;var parent=this;var child=new this.constructor(noop);if(child[PROMISE_ID]===undefined){makePromise(child)}var _state=parent._state;if(_state){(function(){var callback=_arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result)})})()}else{subscribe(parent,child,onFulfillment,onRejection)}return child}function resolve(object){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}var promise=new Constructor(noop);_resolve(promise,object);return promise}var PROMISE_ID=Math.random().toString(36).substring(16);function noop(){}var PENDING=void 0;var FULFILLED=1;var REJECTED=2;var GET_THEN_ERROR=new ErrorObject;function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function getThen(promise){try{return promise.then}catch(error){GET_THEN_ERROR.error=error;return GET_THEN_ERROR}}function tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function handleForeignThenable(promise,thenable,then){asap(function(promise){var sealed=false;var error=tryThen(then,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){_resolve(promise,value)}else{fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;_reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;_reject(promise,error)}},promise)}function handleOwnThenable(promise,thenable){if(thenable._state===FULFILLED){fulfill(promise,thenable._result)}else if(thenable._state===REJECTED){_reject(promise,thenable._result)}else{subscribe(thenable,undefined,function(value){return _resolve(promise,value)},function(reason){return _reject(promise,reason)})}}function handleMaybeThenable(promise,maybeThenable,then$$){if(maybeThenable.constructor===promise.constructor&&then$$===then&&maybeThenable.constructor.resolve===resolve){handleOwnThenable(promise,maybeThenable)}else{if(then$$===GET_THEN_ERROR){_reject(promise,GET_THEN_ERROR.error)}else if(then$$===undefined){fulfill(promise,maybeThenable)}else if(isFunction(then$$)){handleForeignThenable(promise,maybeThenable,then$$)}else{fulfill(promise,maybeThenable)}}}function _resolve(promise,value){if(promise===value){_reject(promise,selfFulfillment())}else if(objectOrFunction(value)){handleMaybeThenable(promise,value,getThen(value))}else{fulfill(promise,value)}}function publishRejection(promise){if(promise._onerror){promise._onerror(promise._result)}publish(promise)}function fulfill(promise,value){if(promise._state!==PENDING){return}promise._result=value;promise._state=FULFILLED;if(promise._subscribers.length!==0){asap(publish,promise)}}function _reject(promise,reason){if(promise._state!==PENDING){return}promise._state=REJECTED;promise._result=reason;asap(publishRejection,promise)}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers;var length=_subscribers.length;parent._onerror=null;_subscribers[length]=child;_subscribers[length+FULFILLED]=onFulfillment;_subscribers[length+REJECTED]=onRejection;if(length===0&&parent._state){asap(publish,parent)}}function publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return}var child=undefined,callback=undefined,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function ErrorObject(){this.error=null}var TRY_CATCH_ERROR=new ErrorObject;function tryCatch(callback,detail){try{return callback(detail)}catch(e){TRY_CATCH_ERROR.error=e;return TRY_CATCH_ERROR}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=undefined,error=undefined,succeeded=undefined,failed=undefined;if(hasCallback){value=tryCatch(callback,detail);if(value===TRY_CATCH_ERROR){failed=true;error=value.error;value=null}else{succeeded=true}if(promise===value){_reject(promise,cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==PENDING){}else if(hasCallback&&succeeded){_resolve(promise,value)}else if(failed){_reject(promise,error)}else if(settled===FULFILLED){fulfill(promise,value)}else if(settled===REJECTED){_reject(promise,value)}}function initializePromise(promise,resolver){try{resolver(function resolvePromise(value){_resolve(promise,value)},function rejectPromise(reason){_reject(promise,reason)})}catch(e){_reject(promise,e)}}var id=0;function nextId(){return id++}function makePromise(promise){promise[PROMISE_ID]=id++;promise._state=undefined;promise._result=undefined;promise._subscribers=[]}function Enumerator(Constructor,input){this._instanceConstructor=Constructor;this.promise=new Constructor(noop);if(!this.promise[PROMISE_ID]){makePromise(this.promise)}if(isArray(input)){this._input=input;this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0){fulfill(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){fulfill(this.promise,this._result)}}}else{_reject(this.promise,validationError())}}function validationError(){return new Error("Array Methods must be provided an Array")}Enumerator.prototype._enumerate=function(){var length=this.length;var _input=this._input;for(var i=0;this._state===PENDING&&i<length;i++){this._eachEntry(_input[i],i)}};Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor;var resolve$$=c.resolve;if(resolve$$===resolve){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING){this._settledAt(entry._state,i,entry._result)}else if(typeof _then!=="function"){this._remaining--;this._result[i]=entry}else if(c===Promise){var promise=new c(noop);handleMaybeThenable(promise,entry,_then);this._willSettleAt(promise,i)}else{this._willSettleAt(new c(function(resolve$$){return resolve$$(entry)}),i)}}else{this._willSettleAt(resolve$$(entry),i)}};Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;if(promise._state===PENDING){this._remaining--;if(state===REJECTED){_reject(promise,value)}else{this._result[i]=value}}if(this._remaining===0){fulfill(promise,this._result)}};Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;subscribe(promise,undefined,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})};function all(entries){return new Enumerator(this,entries).promise}function race(entries){var Constructor=this;if(!isArray(entries)){return new Constructor(function(_,reject){return reject(new TypeError("You must pass an array to race."))})}else{return new Constructor(function(resolve,reject){var length=entries.length;for(var i=0;i<length;i++){Constructor.resolve(entries[i]).then(resolve,reject)}})}}function reject(reason){var Constructor=this;var promise=new Constructor(noop);_reject(promise,reason);return promise}function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Promise(resolver){this[PROMISE_ID]=nextId();this._result=this._state=undefined;this._subscribers=[];if(noop!==resolver){typeof resolver!=="function"&&needsResolver();this instanceof Promise?initializePromise(this,resolver):needsNew()}}Promise.all=all;Promise.race=race;Promise.resolve=resolve;Promise.reject=reject;Promise._setScheduler=setScheduler;Promise._setAsap=setAsap;Promise._asap=asap;Promise.prototype={constructor:Promise,then:then,catch:function _catch(onRejection){return this.then(null,onRejection)}};function polyfill(){var local=undefined;if(typeof global!=="undefined"){local=global}else if(typeof self!=="undefined"){local=self}else{try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e){}if(promiseToString==="[object Promise]"&&!P.cast){return}}local.Promise=Promise}Promise.polyfill=polyfill;Promise.Promise=Promise;return Promise})}).call(exports,__webpack_require__(146),function(){return this}())},function(module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},function(module,exports){},function(module,exports){"use strict";function urlBuilder(params){var builtUrl=params.base;builtUrl+="?";if(params.apiKey){builtUrl+="key="+params.apiKey+"&"}if(params.client){builtUrl+="client="+params.client+"&"}if(params.libraries.length>0){builtUrl+="libraries=";params.libraries.forEach(function(library,index){builtUrl+=library;if(index!==params.libraries.length-1){builtUrl+=","}});builtUrl+="&"}builtUrl+="callback="+params.callback;return builtUrl}module.exports=urlBuilder},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class SearchComponent extends _substance.Component{constructor(...args){super(...args)}getInitialState(){return{searchResults:[],googleMapsLoaded:false}}didMount(){}willReceiveProps(props){let newState={};if(props.google){this.google=props.google;newState.googleMapsLoaded=true;if(props.query){newState.query=props.query;this.populateInitialQuery(props.query)}}if(Object.keys(newState).length>0){this.extendState(newState)}}populateInitialQuery(initialQuery){this.makeInitialSearch(initialQuery)}render($$){var el=$$("div").addClass("search-container").ref("searchContainer");var tmpSearch=$$("div").ref("tmpSearchContainer");el.append(tmpSearch);var container=$$("div").ref("searchContainer").addClass("search-component__main clearfix");if(this.state.googleMapsLoaded){var searchForm=$$("form").attr("style","display:flex").on("submit",this.search.bind(this)).ref("searchForm");var searchInput=$$("input").addClass("form-control search__query col-xs-9").ref("searchInput").val(this.state.query).attr("placeholder",this.getLabel("Address or place"));var searchButton=$$("button").addClass("btn btn-neutral col-xs-3").append(this.getLabel("Search")).on("click",this.search.bind(this)).ref("serchButton");searchForm.append([searchInput,searchButton]);container.append(searchForm);var searchList=$$("ul").ref("searchList");var items=this.state.searchResults.map(function(result){var lat=result.geometry.location.lat();var lng=result.geometry.location.lng();return $$("li").append(result.name).on("click",function(){this.send("searchItemSelected",new google.maps.LatLng(lat,lng))}.bind(this))}.bind(this));searchList.append(items);if(this.state.isSearching){container.append(searchList)}el.append(container)}else{el.append($$("span").append("Waiting for maps to load"))}return el}searchDone(results,status){if(status===this.google.maps.places.PlacesServiceStatus.OK&&results[0]){this.extendState({searchResults:results})}}search(e){this.extendState({isSearching:true});e.preventDefault();var request={query:this.refs.searchInput.val()};var service=new this.google.maps.places.PlacesService(this.refs.tmpSearchContainer.el.el);service.textSearch(request,this.searchDone.bind(this))}makeInitialSearch(query){var request={query:query};var service=new this.google.maps.places.PlacesService(this.refs.tmpSearchContainer.el.el);service.textSearch(request,function(results,status){if(status===this.google.maps.places.PlacesServiceStatus.OK&&results[0]){var lat=results[0].geometry.location.lat();var lng=results[0].geometry.location.lng();this.send("searchItemSelected",new google.maps.LatLng(lat,lng))}}.bind(this))}}exports.default=SearchComponent},function(module,exports){"use strict";module.exports={place:'<?xml version="1.0" encoding="UTF-8"?> '+'<conceptItem xmlns="http://iptc.org/std/nar/2006-10-01/" version="1" standard="NewsML-G2" standardversion="2.20" conformance="power"> '+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/> '+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/> '+"<itemMeta> "+'<itemClass qcode="cinat:concept"/> '+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/> '+'<itemMetaExtProperty type="imext:type" value="x-im/place"/> '+"</itemMeta> "+"<concept> "+'<conceptId uri="im://place/"/> '+'<type qcode="cpnat:poi"/>'+"<name></name>"+'<definition role="drol:long"></definition> '+'<definition role="drol:short"></definition> '+'<metadata xmlns="http://www.infomaker.se/newsml/1.0"> '+'<object id="" type="x-im/position"> '+"<data> "+"<geometry>POINT(14.55600 56.89921)</geometry> "+"</data> "+"</object> "+"</metadata> "+"</concept> "+"</conceptItem>"}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(133);var _XimPlacePackageConfigure=__webpack_require__(135);var _XimPlacePackageConfigure2=_interopRequireDefault(_XimPlacePackageConfigure);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const id="se.infomaker.ximplace-polygon";exports.default={id:id,name:"ximplace",configure:(0,_XimPlacePackageConfigure2.default)(id)}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(133);var _XimPlacePackageConfigure=__webpack_require__(135);var _XimPlacePackageConfigure2=_interopRequireDefault(_XimPlacePackageConfigure);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const id="se.infomaker.ximplace-position";exports.default={id:id,name:"ximplace",configure:(0,_XimPlacePackageConfigure2.default)(id)}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _AuthorPackage=__webpack_require__(154);var _AuthorPackage2=_interopRequireDefault(_AuthorPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_AuthorPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(155);__webpack_require__(157);var _AuthorMainComponent=__webpack_require__(159);var _AuthorMainComponent2=_interopRequireDefault(_AuthorMainComponent);var _AuthorValidation=__webpack_require__(163);var _AuthorValidation2=_interopRequireDefault(_AuthorValidation);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.ximauthor",name:"ximauthor",configure:function configure(config){config.addLabel("validation-no-author",{en:"No author specified",sv:"Ingen författare är vald"});config.addLabel("Search authors",{sv:"Sök författare"});config.addLabel("Authors",{sv:"Författare"});config.addLabel("Enter author",{sv:"Ange författare"});config.addLabel("Add",{sv:"Lägg till"});config.addLabel("Add new",{sv:"Lägg till ny"});config.addValidator(_AuthorValidation2.default);config.addComponentToSidebarWithTabId(this.id,"main",_AuthorMainComponent2.default)}}},function(module,exports){},,function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _AuthorListComponent=__webpack_require__(160);
var _AuthorListComponent2=_interopRequireDefault(_AuthorListComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class AuthorMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximauthor"}didMount(){}getInitialState(){return{existingAuthors:_writer.api.newsItem.getAuthors()}}reloadAuthors(){this.extendState({existingAuthors:_writer.api.newsItem.getAuthors()})}render($$){const noSearch=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"noSearch");const el=$$("div").ref("authorContainer").addClass("authors").append($$("h2").append(this.getLabel("Authors")));let searchComponent;if(noSearch){const AuthorAddComponent=this.context.componentRegistry.get("form-add");searchComponent=$$(AuthorAddComponent,{existingItems:this.state.existingAuthors,onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Enter author")}).ref("authorSearchComponent")}else{const AuthorSearchComponent=this.context.componentRegistry.get("form-search");searchComponent=$$(AuthorSearchComponent,{existingItems:this.state.existingAuthors,searchUrl:"/api/search/concepts/authors?q=",onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Search authors")}).ref("authorSearchComponent")}const existingAuthorsList=$$(_AuthorListComponent2.default,{existingAuthors:this.state.existingAuthors,removeAuthor:this.removeAuthor.bind(this)}).ref("existingAuthorList");el.append(existingAuthorsList);el.append(searchComponent);return el}removeAuthor(author){try{if(_writer.NilUUID.isNilUUID(author.uuid)){_writer.api.newsItem.removeAuthorByTitle(this.name,author.title)}else{_writer.api.newsItem.removeAuthorByUUID(this.name,author.uuid)}this.reloadAuthors()}catch(e){console.error(e)}}addAuthor(author){try{_writer.api.newsItem.addAuthor(this.name,author);this.reloadAuthors()}catch(e){console.error("e",e)}}createAuthor(authorTemp){_writer.api.newsItem.addSimpleAuthor(this.name,authorTemp.inputValue);this.reloadAuthors()}}exports.default=AuthorMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _AuthorItemComponent=__webpack_require__(161);var _AuthorItemComponent2=_interopRequireDefault(_AuthorItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class AuthorListComponent extends _substance.Component{getIdForRef(author){if(_writer.NilUUID.isNilUUID(author.uuid)){return"author-"+author.title.replace(" ","")}else if(author.uuid){return"author-"+author.uuid}else{console.warn("No UUID")}}render($$){var existingAuthors=this.props.existingAuthors;var authorList=$$("ul").addClass("authors__list");existingAuthors.forEach(author=>{authorList.append($$(_AuthorItemComponent2.default,{author:author,removeAuthor:this.deleteAuthorAndReference.bind(this)}).ref(this.getIdForRef(author)))});return authorList}deleteAuthorAndReference(author){this.refs[this.getIdForRef(author)].remove();delete this.refs[this.getIdForRef(author)];this.props.removeAuthor(author)}}exports.default=AuthorListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _lodash=__webpack_require__(139);var _AuthorInfoComponent=__webpack_require__(162);var _AuthorInfoComponent2=_interopRequireDefault(_AuthorInfoComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class AuthorItemComponent extends _substance.Component{constructor(...args){super(...args);this.handleActions({avatarLoaded:this.avatarLoaded})}didMount(){}getInitialState(){return{name:undefined,isLoaded:false,isSimpleAuthor:false,loadedAuthor:{}}}dispose(){super.dispose()}loadAuthor(){if(_writer.NilUUID.isNilUUID(this.props.author.uuid)&&this.props.author.title){setTimeout(function(){this.setState({name:this.props.author.title,isLoaded:true,isSimpleAuthor:true,loadedAuthor:{name:this.props.author.title}})}.bind(this),1)}else{this.context.api.router.getConceptItem(this.props.author.uuid,this.props.author.type).then(function(dom){var conceptXML=dom.querySelector("concept");var linksXML=dom.querySelector("itemMeta links");var jsonFormat=_writer.jxon.build(conceptXML);var authorLinks;if(linksXML){authorLinks=_writer.jxon.build(linksXML)}this.setState({name:jsonFormat.name,isLoaded:true,isSimpleAuthor:false,loadedAuthor:jsonFormat,loadedAuhtorLinks:authorLinks})}.bind(this)).catch(function(){this.setState({name:this.props.author.title,isLoaded:true,isSimpleAuthor:true,loadedAuthor:{name:this.props.author.title}})}.bind(this))}}render($$){var author=this.props.author,authorItem=$$("li").addClass("authors__list-item").addClass("clearfix").ref("authorItem"),displayTitle=this.state.name?this.state.name:author.title;var deleteButton=$$("button").addClass("author__button--delete").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"})).attr("title",this.getLabel("Remove from article")).on("click",function(){this.removeAuthor(author)}.bind(this));if(!this.state.isLoaded){this.loadAuthor()}else if(this.state.isSimpleAuthor){this.populateElementsForSimpleAuthor($$,authorItem,displayTitle,deleteButton)}else{this.populateElementForAuthor($$,authorItem,author,displayTitle,deleteButton)}authorItem.on("mouseenter",this.showHover);authorItem.on("mouseleave",this.hideHover);return authorItem}populateElementsForSimpleAuthor($$,authorItem,displayTitle,deleteButton){authorItem.append($$("div").addClass("avatar__container").append($$(_substance.FontAwesomeIcon,{icon:"fa-user"}))).append($$("div").addClass("metadata__container").append($$("span").append(displayTitle).addClass("author__name notClickable meta")).attr("title",this.getLabel("Not editable author"))).append($$("div").addClass("button__container").append(deleteButton))}populateElementForAuthor($$,authorItem,author,displayTitle,deleteButton){var displayNameEl=$$("span").append(displayTitle);displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");displayNameEl.on("mouseenter",this.toggleTooltip);displayNameEl.on("mouseout",this.hideTooltip);this.updateTagItemName(displayNameEl,this.state.loadedAuthor);var metaDataContainer=$$("div").addClass("metadata__container").append($$("span").append(displayNameEl).addClass("author__name meta").on("click",this.showInformation));var email=this.findAttribute(this.state.loadedAuthor,"email");if(email){metaDataContainer.append($$("span").append(email).addClass("author__email meta"))}authorItem.append($$("div").addClass("avatar__container").ref("avatarContainer").append($$(_substance.FontAwesomeIcon,{icon:"fa-user"}))).append(metaDataContainer).append($$("div").addClass("button__container").append(deleteButton))}toggleTooltip(){}hideTooltip(){}updateTagItemName(tagItem,loadedTag){if(loadedTag&&loadedTag.definition){var definition=(0,_lodash.isArray)(loadedTag.definition)?loadedTag.definition:[loadedTag.definition];for(var i=0;i<definition.length;i++){var item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}removeAuthor(author){this.props.removeAuthor(author)}avatarLoaded(avatar){var loadedAuthor=this.state.loadedAuthor;loadedAuthor.avatarSrc=avatar.url;if(loadedAuthor.avatarSrc!==avatar.url){this.extendState({loadedAuthor:loadedAuthor})}}showInformation(){this.context.api.ui.showDialog(_AuthorInfoComponent2.default,{author:this.state.loadedAuthor},{secondary:false,title:this.state.loadedAuthor.name,global:true})}showHover(){var delButton=this.el.find(".author__button--delete");delButton.addClass("active")}hideHover(){var delButton=this.el.find(".author__button--delete");delButton.removeClass("active")}findAttribute(object,attribute){var match;function iterateObject(target,name){Object.keys(target).forEach(function(key){if((0,_lodash.isObject)(target[key])){iterateObject(target[key],name)}else if(key===name){match=target[key]}})}iterateObject(object,attribute);return match?match:undefined}}exports.default=AuthorItemComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _lodash=__webpack_require__(139);class AuthorInfoComponent extends _substance.Component{constructor(...args){super(...args)}dispose(){super.dispose()}render($$){let el=$$("div").addClass("author__info");let description=(0,_lodash.find)(this.props.author.definition,function(def){return def["@role"]==="drol:long"});if(description){var descriptionEl=$$("p").append(description["keyValue"]);el.append(descriptionEl)}let email=this.findAttribute(this.props.author,"email");if(email){let emailEl=$$("a").append($$(_substance.FontAwesomeIcon,{icon:"fa-envelope-o"})).attr("href","mailto:"+email).append(email);el.append(emailEl)}let phone=this.findAttribute(this.props.author,"phone");if(phone){let phoneEl=$$("a").append($$(_substance.FontAwesomeIcon,{icon:"fa-phone"})).attr("href","tel:"+phone).append(phone);el.append(phoneEl)}return el}findAttribute(object,attribute){let match;function iterateObject(target,name){Object.keys(target).forEach(function(key){if((0,_lodash.isObject)(target[key])){iterateObject(target[key],name)}else if(key===name){match=target[key]}})}iterateObject(object,attribute);return match?match:undefined}onClose(){}}exports.default=AuthorInfoComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class AuthorValidation extends _writer.Validator{constructor(...args){super(...args)}validate(){if(_writer.api.newsItem.getAuthors().length===0){this.addWarning(_writer.api.getLabel("validation-no-author"))}}}exports.default=AuthorValidation},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(165);var _ContentrelationsPackage=__webpack_require__(167);var _ContentrelationsPackage2=_interopRequireDefault(_ContentrelationsPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_ContentrelationsPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ContentRelationsNode=__webpack_require__(168);var _ContentRelationsNode2=_interopRequireDefault(_ContentRelationsNode);var _ContentRelationsComponent=__webpack_require__(169);var _ContentRelationsComponent2=_interopRequireDefault(_ContentRelationsComponent);var _ContentRelationsConverter=__webpack_require__(170);var _ContentRelationsConverter2=_interopRequireDefault(_ContentRelationsConverter);var _ContentRelationsMainComponent=__webpack_require__(171);var _ContentRelationsMainComponent2=_interopRequireDefault(_ContentRelationsMainComponent);var _ContentRelationsDropHandler=__webpack_require__(175);var _ContentRelationsDropHandler2=_interopRequireDefault(_ContentRelationsDropHandler);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"contentrelations",id:"se.infomaker.contentrelations",configure:function configure(config){config.addSidebarTab("contentrelations","Relaterat innehåll");config.addComponentToSidebarWithTabId("contentrelations","contentrelations",_ContentRelationsMainComponent2.default);config.addDragAndDrop(_ContentRelationsDropHandler2.default);config.addComponent("contentrelations",_ContentRelationsComponent2.default);config.addNode(_ContentRelationsNode2.default);config.addConverter("newsml",_ContentRelationsConverter2.default);config.addLabel("ContentRelations",{sv:"Relaterat innehåll"});config.addLabel("Enter query",{sv:"Sökfråga"});config.addLabel("Search",{sv:"Sök"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class ContentRelationsNode extends _substance.BlockNode{}ContentRelationsNode.define({type:"contentrelations",uuid:{type:"string",optional:true},label:{type:"string",optional:true},products:{type:"string",optional:true},dataType:"string"});exports.default=ContentRelationsNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class ContentRelationsComponent extends _substance.Component{render($$){const el=$$("div").addClass("im-blocknode__container");el.append(this.renderHeader($$));el.append(this.renderContent($$));el.addClass("x-im-contentrelations");el.attr("contentEditable",false);return el}renderContent($$){const content=$$("div").addClass("im-blocknode__content");const link=$$("a").append(this.props.node.label).attr("href","#"+this.props.node.uuid).attr("target","_blank").on("click",function(evt){evt.stopPropagation()});content.append(link);return content}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-external-link"}),$$("strong").append(this.getLabel("External link")).attr("contenteditable",false)]).addClass("header").attr("contenteditable",false)}}exports.default=ContentRelationsComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ContentRelationsConverter={type:"contentrelations",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/link"},import:function _import(el,node){if(el.attr("uuid")){node.uuid=el.attr("uuid")}node.label=el.attr("title");node.dataType=el.attr("type")},export:function _export(node,el,converter){if(node.uuid){el.attr("uuid",node.uuid)}el.attr("title",node.label);el.attr("type",node.dataType);var links=converter.$$("links");var link=converter.$$("link");link.attr({rel:"self",type:"x-im/article"});if(node.uuid){link.attr("uuid",node.uuid)}links.append(link);el.append(links)}};exports.default=ContentRelationsConverter},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _ContentSearchComponent=__webpack_require__(172);var _ContentSearchComponent2=_interopRequireDefault(_ContentSearchComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentRelationsMainComponent extends _substance.Component{render($$){var el=$$("div").ref("relationsContainer").addClass("authors").append($$("h2").append(this.getLabel("ContentRelations")));el.append($$(_ContentSearchComponent2.default));return el}}exports.default=ContentRelationsMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ContentSearchResultComponent=__webpack_require__(173);var _ContentSearchResultComponent2=_interopRequireDefault(_ContentSearchResultComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentSearchComponent extends _substance.Component{getInitialState(){return{query:"",results:[]}}render($$){const el=$$("div").addClass("search__container");const searchForm=$$("form").addClass("clearfix").on("submit",this.search.bind(this)).ref("form");searchForm.append($$("input").attr({type:"submit",style:"display:none"}));const searchInput=$$("input").addClass("form-control search__query col-xs-9").ref("queryInput").attr("placeholder",this.getLabel("Enter query"));const searchButton=$$("button").addClass("sc-np-btn btn btn-neutral col-xs-3").append(this.getLabel("Search")).on("click",this.search.bind(this)).ref("serchButton");searchForm.append([searchInput,searchButton]);el.append(searchForm);const results=$$(_ContentSearchResultComponent2.default,{results:this.state.results,query:this.state.query});el.append(results);return el}search(e){e.preventDefault();const query=this.refs.queryInput.val();_writer.api.router.get("/api/search/concepts/articles?q="+query).then(reponse=>_writer.api.router.checkForOKStatus(reponse)).then(response=>response.json()).then(json=>{this.setState({query:query,results:json})}).catch(()=>{})}}exports.default=ContentSearchComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _SearchResultItem=__webpack_require__(174);var _SearchResultItem2=_interopRequireDefault(_SearchResultItem);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentSearchResultComponent extends _substance.Component{render($$){const el=$$("ul").addClass("search__results");const items=this.props.results.map(function(item){return $$(_SearchResultItem2.default,{item:item})});el.append(items);return el}}exports.default=ContentSearchResultComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class SearchResultItem extends _substance.Component{getInitialState(){return{imageLoaded:false,imageURL:""}}getDroplinkForItem(item){const imType=item.imType[0];const name=item.name[0];let data={uuid:item.uuid,imType:imType,name:name};let dropData=window.btoa(JSON.stringify(data));switch(imType){case"article":return"x-im-entity://x-im/article?data="+dropData;case"image":return"x-im-entity://x-im/image?data="+dropData;default:return"x-im-entity://x-im/article?data="+dropData}}getTitle($$,item){let name=item.name?item.name[0]:"Unidentified",products=item.type,productsType=item.typeCatalog?item.typeCatalog[0]:"text";if(!products){return name}if(productsType&&productsType==="icon"){const icons=products.map(function(product){return $$("img").attr("src",product).addClass("product-icon")});const result=$$("span").append(name);icons.forEach(function(icon){result.append(icon)});return result}else{return`${name} [${products.join(", ")}]`}}didMount(){this.dropLink=this.getDroplinkForItem(this.props.item)}_onDragStart(e){e.stopPropagation();e.dataTransfer.setData("text/uri-list",this.dropLink)}render($$){const item=this.props.item;return this.getItem($$,item)}getItem($$,item){const imType=item.imType?item.imType[0]:"article";switch(imType){case"article":return this.getArticleItem($$,item);case"image":return this.getImageItem($$,item);default:}}getArticleItem($$,item){const listItem=$$("li").addClass("article").attr("draggable",true).on("dragstart",this._onDragStart,this);const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-file-text-o"}).addClass("type-icon");const label=$$("span").addClass("title").append(this.getTitle($$,item));listItem.append([icon,label]);return listItem}getImageItem($$,item){const listItem=$$("li").addClass("image").attr("draggable",true).on("dragstart",this._onDragStart,this);let icon=$$(_substance.FontAwesomeIcon,{icon:"fa-picture-o"});const label=$$("span").addClass("title").append(this.getTitle($$,item));if(this.state.imageLoaded){icon=$$("img").attr("src",this.state.imageURL).addClass("image-icon")}else{this.fetchImageURLForUUID(item.uuid).then(url=>{this.setState({imageLoaded:true,imageURL:url})})}listItem.append([icon,label]);return listItem}fetchImageURLForUUID(uuid){return _writer.api.router.get("/api/binary/url/"+uuid+"/40?imType=x-im/image&height=40").then(response=>response.text()).catch(error=>{console.error(error)})}}exports.default=SearchResultItem},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _insertRelatedContentLink=__webpack_require__(176);var _insertRelatedContentLink2=_interopRequireDefault(_insertRelatedContentLink);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentRelationsDropHandler extends _substance.DragAndDropHandler{match(params){if(!params.uri){return false}if(this.isContentRelationsArticleDrop(params)||this.isNpDroplink(params)){if(params.isNpDroplink){this.data=this.getDataFromNpDroplink(params.uri)}else if(params.isContentRelations){this.data=this.getDataFromURL(params.uri)}else{return false}return true}}isNpDroplink(params){const npDropLinkRegex=_writer.api.getConfigValue("se.infomaker.contentrelations","npDropLinkMatcher");if(!npDropLinkRegex){return false}const re=new RegExp(npDropLinkRegex);const urlMatches=re.exec(params.uri);if(urlMatches&&urlMatches.length>=1){params.isNpDroplink=true;return true}}isContentRelationsArticleDrop(params){if(params.uri.indexOf("x-im-entity://x-im/article")>=0){params.isContentRelations=true;return true}}getDataFromNpDroplink(link){link=decodeURIComponent(link);function decodeLabel(xml){const reg=new RegExp(".*<name>([^<]+)");const result=reg.exec(xml);return result[1]}function decodeUuid(xml){const reg=new RegExp(".*?id=([^<]+)");const result=reg.exec(xml);return result[1]}const name=decodeLabel(link);const uuid=decodeUuid(link);return{name:name,uuid:uuid}}getDataFromURL(url){const queryParamKey="data=";const dataPosition=url.indexOf(queryParamKey);let encodedData=url.substr(dataPosition+queryParamKey.length,url.length);return JSON.parse(window.atob(encodedData))}drop(tx){(0,_insertRelatedContentLink2.default)(tx,this.data)}}exports.default=ContentRelationsDropHandler},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=insertRelatedContentLink;function insertRelatedContentLink(tx,data){tx.insertBlockNode({dataType:"x-im/link",type:"contentrelations",uuid:data.uuid,label:data.name})}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _Channelselector=__webpack_require__(178);var _Channelselector2=_interopRequireDefault(_Channelselector);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_Channelselector2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(179);var _ChannelSelectorComponent=__webpack_require__(181);var _ChannelSelectorComponent2=_interopRequireDefault(_ChannelSelectorComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.hdsds.channelselector",name:"channelselector",configure:function configure(config){config.addLabel("channelselector-Products",{en:"Products",sv:"Produkter"});config.addComponentToSidebarWithTabId("channelselector","main",_ChannelSelectorComponent2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);const sortBy=_writer.lodash.sortBy;const clone=_writer.lodash.clone;class ChannelselectorComponent extends _substance.Component{constructor(...args){super(...args)}getInitialState(){this.configProducts=this.context.api.getConfigValue("se.infomaker.hdsds.channelselector","products");var channels=this.context.api.newsItem.getChannels(),initialChannels=[];channels.forEach(function(channel){var compare=_writer.lodash.find(this.configProducts,function(o){if(o.qcode===channel["qcode"]){o.active=true;return true}});initialChannels.push(compare)}.bind(this));return{products:sortBy(this.configProducts,["active","name"]),selectedProducts:initialChannels}}sortProducts(){return sortBy(this.state.products,["active","name"])}selectProduct(product){var selectedProduct=this.state.selectedProducts,products=this.state.products;var productIndex=products.indexOf(product);if(_writer.lodash.includes(selectedProduct,product)){delete products[productIndex].active;selectedProduct.splice(selectedProduct.indexOf(product),1);this.context.api.newsItem.removeChannel("channelselector",product)}else{selectedProduct.push(product);products[productIndex].active=true;var productToSave=clone(product);delete productToSave.active;this.context.api.newsItem.addChannel("channelselector",productToSave)}this.extendState({selectedProducts:selectedProduct})}render($$){var el=$$("div").addClass("sc-channelselector"),listContainer=$$("div").addClass("sc-productlist-container").addClass("list-group"),list=$$("div").addClass("sc-productlist"),title=$$("h2").append(this.getLabel("channelselector-Products"));var products=this.sortProducts().map(function(product){var cssClass=product.active?"active":"";return $$("a").addClass("list-group-item").addClass(cssClass).append(product.name.toString()).on("click",()=>{this.selectProduct(product)})},this);el.append(title);list.append(products);listContainer.append(list);el.append(listContainer);return el}}exports.default=ChannelselectorComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(183);var _Publicationchannel=__webpack_require__(185);var _Publicationchannel2=_interopRequireDefault(_Publicationchannel);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_Publicationchannel2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublicationchannelComponent=__webpack_require__(186);var _PublicationchannelComponent2=_interopRequireDefault(_PublicationchannelComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.mitm.publicationchannel",name:"publicationchannel",configure:function configure(config){config.addLabel("publicationchannel-Channels",{en:"Channels",sv:"Publiceringskanaler"});config.addLabel("publicationchannel-Shared_with",{en:"Shared with",sv:"Delas med"});config.addLabel("publicationchannel-Choose_all",{en:"Choose all",sv:"Välj alla"});config.addLabel("publicationchannel-Choose_main_channel",{en:"Choose main channel",sv:"Välj huvudkanal"});config.addLabel("publicationchannel-mainChannel-warning",{en:"Please choose main publication channel before sharing with other channels",sv:"Vänligen välj huvudkanal innan delning med andra kanaler"});config.addComponentToSidebarWithTabId("publicationchannel","main",_PublicationchannelComponent2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class PublicationchannelComponent extends _substance.Component{constructor(...args){super(...args)}didMount(){this.context.api.events.on("publicationchannel","data:changed",event=>{if(event.data&&event.data.type==="channel"){this.synchronize(event)}});this.context.api.events.on("publicationchannel","data:duplicated",()=>{this.clearAllChannels()});this.refs.dropdownButton.el.el.addEventListener("blur",()=>{setTimeout(()=>{this.hideMenu()},50)})}getInitialState(){var activeChannelCount=0,currentChannels=this.context.api.newsItem.getChannels(),channels=this.context.api.getConfigValue("se.infomaker.mitm.publicationchannel","publicationchannels"),mainChannel=null;channels.forEach(channel=>{if(currentChannels.some(currentChannel=>channel.qcode===currentChannel["qcode"]&&currentChannel["@why"]==="imext:main")){channel.main=true;channel.active=true;mainChannel=channel;activeChannelCount++}else if(currentChannels.some(currentChannel=>channel.qcode===currentChannel["qcode"])){channel.active=true;channel.main=false;activeChannelCount++}else{channel.active=false;channel.main=false}});return{mainChannel:mainChannel,channels:_writer.lodash.sortBy(channels,["name"]),activeChannelCount:activeChannelCount}}render($$){var el=$$("div").addClass("sc-publicationchannel");el.append([$$("h2").append(this.getLabel("publicationchannel-Channels")),this.renderMainChannelSelect($$),$$("p").addClass("sc-sharedwith").append([this.getLabel("publicationchannel-Shared_with")])]);el.append(this.renderChannelButtons($$));return el}renderMainChannelSelect($$){var channels=[],mainChannel=null,dropdownButton=null;this.state.channels.forEach(channel=>{if(channel.main===true){mainChannel=channel}if(typeof channel.scope!=="undefined"&&channel.scope==="shared"){return}channels.push($$("button").addClass("dropdown-item").append([$$("img").attr({src:channel.icon}),channel.name]).on("focus",()=>{this.toggleChannel(channel,true)}))});if(!mainChannel){dropdownButton=$$("button").addClass("btn btn-secondary dropdown-toggle").attr({id:"w-sharedchannels-main-select",type:"button","data-toggle":"dropdown"}).append(this.getLabel("publicationchannel-Choose_main_channel"))}else{dropdownButton=$$("button").addClass("btn btn-secondary dropdown-toggle").attr({id:"w-sharedchannels-main-select",type:"button","data-toggle":"dropdown"}).append([$$("img").attr({src:mainChannel.icon}),mainChannel.name])}dropdownButton.on("click",()=>{this.toggleMenu();return false});dropdownButton.ref("dropdownButton");let components=[dropdownButton];if(this.state.showChannelButtons){components.push($$("div").addClass("dropdown-menu").append(channels))}return $$("div").attr({id:"w-sharedchannels-main"}).addClass("dropdown").attr({"aria-labelledby":"w-sharedchannels-main-select"}).append(components)}renderChannelButtons($$){var ul=$$("ul").addClass("tag-list sc-sharedchannels");this.state.channels.forEach(channel=>{if(typeof channel.scope!=="undefined"&&channel.scope==="main"){return}var channelClass="";if(channel.main){channelClass=" main"}else if(channel.active){channelClass=" active"}ul.append($$("li").addClass("tag-list__item "+channelClass).append($$("img").attr({src:channel.icon})).attr({title:channel.name,"data-toggle":"tooltip","data-placement":"bottom","data-trigger":"manual"}).on("click",()=>{if(!channel.main){this.toggleChannel(channel,false)}return false}))});return ul}clearAllChannels(){this.state.channels.forEach(channel=>{if(channel.active){this.context.api.newsItem.removeChannel("publicationchannel",channel)}});this.synchronize()}toggleMenu(){this.extendState({showChannelButtons:!this.state.showChannelButtons})}hideMenu(){this.extendState({showChannelButtons:false})}toggleAllChannels(target){var activate=true;if(target.classList.contains("checked")){activate=false}this.state.channels.forEach(channel=>{if(activate&&!channel.active&&!channel.main){this.context.api.newsItem.addChannel("publicationchannel",channel)}else if(!activate&&channel.active&&!channel.main){this.context.api.newsItem.removeChannel("publicationchannel",channel)}channel.active=activate});this.synchronize()}toggleChannel(channel,setAsMainChannel){var mainChannel=this.context.api.newsItem.getMainChannel();if(!mainChannel&&!setAsMainChannel){this.context.api.ui.showMessageDialog([{plugin:"publicationchannel",type:"error",message:this.getLabel("Please choose main publication channel before sharing with other channels")}]);return}if(channel.active&&!setAsMainChannel){this.context.api.newsItem.removeChannel("publicationchannel",channel);channel.active=false}else{if(mainChannel&&setAsMainChannel){this.context.api.newsItem.removeChannel("publicationchannel",mainChannel)}this.context.api.newsItem.addChannel("publicationchannel",channel,setAsMainChannel===true);
channel.active=true}this.synchronize()}synchronize(){var currentChannels=this.context.api.newsItem.getChannels(),activeChannelCount=0,mainChannel=null;this.state.channels.forEach(channel=>{if(currentChannels.some(currentChannel=>channel.qcode===currentChannel["qcode"]&&currentChannel["@why"]==="imext:main")){channel.main=true;channel.active=true;mainChannel=channel;activeChannelCount++}else if(currentChannels.some(currentChannel=>channel.qcode===currentChannel["qcode"])){channel.active=true;channel.main=false;activeChannelCount++}else{channel.active=false;channel.main=false}});this.extendState({activeChannelCount:activeChannelCount,mainChannel:mainChannel})}}exports.default=PublicationchannelComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(188);var _TagsPackage=__webpack_require__(190);var _TagsPackage2=_interopRequireDefault(_TagsPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_TagsPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(188);var _TagsMainComponent=__webpack_require__(191);var _TagsMainComponent2=_interopRequireDefault(_TagsMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.mitm.tags",name:"mmtags",vendor:"infomaker.se",configure:function configure(config){config.addLabel("mmtags-could_not_load_uuid",{en:"This item could not be loaded. UUID: ",sv:"Detta objekt kunde inte laddas in. UUID: "});config.addLabel("mmtags-title",{sv:"Organisationer/personer/ämnen",en:"Organizations/persons/topics"});config.addLabel("mmtags-search_placeholder",{sv:"Sök Organisationer/personer/ämnen",en:"Search Organizations/persons/topics"});config.addLabel("mmtags-create",{en:"Create",sv:"Skapa"});config.addLabel("mmtags-save",{en:"Save",sv:"Spara"});config.addLabel("mmtags-edit",{en:"Edit",sv:"Redigera"});config.addLabel("mmtags-Person",{en:"Person",sv:"Person"});config.addLabel("mmtags-Organization",{en:"Organization",sv:"Organisation"});config.addLabel("mmtags-Topic",{en:"Topic",sv:"Ämne"});config.addLabel("mmtags-type-question-label",{en:"What kind of tag do you want to create?",sv:"Vilken typ vill du skapa?"});config.addLabel("mmtags-name_already_in_use",{en:"Please note that this name is already in use",sv:"Observera att namnet redan används"});config.addLabel("mmtags-error-save",{en:"Error when saving tag",sv:"Fel vid sparande av tag"});config.addLabel("mmtags-Short_description",{en:"Short description",sv:"Kort beskrivning"});config.addLabel("mmtags-Long_description",{en:"Long description",sv:"Lång beskrivning"});config.addLabel("mmtags-Website_url",{en:"Website url",sv:"Länk till webbsida"});config.addLabel("mmtags-Twitter_url",{en:"Twitter url",sv:"Länk till Twitter"});config.addLabel("mmtags-Facebook_url",{en:"Facebook url",sv:"Länk till Facebook"});config.addLabel("mmtags-Remove_from_article",{en:"Remove from article",sv:"Ta bort från artikel"});config.addComponentToSidebarWithTabId(this.id,"main",_TagsMainComponent2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _TagsListComponent=__webpack_require__(192);var _TagsListComponent2=_interopRequireDefault(_TagsListComponent);var _TagEditBaseComponent=__webpack_require__(196);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _TagEditPersonComponent=__webpack_require__(198);var _TagEditPersonComponent2=_interopRequireDefault(_TagEditPersonComponent);var _TagEditCompanyComponent=__webpack_require__(197);var _TagEditCompanyComponent2=_interopRequireDefault(_TagEditCompanyComponent);var _TagEditTopicComponent=__webpack_require__(199);var _TagEditTopicComponent2=_interopRequireDefault(_TagEditTopicComponent);var _concept=__webpack_require__(200);var _concept2=_interopRequireDefault(_concept);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="mmtags"}getInitialState(){return{existingTags:this.context.api.newsItem.getTags(["x-im/organisation","x-im/person","x-im/topic"])}}reload(){this.extendState({existingTags:this.context.api.newsItem.getTags(["x-im/organisation","x-im/person","x-im/topic"])})}render($$){const el=$$("div").ref("tagContainer").addClass("authors").append($$("h2").append(this.getLabel("mmtags-title")));const SearchComponent=this.context.componentRegistry.get("form-search");const searchComponent=$$(SearchComponent,{existingItems:this.state.existingTags,searchUrl:"/api/search/concepts/tags?q=",onSelect:this.addTag.bind(this),onCreate:this.createTag.bind(this),placeholderText:this.getLabel("mmtags-search_placeholder"),createAllowed:true}).ref("searchComponent");const tagList=$$(_TagsListComponent2.default,{tags:this.state.existingTags,removeTag:this.removeTag.bind(this),reload:this.reload.bind(this)}).ref("tagList");el.append(tagList);el.append(searchComponent);return el}removeTag(tag){try{this.context.api.newsItem.removeLinkByUUIDAndRel(this.name,tag.uuid,"subject");this.reload()}catch(e){}}addTag(tag){try{this.context.api.newsItem.addTag(this.name,tag);this.reload()}catch(e){}}createTag(tag,exists){try{this.context.api.ui.showDialog(_TagEditBaseComponent2.default,{tag:tag,exists:exists,close:this.closeFromDialog.bind(this),createPerson:this.createPerson.bind(this),createOrganisation:this.createOrganisation.bind(this),createTopic:this.createTopic.bind(this)},{primary:false,title:this.getLabel("mmtags-create")+" "+tag.inputValue,global:true})}catch(e){}}createPerson(inputValue){const newName=inputValue.split(" ");const parser=new DOMParser;const tagXML=parser.parseFromString(_concept2.default.personTemplate,"text/xml").firstChild;tagXML.querySelector('itemMeta itemMetaExtProperty[type="imext:firstName"]').setAttribute("value",newName[0]);tagXML.querySelector('itemMeta itemMetaExtProperty[type="imext:lastName"]').setAttribute("value",newName[1]?newName[1]:"");const loadedTag=_writer.jxon.build(tagXML);this.context.api.ui.showDialog(_TagEditPersonComponent2.default,{tag:loadedTag,close:this.closeFromDialog.bind(this)},{primary:this.getLabel("mmtags-save"),title:this.getLabel("mmtags-create")+" "+inputValue,icon:"fa-user",global:true})}createOrganisation(inputValue){const parser=new DOMParser;const tagXML=parser.parseFromString(_concept2.default.organisationTemplate,"text/xml").firstChild;tagXML.querySelector("concept name").textContent=inputValue;const loadedTag=_writer.jxon.build(tagXML);this.context.api.ui.showDialog(_TagEditCompanyComponent2.default,{tag:loadedTag,close:this.closeFromDialog.bind(this)},{primary:this.getLabel("mmtags-save"),title:this.getLabel("mmtags-create")+" "+inputValue,icon:"fa-sitemap",global:true})}createTopic(inputValue){const parser=new DOMParser;const tagXML=parser.parseFromString(_concept2.default.topicTemplate,"text/xml").firstChild;tagXML.querySelector("concept name").textContent=inputValue;const loadedTag=_writer.jxon.build(tagXML);this.context.api.ui.showDialog(_TagEditTopicComponent2.default,{tag:loadedTag,close:this.closeFromDialog.bind(this)},{primary:this.getLabel("mmtags-save"),title:this.getLabel("mmtags-create")+" "+inputValue,icon:"fa-tags",global:true})}closeFromDialog(){this.reload()}}exports.default=TagsMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _TagItemComponent=__webpack_require__(193);var _TagItemComponent2=_interopRequireDefault(_TagItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsListComponent extends _substance.Component{constructor(...args){super(...args);this.name="mmtags"}render($$){const tags=this.props.tags,tagList=$$("ul").addClass("tag-list"),tagEls=tags.map(tag=>{return $$(_TagItemComponent2.default,{tag:tag,removeTag:this.removeTag.bind(this),reload:this.props.reload.bind(this)}).ref("tag-"+tag.uuid)},this);tagList.append(tagEls);return tagList}removeTag(tag){delete this.refs["tag-"+tag.uuid];this.props.removeTag(tag)}}exports.default=TagsListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _Config=__webpack_require__(194);var _Config2=_interopRequireDefault(_Config);var _TagInfoComponent=__webpack_require__(195);var _TagInfoComponent2=_interopRequireDefault(_TagInfoComponent);var _TagEditCompanyComponent=__webpack_require__(197);var _TagEditCompanyComponent2=_interopRequireDefault(_TagEditCompanyComponent);var _TagEditPersonComponent=__webpack_require__(198);var _TagEditPersonComponent2=_interopRequireDefault(_TagEditPersonComponent);var _TagEditTopicComponent=__webpack_require__(199);var _TagEditTopicComponent2=_interopRequireDefault(_TagEditTopicComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="mmtags"}getItemMetaExtPropertyByType(type){if(_writer.lodash.isArray(this.state.loadedTag.itemMeta.itemMetaExtProperty)){return _writer.lodash.find(this.state.loadedTag.itemMeta.itemMetaExtProperty,function(itemMeta){return itemMeta["@type"]===type})}else if(_writer.lodash.isObject(this.state.loadedTag.itemMeta.itemMetaExtProperty)){if(this.state.loadedTag.itemMeta.itemMetaExtProperty["@type"]===type){return this.state.loadedTag.itemMeta.itemMetaExtProperty}}}loadTag(){this.context.api.router.getConceptItem(this.props.tag.uuid,this.props.tag.type).then(xml=>{const conceptXML=xml.querySelector("conceptItem"),conceptItemJSON=_writer.jxon.build(conceptXML);this.extendState({loadedTag:conceptItemJSON,isLoaded:true});this.state.loadedTag.type=this.getItemMetaExtPropertyByType("imext:type")}).catch(()=>{this.extendState({isLoaded:true,couldNotLoad:true})})}render($$){const tag=this.props.tag,tagItem=$$("li").addClass("tag-list__item").ref("tagItem"),displayNameEl=$$("span");let displayName;displayNameEl.attr("title",TagsItemComponent.getNameForTag(tag));if(!this.state.isLoaded){this.loadTag()}else{if(this.state.couldNotLoad){displayNameEl.addClass("tag-item__title tag-item__title--no-avatar tag-item__title--notexisting").append(tag.title).attr("title",this.getLabel("mmtags-could_not_load_uuid")+tag.uuid);displayName=tag.title}else{displayName=this.state.loadedTag.concept.name;displayNameEl.addClass("tag-item__title tag-item__title--no-avatar").append(displayName);this.updateTagItemName(displayNameEl,this.state.loadedTag);displayNameEl.on("click",()=>{if(_Config2.default.isTagEditable(tag)){this.editTag(displayName)}else{this.showTag(displayName)}})}displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");tagItem.append(displayNameEl);const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("mmtags-Remove_from_article"))).on("click",()=>{this.removeTag(tag)});tagItem.append(deleteButton);const iconComponent=this.getIconForTag($$,tag);if(iconComponent){tagItem.append(iconComponent)}}return tagItem}showTag(title){this.context.api.ui.showDialog(_TagInfoComponent2.default,{tag:this.state.loadedTag,close:this.closeFromDialog.bind(this),couldNotLoad:this.state.couldNotLoad},{secondary:false,title:title,global:true})}editTag(title){let tagEdit;switch(this.state.loadedTag.type["@value"]){case"x-im/organisation":tagEdit=_TagEditCompanyComponent2.default;break;case"x-im/person":tagEdit=_TagEditPersonComponent2.default;break;case"x-im/topic":tagEdit=_TagEditTopicComponent2.default;break;default:break}this.context.api.ui.showDialog(tagEdit,{tag:this.state.loadedTag,close:this.closeFromDialog.bind(this),couldNotLoad:this.state.couldNotLoad},{primary:this.getLabel("mmtags-save"),title:this.getLabel("mmtags-edit")+" "+title,global:true})}closeFromDialog(){this.loadTag();this.props.reload()}removeTag(tag){this.props.removeTag(tag)}getIconForTag($$,tag){if(!tag.type){return this.getDefaultIconForTag($$)}const tagConfig=_Config2.default.types[tag.type];if(tagConfig){return $$(_substance.FontAwesomeIcon,{icon:tagConfig.icon}).addClass("tag-icon")}else{this.getDefaultIconForTag($$)}}static getNameForTag(tag){if(!tag.type){return undefined}const tagConfig=_Config2.default.types[tag.type];if(tagConfig){return tagConfig.name}}updateTagItemName(tagItem,loadedTag){if(loadedTag.concept&&loadedTag.concept.definition){const definition=_writer.lodash.isArray(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(let i=0;i<definition.length;i++){const item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}getDefaultIconForTag($$){return $$(_substance.FontAwesomeIcon,{icon:"fa-tag"}).addClass("tag-icon")}}exports.default=TagsItemComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={isTagEditable:function isTagEditable(tag){return Boolean(this.types[tag.type].editable)},types:{"x-im/person":{icon:"fa-user",name:"Person",editable:true},"x-im/organisation":{icon:"fa-sitemap",name:"Organisation",editable:true},"x-im/topic":{icon:"fa-tags",name:"Channel",editable:true}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(196);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagInfoComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args)}render($$){const el=$$("div").addClass("tag-edit-base");const shortDescription=this.getConceptDefinition("drol:short");if(shortDescription){const shortDescEl=$$("p").append(shortDescription.keyValue);el.append(shortDescEl)}const longDescription=this.getConceptDefinition("drol:long");if(longDescription){const longDescEl=$$("p").append(longDescription.keyValue);el.append(longDescEl)}return el}onClose(){}}exports.default=TagInfoComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);const find=_writer.lodash.find;class TagEditBaseComponent extends _substance.Component{constructor(...args){super(...args);this.name="mmtags"}saveConcept(uuid,newsItem){return this.context.api.router.updateConceptItem(uuid,newsItem)}createConcept(newsItem){return this.context.api.router.createConceptItem(newsItem)}updateFacebook(facebookInputValue){const facebookNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="x-im/social+facebook"]');if(facebookInputValue.length>0&&!facebookNode){this.createLinkNode(this.xmlDoc,{type:"x-im/social+facebook",rel:"irel:seeAlso",url:facebookInputValue})}else if(facebookNode&&facebookInputValue.length>0){facebookNode.setAttribute("url",facebookInputValue)}else if(facebookInputValue.length===0&&facebookNode){facebookNode.parentElement.removeChild(facebookNode)}}updateTwitter(twitterInputValue){const twitterNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="x-im/social+twitter"]');if(twitterInputValue.length>0&&!twitterNode){this.createLinkNode(this.xmlDoc,{type:"x-im/social+twitter",rel:"irel:seeAlso",url:twitterInputValue})}else if(twitterNode&&twitterInputValue.length>0){twitterNode.setAttribute("url",twitterInputValue)}else if(twitterInputValue.length===0&&twitterNode){twitterNode.parentElement.removeChild(twitterNode)}}updateWebsite(websiteInputValue){const websiteNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="text/html"]');if(websiteInputValue.length>0&&!websiteNode){this.createLinkNode(this.xmlDoc,{type:"text/html",rel:"irel:seeAlso",url:websiteInputValue})}else if(websiteNode&&websiteInputValue.length>0){websiteNode.setAttribute("url",websiteInputValue)}else if(websiteInputValue.length===0&&websiteNode){websiteNode.parentElement.removeChild(websiteNode)}}createLinkNode(xmlDoc,attributes){const linkNode=xmlDoc.createElement("link");for(let key in attributes){if(attributes.hasOwnProperty(key)){linkNode.setAttribute(key,attributes[key])}}xmlDoc.documentElement.querySelector("itemMeta links").appendChild(linkNode);return linkNode}getItemMetaExtProperty(key){return find(this.props.tag.itemMeta.itemMetaExtProperty,item=>item["@type"]===key)}getConceptDefinition(key){return find(this.props.tag.concept.definition,item=>item["@role"]===key)}getSeeAlsoLinkByType(type){return find(this.props.tag.itemMeta.links.link,link=>link["@type"]===type&&link["@rel"]==="irel:seeAlso")}render($$){const el=$$("div").addClass("tag-edit tag-edit-base");const personBtn=$$("button").append($$(_substance.FontAwesomeIcon,{icon:"fa-user"})).append($$("span").append(this.getLabel("mmtags-Person"))).on("click",this.createPerson);const organisationBtn=$$("button").append($$(_substance.FontAwesomeIcon,{icon:"fa-sitemap"})).append($$("span").append(this.getLabel("mmtags-Organization"))).on("click",this.createOrganisation);const topicBtn=$$("button").append($$(_substance.FontAwesomeIcon,{icon:"fa-tags"})).append($$("span").append(this.getLabel("mmtags-Topic"))).on("click",this.createTopic);el.append($$("small").addClass("text-muted").append(this.getLabel("mmtags-type-question-label")));el.append([personBtn,organisationBtn,topicBtn]);if(this.props.exists){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-info").append(this.getLabel("mmtags-name_already_in_use")+": "+this.props.tag.value)))}if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("mmtags-error-save"))))}return el}createPerson(){this.send("close");this.props.createPerson(this.props.tag.inputValue)}createOrganisation(){this.send("close");this.props.createOrganisation(this.props.tag.inputValue)}createTopic(){this.send("close");this.props.createTopic(this.props.tag.inputValue)}closeAndReload(){this.props.close();this.send("close")}renderElement($$,refName,label,inputValue,fullWidth,inputType){const cssClass=fullWidth?"col-xs-12":"col-xs-12 col-sm-6";let input;switch(inputType){case"textarea":input=this.getTextAreaElement($$);break;default:input=this.getTextInputElement($$);break}const formGroup=$$("fieldset").addClass("form-group").addClass(cssClass);formGroup.append($$("label").append(label));formGroup.append(input.val(inputValue).ref(refName));return formGroup}getTextInputElement($$){return $$("input").attr("type","text").addClass("form-control")}getTextAreaElement($$){return $$("textarea").attr("rows","4").addClass("form-control")}static getShortDescription(xmlTag){return xmlTag.documentElement.querySelector('concept definition[role="drol:short"]')}static getLongDescription(xmlTag){return xmlTag.documentElement.querySelector('concept definition[role="drol:long"]')}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditBaseComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(196);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagEditCompanyComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args);this.name="mmtags"}save(){const tag=this.props.tag,name=this.refs.nameInput.val(),shortDesc=this.refs.shortDescInput.val(),longDesc=this.refs.longDescTextarea.val(),uuid=tag["@guid"]?tag["@guid"]:null;tag.concept.name=name;const xmlTag=_writer.jxon.unbuild(tag,null,"conceptItem");this.xmlDoc=xmlTag;const shortDescNode=_TagEditBaseComponent2.default.getShortDescription(xmlTag),longDescNode=_TagEditBaseComponent2.default.getLongDescription(xmlTag);shortDescNode.textContent=shortDesc;longDescNode.textContent=longDesc;this.updateWebsite(this.refs.urlInput.val());this.updateTwitter(this.refs.twitterInput.val());this.updateFacebook(this.refs.facebookInput.val());if(uuid===null){this.createConcept(xmlTag.documentElement.outerHTML).then(uuid=>{this.xmlDoc.querySelector("conceptItem").setAttribute("guid",uuid);this.context.api.newsItem.addTag(this.name,{uuid:uuid,name:[name],type:["organisation"],imType:["x-im/organisation"]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}else{this.saveConcept(uuid,xmlTag.documentElement.outerHTML).then(()=>{this.context.api.newsItem.updateTag(this.name,uuid,{name:[name],imType:[tag.type["@value"]]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}}render($$){const tag=this.props.tag,el=$$("div").addClass("tag-edit tag-edit-person").addClass("row"),name=this.renderElement($$,"nameInput","Name",tag.concept.name,true,"input"),shortDesc=this.renderElement($$,"shortDescInput",this.getLabel("mmtags-Short_description"),this.getConceptDefinition("drol:short").keyValue,true,"input"),longDesc=this.renderElement($$,"longDescTextarea",this.getLabel("mmtags-Long_description"),this.getConceptDefinition("drol:long").keyValue,true,"textarea"),websiteUrl=this.getSeeAlsoLinkByType("text/html"),websiteUrlEl=this.renderElement($$,"urlInput",this.getLabel("mmtags-Website_url"),websiteUrl?websiteUrl["@url"]:"",true,"input"),twitterUrl=this.getSeeAlsoLinkByType("x-im/social+twitter"),twitterEl=this.renderElement($$,"twitterInput",this.getLabel("mmtags-Twitter_url"),twitterUrl?twitterUrl["@url"]:"",false,"input"),facebook=this.getSeeAlsoLinkByType("x-im/social+facebook"),facebookEl=this.renderElement($$,"facebookInput",this.getLabel("mmtags-Facebook_url"),facebook?facebook["@url"]:"",false,"input");name.on("change",()=>{if(this.refs["nameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}});el.append([name,shortDesc,longDesc,websiteUrlEl,twitterEl,facebookEl]);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("mmtags-error-save"))))}return el}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditCompanyComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(196);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagEditPersonComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args);this.name="mmtags"}save(){const tag=this.props.tag,firstName=this.refs.firstNameInput.val(),lastName=this.refs.lastNameInput.val(),shortDesc=this.refs.shortDescInput.val(),longDesc=this.refs.longDescTextarea.val(),uuid=tag["@guid"]?tag["@guid"]:null,fullName=firstName+" "+lastName;tag.concept.name=fullName;const xmlTag=_writer.jxon.unbuild(tag,null,"conceptItem");this.xmlDoc=xmlTag;const firstNameNode=xmlTag.documentElement.querySelector('itemMetaExtProperty[type="imext:firstName"]');const lastNameNode=xmlTag.documentElement.querySelector('itemMetaExtProperty[type="imext:lastName"]');firstNameNode.setAttribute("value",firstName);lastNameNode.setAttribute("value",lastName);const shortDescNode=_TagEditBaseComponent2.default.getShortDescription(xmlTag),longDescNode=_TagEditBaseComponent2.default.getLongDescription(xmlTag);shortDescNode.textContent=shortDesc;longDescNode.textContent=longDesc;this.updateWebsite(this.refs.urlInput.val());this.updateTwitter(this.refs.twitterInput.val());this.updateFacebook(this.refs.facebookInput.val());if(uuid===null){this.createConcept(xmlTag.documentElement.outerHTML).then(uuid=>{this.xmlDoc.querySelector("conceptItem").setAttribute("guid",uuid);this.context.api.newsItem.addTag(this.name,{uuid:uuid,name:[fullName],type:["person"],imType:["x-im/person"]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}else{this.saveConcept(uuid,xmlTag.documentElement.outerHTML).then(()=>{this.context.api.newsItem.updateTag(this.name,uuid,{name:[fullName],imType:[tag.type["@value"]]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}}render($$){const el=$$("div").addClass("tag-edit tag-edit-person").addClass("row"),firstName=this.renderElement($$,"firstNameInput","First name",this.getItemMetaExtProperty("imext:firstName")["@value"],false,"input"),lastName=this.renderElement($$,"lastNameInput","Last name",this.getItemMetaExtProperty("imext:lastName")["@value"],false,"input"),shortDesc=this.renderElement($$,"shortDescInput",this.getLabel("mmtags-Short_description"),this.getConceptDefinition("drol:short").keyValue,true,"input"),longDesc=this.renderElement($$,"longDescTextarea",this.getLabel("mmtags-Long_description"),this.getConceptDefinition("drol:long").keyValue,true,"textarea"),websiteUrl=this.getSeeAlsoLinkByType("text/html"),websiteUrlEl=this.renderElement($$,"urlInput",this.getLabel("mmtags-Website_url"),websiteUrl?websiteUrl["@url"]:"",true,"input"),twitterUrl=this.getSeeAlsoLinkByType("x-im/social+twitter"),twitterEl=this.renderElement($$,"twitterInput",this.getLabel("mmtags-Twitter_url"),twitterUrl?twitterUrl["@url"]:"",false,"input"),facebook=this.getSeeAlsoLinkByType("x-im/social+facebook"),facebookEl=this.renderElement($$,"facebookInput",this.getLabel("mmtags-Facebook_url"),facebook?facebook["@url"]:"",false,"input");firstName.on("change",()=>{if(this.refs["firstNameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}});el.append([firstName,lastName,shortDesc,longDesc,websiteUrlEl,twitterEl,facebookEl]);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("mmtags-error-save"))))}return el}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditPersonComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(196);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagEditTopicComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args);this.name="mmtags"}save(){const tag=this.props.tag,name=this.refs.nameInput.val(),shortDesc=this.refs.shortDescInput.val(),longDesc=this.refs.longDescTextarea.val(),uuid=tag["@guid"]?tag["@guid"]:null;tag.concept.name=name;const xmlTag=_writer.jxon.unbuild(tag,null,"conceptItem");this.xmlDoc=xmlTag;const shortDescNode=_TagEditBaseComponent2.default.getShortDescription(xmlTag),longDescNode=_TagEditBaseComponent2.default.getLongDescription(xmlTag);shortDescNode.textContent=shortDesc;longDescNode.textContent=longDesc;if(uuid===null){this.createConcept(xmlTag.documentElement.outerHTML).then(uuid=>{this.xmlDoc.querySelector("conceptItem").setAttribute("guid",uuid);this.context.api.newsItem.addTag(this.name,{uuid:uuid,name:[name],type:["organisation"],imType:["x-im/topic"]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}else{this.saveConcept(uuid,xmlTag.documentElement.outerHTML).then(()=>{this.context.api.newsItem.updateTag(this.name,uuid,{name:[name],imType:[tag.type["@value"]]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}}render($$){const tag=this.props.tag,el=$$("div").addClass("tag-edit tag-edit-person").addClass("row"),name=this.renderElement($$,"nameInput","Name",tag.concept.name,true,"input"),shortDesc=this.renderElement($$,"shortDescInput",this.getLabel("mmtags-Short_description"),this.getConceptDefinition("drol:short").keyValue,true,"input"),longDesc=this.renderElement($$,"longDescTextarea",this.getLabel("mmtags-Long_description"),this.getConceptDefinition("drol:long").keyValue,true,"textarea");name.on("change",()=>{if(this.refs["nameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}});el.append([name,shortDesc,longDesc]);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("mmtags-error-save"))))}return el}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditTopicComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={personTemplate:'<conceptItem conformance="power" standard="NewsML-G2" standardversion="2.20" version="1">'+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/>'+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/>'+"<itemMeta>"+'<itemClass qcode="cinat:concept"/>'+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/>'+"<edNote/>"+'<itemMetaExtProperty type="imext:type" value="x-im/person"/>'+'<itemMetaExtProperty type="imext:firstName" value=""/>'+'<itemMetaExtProperty type="imext:lastName" value=""/>'+'<links xmlns="http://www.infomaker.se/newsml/1.0"/>'+"</itemMeta>"+"<concept>"+'<conceptId uri="im://person/"/>'+'<type qcode="cpnat:person"/>'+"<name></name>"+'<definition role="drol:long"></definition>'+'<definition role="drol:short"></definition>'+"</concept>"+"</conceptItem>",organisationTemplate:'<conceptItem conformance="power" standard="NewsML-G2" standardversion="2.20" version="1">'+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/>'+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/>'+"<itemMeta>"+'<itemClass qcode="cinat:concept"/>'+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/>'+"<edNote/>"+'<itemMetaExtProperty type="imext:type" value="x-im/organisation"/>'+'<links xmlns="http://www.infomaker.se/newsml/1.0"/>'+"</itemMeta>"+"<concept>"+'<conceptId uri="im://organisation/"/>'+'<type qcode="cpnat:organisation"/>'+"<name></name>"+'<definition role="drol:long"></definition>'+'<definition role="drol:short"></definition>'+'<metadata xmlns="http://www.infomaker.se/newsml/1.0">'+'<object id="" type="x-im/contact-info">'+"<data>"+"<email></email>"+"<phone></phone>"+"<fax></fax>"+"<streetAddress></streetAddress>"+"<postalCode></postalCode>"+"<country></country>"+"</data>"+"</object>"+"</metadata>"+"</concept>"+"</conceptItem>",topicTemplate:'<conceptItem conformance="power" standard="NewsML-G2" standardversion="2.20" version="1">'+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/>'+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/>'+"<itemMeta>"+'<itemClass qcode="cinat:concept"/>'+'<provider literal=""/>'+'<pubStatus qcode="stat:usable"/>'+"<firstCreated />"+"<versionCreated/>"+"<edNote/>"+'<itemMetaExtProperty type="imext:type" value="x-im/topic"/>'+'<itemMetaExtProperty type="imext:firstName" value=""/>'+'<itemMetaExtProperty type="imext:lastName" value=""/>'+'<links xmlns="http://www.infomaker.se/newsml/1.0"/>'+"</itemMeta>"+"<concept>"+"<conceptId />"+'<type qcode="cpnat:object"/>'+"<name></name>"+'<definition role="drol:long"></definition>'+'<definition role="drol:short"></definition>'+"</concept>"+"</conceptItem>"
}},,,,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _DefaultValidation=__webpack_require__(215);var _DefaultValidation2=_interopRequireDefault(_DefaultValidation);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;const validationPackage={id:"se.infomaker.defaultvalidation",name:"defaultvalidation",configure:config=>{config.addValidator(_DefaultValidation2.default)}};exports.default=(()=>{if(registerPlugin){registerPlugin(validationPackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class DefaultValidation extends _writer.Validator{constructor(...args){super(...args)}validate(){var pubStatus=_writer.api.newsItem.getPubStatus(),headlines=this.newsItem.querySelectorAll('idf>group element[type="headline"]'),messageMethod;switch(pubStatus.qcode){case"imext:draft":case"stat:canceled":messageMethod=this.addWarning.bind(this);break;default:messageMethod=this.addError.bind(this)}if(headlines.length===0){messageMethod("The article is missing a headline which might make it hard to find.")}else if(headlines[0].childNodes.length===0||headlines[0].firstChild.nodeName!=="#text"||headlines[0].firstChild.textContent.trim()===""){messageMethod("The first headline in the article should not be empty.")}}}exports.default=DefaultValidation},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(253);var _DropheadPackage=__webpack_require__(255);var _DropheadPackage2=_interopRequireDefault(_DropheadPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_DropheadPackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _DropheadComponent=__webpack_require__(256);var _DropheadComponent2=_interopRequireDefault(_DropheadComponent);var _DropheadConverter=__webpack_require__(257);var _DropheadConverter2=_interopRequireDefault(_DropheadConverter);var _DropheadNode=__webpack_require__(258);var _DropheadNode2=_interopRequireDefault(_DropheadNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"drophead",id:"se.infomaker.drophead",configure:function configure(config){_DropheadNode2.default.type=this.name;_DropheadConverter2.default.type=_DropheadNode2.default.type;_DropheadConverter2.default.element=_DropheadNode2.default.type;config.addNode(_DropheadNode2.default);config.addComponent(_DropheadNode2.default.type,_DropheadComponent2.default);config.addConverter("newsml",_DropheadConverter2.default);config.addTextType({name:this.name,data:{type:_DropheadNode2.default.type}});config.addLabel("drophead",{en:"Drophead",sv:"Nedryckare"});config.addLabel("drophead.content",{en:"Drophead",sv:"Nedryckare"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class DropheadComponent extends Component{render($$){return $$("div").addClass("sc-drophead").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=DropheadComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="drophead"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","drophead").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class DropheadNode extends TextBlock{}DropheadNode.define({id:{type:"string"}});exports.default=DropheadNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(260);var _PagedatelinePackage=__webpack_require__(262);var _PagedatelinePackage2=_interopRequireDefault(_PagedatelinePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PagedatelinePackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PagedatelineComponent=__webpack_require__(263);var _PagedatelineComponent2=_interopRequireDefault(_PagedatelineComponent);var _PagedatelineConverter=__webpack_require__(264);var _PagedatelineConverter2=_interopRequireDefault(_PagedatelineConverter);var _PagedatelineNode=__webpack_require__(265);var _PagedatelineNode2=_interopRequireDefault(_PagedatelineNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"pagedateline",id:"se.infomaker.pagedateline",configure:function configure(config){_PagedatelineNode2.default.type=this.name;_PagedatelineConverter2.default.type=_PagedatelineNode2.default.type;_PagedatelineConverter2.default.element=_PagedatelineNode2.default.type;config.addNode(_PagedatelineNode2.default);config.addComponent(_PagedatelineNode2.default.type,_PagedatelineComponent2.default);config.addConverter("newsml",_PagedatelineConverter2.default);config.addTextType({name:this.name,data:{type:_PagedatelineNode2.default.type}});config.addLabel("pagedateline",{en:"Pagedateline",sv:"Vinjett"});config.addLabel("pagedateline.content",{en:"Pagedateline",sv:"Vinjett"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class PagedatelineComponent extends Component{render($$){return $$("div").addClass("sc-pagedateline").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=PagedatelineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="pagedateline"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","pagedateline").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class PagedatelineNode extends TextBlock{}PagedatelineNode.define({id:{type:"string"}});exports.default=PagedatelineNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(267);var _DatelinePackage=__webpack_require__(269);var _DatelinePackage2=_interopRequireDefault(_DatelinePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_DatelinePackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _DatelineComponent=__webpack_require__(270);var _DatelineComponent2=_interopRequireDefault(_DatelineComponent);var _DatelineConverter=__webpack_require__(271);var _DatelineConverter2=_interopRequireDefault(_DatelineConverter);var _DatelineNode=__webpack_require__(272);var _DatelineNode2=_interopRequireDefault(_DatelineNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"dateline",id:"se.infomaker.dateline",configure:function configure(config){_DatelineNode2.default.type=this.name;_DatelineConverter2.default.type=_DatelineNode2.default.type;_DatelineConverter2.default.element=_DatelineNode2.default.type;config.addNode(_DatelineNode2.default);config.addComponent(_DatelineNode2.default.type,_DatelineComponent2.default);config.addConverter("newsml",_DatelineConverter2.default);config.addTextType({name:this.name,data:{type:_DatelineNode2.default.type}});config.addLabel("dateline",{en:"Dateline",sv:"Ortdatering"});config.addLabel("dateline.content",{en:"Dateline",sv:"Ortdatering"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class DatelineComponent extends Component{render($$){return $$("div").addClass("sc-dateline").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=DatelineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="dateline"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","dateline").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class DatelineNode extends TextBlock{}DatelineNode.define({id:{type:"string"}});exports.default=DatelineNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(274);var _PreleadinPackage=__webpack_require__(276);var _PreleadinPackage2=_interopRequireDefault(_PreleadinPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PreleadinPackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PreleadinComponent=__webpack_require__(277);var _PreleadinComponent2=_interopRequireDefault(_PreleadinComponent);var _PreleadinConverter=__webpack_require__(278);var _PreleadinConverter2=_interopRequireDefault(_PreleadinConverter);var _PreleadinNode=__webpack_require__(279);var _PreleadinNode2=_interopRequireDefault(_PreleadinNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"preleadin",id:"se.infomaker.preleadin",configure:function configure(config){_PreleadinNode2.default.type=this.name;_PreleadinConverter2.default.type=_PreleadinNode2.default.type;_PreleadinConverter2.default.element=_PreleadinNode2.default.type;config.addNode(_PreleadinNode2.default);config.addComponent(_PreleadinNode2.default.type,_PreleadinComponent2.default);config.addConverter("newsml",_PreleadinConverter2.default);config.addTextType({name:this.name,data:{type:_PreleadinNode2.default.type}});config.addLabel("preleadin",{en:"Preleadin",sv:"Överingress"});config.addLabel("preleadin.content",{en:"Preleadin",sv:"Överingress"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class PreleadinComponent extends Component{render($$){return $$("div").addClass("sc-preleadin").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=PreleadinComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="preleadin"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","preleadin").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class PreleadinNode extends TextBlock{}PreleadinNode.define({id:{type:"string"}});exports.default=PreleadinNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(281);var _MadmansrowPackage=__webpack_require__(283);var _MadmansrowPackage2=_interopRequireDefault(_MadmansrowPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_MadmansrowPackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _MadmansrowComponent=__webpack_require__(284);var _MadmansrowComponent2=_interopRequireDefault(_MadmansrowComponent);var _MadmansrowConverter=__webpack_require__(285);var _MadmansrowConverter2=_interopRequireDefault(_MadmansrowConverter);var _MadmansrowNode=__webpack_require__(286);var _MadmansrowNode2=_interopRequireDefault(_MadmansrowNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"madmansrow",id:"se.infomaker.madmansrow",configure:function configure(config){_MadmansrowNode2.default.type=this.name;_MadmansrowConverter2.default.type=_MadmansrowNode2.default.type;_MadmansrowConverter2.default.element=_MadmansrowNode2.default.type;config.addNode(_MadmansrowNode2.default);config.addComponent(_MadmansrowNode2.default.type,_MadmansrowComponent2.default);config.addConverter("newsml",_MadmansrowConverter2.default);config.addTextType({name:this.name,data:{type:_MadmansrowNode2.default.type}});config.addLabel("madmansrow",{en:"Madmansrow",sv:"Dårrad"});config.addLabel("madmansrow.content",{en:"Madmansrow",sv:"Dårrad"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class MadmansrowComponent extends Component{render($$){return $$("div").addClass("sc-madmansrow").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=MadmansrowComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="madmansrow"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","madmansrow").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class MadmansrowNode extends TextBlock{}MadmansrowNode.define({id:{type:"string"}});exports.default=MadmansrowNode}]);(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)})([function(module,exports,__webpack_require__){"use strict";var _index=__webpack_require__(121);var _index2=_interopRequireDefault(_index);var _index3=__webpack_require__(1);var _index4=_interopRequireDefault(_index3);var _index5=__webpack_require__(9);var _index6=_interopRequireDefault(_index5);var _index7=__webpack_require__(126);var _index8=_interopRequireDefault(_index7);var _index9=__webpack_require__(23);var _index10=_interopRequireDefault(_index9);var _index11=__webpack_require__(34);var _index12=_interopRequireDefault(_index11);var _index13=__webpack_require__(131);var _index14=_interopRequireDefault(_index13);var _index15=__webpack_require__(153);var _index16=_interopRequireDefault(_index15);var _index17=__webpack_require__(56);var _index18=_interopRequireDefault(_index17);var _index19=__webpack_require__(164);var _index20=_interopRequireDefault(_index19);var _index21=__webpack_require__(67);var _index22=_interopRequireDefault(_index21);var _index23=__webpack_require__(177);var _index24=_interopRequireDefault(_index23);var _DefaultvalidationPackage=__webpack_require__(214);var _DefaultvalidationPackage2=_interopRequireDefault(_DefaultvalidationPackage);var _index25=__webpack_require__(81);var _index26=_interopRequireDefault(_index25);var _seInfomaker=__webpack_require__(201);var _seInfomaker2=_interopRequireDefault(_seInfomaker);var _index27=__webpack_require__(240);var _index28=_interopRequireDefault(_index27);var _index29=__webpack_require__(223);var _index30=_interopRequireDefault(_index29);var _BlockquotePackage=__webpack_require__(287);var _BlockquotePackage2=_interopRequireDefault(_BlockquotePackage);var _ParagraphPackage=__webpack_require__(115);var _ParagraphPackage2=_interopRequireDefault(_ParagraphPackage);var _SubheadlinePackage=__webpack_require__(109);var _SubheadlinePackage2=_interopRequireDefault(_SubheadlinePackage);var _HeadlinePackage=__webpack_require__(96);var _HeadlinePackage2=_interopRequireDefault(_HeadlinePackage);var _Madmansrow=__webpack_require__(280);var _Madmansrow2=_interopRequireDefault(_Madmansrow);var _Drophead=__webpack_require__(252);var _Drophead2=_interopRequireDefault(_Drophead);var _Pagedateline=__webpack_require__(259);var _Pagedateline2=_interopRequireDefault(_Pagedateline);var _Dateline=__webpack_require__(266);var _Dateline2=_interopRequireDefault(_Dateline);var _Preleadin=__webpack_require__(273);var _Preleadin2=_interopRequireDefault(_Preleadin);var _Preamble=__webpack_require__(102);var _Preamble2=_interopRequireDefault(_Preamble);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(()=>{(0,_BlockquotePackage2.default)();(0,_ParagraphPackage2.default)();(0,_SubheadlinePackage2.default)();(0,_HeadlinePackage2.default)();(0,_Madmansrow2.default)();(0,_Drophead2.default)();(0,_Pagedateline2.default)();(0,_Dateline2.default)();(0,_Preleadin2.default)();(0,_Preamble2.default)();(0,_index14.default)("position");(0,_index2.default)();(0,_index12.default)();(0,_index6.default)();(0,_index10.default)();(0,_index4.default)();(0,_index8.default)();(0,_index16.default)();(0,_index18.default)();(0,_index20.default)();(0,_index22.default)();(0,_index26.default)();(0,_DefaultvalidationPackage2.default)();(0,_index24.default)();(0,_seInfomaker2.default)();(0,_index28.default)();(0,_index30.default)()})()},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowPackage=__webpack_require__(2);var _PublishFlowPackage2=_interopRequireDefault(_PublishFlowPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PublishFlowPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowComponent=__webpack_require__(3);var _PublishFlowComponent2=_interopRequireDefault(_PublishFlowComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"publishflow",id:"se.infomaker.publishflow",index:100,configure:function configure(config){config.addPopover(this.id+"_1",{icon:"fa-ellipsis-h",button:"Save",align:"right"},_PublishFlowComponent2.default);config.addLabel("Save",{sv:"Spara"});config.addLabel("Save *",{sv:"Spara *"});config.addLabel("Cancel",{sv:"Avbryt"});config.addLabel("Publish article?",{sv:"Publicera artikeln?"});config.addLabel("This article is currently an unpublished draft",{sv:"Den här artikeln är ett ej publicerat utkast"});config.addLabel("Article is currently pending approval",{sv:"Artikeln väntar på godkännande"});config.addLabel("Scheduled",{sv:"Schemalagd"});config.addLabel("Article is scheduled to be published",{sv:"Artiklen är schemalagd för publicering"});config.addLabel("From",{sv:"Från"});config.addLabel("To",{sv:"Till"});config.addLabel("Republish article?",{sv:"Ompublicera artikeln?"});config.addLabel("Article was published",{sv:"Artikeln publicerades"});config.addLabel("Publish article again?",{sv:"Publicera artikeln igen?"});config.addLabel("Article has been canceled and is no longer published",{sv:"Artikeln har blivit avpublicerad och är ej längre publicerad"});config.addLabel("Unknown state",{sv:"Okänd status"});config.addLabel("This article has an unknown, unsupported, status",{sv:"Artikeln har en okänd eller felaktig status"});config.addLabel("Save as draft",{sv:"Spara som utkast"});config.addLabel("Ready for approval",{sv:"Klar för godkännande"});config.addLabel("Schedule for publish",{sv:"Schemalägg publicering"});config.addLabel("Republish article",{sv:"Ompublicera artikeln"});config.addLabel("Publish article",{sv:"Publicera artikeln"});config.addLabel("Unpublish article",{sv:"Avpublicera artikeln"});config.addLabel("imext:draft",{en:"Draft",sv:"Utkast"});config.addLabel("imext:done",{en:"Ready for approval",sv:"Klar för godkännande"});config.addLabel("stat:withheld",{en:"Scheduled for publication",sv:"Schemalagd för publicering"});config.addLabel("stat:usable",{en:"Published",sv:"Publicerad"});config.addLabel("stat:canceled",{en:"Unpublished",sv:"Avpublicerad"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PublishFlowManager=__webpack_require__(4);var _PublishFlowManager2=_interopRequireDefault(_PublishFlowManager);__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{Component}=substance;const{api,moment,event}=writer;const pluginId="se.infomaker.publishflow";class PublishFlowComponent extends Component{constructor(...args){super(...args);api.events.on(pluginId,event.DOCUMENT_CHANGED,()=>{this.props.popover.setButtonText(this.getLabel("Save *"))});api.events.on(pluginId,event.DOCUMENT_SAVED,()=>{this._onDocumentSaved()});api.events.on(pluginId,event.DOCUMENT_SAVE_FAILED,()=>{this._onDocumentSaveFailed()});api.events.on(pluginId,event.USERACTION_CANCEL_SAVE,()=>{this._onDocumentSaveFailed()});api.events.on(pluginId,event.USERACTION_SAVE,()=>{this.defaultAction()})}dispose(){api.events.off(pluginId,"document:changed");api.events.off(pluginId,"document:saved")}getInitialState(){let status=api.newsItem.getPubStatus();this.publishFlowMgr=new _PublishFlowManager2.default(pluginId);return{status:status,pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop(),allowed:this.publishFlowMgr.getAllowedActions(status.qcode)}}didMount(){this.props.popover.setButtonText(this.getLabel("Save"));this._updateStatus();if(!api.browser.isSupported()){this.props.popover.disable()}}render($$){var el=$$("div").addClass("sc-np-publishflow").append(this.renderBody($$));return el}renderBody($$){let el=$$("div").addClass("sc-np-publish-body"),actions=this.renderAllowedActions($$);switch(this.state.status.qcode){case"imext:draft":el.append([$$("h2").append(this.getLabel("Publish article?")),$$("p").append(this.getLabel("This article is currently an unpublished draft"))]);break;case"imext:done":el.append([$$("h2").append(this.getLabel("Publish article?")),$$("p").append(this.getLabel("Article is currently pending approval"))]);break;case"stat:withheld":el.append([$$("h2").append(this.getLabel("Scheduled")),$$("p").append(this.getLabel("Article is scheduled to be published")+" "+moment(this.state.pubStart.value).fromNow())]);var specEl=$$("p").addClass("dates").append([$$("span").append(this.getLabel("From")+": "),$$("strong").append(moment(this.state.pubStart.value).format("YYYY-MM-DD HH:mm"))]);if(this.state.pubStop){let toObj=moment(this.state.pubStop.value);if(toObj.isValid()){specEl.append([$$("br"),$$("span").append(this.getLabel("To")+": "),$$("strong").append(moment(this.state.pubStop.value).format("YYYY-MM-DD HH:mm"))])}}el.append(specEl);break;case"stat:usable":el.append([$$("h2").append(this.getLabel("Republish article?")),$$("p").append(this.getLabel("Article was published")+" "+moment(this.state.pubStart.value).fromNow())]);break;case"stat:canceled":el.append([$$("h2").append(this.getLabel("Publish article again?")),$$("p").append(this.getLabel("Article has been canceled and is no longer published"))]);break;default:el.append([$$("h2").append(this.getLabel("Unknown state")),$$("p").append(this.getLabel("This article has an unknown, unsupported, status"))]);break}el.append(actions);el.append($$("div").css({"text-align":"right"}).append($$("button").addClass("sc-np-btn btn-secondary").append(this.getLabel("Cancel")).on("click",()=>{this.props.popover.close()})));return el}renderAllowedActions($$){let actionsEl=$$("div").addClass("sc-np-publish-actions");this.publishFlowMgr.getAllowedActions(this.state.status.qcode).forEach(action=>{switch(action){case"imext:draft":actionsEl.append(this.renderActionDraft($$));break;case"imext:done":actionsEl.append(this.renderActionDone($$));break;case"stat:withheld":actionsEl.append(this.renderActionWithheld($$));break;case"stat:usable":actionsEl.append(this.renderActionUsable($$));break;case"stat:canceled":actionsEl.append(this.renderActionCanceled($$));break}});return actionsEl}renderActionDraft($$){return $$("a").append([$$("i").addClass("fa fa-pencil"),$$("span").append(this.getLabel("Save as draft"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToDraft()})})}renderActionDone($$){return $$("a").append([$$("i").addClass("fa fa-check-circle-o"),$$("span").append(this.getLabel("Ready for approval"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToDone()})})}renderActionWithheld($$){let el=$$("div").addClass("sc-np-publish-action-section").ref("pfc-withheld");el.append($$("a").append([$$("i").addClass("fa fa-clock-o"),$$("span").append(this.getLabel("Schedule for publish"))]).addClass("more").on("click",()=>{if(this.refs["pfc-withheld"].hasClass("active")){this.refs["pfc-withheld"].removeClass("active")}else{this.refs["pfc-withheld"].addClass("active")}}));let fromVal="",toVal="";if(this.state.pubStart){fromVal=moment(this.state.pubStart.value).format("YYYY-MM-DDTHH:mm")}if(this.state.pubStop){toVal=moment(this.state.pubStop.value).format("YYYY-MM-DDTHH:mm")}el.append($$("div").addClass("sc-np-publish-action-section-content sc-np-date-time").append([$$("label").attr("for","pfc-lbl-withheld-from").append(this.getLabel("From")),$$("input").attr({id:"pfc-lbl-withheld-from",type:"datetime-local",required:true}).addClass("form-control").ref("pfc-lbl-withheld-from").val(fromVal),$$("label").attr("for","pfc-lbl-withheld-to").append(this.getLabel("To")),$$("input").attr({id:"pfc-lbl-withheld-to",type:"datetime-local"}).addClass("form-control").ref("pfc-lbl-withheld-to").val(toVal),$$("div").addClass("sc-np-publish-action-section-content-actions").append($$("button").addClass("sc-np-btn btn-secondary").append(this.getLabel("Save"))).on("click",()=>{try{var fromVal=this.refs["pfc-lbl-withheld-from"].val(),toVal=this.refs["pfc-lbl-withheld-to"].val();this._save(()=>{this.publishFlowMgr.setToWithheld(fromVal,toVal)})}catch(ex){this.refs["pfc-lbl-withheld-from"].addClass("imc-flash");window.setTimeout(()=>{this.refs["pfc-lbl-withheld-from"].removeClass("imc-flash")},500);return false}})]));return el}renderActionUsable($$){let el=$$("a");if(this.state.status.qcode==="stat:usable"){el.append([$$("i").addClass("fa fa-retweet"),$$("span").append(this.getLabel("Republish article"))])}else{el.append([$$("i").addClass("fa fa-send"),$$("span").append(this.getLabel("Publish article"))])}el.on("click",()=>{this._save(()=>{this.publishFlowMgr.setToUsable()})});return el}renderActionCanceled($$){return $$("a").append([$$("span").append($$("i").addClass("fa fa-ban"),this.getLabel("Unpublish article"))]).on("click",()=>{this._save(()=>{this.publishFlowMgr.setToCanceled()})})}defaultAction(){api.newsItem.save();this.props.popover.disable();this.props.popover.setIcon("fa-refresh fa-spin fa-fw")}_save(beforeSaveFunc){this._saveState();if(beforeSaveFunc){beforeSaveFunc()}this.defaultAction()}_saveState(){this.extendState({previousState:{pubStatus:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop()}})}_onDocumentSaveFailed(){this.props.popover.setIcon("fa-ellipsis-h");this.props.popover.enable();if(!this.state.previousState){this._updateStatus(false);return}api.newsItem.setPubStatus(pluginId,this.state.previousState.pubStatus);if(this.state.previousState.pubStart){api.newsItem.setPubStart(pluginId,this.state.previousState.pubStart)}else{api.newsItem.removePubStart(pluginId)}if(this.state.previousState.pubStop){api.newsItem.setPubStop(pluginId,this.state.previousState.pubStop)}else{api.newsItem.removePubStop(pluginId)}this.extendState({status:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop(),previousState:null});this._updateStatus(false)}_onDocumentSaved(){this.props.popover.setIcon("fa-ellipsis-h");this.props.popover.enable();this.extendState({status:api.newsItem.getPubStatus(),pubStart:api.newsItem.getPubStart(),pubStop:api.newsItem.getPubStop()});this._updateStatus(true)}_updateStatus(updateButtonSavedLabel){if(updateButtonSavedLabel){this.props.popover.setButtonText(this.getLabel("Save"))}if(this.state.status.qcode==="stat:usable"){this.props.popover.setStatusText(this.getLabel(this.state.status.qcode)+" "+moment(this.state.pubStart.value).fromNow())}else if(this.state.status.qcode==="stat:withheld"){this.props.popover.setStatusText(this.getLabel(this.state.status.qcode)+" "+moment(this.state.pubStart.value).fromNow())}else{this.props.popover.setStatusText(this.getLabel(this.state.status.qcode))}}}exports.default=PublishFlowComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{api,moment}=writer;class PublishFlowConfiguration{constructor(pluginId){this.pluginId=pluginId;this.status={"imext:draft":{allowed:["imext:done","stat:usable","stat:withheld"]},"imext:done":{allowed:["stat:usable","imext:draft","stat:withheld"]},"stat:withheld":{allowed:["stat:withheld","stat:usable","stat:canceled","imext:draft"]},"stat:usable":{allowed:["stat:usable","stat:canceled"]},"stat:canceled":{allowed:["imext:draft","imext:done","stat:usable","stat:withheld"]}}}getAllowedActions(status){if(this.status[status]){return this.status[status].allowed}return[]}setToDraft(){this.setStatus("imext:draft",null,null)}setToDone(){this.setStatus("imext:done",null,null)}setToWithheld(from,to){let fromObj=moment(from),toObj=moment(to);if(!fromObj.isValid()){throw new Error("Invalid from date and time")}this.setStatus("stat:withheld",{value:fromObj.format("YYYY-MM-DDTHH:mm:ssZ")},!toObj.isValid()?null:{value:toObj.format("YYYY-MM-DDTHH:mm:ssZ")})}setToUsable(){this.setStatus("stat:usable",{value:moment().format("YYYY-MM-DDTHH:mm:ssZ")},null)}setToCanceled(){this.setStatus("stat:canceled",null,null);
}setStatus(qcode,pubStart,pubStop){if(qcode){api.newsItem.setPubStatus(this.pluginId,{qcode:qcode})}if(pubStart===null){api.newsItem.removePubStart(this.pluginId)}else if(typeof pubStart!=="undefined"){api.newsItem.setPubStart(this.pluginId,pubStart)}if(pubStop===null){api.newsItem.removePubStop(this.pluginId)}else if(typeof pubStop!=="undefined"){api.newsItem.setPubStop(this.pluginId,pubStop)}}}exports.default=PublishFlowConfiguration},function(module,exports){},,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(10);var _SocialembedPackage=__webpack_require__(12);var _SocialembedPackage2=_interopRequireDefault(_SocialembedPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_SocialembedPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _SocialembedComponent=__webpack_require__(13);var _SocialembedComponent2=_interopRequireDefault(_SocialembedComponent);var _SocialembedCommand=__webpack_require__(15);var _SocialembedCommand2=_interopRequireDefault(_SocialembedCommand);var _SocialembedConverter=__webpack_require__(18);var _SocialembedConverter2=_interopRequireDefault(_SocialembedConverter);var _SocialembedMacro=__webpack_require__(19);var _SocialembedMacro2=_interopRequireDefault(_SocialembedMacro);var _SocialembedNode=__webpack_require__(20);var _SocialembedNode2=_interopRequireDefault(_SocialembedNode);var _DropSocialEmbed=__webpack_require__(22);var _DropSocialEmbed2=_interopRequireDefault(_DropSocialEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"socialembed",id:"se.infomaker.socialembed",configure:function configure(config){config.addNode(_SocialembedNode2.default);config.addCommand("socialembed",_SocialembedCommand2.default);config.addComponent(_SocialembedNode2.default.type,_SocialembedComponent2.default);config.addConverter("newsml",_SocialembedConverter2.default);config.addMacro(_SocialembedMacro2.default);config.addDragAndDrop(_DropSocialEmbed2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class SocialembedComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this.rerender,this,{path:[this.props.node.id]});this.context.api.document.triggerFetchResourceNode(this.props.node,{history:false})}dispose(){this.context.editorSession.off(this)}render($$){const node=this.props.node;const el=$$("div").addClass("im-blocknode__container").addClass(node.socialChannel).attr("contenteditable",false);if(node.hasPayload()){const innerEl=$$("div").ref("embed-container");const headerEl=this.renderHeader($$,node);const contentEl=this.renderContent($$,node);innerEl.append([headerEl,contentEl]);el.append(innerEl)}else if(node.errorMessage){el.append($$("div").addClass("se-error").append(node.errorMessage))}else{el.append($$(_substance.FontAwesomeIcon,{icon:"fa-spin fa-refresh"}))}return el}renderContent($$,node){return $$("div").ref("embedContent").addClass("im-blocknode__content full-width").html(node.html)}renderHeader($$,node){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:node.socialChannelIcon}),$$("strong").append(node.socialChannel).attr("contenteditable",false)]).addClass("header").attr("contenteditable",false)}removeEmbed(){this.context.api.document.deleteNode("socialembed",this.props.node)}}SocialembedComponent.noStyle=true;exports.default=SocialembedComponent},function(module,exports){module.exports=substance},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertEmbed=__webpack_require__(17);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class SocialembedCommand extends _writer.WriterCommand{execute(params){if(params.isPaste){const currentNode=params.selection.getPath();if(!currentNode){return false}const currentNodeId=currentNode[0];const previousNode=_writer.api.document.getPreviousNode(currentNodeId);_writer.api.document.deleteNode("socialembed",previousNode)}params.editorSession.transaction(tx=>{(0,_insertEmbed2.default)(tx,params.url)});return true}}exports.default=SocialembedCommand},function(module,exports){module.exports=writer},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=insertEmbed;function insertEmbed(tx,embedUrl){tx.insertBlockNode({type:"socialembed",dataType:"x-im/socialembed",url:embedUrl})}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"socialembed",tagName:"object",matchElement:function matchElement(el){return el.is('object[type="x-im/socialembed"]')},import:function _import(el,node){node.dataType=el.attr("type");const linkEl=el.find("links>link");node.url=linkEl.attr("url");node.uri=linkEl.attr("uri");node.linkType=linkEl.attr("type")},export:function _export(node,el,converter){const $$=converter.$$;el.attr({id:node.id,type:node.dataType});el.removeAttr("data-id");const links=$$("links");const link=$$("link");link.attr({rel:"self",type:node.linkType,url:node.url,uri:node.uri});links.append(link);el.append(links)}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={execute:function execute(params,context){const editorSession=context.editorSession;const text=params.text;if(params.action!=="break"){return}let match=/^\s*(https?:\/\/([^\s]+))\s*$/.exec(text);if(!match)return;let url=match[1];let hasMatch=false;if(url.indexOf("twitter")>0){hasMatch=true}else if(url.indexOf("instagram")>0){hasMatch=true}else if(url.indexOf("facebook")>0){hasMatch=true}else if(url.indexOf("vimeo")>0){hasMatch=true}else if(url.indexOf("soundcloud")>0){hasMatch=true}if(hasMatch){editorSession.executeCommand("socialembed",{url:url,isPaste:true});return true}return false}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _embedInfoFromURL=__webpack_require__(21);var _embedInfoFromURL2=_interopRequireDefault(_embedInfoFromURL);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class SocialembedNode extends _substance.BlockNode{fetchPayload(context,cb){let url=this.url;let embedInfo=(0,_embedInfoFromURL2.default)(url);switch(embedInfo.socialChannel){case"twitter":this._loadTwitter(url,context,cb);break;case"instagram":this._loadInstagram(url,context,cb);break;case"facebook":this._loadFacebook(url,context,cb);break;case"vimeo":this._loadVimeo(url,context,cb);break;case"soundcloud":this._loadSoundcloud(url,context,cb);break;default:cb(new Error("Could not resolve an embed for this url"))}}hasPayload(){return Boolean(this.html)}_loadInstagram(url,context,cb){const instagramBase=`https://api.instagram.com/oembed?url=${encodeURIComponent(url)}&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:instagramBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{let tplNode=document.createElement("template"),parentNode,oldImgNode,newImgNode;try{tplNode.innerHTML=json.html;parentNode=tplNode.content.childNodes[0].querySelector("blockquote>div");oldImgNode=tplNode.content.childNodes[0].querySelector("blockquote>div>div");newImgNode=document.createElement("img");newImgNode.setAttribute("src",json.thumbnail_url);newImgNode.style.width="100%";newImgNode.style.textAlign="center";tplNode.content.childNodes[0].style.boxShadow=null;parentNode.style.padding=0;parentNode.removeChild(oldImgNode);parentNode.insertBefore(newImgNode,parentNode.firstChild);json.html=tplNode.innerHTML}catch(ex){}cb(null,{author:json.author_url,html:json.html,uri:`im://instagram/${json.media_id}`,url:url,title:json.title,linkType:"x-im/instagram",socialChannel:"Instagram",socialChannelIcon:"fa-instagram"},{history:false})}).catch(error=>{cb(error)})}_loadFacebook(url,context,cb){const apiBase=`https://www.facebook.com/plugins/post/oembed.json?url=${encodeURIComponent(url)}&omitscript=true`;let postId=(0,_writer.uuidv5)("url","https://facebook.com");const matches=/.*[\/=](\d+)/.exec(url);if(matches&&matches.length===2){postId=matches[1]}_writer.api.router.get("/api/resourceproxy",{url:apiBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://facebook-post/${postId}`,url:json.url,linkType:"x-im/facebook-post",socialChannel:"Facebook",socialChannelIcon:"fa-facebook"},{history:false})}).catch(error=>{cb(error)})}_loadTwitter(url,context,cb){const twitterBase=`https://api.twitter.com/1/statuses/oembed.json?url=${encodeURIComponent(url)}&hide_media=false&omit_script=true`;const twitterPostId=/status*\/(\d+)/.exec(url);_writer.api.router.get("/api/resourceproxy",{url:twitterBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://tweet/${twitterPostId[1]}`,url:json.url,linkType:"x-im/tweet",socialChannel:"Twitter",socialChannelIcon:"fa-twitter"},{history:false})}).catch(error=>{cb(error)})}_loadVimeo(url,context,cb){const vimeoBase=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(url)}&format=json&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:vimeoBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://vimeo/${json.video_id}`,url:url,title:json.title,linkType:"x-im/vimeo",socialChannel:"Vimeo",socialChannelIcon:"fa-vimeo"},{history:false})}).catch(error=>{cb(error)})}_loadSoundcloud(url,context,cb){const soundcloudBase=`https://soundcloud.com/oembed?format=json&url=${encodeURIComponent(url)}&omitscript=true`;_writer.api.router.get("/api/resourceproxy",{url:soundcloudBase}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>_writer.api.router.toJson(response)).then(json=>{cb(null,{author:json.author_url,html:json.html,uri:`im://soundcloud/${encodeURIComponent(json.author_name+"."+json.title)}`,url:url,title:json.title,linkType:"x-im/soundcloud",socialChannel:"Soundcloud",socialChannelIcon:"fa-soundcloud"},{history:false})}).catch(error=>{cb(error)})}}SocialembedNode.isResource=true;SocialembedNode.define({type:"socialembed",dataType:"string",url:"string",data:{type:"string",optional:true},errorMessage:{type:"string",optional:true},html:{type:"string",optional:true},uri:{type:"string",optional:true},linkType:{type:"string",optional:true},author:{type:"string",optional:true},socialChannel:{type:"string",optional:true},socialChannelIcon:{type:"string",optional:true}});exports.default=SocialembedNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=embedInfoFromURL;var _writer=__webpack_require__(16);function embedInfoFromURL(url){if(!_writer.lodash.isString(url)){return{isEmbed:false}}let result={isEmbed:true};if(url.indexOf("twitter")>0){result.socialChannel="twitter"}else if(url.indexOf("instagram")>0){result.socialChannel="instagram"}else if(url.indexOf("facebook")>0){result.socialChannel="facebook"}else if(url.indexOf("vimeo")>0){result.socialChannel="vimeo"}else if(url.indexOf("soundcloud")>0){result.socialChannel="soundcloud"}else{result.isEmbed=false}return result}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _embedInfoFromURL=__webpack_require__(21);var _embedInfoFromURL2=_interopRequireDefault(_embedInfoFromURL);var _insertEmbed=__webpack_require__(17);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropSocialEmbed extends _substance.DragAndDropHandler{match(params){if(params.type==="uri"){let embedInfo=(0,_embedInfoFromURL2.default)(params.uri);return embedInfo.isEmbed}}drop(tx,params){(0,_insertEmbed2.default)(tx,params.uri)}}exports.default=DropSocialEmbed},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(24);var _XimteaserPackage=__webpack_require__(26);var _XimteaserPackage2=_interopRequireDefault(_XimteaserPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_XimteaserPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(24);var _XimteaserComponent=__webpack_require__(27);var _XimteaserComponent2=_interopRequireDefault(_XimteaserComponent);var _XimteaserConverter=__webpack_require__(29);var _XimteaserConverter2=_interopRequireDefault(_XimteaserConverter);var _Ximteaser=__webpack_require__(30);var _Ximteaser2=_interopRequireDefault(_Ximteaser);var _XimteaserTool=__webpack_require__(31);var _XimteaserTool2=_interopRequireDefault(_XimteaserTool);var _XimteaserCommand=__webpack_require__(32);var _XimteaserCommand2=_interopRequireDefault(_XimteaserCommand);var _XimteaserInsertImageCommand=__webpack_require__(33);var _XimteaserInsertImageCommand2=_interopRequireDefault(_XimteaserInsertImageCommand);var _substance=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"ximteaser",id:"se.infomaker.ximteaser",configure:function configure(config,pluginConfig){config.addNode(_Ximteaser2.default);config.addComponent(_Ximteaser2.default.type,_XimteaserComponent2.default);config.addConverter("newsml",_XimteaserConverter2.default);config.addContentMenuTopTool("ximteaser",_XimteaserTool2.default);config.addCommand("ximteaser",_XimteaserCommand2.default,pluginConfig);config.addCommand("ximteaserinsertimage",_XimteaserInsertImageCommand2.default,pluginConfig);config.addIcon("ximteaser",{fontawesome:" fa-newspaper-o"});if(_substance.platform.isMac){config.addKeyboardShortcut("cmd+alt+t",{command:"ximteaser"})}else{config.addKeyboardShortcut("ctrl+alt+t",{command:"ximteaser"})}config.addLabel("Insert Teaser",{en:"Insert Teaser",sv:"Infoga puff"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _FileInputComponent=__webpack_require__(28);var _FileInputComponent2=_interopRequireDefault(_FileInputComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class XimteaserComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this._onDocumentChange,this);this.parent.parent.attr("draggable",false);this.parent.attr("draggable",false);this.attr("draggable",false)}dispose(){this.context.editorSession.off(this)}_onDocumentChange(change){if(change.isAffected(this.props.node.id)||change.isAffected(this.props.node.imageFile)){this.rerender()}}render($$){const node=this.props.node;const el=$$("div").addClass("sc-ximteaser im-blocknode__container");const teaserFields=_writer.api.getConfigValue("se.infomaker.ximteaser","fields",[]);el.append(this.renderHeader($$));const ImageDisplay=_writer.api.ui.getComponent("imageDisplay");if(this.props.node.imageFile){el.append($$(ImageDisplay,{parentId:"se.infomaker.ximteaser",node:node,isolatedNodeState:this.props.isolatedNodeState,removeImage:this.removeImage.bind(this)}).ref("image"))}el.append(this.renderContent($$,teaserFields));return el}removeImage(){_writer.api.editorSession.transaction(tx=>{const node=this.props.node;tx.set([node.id,"imageFile"],null);tx.set([node.id,"subject"],"")})}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-newspaper-o"}),$$("strong").append(this.getLabel("Teaser")),$$(_FileInputComponent2.default,{onChange:this.triggerFileUpload.bind(this)})]).addClass("header")}triggerFileUpload(ev){const editorSession=_writer.api.editorSession;editorSession.executeCommand("ximteaserinsertimage",{type:"file",data:ev.target.files,context:{node:this.props.node}})}renderContent($$,teaserFields){const content=$$("div").addClass("im-blocknode__content full-width");if(teaserFields.indexOf("subject")>=0){content.append(this.renderSubjectEditor($$))}content.append(this.renderTitleEditor($$));if(teaserFields.indexOf("text")>=0){content.append(this.renderTextEditor($$))}return content}renderSubjectEditor($$){if(this.props.node.imageFile){const subjectContainer=$$("div");const subjectEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"subject"],doc:this.props.doc}).ref("subject").addClass("x-im-teaser-subject");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-flag"});subjectContainer.append([icon,subjectEditor]);return subjectContainer}}renderTitleEditor($$){const titleContainer=$$("div");const titleEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"title"],doc:this.props.doc}).ref("title").addClass("x-im-teaser-title");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-header"});titleContainer.append([icon,titleEditor]);return titleContainer}renderTextEditor($$){const textContainer=$$("div");const textEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"text"],doc:this.props.doc}).ref("text").addClass("x-im-teaser-text");const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-paragraph"});textContainer.append([icon,textEditor]);return textContainer}}exports.default=XimteaserComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class FileInputComponent extends _substance.Component{render($$){const uploadbutton=$$("span").addClass("upload-button").append($$(_substance.FontAwesomeIcon,{icon:"fa-upload"})).on("click",this.triggerFileDialog).attr("title",this.getLabel("Upload image"));const fileInput=$$("input").attr("type","file").attr("multiple","multiple").ref("fileInput").on("change",this.props.onChange);return $$("span").addClass("fileinput").append([uploadbutton,fileInput])}triggerFileDialog(){const evt=document.createEvent("MouseEvents");evt.initEvent("click",true,false);this.refs.fileInput.el.el.dispatchEvent(evt)}}exports.default=FileInputComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"ximteaser",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/teaser"},import:function _import(el,node,converter){const nodeId=el.attr("id");node.title=el.attr("title");node.dataType=el.attr("type");const linkEl=el.find("links>link");if(linkEl){node.imageType=linkEl.attr("type");let imageFile={id:(0,_writer.idGenerator)(),type:"npfile",imType:"x-im/image",parentNodeId:nodeId};if(linkEl.attr("uuid")){imageFile.uuid=linkEl.attr("uuid")}if(linkEl.attr("uri")){node.uri=linkEl.attr("uri")}if(linkEl.attr("url")){imageFile.url=linkEl.attr("url")}converter.createNode(imageFile);node.imageFile=imageFile.id;node.uuid=linkEl.attr("uuid")}const dataEl=el.find("data");node.crops={};if(dataEl){dataEl.children.forEach(function(child){if(child.tagName==="text"){node.text=converter.annotatedText(child,[node.id,"text"])}if(child.tagName==="subject"){node.subject=converter.annotatedText(child,[node.id,"subject"])}if(child.tagName==="width"){node.width=parseInt(child.text(),10)}if(child.tagName==="height"){node.height=parseInt(child.text(),10)}if(child.tagName==="crops"&&child.children.length>0){let crops={crops:[]};child.children.forEach(function(crop){if(crop.children.length===0){return}if(crop.tagName==="width"){crops.width=crop.text()}else if(crop.tagName==="height"){crops.height=crop.text()}else{var x=crop.find("x"),y=crop.find("y"),width=crop.find("width"),height=crop.find("height");crops.crops.push({name:crop.attr("name"),x:x.text(),y:y.text(),width:width.text(),height:height.text()})}});if(crops.crops.length){node.crops=crops}}})}},export:function _export(node,el,converter){const $$=converter.$$;el.removeAttr("data-id");el.attr({id:node.id,type:"x-im/teaser"});if(node.title){el.attr("title",converter.annotatedText([node.id,"title"]))}const data=$$("data");if(node.width){data.append($$("width").append(String(node.width)))}if(node.height){data.append($$("height").append(String(node.width)))}if(node.text){data.append($$("text").append(converter.annotatedText([node.id,"text"])))}if(node.subject){data.append($$("subject").append(converter.annotatedText([node.id,"subject"])))}if(node.crops){let crops=$$("crops");for(var x in node.crops.crops){var origCrop=node.crops.crops[x];crops.append($$("crop").attr("name",origCrop.name).append([$$("x").append(origCrop.x),$$("y").append(origCrop.y),$$("width").append(origCrop.width),$$("height").append(origCrop.height)]))}data.append(crops)}el.append(data);let fileNode=node.document.get(node.imageFile);if(fileNode&&fileNode.uuid!==""&&node.uri){const link=$$("link").attr({rel:"image",type:"x-im/image",uri:node.uri,uuid:fileNode.uuid});el.append($$("links").append(link))}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class Ximteaser extends _substance.BlockNode{getImageFile(){if(this.imageFile){return this.document.get(this.imageFile)}}getUrl(){let imageFile=this.getImageFile();if(imageFile){return imageFile.getUrl()}}setSoftcropData(data){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"crops"],data)})}handleDOMDocument(newsItemDOMDocument){const dom=newsItemDOMDocument.documentElement,uuid=dom.getAttribute("guid"),uri=dom.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]').getAttribute("value"),width=dom.querySelector("contentMeta > metadata > object > data > width"),height=dom.querySelector("contentMeta > metadata > object > data > height");_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"uuid"],uuid);tx.set([this.id,"uri"],uri);tx.set([this.id,"width"],width?width.textContent:"");tx.set([this.id,"height"],height?height.textContent:"")},{history:false})}}Ximteaser.define({type:"ximteaser",dataType:{type:"string",optional:false},imageFile:{type:"file",optional:true},uuid:{type:"string",optional:true},uri:{type:"string",optional:true},title:{type:"string",optional:false,default:""},subject:{type:"string",optional:false,default:""},text:{type:"string",optional:false,default:""},width:{type:"number",optional:true},height:{type:"number",optional:true},crops:{type:"object",default:[]}});exports.default=Ximteaser},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimteaserTool extends _substance.Tool{render($$){const el=$$("div");el.attr("title",this.getLabel("Insert Teaser"));el.append($$("button").addClass("se-tool").append($$("i").addClass("fa fa-newspaper-o")).on("click",this.insertTeaser));return el}insertTeaser(){const commandName=this.getCommandName();_writer.api.editorSession.executeCommand(commandName,{test:"hello"})}}exports.default=XimteaserTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimteaserCommand extends _writer.WriterCommand{execute(params,context){const teaserPosition=context.api.getConfigValue(this.config.id,"teaserPosition","bottom");const nodes=_writer.api.document.getDocumentNodes();const existingTeaser=nodes.filter(node=>{return node.dataType==="x-im/teaser"});if(existingTeaser.length>0){_writer.api.ui.showNotification("se.infomaker.ximteaser",_writer.api.getLabel("A teaser already exist"),_writer.api.getLabel("There is already a teaser in this document"));return false}switch(teaserPosition){case"top":this.insertTeaserAtTop(params);break;default:this.insertTeaserAtBottom(params);break}}insertTeaserAtTop(params){const editorSession=params.editorSession;const doc=editorSession.getDocument();editorSession.transaction(tx=>{const firstNodeId=doc.getNodes()["body"].nodes[0];tx.selection=doc.createSelection({type:"property",containerId:"body",path:[firstNodeId,"content"],startOffset:0});tx.insertBlockNode(this.getEmptyTeaserNode())})}insertTeaserAtBottom(params){const editorSession=params.editorSession;editorSession.transaction(tx=>{const body=tx.get("body");const node=tx.create(this.getEmptyTeaserNode());body.show(node.id)})}getEmptyTeaserNode(){return{type:"ximteaser",dataType:"x-im/teaser",id:(0,_writer.idGenerator)(),uuid:"",url:"",imageType:"x-im/image",title:"",text:"",crops:[]}}}exports.default=XimteaserCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimteaserInsertImageCommand extends _writer.WriterCommand{constructor(...args){super(...args);this.name="ximteaserinsertimage"}execute(params,context){const teaserNode=params.context.node;const editorSession=context.editorSession;const file=params.data[0];editorSession.transaction(tx=>{let imageFile=tx.create({parentNodeId:teaserNode.id,type:"npfile",imType:"x-im/image",mimeType:file.type,sourceFile:file});tx.set([teaserNode.id,"imageFile"],imageFile.id)});_writer.api.editorSession.fileManager.sync()}}exports.default=XimteaserInsertImageCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(35);__webpack_require__(37);__webpack_require__(39);var _XimimagePackage=__webpack_require__(41);var _XimimagePackage2=_interopRequireDefault(_XimimagePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_XimimagePackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports){},,function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimimageComponent=__webpack_require__(42);var _XimimageComponent2=_interopRequireDefault(_XimimageComponent);var _XimimageConverter=__webpack_require__(46);var _XimimageConverter2=_interopRequireDefault(_XimimageConverter);var _Ximimage=__webpack_require__(47);var _Ximimage2=_interopRequireDefault(_Ximimage);var _InsertImagesTool=__webpack_require__(48);var _InsertImagesTool2=_interopRequireDefault(_InsertImagesTool);var _InsertImagesCommand=__webpack_require__(49);var _InsertImagesCommand2=_interopRequireDefault(_InsertImagesCommand);var _DropImageFile=__webpack_require__(51);var _DropImageFile2=_interopRequireDefault(_DropImageFile);var _DropImageUri=__webpack_require__(52);var _DropImageUri2=_interopRequireDefault(_DropImageUri);var _DropImageUUID=__webpack_require__(53);var _DropImageUUID2=_interopRequireDefault(_DropImageUUID);var _XimimageFileProxy=__webpack_require__(54);var _XimimageFileProxy2=_interopRequireDefault(_XimimageFileProxy);var _InsertImageUrlCommand=__webpack_require__(55);var _InsertImageUrlCommand2=_interopRequireDefault(_InsertImageUrlCommand);var _ImageDisplay=__webpack_require__(43);var _ImageDisplay2=_interopRequireDefault(_ImageDisplay);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"ximimage",id:"se.infomaker.ximimage",configure:function configure(config){config.addNode(_Ximimage2.default);config.addComponent(_Ximimage2.default.type,_XimimageComponent2.default);config.addConverter("newsml",_XimimageConverter2.default);config.addContentMenuTopTool("insert-images",_InsertImagesTool2.default);config.addCommand("insert-images",_InsertImagesCommand2.default);config.addCommand("ximimage-insert-image-url",_InsertImageUrlCommand2.default);config.addComponent("imageDisplay",_ImageDisplay2.default);config.addConverter("newsml",_XimimageConverter2.default);config.addDragAndDrop(_DropImageFile2.default);config.addDragAndDrop(_DropImageUri2.default);config.addDragAndDrop(_DropImageUUID2.default);config.addIcon("image",{fontawesome:"fa-image"});config.addIcon("crop",{fontawesome:"fa-crop"});config.addIcon("user-plus",{fontawesome:"fa-user-plus"});config.addIcon("upload",{fontawesome:"fa-upload"});config.addIcon("remove",{fontawesome:"fa-times"});config.addFileProxy(_XimimageFileProxy2.default);config.addLabel("Upload image",{en:"Upload image",sv:"Ladda upp bild"});config.addLabel("remove-image-button-title",{en:"Remove image",sv:"Ta bort bild"});config.addLabel("Image archive information",{sv:"Arkivinformation om bild"});config.addLabel("Add to image byline",{sv:"Lägg till byline till bild"});config.addLabel("Add to byline",{sv:"Lägg till byline"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ImageDisplay=__webpack_require__(43);var _ImageDisplay2=_interopRequireDefault(_ImageDisplay);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{api}=writer;class XimimageComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){this.context.editorSession.off(this)}_onDocumentChange(change){if(change.isAffected(this.props.node.id)||change.isAffected(this.props.node.imageFile)){this.rerender()}}render($$){let node=this.props.node;let el=$$("div").addClass("sc-ximimage");let fields=api.getConfigValue("se.infomaker.ximimage","fields");el.append($$(_ImageDisplay2.default,{parentId:"se.infomaker.ximimage",node:node,isolatedNodeState:this.props.isolatedNodeState}).ref("image"));this.renderAuthors($$,el);fields.forEach(obj=>{if(obj.type==="option"){el.append(this.renderOptionField($$,obj))}else{el.append(this.renderTextField($$,obj))}});return el}renderAuthors($$,el){if(api.getConfigValue("se.infomaker.ximimage","byline")){const authorList=$$("ul").addClass("dialog-image-authorlist").attr("contenteditable",false);this.props.node.authors.forEach(item=>{const authorItem=this.renderAuthor($$,item);if(authorItem){authorList.append(authorItem)}});el.append($$("div").attr("contenteditable",false).addClass("x-im-image-authors").append(authorList))}}renderAuthor($$,author){const avatar=$$("span").addClass("x-im-image-author-token");const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;return $$("li").append($$("div").append([avatar,$$("div").append([$$("strong").append(author.name)]),$$("span").append($$("a").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"})).attr("title",this.getLabel("Remove")).on("click",()=>{this.removeAuthor(author)}))])).ref("item-"+refid)}removeAuthor(author){const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;
delete this.refs["item-"+refid];const authors=this.props.node.authors;for(let n=0;n<authors.length;n++){if(!_writer.NilUUID.isNilUUID(author.uuid)&&authors[n].uuid===author.uuid){authors.splice(n,1);break}else if(_writer.NilUUID.isNilUUID(author.uuid)&&authors[n].name===author.name){authors.splice(n,1);break}}this.props.node.setAuthors(authors)}renderTextField($$,obj){return $$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,obj.name],doc:this.props.doc}).ref(obj.name).attr("title",obj.label).addClass("x-im-image-dynamic x-im-image-"+obj.name)}renderOptionField($$,obj){let options=[],currentOption=null;if(!this.props.node.alignment){currentOption=obj.options[0].name}else{currentOption=this.props.node.alignment}obj.options.forEach(option=>{let selectedClass=currentOption===option.name?" selected":"";options.push($$("em").addClass("fa "+option.icon+selectedClass).attr({contenteditable:"false",title:option.label}).on("click",()=>{if(option.name!==this.props.node.alignment){this.props.node.setAlignment(option.name);this.rerender()}return false}))});return $$("div").addClass("x-im-image-dynamic x-im-image-alignment").attr({contenteditable:"false"}).append(options)}}exports.default=XimimageComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ImageCropper=__webpack_require__(44);var _ImageCropper2=_interopRequireDefault(_ImageCropper);var _XimimageAddToBylineComponent=__webpack_require__(45);var _XimimageAddToBylineComponent2=_interopRequireDefault(_XimimageAddToBylineComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ImageDisplay extends _substance.Component{constructor(...args){super(...args)}_onDragStart(e){e.preventDefault();e.stopPropagation()}render($$){let imgContainer=$$("div").addClass("se-image-container").ref("imageContainer");let imgSrc;try{this.hasLoadingErrors=false;imgSrc=this.props.node.getUrl()}catch(e){this.hasLoadingErrors=e}let contentElement=$$(_substance.FontAwesomeIcon,{icon:"fa-picture-o"}).attr("style","font-size:25rem;color:#efefef");if(imgSrc){if(this.props.removeImage){const deleteButton=$$(_substance.Button,{icon:"remove"}).addClass("remove-image__button").attr("title",this.getLabel("remove-image-button-title")).on("click",()=>{this.props.removeImage()});imgContainer.append(deleteButton)}contentElement=$$("img",{src:imgSrc}).ref("img")}else if(this.hasLoadingErrors){contentElement=$$(_substance.FontAwesomeIcon,{icon:"fa-chain-broken"}).attr("style","font-size:4rem;").addClass("broken-image").attr("title",this.getLabel("Image could not be found"))}imgContainer.append(contentElement);const imageFile=this.context.doc.get(this.props.node.imageFile);const actionsEl=$$("div").addClass("se-actions");if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"byline")){actionsEl.append($$(_substance.Button,{icon:"user-plus"}).on("click",this._openAddToByline))}if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"imageinfo")){actionsEl.append($$(_substance.Button,{icon:"image"}).on("click",this._openMetaData))}if(!this.hasLoadingErrors&&imageFile.uuid&&_writer.api.getConfigValue(this.props.parentId,"softcrop")){actionsEl.append($$(_substance.Button,{icon:"crop"}).on("click",this._openCropper))}imgContainer.append(actionsEl);let el=$$("div").addClass("sc-image-display");el.addClass("sm-"+this.props.isolatedNodeState);el.append(imgContainer);return el}_openMetaData(){_writer.api.router.getNewsItem(this.props.node.uuid,"x-im/image").then(response=>{_writer.api.ui.showDialog(this.getComponent("dialog-image"),{node:this.props.node,newsItem:response,disablebylinesearch:!_writer.api.getConfigValue(this.props.parentId,"bylinesearch")},{title:this.getLabel("Image archive information"),global:true,primary:this.getLabel("Save"),secondary:this.getLabel("Cancel")})})}_openAddToByline(){_writer.api.ui.showDialog(_XimimageAddToBylineComponent2.default,{authors:this.props.node.authors,removeAuthor:()=>author=>{this.props.node.removeAuthor(author)},addAuthor:(author,cbDone)=>{const authors=this.props.node.authors;authors.push(author);this.props.node.setAuthors(authors);cbDone()}},{title:this.getLabel("Add to image byline"),global:true,primary:this.getLabel("Close"),secondary:false})}_openCropper(){let tertiary=false;if(this.props.node.crops){tertiary=[{caption:this.getLabel("Remove"),callback:()=>{this.props.node.setSoftcropData([]);return true}}]}_writer.api.ui.showDialog(_ImageCropper2.default,{parentId:this.props.parentId,src:this.props.node.getUrl(),width:this.props.node.width,height:this.props.node.height,crops:this.props.node.crops.crops||[],callback:crops=>{this.props.node.setSoftcropData(crops)}},{tertiary:tertiary})}}exports.default=ImageDisplay},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);const{api}=writer;class ImageCropper extends _substance.Component{didMount(){this.cropEditor=new IMSoftcrop.Editor("ximimage__softcrop",{autocrop:false,debug:false});let definedCrops=api.getConfigValue(this.props.parentId,"crops",[]),encodedSrc=encodeURIComponent(this.props.src);this.cropEditor.addImage("/api/resourceproxy?url="+encodedSrc,()=>{let selected=true;for(var name in definedCrops){if(this.props.crops){this.addCrop(name,selected,definedCrops[name],this.props.crops)}else{this.createCrop(name,selected,definedCrops[name])}selected=false}})}createCrop(name,selected,definedCrop){this.cropEditor.addSoftcrop(name,selected,definedCrop[0],definedCrop[1])}addCrop(name,selected,definedCrop,existingCrops){var existingCrop=null;for(var n=0;n<existingCrops.length;n++){if(existingCrops[n].name===name){existingCrop=existingCrops[n];break}}if(!existingCrop){this.createCrop(name,selected,definedCrop);return}let imageWidth=this.props.width;let imageHeight=this.props.height;let matches=this.props.src.match(/&w=([0-9]*)/);if(Array.isArray(matches)&&matches.length===2){imageWidth=matches[1];imageHeight=Math.round(imageWidth/this.props.width*this.props.height)}this.cropEditor.addSoftcrop(name,selected,Math.round(existingCrop.width*imageWidth),Math.round(existingCrop.height*imageHeight),Math.round(existingCrop.x*imageWidth),Math.round(existingCrop.y*imageHeight))}render($$){return $$("div").attr("id","ximimage__softcrop").addClass("sc-image-cropper").ref("cropper")}onClose(status){if(status==="cancel"){return}let data=this.cropEditor.getSoftcropData(),crops=[];data.crops.forEach(crop=>{crops.push({name:crop.id,x:crop.x/data.width,y:crop.y/data.height,width:crop.width/data.width,height:crop.height/data.height})});this.props.callback({crops:crops})}}exports.default=ImageCropper},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimimageAddToBylineComponent extends _substance.Component{constructor(...args){super(...args)}render($$){const el=$$("div").ref("authorContainer").addClass("authors dialog-image-info clearfix");const bylinesearch=this.context.api.getConfigValue("se.infomaker.ximimage","bylinesearch");let searchComponent;if(bylinesearch){const AuthorSearchComponent=this.context.componentRegistry.get("form-search");searchComponent=$$(AuthorSearchComponent,{existingItems:this.props.authors,searchUrl:"/api/search/concepts/authors?q=",onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Add to byline")}).ref("authorSearchComponent")}else{const AuthorAddComponent=this.context.componentRegistry.get("form-add");searchComponent=$$(AuthorAddComponent,{existingItems:this.props.authors,onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Add to byline")}).ref("authorSearchComponent")}return el.append([searchComponent,this.renderAuthors($$)])}renderAuthors($$){const authorList=$$("ul").addClass("dialog-image-authorlist").attr("contenteditable",false);for(let n=0;n<this.props.authors.length;n++){const authorItem=this.renderAuthor($$,this.props.authors[n]);if(authorItem){authorList.append(authorItem)}}return $$("div").addClass("dialog-image-authors").append(authorList)}renderAuthor($$,author){let avatar;avatar=$$("span");const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;return $$("li").append($$("div").append([avatar,$$("div").append([$$("strong").append(author.name),$$("em").append(author.data?author.data.email?author.data.email:"":"")]),$$("span").append($$("a").append($$(_substance.FontAwesomeIcon,{icon:"remove"})).attr("title",this.getLabel("Remove")).on("click",function(){this.removeAuthor(author)}.bind(this)))])).ref("item-"+refid)}createAuthor(authorItem){const author={uuid:_writer.NilUUID.getNilUUID(),name:authorItem.inputValue};this.props.addAuthor(author,function(){this.rerender()}.bind(this))}addAuthor(authorItem){const author={uuid:authorItem.uuid,name:authorItem.name[0]};this.props.addAuthor(author,function(){this.rerender()}.bind(this))}removeAuthor(author){const refid=_writer.NilUUID.isNilUUID(author.uuid)?author.name:author.uuid;delete this.refs["item-"+refid];this.props.removeAuthor(author)}onClose(){return true}}exports.default=XimimageAddToBylineComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"ximimage",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/image"},import:function _import(el,node,converter,newsItemConversion){const objectElementId=el.attr("id");var linkEl=el.find("links>link");let imageFile={id:(0,_writer.idGenerator)(),type:"npfile",imType:"x-im/image",parentNodeId:objectElementId};if(el.attr("uuid")){imageFile.uuid=el.attr("uuid")}if(linkEl&&linkEl.attr("uri")){node.uri=linkEl.attr("uri")}if(linkEl&&linkEl.attr("url")){imageFile.url=linkEl.attr("url")}converter.createNode(imageFile);node.imageFile=imageFile.id;node.uuid=el.attr("uuid");let dataEl;if(newsItemConversion){dataEl=el.find("data")}else{dataEl=linkEl.find("data")}node.caption="";node.alttext="";node.credit="";node.alignment="";if(dataEl){dataEl.children.forEach(function(child){if(child.tagName==="text"){node.caption=converter.annotatedText(child,[node.id,"caption"])}if(child.tagName==="alttext"){node.alttext=converter.annotatedText(child,[node.id,"alttext"])}if(child.tagName==="credit"){node.credit=converter.annotatedText(child,[node.id,"credit"])}if(child.tagName==="alignment"){node.alignment=child.text()}if(child.tagName==="width"){node.width=parseInt(child.text(),10)}if(child.tagName==="height"){node.height=parseInt(child.text(),10)}if(child.tagName==="crops"&&child.children.length>0){var crops={crops:[]};child.children.forEach(function(crop){if(crop.children.length===0){return}if(crop.tagName==="width"){crops.width=crop.text()}else if(crop.tagName==="height"){crops.height=crop.text()}else{var x=crop.find("x"),y=crop.find("y"),width=crop.find("width"),height=crop.find("height");crops.crops.push({name:crop.attr("name"),x:x.text(),y:y.text(),width:width.text(),height:height.text()})}});if(crops.crops.length){node.crops=crops}}})}node.authors=[];let authorLinks;if(newsItemConversion){authorLinks=el.find("links")}else{authorLinks=linkEl.find("links")}if(authorLinks){authorLinks.children.forEach(function(authorLinkEl){if("author"===authorLinkEl.getAttribute("rel")){node.authors.push({uuid:authorLinkEl.getAttribute("uuid"),name:authorLinkEl.getAttribute("title")})}else{console.warn("Unhandled link in image object",authorLinkEl)}})}},export:function _export(node,el,converter){var $$=converter.$$;let fileNode=node.document.get(node.imageFile);el.removeAttr("data-id");el.attr({id:node.id,type:"x-im/image",uuid:fileNode.uuid?fileNode.uuid:_writer.NilUUID.getNilUUID()});var data=$$("data").append([$$("width").append(String(node.width)),$$("height").append(String(node.height))]);let fields=_writer.api.getConfigValue("se.infomaker.ximimage","fields")||[];fields.forEach(obj=>{let name=obj.name==="caption"?"text":obj.name;if(!node[obj.name]){data.append($$(name).append(""))}else if(obj.type==="option"){data.append($$(name).append(node[obj.name]))}else{data.append($$(name).append(converter.annotatedText([node.id,obj.name])))}});if(node.crops){let crops=$$("crops");for(var x in node.crops.crops){if(node.crops.crops.hasOwnProperty(x)){var origCrop=node.crops.crops[x];crops.append($$("crop").attr("name",origCrop.name).append([$$("x").append(origCrop.x),$$("y").append(origCrop.y),$$("width").append(origCrop.width),$$("height").append(origCrop.height)]))}}data.append(crops)}var link=$$("link").attr({rel:"self",type:"x-im/image",uri:node.uri?node.uri:"",uuid:fileNode.uuid?fileNode.uuid:_writer.NilUUID.getNilUUID()}).append(data);if(node.authors.length){var authorLinks=$$("links");for(var n in node.authors){if(node.authors.hasOwnProperty(n)){var authorLink=$$("link").attr({rel:"author",uuid:node.authors[n].uuid,title:node.authors[n].name});if(!_writer.NilUUID.isNilUUID(node.authors[n].uuid)){authorLink.attr("type","x-im/author")}authorLinks.append(authorLink)}}link.append(authorLinks)}el.append($$("links").append(link))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _substance=__webpack_require__(14);const{BlockNode}=substance;class Ximimage extends BlockNode{getImageFile(){if(this.imageFile){return this.document.get(this.imageFile)}}getUrl(){let imageFile=this.getImageFile();if(imageFile){return imageFile.getUrl()}}setAlignment(alignment){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"alignment"],alignment)})}setSoftcropData(data){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"crops"],data)})}setAuthors(authors){_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"authors"],authors)})}handleDOMDocument(newsItemDOMDocument){const dom=newsItemDOMDocument.documentElement,uuid=dom.getAttribute("guid"),uri=dom.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]'),text=dom.querySelector("contentMeta > metadata > object > data > text"),credit=dom.querySelector("contentMeta > metadata > object > data > credit"),width=dom.querySelector("contentMeta > metadata > object > data > width"),height=dom.querySelector("contentMeta > metadata > object > data > height");_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"uuid"],uuid?uuid:"");tx.set([this.id,"uri"],uri?uri.attributes["value"].value:"");tx.set([this.id,"caption"],text?text.textContent:"");tx.set([this.id,"credit"],credit?credit.textContent:"");tx.set([this.id,"width"],width?width.textContent:"");tx.set([this.id,"height"],height?height.textContent:"")},{history:false})}fetchPayload(context,cb){const fileNode=this.getImageFile();if(fileNode.sourceUUID){_writer.api.router.get("/api/newsitem/"+fileNode.uuid,{imType:"x-im/article"}).then(response=>_writer.api.router.checkForOKStatus(response)).then(response=>response.text()).then(xmlString=>{const newsMLImporter=_writer.api.configurator.createImporter("newsml",{api:_writer.api});const newsMLConverters=context.converterRegistry.get("newsml");const ximImageConverter=newsMLConverters.get("ximimage");const imageNewsItemDocument=_substance.DefaultDOMElement.parseXML(xmlString);const imageNewsItem=imageNewsItemDocument[0];let imageObjectElement=imageNewsItem.find('contentMeta > metadata > object[type="x-im/image"]');let node={};const defaultDOMImageNewsitem=_substance.DefaultDOMElement.parseXML(imageObjectElement.outerHTML);ximImageConverter.import(defaultDOMImageNewsitem,node,newsMLImporter,true);const uri=imageNewsItem.find('itemMetaExtProperty[type="imext:uri"]').attr("value");const uuid=imageNewsItem.attr("guid");node.uri=uri;node.uuid=uuid;node.imageFile=fileNode.id;cb(null,node)}).catch(e=>{cb(e)})}}}Ximimage.isResource=true;Ximimage.define({type:"ximimage",uuid:{type:"string",optional:true},uri:{type:"string",optional:true},imageFile:{type:"file"},width:{type:"number",optional:true},height:{type:"number",optional:true},errorMessage:{type:"string",optional:true},crops:{type:"object",default:[]},authors:{type:"array",default:[]},caption:{type:"string",default:""},alttext:{type:"string",optional:true},credit:{type:"string",optional:true},alignment:{type:"string",optional:true}});exports.default=Ximimage},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class XimimageTool extends _substance.Tool{render($$){var el=$$("div");el.attr("title",this.getLabel("Upload image"));el.append($$("button").addClass("se-tool").append($$("i").addClass("fa fa-image")).on("click",this.triggerFileDialog));el.append($$("input").attr("type","file").attr("multiple","multiple").attr("id","x-im-image-fileupload").ref("x-im-image-fileupload").on("change",this.triggerFileUpload));return el}triggerFileDialog(){var evt=document.createEvent("MouseEvents");evt.initEvent("click",true,false);this.refs["x-im-image-fileupload"].el.el.dispatchEvent(evt)}triggerFileUpload(ev){this.context.editorSession.executeCommand("insert-images",{files:ev.target.files})}}exports.default=XimimageTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class XimimageCommand extends _writer.WriterCommand{execute(params){params.editorSession.transaction(tx=>{Array.prototype.forEach.call(params.files,file=>{(0,_insertImage2.default)(tx,file)})});_writer.api.editorSession.fileManager.sync();return true}}exports.default=XimimageCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(tx,data){let isFile=data instanceof File,nodeId=(0,_writer.idGenerator)();if(!typeof data==="string"&&!isFile){throw new Error("Unsupported data. Must be File or String")}const imageFileNode={parentNodeId:nodeId,type:"npfile",imType:"x-im/image"};if(isFile){imageFileNode["sourceFile"]=data}else if(typeof data==="string"){imageFileNode["sourceUrl"]=data}let imageFile=tx.create(imageFileNode);tx.insertBlockNode({id:nodeId,type:"ximimage",imageFile:imageFile.id,caption:"",alttext:"",credit:"",alignment:"",width:0,height:0})};var _writer=__webpack_require__(16)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _substance=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropImageFile extends _substance.DragAndDropHandler{match(params){return params.type==="file"&&_writer.lodash.startsWith(params.file.type,"image")}drop(tx,params){(0,_insertImage2.default)(tx,params.file);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}exports.default=DropImageFile},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropImageUri extends _substance.DragAndDropHandler{match(params){return params.type==="uri"&&_isImage(params.uri)}drop(tx,params){(0,_insertImage2.default)(tx,params.uri);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}function _isImage(uri){return uri.indexOf(".jpg")>0||uri.indexOf(".png")>0||uri.indexOf(".gif")>0}exports.default=DropImageUri},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class DropImageUUID extends _substance.DragAndDropHandler{match(params){if(this.isExistingImageDrop(params)){console.info("Implement support for handle existing image drop",this.getDataFromURL(params.uri));return true}return false}isExistingImageDrop(params){if(params.uri&&params.uri.indexOf("x-im-entity://x-im/image")>=0){return true}}drop(tx,params){const dropData=this.getDataFromURL(params.uri);const uuid=dropData.uuid;const nodeId=(0,_writer.idGenerator)();if(!dropData.uuid){throw new Error("Unsupported data. UUID must exist")}const imageFileNode={parentNodeId:nodeId,type:"npfile",imType:"x-im/image",uuid:uuid,sourceUUID:uuid};let imageFile=tx.create(imageFileNode);tx.insertBlockNode({id:nodeId,type:"ximimage",imageFile:imageFile.id,caption:dropData.name,alttext:"",credit:"",alignment:""})}getDataFromURL(url){const queryParamKey="data=";const dataPosition=url.indexOf(queryParamKey);let encodedData=url.substr(dataPosition+queryParamKey.length,url.length);return JSON.parse(window.atob(encodedData))}}exports.default=DropImageUUID},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimimageFileProxy extends _writer.NPFileProxy{}XimimageFileProxy.match=function(fileNode){return fileNode.imType==="x-im/image"};exports.default=XimimageFileProxy},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _insertImage=__webpack_require__(50);var _insertImage2=_interopRequireDefault(_insertImage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class InsertImageUrlCommand extends _writer.WriterCommand{execute(params){_writer.api.editorSession.transaction(tx=>{(0,_insertImage2.default)(tx,params.imageUrl)});_writer.api.editorSession.fileManager.sync()}}exports.default=InsertImageUrlCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _YoutubeEmbedPackage=__webpack_require__(57);var _YoutubeEmbedPackage2=_interopRequireDefault(_YoutubeEmbedPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_YoutubeEmbedPackage2.default)}else{console.error("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(58);var _YoutubeEmbedCommand=__webpack_require__(60);var _YoutubeEmbedCommand2=_interopRequireDefault(_YoutubeEmbedCommand);var _YoutubeEmbedNode=__webpack_require__(62);var _YoutubeEmbedNode2=_interopRequireDefault(_YoutubeEmbedNode);var _YoutubeEmbedComponent=__webpack_require__(63);var _YoutubeEmbedComponent2=_interopRequireDefault(_YoutubeEmbedComponent);var _YoutubeEmbedConverter=__webpack_require__(64);var _YoutubeEmbedConverter2=_interopRequireDefault(_YoutubeEmbedConverter);var _YoutubeEmbedMacro=__webpack_require__(65);var _YoutubeEmbedMacro2=_interopRequireDefault(_YoutubeEmbedMacro);var _YoutubeEmbedValidation=__webpack_require__(66);var _YoutubeEmbedValidation2=_interopRequireDefault(_YoutubeEmbedValidation);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.youtubeembed",name:"youtubeembed",configure:function configure(config){config.addConverter("newsml",_YoutubeEmbedConverter2.default);config.addComponent("youtubeembed",_YoutubeEmbedComponent2.default);config.addValidator(_YoutubeEmbedValidation2.default);config.addCommand("youtubeembed",_YoutubeEmbedCommand2.default);config.addNode(_YoutubeEmbedNode2.default);config.addMacro(_YoutubeEmbedMacro2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _insertEmbed=__webpack_require__(61);var _insertEmbed2=_interopRequireDefault(_insertEmbed);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class YoutubeEmbedCommand extends _writer.WriterCommand{execute(params){if(params.isPaste){const currentNode=params.selection.getPath();if(!currentNode){return false}const currentNodeId=currentNode[0];const previousNode=_writer.api.document.getPreviousNode(currentNodeId);_writer.api.document.deleteNode("youtubeembed",previousNode)}params.editorSession.transaction(tx=>{(0,_insertEmbed2.default)(tx,params.url)});return true}}exports.default=YoutubeEmbedCommand},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=insertEmbed;function insertEmbed(tx,embedUrl){tx.insertBlockNode({type:"youtubeembed",dataType:"x-im/youtube",url:embedUrl})}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class YoutubeEmbedNode extends _substance.BlockNode{fetchPayload(context,cb){let url=this.url;var baseUrl="https://youtube.com/oembed?url=";var apiUrl=baseUrl+this.url;_writer.api.router.get("/api/resourceproxy/",{url:apiUrl}).then(response=>response.json()).then(json=>{cb(null,{html:json.html,uri:url,thumbnail_url:json.thumbnail_url,title:json.title},{history:false})}).catch(e=>{cb(e)})}hasPayload(){return Boolean(this.html)}}YoutubeEmbedNode.isResource=true;YoutubeEmbedNode.define({type:"youtubeembed",dataType:"string",url:"string",start:{type:"string",default:"00:00"},errorMessage:{type:"string",optional:true},html:{type:"string",optional:true},thumbnail_url:{type:"string",default:""},uri:{type:"string",optional:true},linkType:{type:"string",optional:true},title:{type:"string",default:""}});exports.default=YoutubeEmbedNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class YoutubeEmbedComponent extends _substance.Component{constructor(...args){super(...args);_writer.api.document.triggerFetchResourceNode(this.props.node,{history:false})}didMount(){_writer.api.editorSession.onRender("document",this.rerender,this,{path:[this.props.node.id]})}dispose(){_writer.api.editorSession.off(this)}render($$){const el=$$("div").addClass("im-blocknode__container im-youtube");el.append(this.renderHeader($$));el.append(this.renderContent($$));return el}renderContent($$){const content=$$("div").addClass("im-blocknode__content full-width");const thumbnail=$$("img").attr("src",this.props.node.thumbnail_url).attr("style","width:100%");const startTimeEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"start"],doc:this.props.doc}).ref("startTime").addClass("start-time-editor");content.append(thumbnail);content.append($$(_substance.FontAwesomeIcon,{icon:"fa-clock-o"}));content.append(startTimeEditor);return content}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-youtube"}),$$("strong").append(this.getLabel("Youtube video")+" - "+this.props.node.title)]).addClass("header")}}exports.default=YoutubeEmbedComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"youtubeembed",tagName:"object",matchElement:function matchElement(el){return el.is('object[type="x-im/youtube"]')},import:function _import(el,node){node.dataType=el.attr("type");node.url=el.attr("url");node.uri=el.attr("uri");const startTimeEl=el.find("data > start");let startTimeFromEl=0;if(startTimeEl){startTimeFromEl=startTimeEl.text()}const startTime=_writer.moment.duration(parseInt(startTimeFromEl,10),"seconds");node.start=startTime.minutes()+":"+startTime.seconds()},export:function _export(node,el,converter){const $$=converter.$$;el.attr({id:node.id,type:node.dataType,url:node.url,uri:node.uri});let seconds;if(node.start&&node.start.indexOf(":")>-1){const startTime=node.start.split(":");seconds=parseInt(startTime[0],10)*60+parseInt(startTime[1],10)}else{seconds=node.start}const data=$$("data");data.append($$("start").append(seconds));el.removeAttr("data-id");el.append(data)}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={execute:function execute(params,context){let editorSession=context.editorSession;let text=params.text;if(!params.action==="break")return;let match=/^\s*(https?:\/\/([^\s]+))\s*$/.exec(text);if(!match)return;let url=match[1];if(url.indexOf("youtube")>0){editorSession.executeCommand("youtubeembed",{url:url,isPaste:true});return true}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class YoutubeEmbedValidation extends _writer.Validator{constructor(...args){super(...args)}validate(){const youtubeItems=this.newsItem.querySelectorAll('object[type="x-im/youtube"]');Array.prototype.forEach.call(youtubeItems,item=>{const startEl=item.querySelector("start");const time=parseInt(startEl.textContent,10);if(!Number.isInteger(time)){this.addWarning(_writer.api.getLabel("Youtube video has a invalid start time"))}})}}exports.default=YoutubeEmbedValidation},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _HistoryPackage=__webpack_require__(68);var _HistoryPackage2=_interopRequireDefault(_HistoryPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_HistoryPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(69);var _HistoryMainComponent=__webpack_require__(71);var _HistoryMainComponent2=_interopRequireDefault(_HistoryMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.history",name:"history",configure:function configure(config){config.addLabel("history-popover-headline",{en:"Changes since last successful save",sv:"Senaste ändringar"});config.addLabel("history-popover-description",{en:"Changes since last successful save",sv:"Ändringar sedan senast lyckade uppdatering till servern."});config.addPopover("historymaincomponent",{icon:"fa-history",align:"right"},_HistoryMainComponent2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _VersionSelectorDialog=__webpack_require__(72);var _VersionSelectorDialog2=_interopRequireDefault(_VersionSelectorDialog);var _HistoryItemComponent=__webpack_require__(74);var _HistoryItemComponent2=_interopRequireDefault(_HistoryItemComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class HistoryMainComponent extends _substance.Component{constructor(...args){super(...args);_writer.api.events.on("history",_writer.event.DOCUMENT_SAVED,()=>{_writer.api.history.deleteHistory(_writer.api.newsItem.getIdForArticle());
});_writer.api.events.on("history",_writer.event.HISTORY_SAVED,()=>{this.updateHistoryState()});_writer.api.events.on("history",_writer.event.HISTORY_CLEARED,()=>{this.updateHistoryState()})}dispose(){_writer.api.events.off("history","document:saved");_writer.api.events.off("history","history:added");_writer.api.events.off("history","history:saved")}didMount(){var historyArticles=_writer.api.history.getHistory();var unsavedArticles=historyArticles.filter(function(history){return history.unsavedArticle===true});let buttonText="No thanks, create a new article";let description="We've found some unsaved articles. Click on the version you would like to restore";let title="Unsaved articles found";let historyForArticle=_writer.api.history.get(_writer.api.newsItem.getIdForArticle());if(historyForArticle&&historyForArticle.versions&&historyForArticle.versions.length>0&&_writer.api.newsItem.hasTemporaryId()){return}else if(!_writer.api.newsItem.hasTemporaryId()&&historyForArticle.versions.length>0){unsavedArticles=[historyForArticle];buttonText="Continue with last saved version";description="We found some unsaved changes for this article.";title="Unsaved changes found for this article"}else if(!_writer.api.newsItem.hasTemporaryId()&&historyForArticle.versions.length===0){return}else if(unsavedArticles.length===0){return}if(_writer.api.document.getDocumentStatus()==="writerHasNoDocument"){_writer.api.ui.showDialog(_VersionSelectorDialog2.default,{unsavedArticles:unsavedArticles,descriptionText:description,applyVersion:this.applyVersion.bind(this)},{global:true,secondary:false,primary:this.getLabel(buttonText),title:this.getLabel(title)})}}updateHistoryState(){let id=this.context.api.newsItem.getIdForArticle();this.setState({historyForArticle:this.context.api.history.get(id)})}getInitialState(){let id=this.context.api.newsItem.getIdForArticle();return{historyForArticle:this.context.api.history.get(id)}}render($$){var el=$$("div").addClass("imc-history light").append($$("h2").append(this.getLabel("history-popover-headline")));el.append($$("p").append(this.getLabel("history-popover-description")));if(this.state.historyForArticle===false){return el}const scrollpane=_writer.api.ui.getComponent("scroll-pane");const scroll=$$(scrollpane,{scrollbarType:"native"});let versions=this.state.historyForArticle.versions.reverse().slice(0,100).map(function(version){return this.renderHistoryItem($$,version,this.state.historyForArticle)}.bind(this));scroll.append(versions);el.append(scroll);var historyArticles=this.context.api.history.getHistory();var unsavedArticles=historyArticles.filter(function(history){return history.unsavedArticle===true});if(this.context.api.newsItem.hasTemporaryId()){el.append(this.renderSeeAllUnsavedLink($$,unsavedArticles))}return el}renderSeeAllUnsavedLink($$,unsavedArticles){return $$("a").addClass("all-unsaved-articles").append(this.getLabel("See all other unsaved articles")).on("click",()=>{this.context.api.ui.showDialog(_VersionSelectorDialog2.default,{unsavedArticles:unsavedArticles,descriptionText:this.getLabel("We've found some unsaved articles. Click on the version you would like to restore"),applyVersion:this.applyVersion.bind(this)},{global:true,secondary:false,title:this.getLabel("Following unsaved articles found")})})}renderHistoryItem($$,version,article){return $$(_HistoryItemComponent2.default,{version:version,article:article,applyVersion:this.applyVersion.bind(this)})}applyVersion(version,article){_writer.api.newsItem.setTemporaryId(article.id);_writer.api.events.documentIsUnsaved();_writer.api.newsItem.setSource(version.src,null,true)}}exports.default=HistoryMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _ArticleItem=__webpack_require__(73);var _ArticleItem2=_interopRequireDefault(_ArticleItem);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class VersionSelectorDialog extends _substance.Component{render($$){const el=$$("div").addClass("restore-history-dialog");const unsavedArticles=this.props.unsavedArticles;el.append($$("p").append(this.getLabel(this.props.descriptionText)));let versions=unsavedArticles.map(article=>{return $$(_ArticleItem2.default,{article:article,applyVersion:this.applyVersion.bind(this)})});el.append(versions);return el}applyVersion(version,article){this.props.applyVersion(version,article)}onClose(status){if("cancel"===status){return true}return true}}exports.default=VersionSelectorDialog},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _HistoryItemComponent=__webpack_require__(74);var _HistoryItemComponent2=_interopRequireDefault(_HistoryItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ArticleItem extends _substance.Component{render($$){let el=$$("div").addClass("history-article");let article=this.props.article;const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("icon-delete").attr("title",this.getLabel("Ignore and clear history"))).on("click",function(){this.context.api.history.deleteHistory(article.id);this.remove()}.bind(this));el.append(deleteButton);let title=article.id;el.append($$("h4").append(title));let versions=article.versions.slice(0,100).map(function(version){return this.renderHistoryItem($$,version,article)}.bind(this));el.append(versions);return el}renderHistoryItem($$,version,article){return $$(_HistoryItemComponent2.default,{version:version,article:article,applyVersion:this.props.applyVersion.bind(this)})}}exports.default=ArticleItem},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class HistoryItemComponent extends _substance.Component{render($$){var version=this.props.version;var icon,title;if(this.context.api.newsItemArticle.firstElementChild.outerHTML===version.src){icon="fa fa-check";title=this.getLabel("Identical with the active version")}else{icon="fa fa-file-text-o"}var outer=$$("div").addClass("history-version-item light").append($$("i").addClass(icon).attr("title",title)).on("click",()=>{this.props.applyVersion(version,this.props.article)});var inner=$$("div");inner.append($$("span").append((0,_writer.moment)(version.time).from()));if(version.action==="saved"){inner.addClass("saved")}outer.append(inner);return outer}}exports.default=HistoryItemComponent},,,,,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(82);var _XimpdfPackage=__webpack_require__(84);var _XimpdfPackage2=_interopRequireDefault(_XimpdfPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_XimpdfPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimpdfComponent=__webpack_require__(85);var _XimpdfComponent2=_interopRequireDefault(_XimpdfComponent);var _XimpdfConverter=__webpack_require__(86);var _XimpdfConverter2=_interopRequireDefault(_XimpdfConverter);var _Ximpdf=__webpack_require__(87);var _Ximpdf2=_interopRequireDefault(_Ximpdf);var _XimpdfFileNode=__webpack_require__(88);var _XimpdfFileNode2=_interopRequireDefault(_XimpdfFileNode);var _InsertPdfsTool=__webpack_require__(89);var _InsertPdfsTool2=_interopRequireDefault(_InsertPdfsTool);var _InsertPdfsCommand=__webpack_require__(90);var _InsertPdfsCommand2=_interopRequireDefault(_InsertPdfsCommand);var _DropPdfFile=__webpack_require__(92);var _DropPdfFile2=_interopRequireDefault(_DropPdfFile);var _DropPdfUri=__webpack_require__(93);var _DropPdfUri2=_interopRequireDefault(_DropPdfUri);var _XimpdfMacro=__webpack_require__(94);var _XimpdfMacro2=_interopRequireDefault(_XimpdfMacro);var _XimpdfFileProxy=__webpack_require__(95);var _XimpdfFileProxy2=_interopRequireDefault(_XimpdfFileProxy);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"ximpdf",id:"se.infomaker.ximpdf",configure:function configure(config){config.addNode(_Ximpdf2.default);config.addComponent(_Ximpdf2.default.type,_XimpdfComponent2.default);config.addConverter("newsml",_XimpdfConverter2.default);config.addContentMenuTopTool("insert-pdfs",_InsertPdfsTool2.default);config.addCommand("insert-pdfs",_InsertPdfsCommand2.default);config.addNode(_XimpdfFileNode2.default);config.addDragAndDrop(_DropPdfFile2.default);config.addDragAndDrop(_DropPdfUri2.default);config.addMacro(_XimpdfMacro2.default);config.addFileProxy(_XimpdfFileProxy2.default);config.addLabel("Insert PDF document",{en:"Insert PDF document",sv:"Infoga PDF dokument"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimpdfComponent extends _substance.Component{didMount(){this.context.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){this.context.editorSession.off(this)}_onDocumentChange(change){if(change.isAffected(this.props.node.id)||change.isAffected(this.props.node.pdfFile)){this.rerender()}}render($$){const doc=_writer.api.doc;const node=this.props.node;const fileNode=doc.get(node.pdfFile);const el=$$("div").addClass("im-blocknode__container ximpdf__container");const textEditor=$$(_substance.TextPropertyEditor,{tagName:"div",path:[this.props.node.id,"text"],doc:this.props.doc}).ref("text").addClass("im-blocknode__content");const loadingSpan=$$("span").append("Loading...").addClass("text-pdf");if(fileNode.uuid){el.append([this.renderHeader($$,fileNode),textEditor])}else{el.append([this.renderHeader($$,fileNode),loadingSpan])}return el}renderContent($$){const content=$$("div").addClass("im-blocknode__content");const link=$$("a").append(this.props.node.label).attr("href","#"+this.props.node.uuid).attr("target","_blank").on("click",function(evt){evt.stopPropagation()});content.append(link);return content}renderHeader($$,fileNode){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-file-pdf-o"}),$$("a").append(this.getLabel("Portable Document Format")).attr("contenteditable",false).attr("href",fileNode.url).addClass("pdf-link").attr("target","_blank").on("click",function(evt){evt.stopPropagation()})]).addClass("header").attr("contenteditable",false)}}exports.default=XimpdfComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);exports.default={type:"ximpdf",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/pdf"},import:function _import(el,node,converter){let linkEl=el.find("links>link");let pdfFile={id:(0,_writer.idGenerator)(),type:"npfile",imType:"x-im/pdf",parentNodeId:node.id};if(el.attr("uuid")){pdfFile.uuid=el.attr("uuid")}if(linkEl.attr("uri")){pdfFile.uri=linkEl.attr("uri")}if(linkEl.attr("url")){pdfFile.url=linkEl.attr("url")}converter.createNode(pdfFile);node.pdfFile=pdfFile.id;node.uri=pdfFile.uri;node.uuid=pdfFile.uuid;let dataEl=linkEl.find("data");if(dataEl){dataEl.children.forEach(function(child){if(child.tagName==="text"){node.text=converter.annotatedText(child,[node.id,"text"])}})}},export:function _export(node,el,converter){const $$=converter.$$;const fileNode=node.document.get(node.pdfFile);el.removeAttr("data-id");el.attr({id:node.id,type:"x-im/pdf"});const data=$$("data").append([$$("text").append(converter.annotatedText([node.id,"text"]))]);el.attr("uuid",fileNode.uuid);const link=$$("link").attr({rel:"self",type:"x-im/pdf",uri:node.uri?node.uri:"",uuid:fileNode.uuid?fileNode.uuid:_writer.NilUUID.getNilUUID()}).append(data);el.append($$("links").append(link))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class Ximpdf extends _substance.BlockNode{getPdfFile(){if(this.pdfFile){return this.document.get(this.pdfFile)}}getUrl(){let pdfFile=this.getPdfFile();if(pdfFile){return pdfFile.getUrl()}}handleDOMDocument(newsItemDOMDocument){const document=newsItemDOMDocument.documentElement;const uri=document.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]').getAttribute("value");let text=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > text');const objectName=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > objectName');if(text){text=text.textContent}else if(objectName){text=objectName.textContent}else{text=document.querySelector("itemMeta > fileName").textContent}_writer.api.editorSession.transaction(tx=>{tx.set([this.id,"uri"],uri);tx.set([this.id,"text"],text)},{history:false})}}Ximpdf.define({type:"ximpdf",pdfFile:{type:"file"},uri:{type:"string",optional:true},text:{type:"string",optional:true}});exports.default=Ximpdf},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class XimpdfFileNode extends _substance.FileNode{constructor(...args){super(...args)}handleDocument(xmlString){return new Promise((resolve,reject)=>{try{let doc=_writer.api.editorSession.getDocument();if(!doc.get(this.pdfNodeId)){return resolve()}const parser=new DOMParser;let newsItemDOM=parser.parseFromString(xmlString,"text/xml");let document=newsItemDOM.documentElement;let uuid=document.getAttribute("guid");const uri=document.querySelector('itemMeta > itemMetaExtProperty[type="imext:uri"]').getAttribute("value");let text=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > text');let objectName=document.querySelector('contentMeta > metadata > object[type="x-im/pdf"] > data > objectName');if(text){text=text.textContent}else if(objectName){text=objectName.textContent}else{text=document.querySelector("itemMeta > fileName").textContent}_writer.api.editorSession.transaction(tx=>{tx.set([this.pdfNodeId,"uri"],uri);tx.set([this.pdfNodeId,"text"],text)},{history:false});this.uuid=uuid;resolve()}catch(e){reject(e)}})}getImType(){return"x-im/pdf"}}XimpdfFileNode.define({type:"ximpdffile",pdfNodeId:{type:"string",optional:false},uuid:{type:"string",optional:true},url:{type:"string",optional:true},sourceFile:{type:"object",optional:true},sourceUrl:{type:"string",optional:true}});exports.default=XimpdfFileNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class XimpdfsTool extends _substance.Tool{render($$){var el=$$("div");el.attr("title",this.getLabel("Insert PDF document"));el.append($$("button").addClass("se-tool").append($$("i").addClass("fa fa-file-pdf-o")).on("click",this.triggerFileDialog));el.append($$("input").attr("type","file").attr("multiple","multiple").attr("id","x-im-pdf-fileupload").ref("x-im-pdf-fileupload").on("change",this.triggerFileUpload));return el}triggerFileDialog(){var evt=document.createEvent("MouseEvents");evt.initEvent("click",true,false);this.refs["x-im-pdf-fileupload"].el.el.dispatchEvent(evt)}triggerFileUpload(ev){this.context.editorSession.executeCommand("insert-pdfs",{files:ev.target.files})}}exports.default=XimpdfsTool},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _InsertPdfCommand=__webpack_require__(91);var _InsertPdfCommand2=_interopRequireDefault(_InsertPdfCommand);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class XimpdfCommand extends _writer.WriterCommand{execute(params){if(typeof params.files==="string"){params.editorSession.transaction(tx=>{(0,_InsertPdfCommand2.default)(tx,params.files)})}else{params.editorSession.transaction(tx=>{Array.prototype.forEach.call(params.files,file=>{(0,_InsertPdfCommand2.default)(tx,file)})})}_writer.api.editorSession.fileManager.sync();return true}}exports.default=XimpdfCommand},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(tx,data){const parentNodeId=(0,_writer.idGenerator)();const pdfFileNode={type:"npfile",parentNodeId:parentNodeId,imType:"x-im/pdf"};let isFile=data instanceof File;if(isFile){pdfFileNode["sourceFile"]=data}else if(typeof data==="string"){pdfFileNode["sourceUrl"]=data}else{throw new Error("Unsupported data. Must be File or String")}let pdfFile=tx.create(pdfFileNode);tx.insertBlockNode({id:parentNodeId,type:"ximpdf",pdfFile:pdfFile.id})};var _writer=__webpack_require__(16)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _InsertPdfCommand=__webpack_require__(91);var _InsertPdfCommand2=_interopRequireDefault(_InsertPdfCommand);var _substance=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropPdfFile extends _substance.DragAndDropHandler{match(params){return params.type==="file"&&params.file.type==="application/pdf"}drop(tx,params){(0,_InsertPdfCommand2.default)(tx,params.file);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}exports.default=DropPdfFile},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _InsertPdfCommand=__webpack_require__(91);var _InsertPdfCommand2=_interopRequireDefault(_InsertPdfCommand);var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class DropPdfUri extends _substance.DragAndDropHandler{match(params){return params.type==="uri"&&_isImage(params.uri)}drop(tx,params){(0,_InsertPdfCommand2.default)(tx,params.uri);setTimeout(()=>{_writer.api.editorSession.fileManager.sync()},300)}}function _isImage(uri){return uri.indexOf(".pdf")>0}exports.default=DropPdfUri},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={execute:function execute(params,context){let editorSession=context.editorSession;let text=params.text;if(!params.action==="break"){return}let match=/^\s*(https?:\/\/([^\s]+))\s*$/.exec(text);if(!match){return}let url=match[1];let hasMatch=false;if(url.indexOf(".pdf")>0){hasMatch=true}if(hasMatch){editorSession.executeCommand("insert-pdfs",{files:text});return true}return false}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class XimpdfFileProxy extends _writer.NPFileProxy{}XimpdfFileProxy.match=function(fileNode){return fileNode.imType==="x-im/pdf"};exports.default=XimpdfFileProxy},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _Headline=__webpack_require__(97);var _Headline2=_interopRequireDefault(_Headline);var _HeadlineComponent=__webpack_require__(100);var _HeadlineComponent2=_interopRequireDefault(_HeadlineComponent);var _HeadlineConverter=__webpack_require__(101);var _HeadlineConverter2=_interopRequireDefault(_HeadlineConverter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const headlinePackage={id:"se.infomaker.headline",name:"headline",configure:function configure(config){config.addNode(_Headline2.default);config.addComponent(_Headline2.default.type,_HeadlineComponent2.default);config.addConverter("newsml",_HeadlineConverter2.default);config.addTextType({name:"headline",data:{type:"headline"}});const headlineLbl={en:"Headline",de:"Headline",sv:"Rubrik"};config.addLabel("headline.content",headlineLbl);config.addLabel("headline",headlineLbl)}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(headlinePackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(98);var _substance=__webpack_require__(14);class Headline extends _substance.TextBlock{}Headline.type="headline";exports.default=Headline},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class HeadlineComponent extends _substance.Component{render($$){return $$("div").addClass("sc-headline").attr("data-id",this.props.node.id).append($$(_substance.TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=HeadlineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"headline",tagName:"element",matchElement:function matchElement(el){return el.is('element[type="headline"]')},import:function _import(el,node,converter){var state=converter.state;var oldValue=state.trimWhitespaces;state.trimWhitespaces=true;node.content=converter.annotatedText(el,[node.id,"content"]);state.trimWhitespaces=oldValue},export:function _export(node,el,converter){return el.attr("type","headline").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(103);var _PreamblePackage=__webpack_require__(105);var _PreamblePackage2=_interopRequireDefault(_PreamblePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PreamblePackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PreambleComponent=__webpack_require__(106);var _PreambleComponent2=_interopRequireDefault(_PreambleComponent);var _PreambleConverter=__webpack_require__(107);var _PreambleConverter2=_interopRequireDefault(_PreambleConverter);var _PreambleNode=__webpack_require__(108);var _PreambleNode2=_interopRequireDefault(_PreambleNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"preamble",id:"se.infomaker.preamble",configure:function configure(config){_PreambleNode2.default.type=this.name;_PreambleConverter2.default.type=_PreambleNode2.default.type;_PreambleConverter2.default.element=_PreambleNode2.default.type;config.addNode(_PreambleNode2.default);config.addComponent(_PreambleNode2.default.type,_PreambleComponent2.default);config.addConverter("newsml",_PreambleConverter2.default);config.addTextType({name:this.name,data:{type:_PreambleNode2.default.type}});config.addLabel("preamble",{en:"Preamble",sv:"Ingress"});config.addLabel("preamble.content",{en:"Preamble",sv:"Ingress"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class PreambleComponent extends Component{render($$){return $$("div").addClass("sc-preamble").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=PreambleComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="preamble"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","preamble").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class PreambleNode extends TextBlock{}PreambleNode.define({id:{type:"string"}});exports.default=PreambleNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _Subheadline=__webpack_require__(110);var _Subheadline2=_interopRequireDefault(_Subheadline);var _SubheadlineComponent=__webpack_require__(113);var _SubheadlineComponent2=_interopRequireDefault(_SubheadlineComponent);var _SubheadlineConverter=__webpack_require__(114);var _SubheadlineConverter2=_interopRequireDefault(_SubheadlineConverter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const subheadlinePackage={id:"se.infomaker.subheadline",name:"subheadline",configure:function configure(config){config.addNode(_Subheadline2.default);config.addComponent(_Subheadline2.default.type,_SubheadlineComponent2.default);config.addConverter("newsml",_SubheadlineConverter2.default);config.addTextType({name:"subheadline",data:{type:"subheadline"}});config.addLabel("subheadline",{en:"Subheadline",de:"Subheadline",sv:"Underrubrik"});config.addLabel("subheadline.content",{en:"Subheadline",de:"Subheadline",sv:"Underrubrikrik"})}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(subheadlinePackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(111);var _substance=__webpack_require__(14);class Subheadline extends _substance.TextBlock{}Subheadline.type="subheadline";Subheadline.define({level:{type:"number",default:1},contentType:{type:"string",optional:true},format:{type:"string",default:"html"}});exports.default=Subheadline},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class SubheadlineComponent extends _substance.Component{render($$){let node=this.props.node;return $$("div").addClass("sc-subheadline sc-level-"+node.level).attr("data-id",node.id).append($$(_substance.TextPropertyComponent,{path:[node.id,"content"]}))}}exports.default=SubheadlineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"subheadline",tagName:"element",matchElement:function matchElement(el){return/subheadline\d$/.exec(el.attr("type"))},import:function _import(el,node,converter){var state=converter.state;var oldValue=state.trimWhitespaces;state.trimWhitespaces=true;node.content=converter.annotatedText(el,[node.id,"content"]);node.level=parseInt(String(el.attr("type")[11]),10);state.trimWhitespaces=oldValue},export:function _export(node,el,converter){el.attr({type:node.contentType,format:node.format});return el.attr("type","subheadline"+node.level).append(converter.annotatedText([node.id,"content"]))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _Paragraph=__webpack_require__(116);var _Paragraph2=_interopRequireDefault(_Paragraph);var _ParagraphComponent=__webpack_require__(119);var _ParagraphComponent2=_interopRequireDefault(_ParagraphComponent);var _ParagraphConverter=__webpack_require__(120);var _ParagraphConverter2=_interopRequireDefault(_ParagraphConverter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const paragraphPackage={id:"se.infomaker.paragraph",name:"paragraph",configure:function configure(config){config.addNode(_Paragraph2.default);config.addComponent(_Paragraph2.default.type,_ParagraphComponent2.default);config.addConverter("newsml",_ParagraphConverter2.default);config.addTextType({name:"paragraph",data:{type:"paragraph"}});config.addLabel("paragraph",{en:"Paragraph",de:"Paragraph"});config.addLabel("paragraph.content",{en:"Paragraph",de:"Paragraph"})}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(paragraphPackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(117);var _substance=__webpack_require__(14);class Paragraph extends _substance.TextBlock{}Paragraph.type="paragraph";exports.default=Paragraph},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class ParagraphComponent extends _substance.Component{render($$){return $$("div").addClass("sc-paragraph").attr("data-id",this.props.node.id).append($$(_substance.TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=ParagraphComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"paragraph",tagName:"element",matchElement:function matchElement(el){return el.is('element[type="body"]')||el.is('element[type="paragraph"]')},import:function _import(el,node,converter){var state=converter.state;var oldValue=state.trimWhitespaces;state.trimWhitespaces=true;node.content=converter.annotatedText(el,[node.id,"content"]);state.trimWhitespaces=oldValue},export:function _export(node,el,converter){el.attr("type","body").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TextAnalyzerPackage=__webpack_require__(122);var _TextAnalyzerPackage2=_interopRequireDefault(_TextAnalyzerPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_TextAnalyzerPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TextAnalyzerComponent=__webpack_require__(123);var _TextAnalyzerComponent2=_interopRequireDefault(_TextAnalyzerComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"textanalyzer",id:"se.infomaker.textanalyzer",index:5e3,configure:function configure(config){config.addLabel("Characters",{sv:"Antal tecken"});config.addLabel("Words",{sv:"Antal ord"});config.addPopover("textanalyzer",{icon:"fa-info",align:"right"},_TextAnalyzerComponent2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(124);const{Component}=substance;const{api,event}=writer;class TextanalyzerComponent extends Component{dispose(){api.events.off("textanalyzer",event.DOCUMENT_CHANGED)}constructor(...args){super(...args);api.events.on("textanalyzer",event.DOCUMENT_CHANGED,()=>{this.calculateText()})}calculateText(){var count=this.getCount();this.setState({textLength:count.textLength,words:count.words})}didMount(){}render($$){var el=$$("div").addClass("textanalyzer plugin");var numberContainer=$$("div").addClass("number__container clearfix");var textlengthEl=$$("div").addClass("count-info").append($$("span").append(this.state.textLength.toString())).append($$("p").append(this.getLabel("Characters"))).attr("title",this.getLabel("Characters"));var wordsEl=$$("div").addClass("count-info").append($$("span").append(this.state.words.toString())).append($$("p").append(this.getLabel("Words"))).attr("title",this.getLabel("Words"));
numberContainer.append([textlengthEl,wordsEl]);el.append(numberContainer);return el}getInitialState(){var count=this.getCount();return{textLength:count.textLength,words:count.words}}getCount(){var nodes=api.document.getDocumentNodes();var textContent="";nodes.forEach(function(node){if(node.content){textContent+=node.content.trim()}});var words=textContent.split(/\s+/);var textLength=textContent.length;return{words:words.length,textLength:textLength}}}exports.default=TextanalyzerComponent},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _NewsPriority=__webpack_require__(127);var _NewsPriority2=_interopRequireDefault(_NewsPriority);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_NewsPriority2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(128);var _NewsPriorityComponent=__webpack_require__(130);var _NewsPriorityComponent2=_interopRequireDefault(_NewsPriorityComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"newspriority",id:"se.infomaker.newspriority",configure:function configure(config){config.addComponentToSidebarWithTabId(this.id,"main",_NewsPriorityComponent2.default);config.addLabel("newsvalue",{en:"Newsvalue",sv:"Nyhetsvärde"});config.addLabel("Lifetime",{en:"Lifetime",sv:"Livslängd"});config.addLabel("enter-date-and-time",{en:"Enter date and time",sv:"Ange datum och tid"})}}},function(module,exports){},,function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component}=substance;const{api,moment,idGenerator}=writer;const{isObject,isEmpty}=writer.lodash;const pluginId="se.infomaker.newspriority";class NewsPriorityComponent extends Component{constructor(...args){super(...args);api.events.on("newspriority","data:duplicated",()=>{api.clearNewsPriority("newspriority");this.rerender()})}getInitialState(){this.scores=api.getConfigValue(pluginId,"scores");this.lifetimes=api.getConfigValue(pluginId,"lifetimes");this.durationKey=api.getConfigValue(pluginId,"durationKey");this.defaultScoreIndex=api.getConfigValue(pluginId,"defaultScoresIndex");this.defaultLifetimeIndex=api.getConfigValue(pluginId,"defaultLifetimesIndex");var newsValue={score:this.scores[this.defaultScoreIndex].value,description:this.lifetimes[this.defaultLifetimeIndex].label,format:"lifetimecode"};newsValue[this.durationKey]=this.lifetimes[this.defaultLifetimeIndex].value;return newsValue}updateState(){var newsPriority=api.newsItem.getNewsPriority(pluginId);if(!newsPriority){var template={$id:idGenerator(),$type:"x-im/newsvalue",data:{description:this.lifetimes[this.defaultLifetimeIndex].label,end:"",format:"lifetimecode",score:this.scores[this.defaultScoreIndex].value}};template.data[this.durationKey]=this.lifetimes[this.defaultLifetimeIndex].value;api.newsItem.setNewsPriority("newspriority",template);newsPriority=api.newsItem.getNewsPriority(pluginId);if(isObject(newsPriority.data[this.durationKey])){newsPriority.data[this.durationKey]=template.data[this.durationKey]}}else{if(newsPriority.data.end&&!this.extendedState){this.extendedState={end:newsPriority.data.end}}}if(Number(newsPriority.data.score)===Number(this.state.score)){return}var newState={score:newsPriority.data.score,description:newsPriority.data.description,format:newsPriority.data.format,end:newsPriority.data.end};newState[this.durationKey]=newsPriority.data[this.durationKey];this.setState(newState)}render($$){this.updateState();var el=$$("div");var prioTitle=$$("h2").text(this.getLabel("newsvalue"));el.append(prioTitle);el.append(this._renderPriority($$));var lifetimeTitle=$$("h2").text(this.getLabel("Lifetime"));el.append(lifetimeTitle);if(this.lifetimes.length>1){el.append(this._renderLifeTime($$))}el.append(this._renderDatetimeInput($$).ref("datePickerComponent"));return el}_renderPriority($$){var prio=$$("div").addClass("btn-group");var buttons=this.scores.map(function(score){return $$("button").addClass("btn btn-secondary sc-np-btn").text(String(score.value)).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual").attr("title",score.text).addClass(parseInt(this.state.score,10)===score.value?"active":"").on("click",function(){this.setNewsPriority(score.value)}.bind(this))}.bind(this));prio.append(buttons);return prio}_renderLifeTime($$){var lifetime=$$("div").addClass("btn-group lifetime");var buttons=this.lifetimes.map(function(lifetime){return $$("button").addClass("btn btn-secondary sc-np-btn").text(lifetime.label).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual").attr("title",lifetime.text).addClass(this.state[this.durationKey]===lifetime.value?"active":"").on("click",function(e){this.setLifetime(e,lifetime)}.bind(this))}.bind(this));lifetime.append(buttons);return lifetime}_renderDatetimeInput($$){var form=$$("form").attr("id","npLifetimeForm");var fieldset=$$("fieldset").addClass("form-group").ref("datePickerFieldset");var text=this.getLabel("enter-date-and-time");var endTime=api.newsItem.getNewsPriority("newspriority").data.end;if(endTime!==""&&!isEmpty(endTime)){text="✓ "+text}var small=$$("div").append($$("small").addClass("text-muted").text(text)).addClass("hidden").ref("datePickerInstructionText");var input=$$("input").attr("type","datetime-local").addClass("form-control").attr("id","npLifetimeInput").on("change",this.setLifetimeDatetime).ref("datePickerInput");input.on("focus",()=>{this.refs.datePickerInstructionText.el.removeClass("hidden")});input.on("blur",()=>{this.refs.datePickerInstructionText.el.addClass("hidden")});if(this.state.end&&this.state.end.length>0){input.val(this.state.end.substring(0,16))}if(this.state[this.durationKey]!=="custom"&&this.lifetimes.length>1){form.attr("style","display: none;")}form.append(fieldset.append(input).append(small));return form}setNewsPriority(score){var newsPriority=api.newsItem.getNewsPriority(pluginId);newsPriority.data.score=score;api.newsItem.setNewsPriority(pluginId,newsPriority);this.extendState({score:newsPriority.data.score})}setLifetime(ev,lifetime){var newsPriority=api.newsItem.getNewsPriority(pluginId);for(var n=0;n<this.lifetimes.length;n++){if(ev.target.textContent===this.lifetimes[n].label){newsPriority.data.description=this.lifetimes[n].label;newsPriority.data[this.durationKey]=this.lifetimes[n].value;break}}var extendedState={};if(this.extendedState&&this.extendedState.end){extendedState.end=this.extendedState.end}if(lifetime.value==="custom"&&this.extendedState&&this.extendedState.end){newsPriority.data.end=this.extendedState.end}else{newsPriority.data.end=""}api.newsItem.setNewsPriority("newspriority",newsPriority);extendedState["description"]=newsPriority.data.description;extendedState[this.durationKey]=newsPriority.data[this.durationKey];this.extendState(extendedState)}setLifetimeDatetime(ev){var newsPriority=api.newsItem.getNewsPriority(pluginId);if(ev.target.value===""){newsPriority.data.end={}}else{newsPriority.data.end=moment(ev.target.value).format("YYYY-MM-DDTHH:mm:ssZ")}api.newsItem.setNewsPriority("newspriority",newsPriority);this.extendState({end:newsPriority.data.end})}}exports.default=NewsPriorityComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XImPlacePackage=__webpack_require__(132);var _XImPlacePackage2=_interopRequireDefault(_XImPlacePackage);var _XImPlacePackagePolygon=__webpack_require__(151);var _XImPlacePackagePolygon2=_interopRequireDefault(_XImPlacePackagePolygon);var _XImPlacePackagePosition=__webpack_require__(152);var _XImPlacePackagePosition2=_interopRequireDefault(_XImPlacePackagePosition);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(placeType=>{if(_writer.registerPlugin){switch(placeType){case"position":(0,_writer.registerPlugin)(_XImPlacePackagePosition2.default);break;case"polygon":(0,_writer.registerPlugin)(_XImPlacePackagePolygon2.default);break;default:(0,_writer.registerPlugin)(_XImPlacePackage2.default)}}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(133);var _XimPlacePackageConfigure=__webpack_require__(135);var _XimPlacePackageConfigure2=_interopRequireDefault(_XimPlacePackageConfigure);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const id="se.infomaker.ximplace";exports.default={id:id,name:"ximplace",configure:(0,_XimPlacePackageConfigure2.default)(id)}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _LocationMainComponent=__webpack_require__(136);var _LocationMainComponent2=_interopRequireDefault(_LocationMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(pluginId=>{return(config,pluginConfigObject)=>{config.addComponentToSidebarWithTabId(pluginId,"main",_LocationMainComponent2.default,pluginConfigObject);config.addLabel("Locations",{en:"Locations",sv:"Platser och områden"});config.addLabel("Areas",{en:"Areas",sv:"Län/Kommuner/Områden"});config.addLabel("Positions",{en:"Positions",sv:"Platser"});config.addLabel("Search locations",{en:"Search locations",sv:"Sök platser/områden"});config.addLabel("Search positions",{en:"Search positions",sv:"Sök platser"});config.addLabel("Search areas",{en:"Search areas",sv:"Sök områden"});config.addLabel("ximplace-error-save",{en:"Error saving place",sv:"Fel vid sparande av plats"});config.addLabel("Place",{en:"Place",sv:"Plats"});config.addLabel("Edit of polygons is not currently supported",{en:"Edit of polygons is not currently supported",sv:"Redigering av polygoner är för närvarande inte möjlig"})}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _LocationListComponent=__webpack_require__(137);var _LocationListComponent2=_interopRequireDefault(_LocationListComponent);var _LocationDetailComponent=__webpack_require__(141);var _LocationDetailComponent2=_interopRequireDefault(_LocationDetailComponent);var _concept=__webpack_require__(150);var _concept2=_interopRequireDefault(_concept);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class LocationMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximplace"}configureFeatures(){const features=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"features");switch(features){case"position":this.features="position";this.t={title:this.getLabel("Positions"),placeholder:this.getLabel("Search positions")};break;case"polygon":this.features="polygon";this.t={title:this.getLabel("Areas"),placeholder:this.getLabel("Search areas")};break;default:this.features="all";this.t={title:this.getLabel("Locations"),placeholder:this.getLabel("Search locations")}}this.polygonIsEditable=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"polygon.editable",true)}getInitialState(){this.configureFeatures();return{existingLocations:_writer.api.newsItem.getLocations(this.features)}}reload(){this.setState({existingLocations:_writer.api.newsItem.getLocations(this.features)})}render($$){const el=$$("div").addClass("location-main").append($$("h2").append(this.t.title));const locationList=$$(_LocationListComponent2.default,{locations:this.state.existingLocations,openMap:this.openMap.bind(this),removeLocation:this.removeLocation.bind(this)}).ref("locationList");let query="q=";if(this.features!=="all"){query="f="+this.features+"&q="}const LocationSearchComponent=this.context.componentRegistry.get("form-search");const searchComponent=$$(LocationSearchComponent,{existingItems:this.state.existingLocations,searchUrl:"/api/search/concepts/locations?"+query,onSelect:this.addLocation.bind(this),onCreate:this.createMap.bind(this),createAllowed:this.features!=="polygon",placeholderText:this.t.placeholder}).ref("authorSearchComponent");el.append(locationList);el.append(searchComponent);return el}createMap(selectedItem,exists){const parser=new DOMParser;const placeXML=parser.parseFromString(_concept2.default.place,"text/xml").firstChild;const location=_writer.jxon.build(placeXML);const properties={newLocation:true,exists:exists,query:selectedItem.inputValue,reload:this.reload.bind(this),editable:true,plugin:this.props.pluginConfigObject,location:location};_writer.api.ui.showDialog(_LocationDetailComponent2.default,properties,{title:this.getLabel("Place"),global:true,primary:this.getLabel("Save")})}addLocation(item){const useGeometryType=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"useGeometryType");if(useGeometryType===true&&!item.hasOwnProperty("geometryType")){throw new Error("Writer configured to use geometry type for locations but no geometry type provided by concept backend")}const location={title:item.name[0],uuid:item.uuid,data:item.location?{position:item.location[0]}:{},type:useGeometryType?item.geometryType[0]:"x-im/place"};_writer.api.newsItem.addLocation(this.name,location);this.reload()}removeLocation(location){_writer.api.newsItem.removeLinkByUUID(this.name,location.uuid);this.reload()}openMap(item){let editable=true;if(item.concept.metadata.object["@type"]==="x-im/polygon"&&false===this.polygonIsEditable){editable=false}const properties={newLocation:false,query:item.inputValue,location:item,reload:this.reload.bind(this),editable:editable,plugin:this.props.pluginConfigObject};_writer.api.ui.showDialog(_LocationDetailComponent2.default,properties,{title:this.getLabel("Place")+" "+item.concept.name,global:true,primary:editable?this.getLabel("Save"):this.getLabel("Close"),secondary:editable?this.getLabel("Cancel"):false})}}exports.default=LocationMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _LocationItemComponent=__webpack_require__(138);var _LocationItemComponent2=_interopRequireDefault(_LocationItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class LocationListComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximplace"}render($$){const el=$$("ul").addClass("tag-list").ref("locationItemList");const locations=this.props.locations.map(location=>{return $$(_LocationItemComponent2.default,{location:location,openMap:this.props.openMap.bind(this),removeLocation:this.props.removeLocation.bind(this)}).ref(location.uuid)});el.append(locations);return el}}exports.default=LocationListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _lodash=__webpack_require__(139);class LocationItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximplace"}loadLocation(){const api=this.context.api;api.router.getConceptItem(this.props.location.uuid,this.props.location.type).then(xml=>{const conceptXML=xml.querySelector("conceptItem");try{this.setState({loadedLocation:_writer.jxon.build(conceptXML),isLoaded:true})}catch(e){this.setState({isLoaded:true,couldNotLoad:true})}}).catch(()=>{this.setState({isLoaded:true,couldNotLoad:true})})}render($$){const location=this.props.location;const locItem=$$("li").addClass("tag-list__item");const displayNameEl=$$("span");let locationType="position";if(!this.state.isLoaded){displayNameEl.addClass("tag-item__title tag-item__title--loading").append(location.title);this.loadLocation()}else{if(this.state.couldNotLoad){displayNameEl.addClass("tag-item__title tag-item__title--no-avatar tag-item__title--notexisting").append(location.title).attr("title",this.getLabel("This item could not be loaded. UUID: ")+location.uuid)}else{locationType=this.state.loadedLocation.concept.metadata.object["@type"];displayNameEl.addClass("tag-item__title tag-item__title--no-avatar").append(this.state.loadedLocation.concept.name);displayNameEl.attr("title",location.title);LocationItemComponent.updateTagItemName(displayNameEl,this.state.loadedLocation);displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");if(this.state.loadedLocation.concept.name!==location.title){this.setState({isLoaded:false})}displayNameEl.on("click",function(){this.props.openMap(this.state.loadedLocation)}.bind(this))}locItem.append(displayNameEl);const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("Remove from article"))).on("click",function(){this.removeTag(location)}.bind(this));locItem.append(deleteButton);let icon="fa-map-marker";if(locationType==="x-im/polygon"){icon="fa-map"}locItem.append($$(_substance.FontAwesomeIcon,{icon:icon}).addClass("tag-icon"))}return locItem}removeTag(location){this.props.removeLocation(location)}static updateTagItemName(tagItem,loadedTag){if(loadedTag.concept&&loadedTag.concept.definition){const definition=(0,_lodash.isArray)(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(let i=0;i<definition.length;i++){const item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}}exports.default=LocationItemComponent},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(module,global){(function(){var undefined;var VERSION="3.5.0";var BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,REARG_FLAG=128,ARY_FLAG=256;var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...";var HOT_COUNT=150,HOT_SPAN=16;var LAZY_DROP_WHILE_FLAG=0,LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2;var FUNC_ERROR_TEXT="Expected a function";var PLACEHOLDER="__lodash_placeholder__";var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reUnescapedHtml=/[&<>"'`]/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reFuncName=/^\s*function[ \n\r\t]+\w/;var reHexPrefix=/^0[xX]/;var reHostCtor=/^\[object .+?Constructor\]$/;var reLatin1=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g;var reNoMatch=/($^)/;var reRegExpChars=/[.*+?^${}()|[\]\/\\]/g,reHasRegExpChars=RegExp(reRegExpChars.source);var reThis=/\bthis\b/;var reUnescapedString=/['\n\r\u2028\u2029\\]/g;var reWords=function(){var upper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",lower="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(upper+"+(?="+upper+lower+")|"+upper+"?"+lower+"|"+upper+"+|[0-9]+","g")}();var whitespace=" \t\v\f \ufeff"+"\n\r\u2028\u2029"+" ᠎             　";var contextProps=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window","WinRTError"];var templateCounter=-1;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[stringTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[mapTag]=cloneableTags[setTag]=cloneableTags[weakMapTag]=false;var debounceOptions={leading:false,maxWait:0,trailing:false};var deburredLetters={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"};var objectTypes={function:true,object:true};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module;var freeGlobal=freeExports&&freeModule&&typeof global=="object"&&global;var freeWindow=objectTypes[typeof window]&&window;var moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports;var root=freeGlobal||freeWindow!==(this&&this.window)&&freeWindow||this;function baseCompareAscending(value,other){if(value!==other){var valIsReflexive=value===value,othIsReflexive=other===other;if(value>other||!valIsReflexive||typeof value=="undefined"&&othIsReflexive){return 1}if(value<other||!othIsReflexive||typeof other=="undefined"&&valIsReflexive){return-1}}return 0}function baseIndexOf(array,value,fromIndex){if(value!==value){return indexOfNaN(array,fromIndex)}var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function baseIsFunction(value){return typeof value=="function"||false}function baseToString(value){if(typeof value=="string"){return value}return value==null?"":value+""}function charAtCallback(string){return string.charCodeAt(0)}function charsLeftIndex(string,chars){var index=-1,length=string.length;while(++index<length&&chars.indexOf(string.charAt(index))>-1){}return index}function charsRightIndex(string,chars){var index=string.length;while(index--&&chars.indexOf(string.charAt(index))>-1){}return index}function compareAscending(object,other){return baseCompareAscending(object.criteria,other.criteria)||object.index-other.index}function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=baseCompareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result}return result*(orders[index]?1:-1)}}return object.index-other.index}function deburrLetter(letter){return deburredLetters[letter]}function escapeHtmlChar(chr){return htmlEscapes[chr]}function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function indexOfNaN(array,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?0:-1);while(fromRight?index--:++index<length){var other=array[index];if(other!==other){return index}}return-1}function isObjectLike(value){return value&&typeof value=="object"||false}function isSpace(charCode){return charCode<=160&&(charCode>=9&&charCode<=13)||charCode==32||charCode==160||charCode==5760||charCode==6158||charCode>=8192&&(charCode<=8202||charCode==8232||charCode==8233||charCode==8239||charCode==8287||charCode==12288||charCode==65279)}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){if(array[index]===placeholder){array[index]=PLACEHOLDER;result[++resIndex]=index}}return result}function sortedUniq(array,iteratee){var seen,index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(!index||seen!==computed){seen=computed;result[++resIndex]=value}}return result}function trimmedLeftIndex(string){var index=-1,length=string.length;while(++index<length&&isSpace(string.charCodeAt(index))){}return index}function trimmedRightIndex(string){var index=string.length;while(index--&&isSpace(string.charCodeAt(index))){}return index}function unescapeHtmlChar(chr){return htmlUnescapes[chr]}function runInContext(context){context=context?_.defaults(root.Object(),context,_.pick(root,contextProps)):root;var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayProto=Array.prototype,objectProto=Object.prototype,stringProto=String.prototype;var document=(document=context.window)&&document.document;var fnToString=Function.prototype.toString;var getLength=baseProperty("length");var hasOwnProperty=objectProto.hasOwnProperty;var idCounter=0;var objToString=objectProto.toString;var oldDash=context._;var reNative=RegExp("^"+escapeRegExp(objToString).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ArrayBuffer=isNative(ArrayBuffer=context.ArrayBuffer)&&ArrayBuffer,bufferSlice=isNative(bufferSlice=ArrayBuffer&&new ArrayBuffer(0).slice)&&bufferSlice,ceil=Math.ceil,clearTimeout=context.clearTimeout,floor=Math.floor,getPrototypeOf=isNative(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf,push=arrayProto.push,propertyIsEnumerable=objectProto.propertyIsEnumerable,Set=isNative(Set=context.Set)&&Set,setTimeout=context.setTimeout,splice=arrayProto.splice,Uint8Array=isNative(Uint8Array=context.Uint8Array)&&Uint8Array,WeakMap=isNative(WeakMap=context.WeakMap)&&WeakMap;var Float64Array=function(){try{var func=isNative(func=context.Float64Array)&&func,result=new func(new ArrayBuffer(10),0,1)&&func}catch(e){}return result}();var nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeCreate=isNative(nativeCreate=Object.create)&&nativeCreate,nativeIsFinite=context.isFinite,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeNow=isNative(nativeNow=Date.now)&&nativeNow,nativeNumIsFinite=isNative(nativeNumIsFinite=Number.isFinite)&&nativeNumIsFinite,nativeParseInt=context.parseInt,nativeRandom=Math.random;var NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,POSITIVE_INFINITY=Number.POSITIVE_INFINITY;var MAX_ARRAY_LENGTH=Math.pow(2,32)-1,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;var FLOAT64_BYTES_PER_ELEMENT=Float64Array?Float64Array.BYTES_PER_ELEMENT:0;var MAX_SAFE_INTEGER=Math.pow(2,53)-1;var metaMap=WeakMap&&new WeakMap;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value}if(hasOwnProperty.call(value,"__chain__")&&hasOwnProperty.call(value,"__wrapped__")){return wrapperClone(value)}}return new LodashWrapper(value)}function baseLodash(){}function LodashWrapper(value,chainAll,actions){this.__wrapped__=value;this.__actions__=actions||[];this.__chain__=!!chainAll}var support=lodash.support={};(function(x){support.funcDecomp=!isNative(context.WinRTError)&&reThis.test(runInContext);support.funcNames=typeof Function.name=="string";try{support.dom=document.createDocumentFragment().nodeType===11}catch(e){support.dom=false}try{support.nonEnumArgs=!propertyIsEnumerable.call(arguments,1)}catch(e){support.nonEnumArgs=true}})(0,0);lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};function LazyWrapper(value){this.__wrapped__=value;this.__actions__=null;this.__dir__=1;this.__dropCount__=0;this.__filtered__=false;this.__iteratees__=null;this.__takeCount__=POSITIVE_INFINITY;this.__views__=null}function lazyClone(){var actions=this.__actions__,iteratees=this.__iteratees__,views=this.__views__,result=new LazyWrapper(this.__wrapped__);result.__actions__=actions?arrayCopy(actions):null;result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=iteratees?arrayCopy(iteratees):null;result.__takeCount__=this.__takeCount__;result.__views__=views?arrayCopy(views):null;return result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true}else{result=this.clone();result.__dir__*=-1}return result}function lazyValue(){var array=this.__wrapped__.value();if(!isArray(array)){return baseWrapperValue(array,this.__actions__)}var dir=this.__dir__,isRight=dir<0,view=getView(0,array.length,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,takeCount=nativeMin(length,this.__takeCount__),iteratees=this.__iteratees__,iterLength=iteratees?iteratees.length:0,resIndex=0,result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type;if(type==LAZY_DROP_WHILE_FLAG){if(data.done&&(isRight?index>data.index:index<data.index)){data.count=0;data.done=false}data.index=index;if(!data.done){var limit=data.limit;if(!(data.done=limit>-1?data.count++>=limit:!iteratee(value))){continue outer}}}else{var computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer}else{break outer}}}}result[resIndex++]=value}return result}function MapCache(){this.__data__={}}function mapDelete(key){return this.has(key)&&delete this.__data__[key]}function mapGet(key){return key=="__proto__"?undefined:this.__data__[key]}function mapHas(key){return key!="__proto__"&&hasOwnProperty.call(this.__data__,key)}function mapSet(key,value){if(key!="__proto__"){this.__data__[key]=value}return this}function SetCache(values){var length=values?values.length:0;this.data={hash:nativeCreate(null),set:new Set};while(length--){this.push(values[length])}}function cacheIndexOf(cache,value){var data=cache.data,result=typeof value=="string"||isObject(value)?data.set.has(value):data.hash[value];
return result?0:-1}function cachePush(value){var data=this.data;if(typeof value=="string"||isObject(value)){data.set.add(value)}else{data.hash[value]=true}}function arrayCopy(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayEachRight(array,iteratee){var length=array.length;while(length--){if(iteratee(array[length],length,array)===false){break}}return array}function arrayEvery(array,predicate){var index=-1,length=array.length;while(++index<length){if(!predicate(array[index],index,array)){return false}}return true}function arrayFilter(array,predicate){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[++resIndex]=value}}return result}function arrayMap(array,iteratee){var index=-1,length=array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function arrayMax(array){var index=-1,length=array.length,result=NEGATIVE_INFINITY;while(++index<length){var value=array[index];if(value>result){result=value}}return result}function arrayMin(array){var index=-1,length=array.length,result=POSITIVE_INFINITY;while(++index<length){var value=array[index];if(value<result){result=value}}return result}function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;if(initFromArray&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function arrayReduceRight(array,iteratee,accumulator,initFromArray){var length=array.length;if(initFromArray&&length){accumulator=array[--length]}while(length--){accumulator=iteratee(accumulator,array[length],length,array)}return accumulator}function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function assignDefaults(objectValue,sourceValue){return typeof objectValue=="undefined"?sourceValue:objectValue}function assignOwnDefaults(objectValue,sourceValue,key,object){return typeof objectValue=="undefined"||!hasOwnProperty.call(object,key)?sourceValue:objectValue}function baseAssign(object,source,customizer){var props=keys(source);if(!customizer){return baseCopy(source,object,props)}var index=-1,length=props.length;while(++index<length){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);if((result===result?result!==value:value===value)||typeof value=="undefined"&&!(key in object)){object[key]=result}}return object}function baseAt(collection,props){var index=-1,length=collection.length,isArr=isLength(length),propsLength=props.length,result=Array(propsLength);while(++index<propsLength){var key=props[index];if(isArr){key=parseFloat(key);result[index]=isIndex(key,length)?collection[key]:undefined}else{result[index]=collection[key]}}return result}function baseCopy(source,object,props){if(!props){props=object;object={}}var index=-1,length=props.length;while(++index<length){var key=props[index];object[key]=source[key]}return object}function baseBindAll(object,methodNames){var index=-1,length=methodNames.length;while(++index<length){var key=methodNames[index];object[key]=createWrapper(object[key],BIND_FLAG,object)}return object}function baseCallback(func,thisArg,argCount){var type=typeof func;if(type=="function"){return typeof thisArg!="undefined"&&isBindable(func)?bindCallback(func,thisArg,argCount):func}if(func==null){return identity}if(type=="object"){return baseMatches(func)}return typeof thisArg=="undefined"?baseProperty(func+""):baseMatchesProperty(func+"",thisArg)}function baseClone(value,isDeep,customizer,key,object,stackA,stackB){var result;if(customizer){result=object?customizer(value,key,object):customizer(value)}if(typeof result!="undefined"){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return arrayCopy(value,result)}}else{var tag=objToString.call(value),isFunc=tag==funcTag;if(tag==objectTag||tag==argsTag||isFunc&&!object){result=initCloneObject(isFunc?{}:value);if(!isDeep){return baseCopy(value,result,keys(value))}}else{return cloneableTags[tag]?initCloneByTag(value,tag,isDeep):object?value:{}}}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==value){return stackB[length]}}stackA.push(value);stackB.push(result);(isArr?arrayEach:baseForOwn)(value,function(subValue,key){result[key]=baseClone(subValue,isDeep,customizer,key,value,stackA,stackB)});return result}var baseCreate=function(){function Object(){}return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null}return result||context.Object()}}();function baseDelay(func,wait,args,fromIndex){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return setTimeout(function(){func.apply(undefined,baseSlice(args,fromIndex))},wait)}function baseDifference(array,values){var length=array?array.length:0,result=[];if(!length){return result}var index=-1,indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf,cache=isCommon&&values.length>=200?createCache(values):null,valuesLength=values.length;if(cache){indexOf=cacheIndexOf;isCommon=false;values=cache}outer:while(++index<length){var value=array[index];if(isCommon&&value===value){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===value){continue outer}}result.push(value)}else if(indexOf(values,value,0)<0){result.push(value)}}return result}function baseEach(collection,iteratee){var length=collection?collection.length:0;if(!isLength(length)){return baseForOwn(collection,iteratee)}var index=-1,iterable=toObject(collection);while(++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}function baseEachRight(collection,iteratee){var length=collection?collection.length:0;if(!isLength(length)){return baseForOwnRight(collection,iteratee)}var iterable=toObject(collection);while(length--){if(iteratee(iterable[length],length,iterable)===false){break}}return collection}function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result});return result}function baseFill(array,value,start,end){var length=array.length;start=start==null?0:+start||0;if(start<0){start=-start>length?0:length+start}end=typeof end=="undefined"||end>length?length:+end||0;if(end<0){end+=length}length=start>end?0:end>>>0;start>>>=0;while(start<length){array[start++]=value}return array}function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}function baseFind(collection,predicate,eachFunc,retKey){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=retKey?key:value;return false}});return result}function baseFlatten(array,isDeep,isStrict,fromIndex){var index=fromIndex-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(isObjectLike(value)&&isLength(value.length)&&(isArray(value)||isArguments(value))){if(isDeep){value=baseFlatten(value,isDeep,isStrict,0)}var valIndex=-1,valLength=value.length;result.length+=valLength;while(++valIndex<valLength){result[++resIndex]=value[valIndex]}}else if(!isStrict){result[++resIndex]=value}}return result}function baseFor(object,iteratee,keysFunc){var index=-1,iterable=toObject(object),props=keysFunc(object),length=props.length;while(++index<length){var key=props[index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}function baseForRight(object,iteratee,keysFunc){var iterable=toObject(object),props=keysFunc(object),length=props.length;while(length--){var key=props[length];if(iteratee(iterable[key],key,iterable)===false){break}}return object}function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn)}function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return baseForRight(object,iteratee,keys)}function baseFunctions(object,props){var index=-1,length=props.length,resIndex=-1,result=[];while(++index<length){var key=props[index];if(isFunction(object[key])){result[++resIndex]=key}}return result}function baseInvoke(collection,methodName,args){var index=-1,isFunc=typeof methodName=="function",length=collection?collection.length:0,result=isLength(length)?Array(length):[];baseEach(collection,function(value){var func=isFunc?methodName:value!=null&&value[methodName];result[++index]=func?func.apply(value,args):undefined});return result}function baseIsEqual(value,other,customizer,isWhere,stackA,stackB){if(value===other){return value!==0||1/value==1/other}var valType=typeof value,othType=typeof other;if(valType!="function"&&valType!="object"&&othType!="function"&&othType!="object"||value==null||other==null){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,customizer,isWhere,stackA,stackB)}function baseIsEqualDeep(object,other,equalFunc,customizer,isWhere,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=objToString.call(object);if(objTag==argsTag){objTag=objectTag}else if(objTag!=objectTag){objIsArr=isTypedArray(object)}}if(!othIsArr){othTag=objToString.call(other);if(othTag==argsTag){othTag=objectTag}else if(othTag!=objectTag){othIsArr=isTypedArray(other)}}var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!(objIsArr||objIsObj)){return equalByTag(object,other,objTag)}var valWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(valWrapped||othWrapped){return equalFunc(valWrapped?object.value():object,othWrapped?other.value():other,customizer,isWhere,stackA,stackB)}if(!isSameTag){return false}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==object){return stackB[length]==other}}stackA.push(object);stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isWhere,stackA,stackB);stackA.pop();stackB.pop();return result}function baseIsMatch(object,props,values,strictCompareFlags,customizer){var length=props.length;if(object==null){return!length}var index=-1,noCustomizer=!customizer;while(++index<length){if(noCustomizer&&strictCompareFlags[index]?values[index]!==object[props[index]]:!hasOwnProperty.call(object,props[index])){return false}}index=-1;while(++index<length){var key=props[index];if(noCustomizer&&strictCompareFlags[index]){var result=hasOwnProperty.call(object,key)}else{var objValue=object[key],srcValue=values[index];result=customizer?customizer(objValue,srcValue,key):undefined;if(typeof result=="undefined"){result=baseIsEqual(srcValue,objValue,customizer,true)}}if(!result){return false}}return true}function baseMap(collection,iteratee){var result=[];baseEach(collection,function(value,key,collection){result.push(iteratee(value,key,collection))});return result}function baseMatches(source){var props=keys(source),length=props.length;if(length==1){var key=props[0],value=source[key];if(isStrictComparable(value)){return function(object){return object!=null&&object[key]===value&&hasOwnProperty.call(object,key)}}}var values=Array(length),strictCompareFlags=Array(length);while(length--){value=source[props[length]];values[length]=value;strictCompareFlags[length]=isStrictComparable(value)}return function(object){return baseIsMatch(object,props,values,strictCompareFlags)}}function baseMatchesProperty(key,value){if(isStrictComparable(value)){return function(object){return object!=null&&object[key]===value}}return function(object){return object!=null&&baseIsEqual(value,object[key],null,true)}}function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object)){return object}var isSrcArr=isLength(source.length)&&(isArray(source)||isTypedArray(source));(isSrcArr?arrayEach:baseForOwn)(source,function(srcValue,key,source){if(isObjectLike(srcValue)){stackA||(stackA=[]);stackB||(stackB=[]);return baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB)}var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=typeof result=="undefined";if(isCommon){result=srcValue}if((isSrcArr||typeof result!="undefined")&&(isCommon||(result===result?result!==value:value===value))){object[key]=result}});return object}function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){var length=stackA.length,srcValue=source[key];while(length--){if(stackA[length]==srcValue){object[key]=stackB[length];return}}var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=typeof result=="undefined";if(isCommon){result=srcValue;if(isLength(srcValue.length)&&(isArray(srcValue)||isTypedArray(srcValue))){result=isArray(value)?value:value?arrayCopy(value):[]}else if(isPlainObject(srcValue)||isArguments(srcValue)){result=isArguments(value)?toPlainObject(value):isPlainObject(value)?value:{}}else{isCommon=false}}stackA.push(srcValue);stackB.push(result);if(isCommon){object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB)}else if(result===result?result!==value:value===value){object[key]=result}}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePullAt(array,indexes){var length=indexes.length,result=baseAt(array,indexes);indexes.sort(baseCompareAscending);while(length--){var index=parseFloat(indexes[length]);if(index!=previous&&isIndex(index)){var previous=index;splice.call(array,index,1)}}return result}function baseRandom(min,max){return min+floor(nativeRandom()*(max-min+1))}function baseReduce(collection,iteratee,accumulator,initFromCollection,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initFromCollection?(initFromCollection=false,value):iteratee(accumulator,value,index,collection)});return accumulator}var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func};function baseSlice(array,start,end){var index=-1,length=array.length;start=start==null?0:+start||0;if(start<0){start=-start>length?0:length+start}end=typeof end=="undefined"||end>length?length:+end||0;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result});return!!result}function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value}return array}function baseSortByOrder(collection,props,orders){var index=-1,length=collection.length,result=isLength(length)?Array(length):[];baseEach(collection,function(value){var length=props.length,criteria=Array(length);while(length--){criteria[length]=value==null?undefined:value[props[length]]}result[++index]={criteria:criteria,index:index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function baseUniq(array,iteratee){var index=-1,indexOf=getIndexOf(),length=array.length,isCommon=indexOf==baseIndexOf,isLarge=isCommon&&length>=200,seen=isLarge?createCache():null,result=[];if(seen){indexOf=cacheIndexOf;isCommon=false}else{isLarge=false;seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(isCommon&&value===value){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(indexOf(seen,computed,0)<0){if(iteratee||isLarge){seen.push(computed)}result.push(value)}}return result}function baseValues(object,props){var index=-1,length=props.length,result=Array(length);while(++index<length){result[index]=object[props[index]]}return result}function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value()}var index=-1,length=actions.length;while(++index<length){var args=[result],action=actions[index];push.apply(args,action.args);result=action.func.apply(action.thisArg,args)}return result}function binaryIndex(array,value,retHighest){var low=0,high=array?array.length:low;if(typeof value=="number"&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];if(retHighest?computed<=value:computed<value){low=mid+1}else{high=mid}}return high}return binaryIndexBy(array,value,identity,retHighest)}function binaryIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=array?array.length:0,valIsNaN=value!==value,valIsUndef=typeof value=="undefined";while(low<high){var mid=floor((low+high)/2),computed=iteratee(array[mid]),isReflexive=computed===computed;if(valIsNaN){var setLow=isReflexive||retHighest}else if(valIsUndef){setLow=isReflexive&&(retHighest||typeof computed!="undefined")}else{setLow=retHighest?computed<=value:computed<value}if(setLow){low=mid+1}else{high=mid}}return nativeMin(high,MAX_ARRAY_INDEX)}function bindCallback(func,thisArg,argCount){if(typeof func!="function"){return identity}if(typeof thisArg=="undefined"){return func}switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function bufferClone(buffer){return bufferSlice.call(buffer,0)}if(!bufferSlice){bufferClone=!(ArrayBuffer&&Uint8Array)?constant(null):function(buffer){var byteLength=buffer.byteLength,floatLength=Float64Array?floor(byteLength/FLOAT64_BYTES_PER_ELEMENT):0,offset=floatLength*FLOAT64_BYTES_PER_ELEMENT,result=new ArrayBuffer(byteLength);if(floatLength){var view=new Float64Array(result,0,floatLength);view.set(new Float64Array(buffer,0,floatLength))}if(byteLength!=offset){view=new Uint8Array(result,offset);view.set(new Uint8Array(buffer,offset))}return result}}function composeArgs(args,partials,holders){var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(argsLength+leftLength);while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex]}while(++argsIndex<holdersLength){result[holders[argsIndex]]=args[argsIndex]}while(argsLength--){result[leftIndex++]=args[argsIndex++]}return result}function composeArgsRight(args,partials,holders){var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);while(++argsIndex<argsLength){result[argsIndex]=args[argsIndex]}var pad=argsIndex;while(++rightIndex<rightLength){result[pad+rightIndex]=partials[rightIndex]}while(++holdersIndex<holdersLength){result[pad+holders[holdersIndex]]=args[argsIndex++]}return result}function createAggregator(setter,initializer){return function(collection,iteratee,thisArg){var result=initializer?initializer():{};iteratee=getCallback(iteratee,thisArg,3);if(isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];setter(result,value,iteratee(value,index,collection),collection)}}else{baseEach(collection,function(value,key,collection){setter(result,value,iteratee(value,key,collection),collection)})}return result}}function createAssigner(assigner){return function(){var args=arguments,length=args.length,object=args[0];if(length<2||object==null){return object}var customizer=args[length-2],thisArg=args[length-1],guard=args[3];if(length>3&&typeof customizer=="function"){customizer=bindCallback(customizer,thisArg,5);length-=2}else{customizer=length>2&&typeof thisArg=="function"?thisArg:null;length-=customizer?1:0}if(guard&&isIterateeCall(args[1],args[2],guard)){customizer=length==3?null:customizer;length=2}var index=0;while(++index<length){var source=args[index];if(source){assigner(object,source,customizer)}}return object}}function createBindWrapper(func,thisArg){var Ctor=createCtorWrapper(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(thisArg,arguments)}return wrapper}var createCache=!(nativeCreate&&Set)?constant(null):function(values){return new SetCache(values)};function createComposer(fromRight){return function(){var length=arguments.length,index=length,fromIndex=fromRight?length-1:0;if(!length){return function(){return arguments[0]}}var funcs=Array(length);while(index--){funcs[index]=arguments[index];if(typeof funcs[index]!="function"){throw new TypeError(FUNC_ERROR_TEXT)}}return function(){var index=fromIndex,result=funcs[index].apply(this,arguments);while(fromRight?index--:++index<length){result=funcs[index].call(this,result)}return result}}}function createCompounder(callback){return function(string){var index=-1,array=words(deburr(string)),length=array.length,result="";while(++index<length){result=callback(result,array[index],index)}return result}}function createCtorWrapper(Ctor){return function(){var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,arguments);return isObject(result)?result:thisBinding}}function createExtremum(arrayFunc,isMin){return function(collection,iteratee,thisArg){if(thisArg&&isIterateeCall(collection,iteratee,thisArg)){iteratee=null}var func=getCallback(),noIteratee=iteratee==null;if(!(func===baseCallback&&noIteratee)){noIteratee=false;iteratee=func(iteratee,thisArg,3)}if(noIteratee){var isArr=isArray(collection);if(!isArr&&isString(collection)){iteratee=charAtCallback}else{return arrayFunc(isArr?collection:toIterable(collection))}}return extremumBy(collection,iteratee,isMin)}}function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryBound=bitmask&CURRY_BOUND_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG;var Ctor=!isBindKey&&createCtorWrapper(func),key=func;function wrapper(){var length=arguments.length,index=length,args=Array(length);while(index--){args[index]=arguments[index]}if(partials){args=composeArgs(args,partials,holders)}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight)}if(isCurry||isCurryRight){var placeholder=wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);length-=argsHolders.length;if(length<arity){var newArgPos=argPos?arrayCopy(argPos):null,newArity=nativeMax(arity-length,0),newsHolders=isCurry?argsHolders:null,newHoldersRight=isCurry?null:argsHolders,newPartials=isCurry?args:null,newPartialsRight=isCurry?null:args;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG);if(!isCurryBound){bitmask&=~(BIND_FLAG|BIND_KEY_FLAG)}var result=createHybridWrapper(func,bitmask,thisArg,newPartials,newsHolders,newPartialsRight,newHoldersRight,newArgPos,ary,newArity);result.placeholder=placeholder;return result}}var thisBinding=isBind?thisArg:this;if(isBindKey){func=thisBinding[key]}if(argPos){args=reorder(args,argPos)}if(isAry&&ary<args.length){args.length=ary}var fn=this&&this!==root&&this instanceof wrapper?Ctor||createCtorWrapper(func):func;return fn.apply(thisBinding,args)}return wrapper}function createPad(string,length,chars){var strLength=string.length;length=+length;if(strLength>=length||!nativeIsFinite(length)){return""}var padLength=length-strLength;chars=chars==null?" ":chars+"";return repeat(chars,ceil(padLength/chars.length)).slice(0,padLength)}function createPartialWrapper(func,bitmask,thisArg,partials){var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(argsLength+leftLength);while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex]}while(argsLength--){args[leftIndex++]=arguments[++argsIndex]}var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,args)}return wrapper}function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var length=partials?partials.length:0;if(!length){bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG);partials=holders=null}length-=holders?holders.length:0;if(bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=null}var data=!isBindKey&&getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&data!==true){mergeData(newData,data);bitmask=newData[1];arity=newData[9]}newData[9]=arity==null?isBindKey?0:func.length:nativeMax(arity-length,0)||0;if(bitmask==BIND_FLAG){var result=createBindWrapper(newData[0],newData[2])}else if((bitmask==PARTIAL_FLAG||bitmask==(BIND_FLAG|PARTIAL_FLAG))&&!newData[4].length){result=createPartialWrapper.apply(undefined,newData)}else{result=createHybridWrapper.apply(undefined,newData)}var setter=data?baseSetData:setData;return setter(result,newData)}function equalArrays(array,other,equalFunc,customizer,isWhere,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length,result=true;if(arrLength!=othLength&&!(isWhere&&othLength>arrLength)){return false}while(result&&++index<arrLength){var arrValue=array[index],othValue=other[index];result=undefined;if(customizer){result=isWhere?customizer(othValue,arrValue,index):customizer(arrValue,othValue,index)}if(typeof result=="undefined"){if(isWhere){var othIndex=othLength;while(othIndex--){othValue=other[othIndex];result=arrValue&&arrValue===othValue||equalFunc(arrValue,othValue,customizer,isWhere,stackA,stackB);if(result){break}}}else{result=arrValue&&arrValue===othValue||equalFunc(arrValue,othValue,customizer,isWhere,stackA,stackB)}}}return!!result}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==0?1/object==1/other:object==+other;case regexpTag:case stringTag:return object==other+""}return false}function equalObjects(object,other,equalFunc,customizer,isWhere,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isWhere){return false}var hasCtor,index=-1;while(++index<objLength){var key=objProps[index],result=hasOwnProperty.call(other,key);if(result){var objValue=object[key],othValue=other[key];result=undefined;if(customizer){result=isWhere?customizer(othValue,objValue,key):customizer(objValue,othValue,key)}if(typeof result=="undefined"){result=objValue&&objValue===othValue||equalFunc(objValue,othValue,customizer,isWhere,stackA,stackB)}}if(!result){return false}hasCtor||(hasCtor=key=="constructor")}if(!hasCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){return false}}return true}function extremumBy(collection,iteratee,isMin){var exValue=isMin?POSITIVE_INFINITY:NEGATIVE_INFINITY,computed=exValue,result=computed;baseEach(collection,function(value,index,collection){var current=iteratee(value,index,collection);if((isMin?current<computed:current>computed)||current===exValue&&current===result){computed=current;result=value}});return result}function getCallback(func,thisArg,argCount){var result=lodash.callback||callback;result=result===callback?baseCallback:result;return argCount?result(func,thisArg,argCount):result}var getData=!metaMap?noop:function(func){return metaMap.get(func)};function getIndexOf(collection,target,fromIndex){var result=lodash.indexOf||indexOf;result=result===indexOf?baseIndexOf:result;return collection?result(collection,target,fromIndex):result}function getView(start,end,transforms){var index=-1,length=transforms?transforms.length:0;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size);break}}return{start:start,end:end}}function initCloneArray(array){var length=array.length,result=new array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){var Ctor=object.constructor;if(!(typeof Ctor=="function"&&Ctor instanceof Ctor)){Ctor=Object}return new Ctor}function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return bufferClone(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:var buffer=object.buffer;return new Ctor(isDeep?bufferClone(buffer):buffer,object.byteOffset,object.length);case numberTag:case stringTag:return new Ctor(object);case regexpTag:var result=new Ctor(object.source,reFlags.exec(object));result.lastIndex=object.lastIndex}return result}function isBindable(func){var support=lodash.support,result=!(support.funcNames?func.name:support.funcDecomp);if(!result){var source=fnToString.call(func);if(!support.funcNames){result=!reFuncName.test(source)}if(!result){result=reThis.test(source)||isNative(func);baseSetData(func,result)}}return result}function isIndex(value,length){value=+value;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"){var length=object.length,prereq=isLength(length)&&isIndex(index,length)}else{prereq=type=="string"&&index in object}if(prereq){var other=object[index];return value===value?value===other:other!==other}return false}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isStrictComparable(value){return value===value&&(value===0?1/value>0:!isObject(value))}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask;var arityFlags=ARY_FLAG|REARG_FLAG,bindFlags=BIND_FLAG|BIND_KEY_FLAG,comboFlags=arityFlags|bindFlags|CURRY_BOUND_FLAG|CURRY_RIGHT_FLAG;var isAry=bitmask&ARY_FLAG&&!(srcBitmask&ARY_FLAG),isRearg=bitmask&REARG_FLAG&&!(srcBitmask&REARG_FLAG),argPos=(isRearg?data:source)[7],ary=(isAry?data:source)[8];var isCommon=!(bitmask>=REARG_FLAG&&srcBitmask>bindFlags)&&!(bitmask>bindFlags&&srcBitmask>=REARG_FLAG);var isCombo=newBitmask>=arityFlags&&newBitmask<=comboFlags&&(bitmask<REARG_FLAG||(isRearg||isAry)&&argPos.length<=ary);if(!(isCommon||isCombo)){return data}if(srcBitmask&BIND_FLAG){data[2]=source[2];newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG}var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):arrayCopy(value);
data[4]=partials?replaceHolders(data[3],PLACEHOLDER):arrayCopy(source[4])}value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):arrayCopy(value);data[6]=partials?replaceHolders(data[5],PLACEHOLDER):arrayCopy(source[6])}value=source[7];if(value){data[7]=arrayCopy(value)}if(srcBitmask&ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8])}if(data[9]==null){data[9]=source[9]}data[0]=source[0];data[1]=newBitmask;return data}function pickByArray(object,props){object=toObject(object);var index=-1,length=props.length,result={};while(++index<length){var key=props[index];if(key in object){result[key]=object[key]}}return result}function pickByCallback(object,predicate){var result={};baseForIn(object,function(value,key,object){if(predicate(value,key,object)){result[key]=value}});return result}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=arrayCopy(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}var setData=function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return key}}else{count=0}return baseSetData(key,value)}}();function shimIsPlainObject(value){var Ctor,support=lodash.support;if(!(isObjectLike(value)&&objToString.call(value)==objectTag)||!hasOwnProperty.call(value,"constructor")&&(Ctor=value.constructor,typeof Ctor=="function"&&!(Ctor instanceof Ctor))){return false}var result;baseForIn(value,function(subValue,key){result=key});return typeof result=="undefined"||hasOwnProperty.call(value,result)}function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length,support=lodash.support;var allowIndexes=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key)){result.push(key)}}return result}function toIterable(value){if(value==null){return[]}if(!isLength(value.length)){return values(value)}return isObject(value)?value:Object(value)}function toObject(value){return isObject(value)?value:Object(value)}function wrapperClone(wrapper){return wrapper instanceof LazyWrapper?wrapper.clone():new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__,arrayCopy(wrapper.__actions__))}function chunk(array,size,guard){if(guard?isIterateeCall(array,size,guard):size==null){size=1}else{size=nativeMax(+size||1,1)}var index=0,length=array?array.length:0,resIndex=-1,result=Array(ceil(length/size));while(index<length){result[++resIndex]=baseSlice(array,index,index+=size)}return result}function compact(array){var index=-1,length=array?array.length:0,resIndex=-1,result=[];while(++index<length){var value=array[index];if(value){result[++resIndex]=value}}return result}function difference(){var args=arguments,index=-1,length=args.length;while(++index<length){var value=args[index];if(isArray(value)||isArguments(value)){break}}return baseDifference(value,baseFlatten(args,false,true,++index))}function drop(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}return baseSlice(array,n<0?0:n)}function dropRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}n=length-(+n||0);return baseSlice(array,0,n<0?0:n)}function dropRightWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}predicate=getCallback(predicate,thisArg,3);while(length--&&predicate(array[length],length,array)){}return baseSlice(array,0,length+1)}function dropWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}var index=-1;predicate=getCallback(predicate,thisArg,3);while(++index<length&&predicate(array[index],index,array)){}return baseSlice(array,index)}function fill(array,value,start,end){var length=array?array.length:0;if(!length){return[]}if(start&&typeof start!="number"&&isIterateeCall(array,value,start)){start=0;end=length}return baseFill(array,value,start,end)}function findIndex(array,predicate,thisArg){var index=-1,length=array?array.length:0;predicate=getCallback(predicate,thisArg,3);while(++index<length){if(predicate(array[index],index,array)){return index}}return-1}function findLastIndex(array,predicate,thisArg){var length=array?array.length:0;predicate=getCallback(predicate,thisArg,3);while(length--){if(predicate(array[length],length,array)){return length}}return-1}function first(array){return array?array[0]:undefined}function flatten(array,isDeep,guard){var length=array?array.length:0;if(guard&&isIterateeCall(array,isDeep,guard)){isDeep=false}return length?baseFlatten(array,isDeep,false,0):[]}function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,true,false,0):[]}function indexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}if(typeof fromIndex=="number"){fromIndex=fromIndex<0?nativeMax(length+fromIndex,0):fromIndex}else if(fromIndex){var index=binaryIndex(array,value),other=array[index];if(value===value?value===other:other!==other){return index}return-1}return baseIndexOf(array,value,fromIndex||0)}function initial(array){return dropRight(array,1)}function intersection(){var args=[],argsIndex=-1,argsLength=arguments.length,caches=[],indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf;while(++argsIndex<argsLength){var value=arguments[argsIndex];if(isArray(value)||isArguments(value)){args.push(value);caches.push(isCommon&&value.length>=120?createCache(argsIndex&&value):null)}}argsLength=args.length;var array=args[0],index=-1,length=array?array.length:0,result=[],seen=caches[0];outer:while(++index<length){value=array[index];if((seen?cacheIndexOf(seen,value):indexOf(result,value,0))<0){argsIndex=argsLength;while(--argsIndex){var cache=caches[argsIndex];if((cache?cacheIndexOf(cache,value):indexOf(args[argsIndex],value,0))<0){continue outer}}if(seen){seen.push(value)}result.push(value)}}return result}function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=length;if(typeof fromIndex=="number"){index=(fromIndex<0?nativeMax(length+fromIndex,0):nativeMin(fromIndex||0,length-1))+1}else if(fromIndex){index=binaryIndex(array,value,true)-1;var other=array[index];if(value===value?value===other:other!==other){return index}return-1}if(value!==value){return indexOfNaN(array,index,true)}while(index--){if(array[index]===value){return index}}return-1}function pull(){var args=arguments,array=args[0];if(!(array&&array.length)){return array}var index=0,indexOf=getIndexOf(),length=args.length;while(++index<length){var fromIndex=0,value=args[index];while((fromIndex=indexOf(array,value,fromIndex))>-1){splice.call(array,fromIndex,1)}}return array}function pullAt(array){return basePullAt(array||[],baseFlatten(arguments,false,false,1))}function remove(array,predicate,thisArg){var index=-1,length=array?array.length:0,result=[];predicate=getCallback(predicate,thisArg,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);splice.call(array,index--,1);length--}}return result}function rest(array){return drop(array,1)}function slice(array,start,end){var length=array?array.length:0;if(!length){return[]}if(end&&typeof end!="number"&&isIterateeCall(array,start,end)){start=0;end=length}return baseSlice(array,start,end)}function sortedIndex(array,value,iteratee,thisArg){var func=getCallback(iteratee);return func===baseCallback&&iteratee==null?binaryIndex(array,value):binaryIndexBy(array,value,func(iteratee,thisArg,1))}function sortedLastIndex(array,value,iteratee,thisArg){var func=getCallback(iteratee);return func===baseCallback&&iteratee==null?binaryIndex(array,value,true):binaryIndexBy(array,value,func(iteratee,thisArg,1),true)}function take(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}return baseSlice(array,0,n<0?0:n)}function takeRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}n=length-(+n||0);return baseSlice(array,n<0?0:n)}function takeRightWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}predicate=getCallback(predicate,thisArg,3);while(length--&&predicate(array[length],length,array)){}return baseSlice(array,length+1)}function takeWhile(array,predicate,thisArg){var length=array?array.length:0;if(!length){return[]}var index=-1;predicate=getCallback(predicate,thisArg,3);while(++index<length&&predicate(array[index],index,array)){}return baseSlice(array,0,index)}function union(){return baseUniq(baseFlatten(arguments,false,true,0))}function uniq(array,isSorted,iteratee,thisArg){var length=array?array.length:0;if(!length){return[]}if(isSorted!=null&&typeof isSorted!="boolean"){thisArg=iteratee;iteratee=isIterateeCall(array,isSorted,thisArg)?null:isSorted;isSorted=false}var func=getCallback();if(!(func===baseCallback&&iteratee==null)){iteratee=func(iteratee,thisArg,3)}return isSorted&&getIndexOf()==baseIndexOf?sortedUniq(array,iteratee):baseUniq(array,iteratee)}function unzip(array){var index=-1,length=(array&&array.length&&arrayMax(arrayMap(array,getLength)))>>>0,result=Array(length);while(++index<length){result[index]=arrayMap(array,baseProperty(index))}return result}function without(array){return baseDifference(array,baseSlice(arguments,1))}function xor(){var index=-1,length=arguments.length;while(++index<length){var array=arguments[index];if(isArray(array)||isArguments(array)){var result=result?baseDifference(result,array).concat(baseDifference(array,result)):array}}return result?baseUniq(result):[]}function zip(){var length=arguments.length,array=Array(length);while(length--){array[length]=arguments[length]}return unzip(array)}function zipObject(props,values){var index=-1,length=props?props.length:0,result={};if(length&&!values&&!isArray(props[0])){values=[]}while(++index<length){var key=props[index];if(values){result[key]=values[index]}else if(key){result[key[0]]=key[1]}}return result}function chain(value){var result=lodash(value);result.__chain__=true;return result}function tap(value,interceptor,thisArg){interceptor.call(thisArg,value);return value}function thru(value,interceptor,thisArg){return interceptor.call(thisArg,value)}function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);if(result){previous.__wrapped__=clone}else{result=clone}var previous=clone;parent=parent.__wrapped__}previous.__wrapped__=value;return result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){if(this.__actions__.length){value=new LazyWrapper(this)}return new LodashWrapper(value.reverse(),this.__chain__)}return this.thru(function(value){return value.reverse()})}function wrapperToString(){return this.value()+""}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}function at(collection){var length=collection?collection.length:0;if(isLength(length)){collection=toIterable(collection)}return baseAt(collection,baseFlatten(arguments,false,false,1))}var countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:result[key]=1});function every(collection,predicate,thisArg){var func=isArray(collection)?arrayEvery:baseEvery;if(typeof predicate!="function"||typeof thisArg!="undefined"){predicate=getCallback(predicate,thisArg,3)}return func(collection,predicate)}function filter(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=getCallback(predicate,thisArg,3);return func(collection,predicate)}function find(collection,predicate,thisArg){if(isArray(collection)){var index=findIndex(collection,predicate,thisArg);return index>-1?collection[index]:undefined}predicate=getCallback(predicate,thisArg,3);return baseFind(collection,predicate,baseEach)}function findLast(collection,predicate,thisArg){predicate=getCallback(predicate,thisArg,3);return baseFind(collection,predicate,baseEachRight)}function findWhere(collection,source){return find(collection,baseMatches(source))}function forEach(collection,iteratee,thisArg){return typeof iteratee=="function"&&typeof thisArg=="undefined"&&isArray(collection)?arrayEach(collection,iteratee):baseEach(collection,bindCallback(iteratee,thisArg,3))}function forEachRight(collection,iteratee,thisArg){return typeof iteratee=="function"&&typeof thisArg=="undefined"&&isArray(collection)?arrayEachRight(collection,iteratee):baseEachRight(collection,bindCallback(iteratee,thisArg,3))}var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value)}else{result[key]=[value]}});function includes(collection,target,fromIndex){var length=collection?collection.length:0;if(!isLength(length)){collection=values(collection);length=collection.length}if(!length){return false}if(typeof fromIndex=="number"){fromIndex=fromIndex<0?nativeMax(length+fromIndex,0):fromIndex||0}else{fromIndex=0}return typeof collection=="string"||!isArray(collection)&&isString(collection)?fromIndex<length&&collection.indexOf(target,fromIndex)>-1:getIndexOf(collection,target,fromIndex)>-1}var indexBy=createAggregator(function(result,value,key){result[key]=value});function invoke(collection,methodName){return baseInvoke(collection,methodName,baseSlice(arguments,2))}function map(collection,iteratee,thisArg){var func=isArray(collection)?arrayMap:baseMap;iteratee=getCallback(iteratee,thisArg,3);return func(collection,iteratee)}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});function pluck(collection,key){return map(collection,baseProperty(key))}function reduce(collection,iteratee,accumulator,thisArg){var func=isArray(collection)?arrayReduce:baseReduce;return func(collection,getCallback(iteratee,thisArg,4),accumulator,arguments.length<3,baseEach)}function reduceRight(collection,iteratee,accumulator,thisArg){var func=isArray(collection)?arrayReduceRight:baseReduce;return func(collection,getCallback(iteratee,thisArg,4),accumulator,arguments.length<3,baseEachRight)}function reject(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=getCallback(predicate,thisArg,3);return func(collection,function(value,index,collection){return!predicate(value,index,collection)})}function sample(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):n==null){collection=toIterable(collection);var length=collection.length;return length>0?collection[baseRandom(0,length-1)]:undefined}var result=shuffle(collection);result.length=nativeMin(n<0?0:+n||0,result.length);return result}function shuffle(collection){collection=toIterable(collection);var index=-1,length=collection.length,result=Array(length);while(++index<length){var rand=baseRandom(0,index);if(index!=rand){result[index]=result[rand]}result[rand]=collection[index]}return result}function size(collection){var length=collection?collection.length:0;return isLength(length)?length:keys(collection).length}function some(collection,predicate,thisArg){var func=isArray(collection)?arraySome:baseSome;if(typeof predicate!="function"||typeof thisArg!="undefined"){predicate=getCallback(predicate,thisArg,3)}return func(collection,predicate)}function sortBy(collection,iteratee,thisArg){if(collection==null){return[]}var index=-1,length=collection.length,result=isLength(length)?Array(length):[];if(thisArg&&isIterateeCall(collection,iteratee,thisArg)){iteratee=null}iteratee=getCallback(iteratee,thisArg,3);baseEach(collection,function(value,key,collection){result[++index]={criteria:iteratee(value,key,collection),index:index,value:value}});return baseSortBy(result,compareAscending)}function sortByAll(collection){if(collection==null){return[]}var args=arguments,guard=args[3];if(guard&&isIterateeCall(args[1],args[2],guard)){args=[collection,args[1]]}return baseSortByOrder(collection,baseFlatten(args,false,false,1),[])}function sortByOrder(collection,props,orders,guard){if(collection==null){return[]}if(guard&&isIterateeCall(props,orders,guard)){orders=null}if(!isArray(props)){props=props==null?[]:[props]}if(!isArray(orders)){orders=orders==null?[]:[orders]}return baseSortByOrder(collection,props,orders)}function where(collection,source){return filter(collection,baseMatches(source))}var now=nativeNow||function(){return(new Date).getTime()};function after(n,func){if(typeof func!="function"){if(typeof n=="function"){var temp=n;n=func;func=temp}else{throw new TypeError(FUNC_ERROR_TEXT)}}n=nativeIsFinite(n=+n)?n:0;return function(){if(--n<1){return func.apply(this,arguments)}}}function ary(func,n,guard){if(guard&&isIterateeCall(func,n,guard)){n=null}n=func&&n==null?func.length:nativeMax(+n||0,0);return createWrapper(func,ARY_FLAG,null,null,null,null,n)}function before(n,func){var result;if(typeof func!="function"){if(typeof n=="function"){var temp=n;n=func;func=temp}else{throw new TypeError(FUNC_ERROR_TEXT)}}return function(){if(--n>0){result=func.apply(this,arguments)}else{func=null}return result}}function bind(func,thisArg){var bitmask=BIND_FLAG;if(arguments.length>2){var partials=baseSlice(arguments,2),holders=replaceHolders(partials,bind.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(func,bitmask,thisArg,partials,holders)}function bindAll(object){return baseBindAll(object,arguments.length>1?baseFlatten(arguments,false,false,1):functions(object))}function bindKey(object,key){var bitmask=BIND_FLAG|BIND_KEY_FLAG;if(arguments.length>2){var partials=baseSlice(arguments,2),holders=replaceHolders(partials,bindKey.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(key,bitmask,object,partials,holders)}function curry(func,arity,guard){if(guard&&isIterateeCall(func,arity,guard)){arity=null}var result=createWrapper(func,CURRY_FLAG,null,null,null,null,null,arity);result.placeholder=curry.placeholder;return result}function curryRight(func,arity,guard){if(guard&&isIterateeCall(func,arity,guard)){arity=null}var result=createWrapper(func,CURRY_RIGHT_FLAG,null,null,null,null,null,arity);result.placeholder=curryRight.placeholder;return result}function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=wait<0?0:+wait||0;if(options===true){var leading=true;trailing=false}else if(isObject(options)){leading=options.leading;maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait);trailing="trailing"in options?options.trailing:trailing}function cancel(){if(timeoutId){clearTimeout(timeoutId)}if(maxTimeoutId){clearTimeout(maxTimeoutId)}maxTimeoutId=timeoutId=trailingCall=undefined}function delayed(){var remaining=wait-(now()-stamp);if(remaining<=0||remaining>wait){if(maxTimeoutId){clearTimeout(maxTimeoutId)}var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}}else{timeoutId=setTimeout(delayed,remaining)}}function maxDelayed(){if(timeoutId){clearTimeout(timeoutId)}maxTimeoutId=timeoutId=trailingCall=undefined;if(trailing||maxWait!==wait){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}}function debounced(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId}else{if(!maxTimeoutId&&!leading){lastCalled=stamp}var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||remaining>maxWait;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId)}lastCalled=stamp;result=func.apply(thisArg,args)}else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining)}}if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId)}else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait)}if(leadingCall){isCalled=true;result=func.apply(thisArg,args)}if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=null}return result}debounced.cancel=cancel;return debounced}function defer(func){return baseDelay(func,1,arguments,1)}function delay(func,wait){return baseDelay(func,wait,arguments,2)}var flow=createComposer();var flowRight=createComposer(true);function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,cache=memoized.cache,key=resolver?resolver.apply(this,args):args[0];if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);cache.set(key,result);return result};memoized.cache=new memoize.Cache;return memoized}function negate(predicate){if(typeof predicate!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(){return!predicate.apply(this,arguments)}}function once(func){return before(func,2)}function partial(func){var partials=baseSlice(arguments,1),holders=replaceHolders(partials,partial.placeholder);return createWrapper(func,PARTIAL_FLAG,null,partials,holders)}function partialRight(func){var partials=baseSlice(arguments,1),holders=replaceHolders(partials,partialRight.placeholder);return createWrapper(func,PARTIAL_RIGHT_FLAG,null,partials,holders)}function rearg(func){var indexes=baseFlatten(arguments,false,false,1);return createWrapper(func,REARG_FLAG,null,null,null,indexes)}function spread(func){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(array){return func.apply(this,array)}}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(options===false){leading=false}else if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}debounceOptions.leading=leading;debounceOptions.maxWait=+wait;debounceOptions.trailing=trailing;return debounce(func,wait,debounceOptions)}function wrap(value,wrapper){wrapper=wrapper==null?identity:wrapper;return createWrapper(wrapper,PARTIAL_FLAG,null,[value],[])}function clone(value,isDeep,customizer,thisArg){if(isDeep&&typeof isDeep!="boolean"&&isIterateeCall(value,isDeep,customizer)){isDeep=false}else if(typeof isDeep=="function"){thisArg=customizer;customizer=isDeep;isDeep=false}customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,1);return baseClone(value,isDeep,customizer)}function cloneDeep(value,customizer,thisArg){customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,1);return baseClone(value,true,customizer)}function isArguments(value){var length=isObjectLike(value)?value.length:undefined;return isLength(length)&&objToString.call(value)==argsTag||false}var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag||false};function isBoolean(value){return value===true||value===false||isObjectLike(value)&&objToString.call(value)==boolTag||false}function isDate(value){return isObjectLike(value)&&objToString.call(value)==dateTag||false}function isElement(value){return value&&value.nodeType===1&&isObjectLike(value)&&objToString.call(value).indexOf("Element")>-1||false}if(!support.dom){isElement=function(value){return value&&value.nodeType===1&&isObjectLike(value)&&!isPlainObject(value)||false}}function isEmpty(value){if(value==null){return true}var length=value.length;if(isLength(length)&&(isArray(value)||isString(value)||isArguments(value)||isObjectLike(value)&&isFunction(value.splice))){return!length}return!keys(value).length}function isEqual(value,other,customizer,thisArg){customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,3);if(!customizer&&isStrictComparable(value)&&isStrictComparable(other)){return value===other}var result=customizer?customizer(value,other):undefined;return typeof result=="undefined"?baseIsEqual(value,other,customizer):!!result}function isError(value){return isObjectLike(value)&&typeof value.message=="string"&&objToString.call(value)==errorTag||false}var isFinite=nativeNumIsFinite||function(value){return typeof value=="number"&&nativeIsFinite(value)};var isFunction=!(baseIsFunction(/x/)||Uint8Array&&!baseIsFunction(Uint8Array))?baseIsFunction:function(value){return objToString.call(value)==funcTag};function isObject(value){var type=typeof value;return type=="function"||value&&type=="object"||false}function isMatch(object,source,customizer,thisArg){var props=keys(source),length=props.length;customizer=typeof customizer=="function"&&bindCallback(customizer,thisArg,3);if(!customizer&&length==1){var key=props[0],value=source[key];if(isStrictComparable(value)){return object!=null&&value===object[key]&&hasOwnProperty.call(object,key)}}var values=Array(length),strictCompareFlags=Array(length);while(length--){value=values[length]=source[props[length]];strictCompareFlags[length]=isStrictComparable(value)}return baseIsMatch(object,props,values,strictCompareFlags,customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(value==null){return false}if(objToString.call(value)==funcTag){return reNative.test(fnToString.call(value))}return isObjectLike(value)&&reHostCtor.test(value)||false}function isNull(value){return value===null}function isNumber(value){return typeof value=="number"||isObjectLike(value)&&objToString.call(value)==numberTag||false}var isPlainObject=!getPrototypeOf?shimIsPlainObject:function(value){if(!(value&&objToString.call(value)==objectTag)){return false}var valueOf=value.valueOf,objProto=isNative(valueOf)&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?value==objProto||getPrototypeOf(value)==objProto:shimIsPlainObject(value)};function isRegExp(value){return isObjectLike(value)&&objToString.call(value)==regexpTag||false}function isString(value){return typeof value=="string"||isObjectLike(value)&&objToString.call(value)==stringTag||false}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&typedArrayTags[objToString.call(value)]||false}function isUndefined(value){return typeof value=="undefined"}function toArray(value){var length=value?value.length:0;if(!isLength(length)){return values(value)}if(!length){return[]}return arrayCopy(value)}function toPlainObject(value){return baseCopy(value,keysIn(value))}var assign=createAssigner(baseAssign);function create(prototype,properties,guard){var result=baseCreate(prototype);if(guard&&isIterateeCall(prototype,properties,guard)){properties=null}return properties?baseCopy(properties,result,keys(properties)):result}function defaults(object){if(object==null){return object}var args=arrayCopy(arguments);args.push(assignDefaults);return assign.apply(undefined,args)}function findKey(object,predicate,thisArg){predicate=getCallback(predicate,thisArg,3);return baseFind(object,predicate,baseForOwn,true)}function findLastKey(object,predicate,thisArg){predicate=getCallback(predicate,thisArg,3);return baseFind(object,predicate,baseForOwnRight,true)}function forIn(object,iteratee,thisArg){if(typeof iteratee!="function"||typeof thisArg!="undefined"){iteratee=bindCallback(iteratee,thisArg,3)}return baseFor(object,iteratee,keysIn)}function forInRight(object,iteratee,thisArg){iteratee=bindCallback(iteratee,thisArg,3);return baseForRight(object,iteratee,keysIn)}function forOwn(object,iteratee,thisArg){if(typeof iteratee!="function"||typeof thisArg!="undefined"){iteratee=bindCallback(iteratee,thisArg,3)}return baseForOwn(object,iteratee)}function forOwnRight(object,iteratee,thisArg){iteratee=bindCallback(iteratee,thisArg,3);return baseForRight(object,iteratee,keys)}function functions(object){return baseFunctions(object,keysIn(object))}function has(object,key){return object?hasOwnProperty.call(object,key):false}function invert(object,multiValue,guard){if(guard&&isIterateeCall(object,multiValue,guard)){multiValue=null}var index=-1,props=keys(object),length=props.length,result={};while(++index<length){var key=props[index],value=object[key];if(multiValue){if(hasOwnProperty.call(result,value)){result[value].push(key)}else{result[value]=[key]}}else{result[value]=key}}return result}var keys=!nativeKeys?shimKeys:function(object){if(object){var Ctor=object.constructor,length=object.length}if(typeof Ctor=="function"&&Ctor.prototype===object||typeof object!="function"&&(length&&isLength(length))){return shimKeys(object)}return isObject(object)?nativeKeys(object):[]};function keysIn(object){if(object==null){return[]}if(!isObject(object)){object=Object(object)}var length=object.length;length=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object))&&length||0;var Ctor=object.constructor,index=-1,isProto=typeof Ctor=="function"&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;while(++index<length){result[index]=index+""}for(var key in object){if(!(skipIndexes&&isIndex(key,length))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}function mapValues(object,iteratee,thisArg){var result={};iteratee=getCallback(iteratee,thisArg,3);baseForOwn(object,function(value,key,object){result[key]=iteratee(value,key,object)});return result}var merge=createAssigner(baseMerge);function omit(object,predicate,thisArg){if(object==null){return{}}if(typeof predicate!="function"){var props=arrayMap(baseFlatten(arguments,false,false,1),String);return pickByArray(object,baseDifference(keysIn(object),props))}predicate=bindCallback(predicate,thisArg,3);return pickByCallback(object,function(value,key,object){return!predicate(value,key,object)})}function pairs(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]]}return result}function pick(object,predicate,thisArg){if(object==null){return{}}return typeof predicate=="function"?pickByCallback(object,bindCallback(predicate,thisArg,3)):pickByArray(object,baseFlatten(arguments,false,false,1))}function result(object,key,defaultValue){var value=object==null?undefined:object[key];if(typeof value=="undefined"){value=defaultValue}return isFunction(value)?value.call(object):value}function transform(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);iteratee=getCallback(iteratee,thisArg,4);if(accumulator==null){if(isArr||isObject(object)){var Ctor=object.constructor;if(isArr){accumulator=isArray(object)?new Ctor:[]}else{accumulator=baseCreate(isFunction(Ctor)&&Ctor.prototype)}}else{accumulator={}}}(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}function values(object){return baseValues(object,keys(object))}function valuesIn(object){return baseValues(object,keysIn(object))}function inRange(value,start,end){start=+start||0;if(typeof end==="undefined"){end=start;start=0}else{end=+end||0}return value>=start&&value<end}function random(min,max,floating){if(floating&&isIterateeCall(min,max,floating)){max=floating=null}var noMin=min==null,noMax=max==null;if(floating==null){if(noMax&&typeof min=="boolean"){floating=min;min=1}else if(typeof max=="boolean"){floating=max;noMax=true}}if(noMin&&noMax){max=1;noMax=false}min=+min||0;if(noMax){max=min;min=0}else{max=+max||0}if(floating||min%1||max%1){var rand=nativeRandom();return nativeMin(min+rand*(max-min+parseFloat("1e-"+((rand+"").length-1))),max);
}return baseRandom(min,max)}var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?word.charAt(0).toUpperCase()+word.slice(1):word)});function capitalize(string){string=baseToString(string);return string&&string.charAt(0).toUpperCase()+string.slice(1)}function deburr(string){string=baseToString(string);return string&&string.replace(reLatin1,deburrLetter)}function endsWith(string,target,position){string=baseToString(string);target=target+"";var length=string.length;position=typeof position=="undefined"?length:nativeMin(position<0?0:+position||0,length);position-=target.length;return position>=0&&string.indexOf(target,position)==position}function escape(string){string=baseToString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){string=baseToString(string);return string&&reHasRegExpChars.test(string)?string.replace(reRegExpChars,"\\$&"):string}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()});function pad(string,length,chars){string=baseToString(string);length=+length;var strLength=string.length;if(strLength>=length||!nativeIsFinite(length)){return string}var mid=(length-strLength)/2,leftLength=floor(mid),rightLength=ceil(mid);chars=createPad("",rightLength,chars);return chars.slice(0,leftLength)+string+chars}function padLeft(string,length,chars){string=baseToString(string);return string&&createPad(string,length,chars)+string}function padRight(string,length,chars){string=baseToString(string);return string&&string+createPad(string,length,chars)}function parseInt(string,radix,guard){if(guard&&isIterateeCall(string,radix,guard)){radix=0}return nativeParseInt(string,radix)}if(nativeParseInt(whitespace+"08")!=8){parseInt=function(string,radix,guard){if(guard?isIterateeCall(string,radix,guard):radix==null){radix=0}else if(radix){radix=+radix}string=trim(string);return nativeParseInt(string,radix||(reHexPrefix.test(string)?16:10))}}function repeat(string,n){var result="";string=baseToString(string);n=+n;if(n<1||!string||!nativeIsFinite(n)){return result}do{if(n%2){result+=string}n=floor(n/2);string+=string}while(n);return result}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()});var startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+(word.charAt(0).toUpperCase()+word.slice(1))});function startsWith(string,target,position){string=baseToString(string);position=position==null?0:nativeMin(position<0?0:+position||0,string.length);return string.lastIndexOf(target,position)==position}function template(string,options,otherOptions){var settings=lodash.templateSettings;if(otherOptions&&isIterateeCall(string,options,otherOptions)){options=otherOptions=null}string=baseToString(string);options=baseAssign(baseAssign({},otherOptions||options),settings,assignOwnDefaults);var imports=baseAssign(baseAssign({},options.imports),settings.imports,assignOwnDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");var sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){isEscaping=true;source+="' +\n__e("+escapeValue+") +\n'"}if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '"}if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"}index=offset+match.length;return match});source+="';\n";var variable=options.variable;if(!variable){source="with (obj) {\n"+source+"\n}\n"}source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});result.source=source;if(isError(result)){throw result}return result}function trim(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(trimmedLeftIndex(string),trimmedRightIndex(string)+1)}chars=chars+"";return string.slice(charsLeftIndex(string,chars),charsRightIndex(string,chars)+1)}function trimLeft(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(trimmedLeftIndex(string))}return string.slice(charsLeftIndex(string,chars+""))}function trimRight(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(0,trimmedRightIndex(string)+1)}return string.slice(0,charsRightIndex(string,chars+"")+1)}function trunc(string,options,guard){if(guard&&isIterateeCall(string,options,guard)){options=null}var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(options!=null){if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?+options.length||0:length;omission="omission"in options?baseToString(options.omission):omission}else{length=+options||0}}string=baseToString(string);if(length>=string.length){return string}var end=length-omission.length;if(end<1){return omission}var result=string.slice(0,end);if(separator==null){return result+omission}if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,newEnd,substring=string.slice(0,end);if(!separator.global){separator=RegExp(separator.source,(reFlags.exec(separator)||"")+"g")}separator.lastIndex=0;while(match=separator.exec(substring)){newEnd=match.index}result=result.slice(0,newEnd==null?end:newEnd)}}else if(string.indexOf(separator,end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index)}}return result+omission}function unescape(string){string=baseToString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}function words(string,pattern,guard){if(guard&&isIterateeCall(string,pattern,guard)){pattern=null}string=baseToString(string);return string.match(pattern||reWords)||[]}function attempt(){var func=arguments[0],length=arguments.length,args=Array(length?length-1:0);while(--length>0){args[length-1]=arguments[length]}try{return func.apply(undefined,args)}catch(e){return isError(e)?e:new Error(e)}}function callback(func,thisArg,guard){if(guard&&isIterateeCall(func,thisArg,guard)){thisArg=null}return isObjectLike(func)?matches(func):baseCallback(func,thisArg)}function constant(value){return function(){return value}}function identity(value){return value}function matches(source){return baseMatches(baseClone(source,true))}function matchesProperty(key,value){return baseMatchesProperty(key+"",baseClone(value,true))}function mixin(object,source,options){if(options==null){var isObj=isObject(source),props=isObj&&keys(source),methodNames=props&&props.length&&baseFunctions(source,props);if(!(methodNames?methodNames.length:isObj)){methodNames=false;options=source;source=object;object=this}}if(!methodNames){methodNames=baseFunctions(source,keys(source))}var chain=true,index=-1,isFunc=isFunction(object),length=methodNames.length;if(options===false){chain=false}else if(isObject(options)&&"chain"in options){chain=options.chain}while(++index<length){var methodName=methodNames[index],func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(func){return function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__);(result.__actions__=arrayCopy(this.__actions__)).push({func:func,args:arguments,thisArg:object});result.__chain__=chainAll;return result}var args=[this.value()];push.apply(args,arguments);return func.apply(object,args)}}(func)}}return object}function noConflict(){context._=oldDash;return this}function noop(){}function property(key){return baseProperty(key+"")}function propertyOf(object){return function(key){return object==null?undefined:object[key]}}function range(start,end,step){if(step&&isIterateeCall(start,end,step)){end=step=null}start=+start||0;step=step==null?1:+step||0;if(end==null){end=start;start=0}else{end=+end||0}var index=-1,length=nativeMax(ceil((end-start)/(step||1)),0),result=Array(length);while(++index<length){result[index]=start;start+=step}return result}function times(n,iteratee,thisArg){n=+n;if(n<1||!nativeIsFinite(n)){return[]}var index=-1,result=Array(nativeMin(n,MAX_ARRAY_LENGTH));iteratee=bindCallback(iteratee,thisArg,1);while(++index<n){if(index<MAX_ARRAY_LENGTH){result[index]=iteratee(index)}else{iteratee(index)}}return result}function uniqueId(prefix){var id=++idCounter;return baseToString(prefix)+id}function add(augend,addend){return augend+addend}var max=createExtremum(arrayMax);var min=createExtremum(arrayMin,true);function sum(collection){if(!isArray(collection)){collection=toIterable(collection)}var length=collection.length,result=0;while(length--){result+=+collection[length]||0}return result}lodash.prototype=baseLodash.prototype;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;MapCache.prototype["delete"]=mapDelete;MapCache.prototype.get=mapGet;MapCache.prototype.has=mapHas;MapCache.prototype.set=mapSet;SetCache.prototype.push=cachePush;memoize.Cache=MapCache;lodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.callback=callback;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;lodash.flow=flow;lodash.flowRight=flowRight;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.functions=functions;lodash.groupBy=groupBy;lodash.indexBy=indexBy;lodash.initial=initial;lodash.intersection=intersection;lodash.invert=invert;lodash.invoke=invoke;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.mixin=mixin;lodash.negate=negate;lodash.omit=omit;lodash.once=once;lodash.pairs=pairs;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pluck=pluck;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAt=pullAt;lodash.range=range;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortByAll=sortByAll;lodash.sortByOrder=sortByOrder;lodash.spread=spread;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.times=times;lodash.toArray=toArray;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.union=union;lodash.uniq=uniq;lodash.unzip=unzip;lodash.values=values;lodash.valuesIn=valuesIn;lodash.where=where;lodash.without=without;lodash.wrap=wrap;lodash.xor=xor;lodash.zip=zip;lodash.zipObject=zipObject;lodash.backflow=flowRight;lodash.collect=map;lodash.compose=flowRight;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.extend=assign;lodash.iteratee=callback;lodash.methods=functions;lodash.object=zipObject;lodash.select=filter;lodash.tail=rest;lodash.unique=uniq;mixin(lodash,lodash);lodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.deburr=deburr;lodash.endsWith=endsWith;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.findWhere=findWhere;lodash.first=first;lodash.has=has;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isBoolean=isBoolean;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isMatch=isMatch;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isString=isString;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.max=max;lodash.min=min;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padLeft=padLeft;lodash.padRight=padRight;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.result=result;lodash.runInContext=runInContext;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedLastIndex=sortedLastIndex;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.sum=sum;lodash.template=template;lodash.trim=trim;lodash.trimLeft=trimLeft;lodash.trimRight=trimRight;lodash.trunc=trunc;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.words=words;lodash.all=every;lodash.any=some;lodash.contains=includes;lodash.detect=find;lodash.foldl=reduce;lodash.foldr=reduceRight;lodash.head=first;lodash.include=includes;lodash.inject=reduce;mixin(lodash,function(){var source={};baseForOwn(lodash,function(func,methodName){if(!lodash.prototype[methodName]){source[methodName]=func}});return source}(),false);lodash.sample=sample;lodash.prototype.sample=function(n){if(!this.__chain__&&n==null){return sample(this.value())}return this.thru(function(value){return sample(value,n)})};lodash.VERSION=VERSION;arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash});arrayEach(["dropWhile","filter","map","takeWhile"],function(methodName,type){var isFilter=type!=LAZY_MAP_FLAG,isDropWhile=type==LAZY_DROP_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee,thisArg){var filtered=this.__filtered__,result=filtered&&isDropWhile?new LazyWrapper(this):this.clone(),iteratees=result.__iteratees__||(result.__iteratees__=[]);iteratees.push({done:false,count:0,index:0,iteratee:getCallback(iteratee,thisArg,1),limit:-1,type:type});result.__filtered__=filtered||isFilter;return result}});arrayEach(["drop","take"],function(methodName,index){var whileName=methodName+"While";LazyWrapper.prototype[methodName]=function(n){var filtered=this.__filtered__,result=filtered&&!index?this.dropWhile():this.clone();n=n==null?1:nativeMax(floor(n)||0,0);if(filtered){if(index){result.__takeCount__=nativeMin(result.__takeCount__,n)}else{last(result.__iteratees__).limit=n}}else{var views=result.__views__||(result.__views__=[]);views.push({size:n,type:methodName+(result.__dir__<0?"Right":"")})}return result};LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()};LazyWrapper.prototype[methodName+"RightWhile"]=function(predicate,thisArg){return this.reverse()[whileName](predicate,thisArg).reverse()}});arrayEach(["first","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}});arrayEach(["initial","rest"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this[dropName](1)}});arrayEach(["pluck","where"],function(methodName,index){var operationName=index?"filter":"map",createCallback=index?baseMatches:baseProperty;LazyWrapper.prototype[methodName]=function(value){return this[operationName](createCallback(value))}});LazyWrapper.prototype.compact=function(){return this.filter(identity)};LazyWrapper.prototype.reject=function(predicate,thisArg){predicate=getCallback(predicate,thisArg,1);return this.filter(function(value){return!predicate(value)})};LazyWrapper.prototype.slice=function(start,end){start=start==null?0:+start||0;var result=start<0?this.takeRight(-start):this.drop(start);if(typeof end!="undefined"){end=+end||0;result=end<0?result.dropRight(-end):result.take(end-start)}return result};LazyWrapper.prototype.toArray=function(){return this.drop(0)};baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName],checkIteratee=/^(?:filter|map|reject)|While$/.test(methodName),retUnwrapped=/^(?:first|last)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments,length=args.length,chainAll=this.__chain__,value=this.__wrapped__,isHybrid=!!this.__actions__.length,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);if(useLazy&&checkIteratee&&typeof iteratee=="function"&&iteratee.length!=1){isLazy=useLazy=false}var onlyLazy=isLazy&&!isHybrid;if(retUnwrapped&&!chainAll){return onlyLazy?func.call(value):lodashFunc.call(lodash,this.value())}var interceptor=function(value){var otherArgs=[value];push.apply(otherArgs,args);return lodashFunc.apply(lodash,otherArgs)};if(useLazy){var wrapper=onlyLazy?value:new LazyWrapper(this),result=func.apply(wrapper,args);if(!retUnwrapped&&(isHybrid||result.__actions__)){var actions=result.__actions__||(result.__actions__=[]);actions.push({func:thru,args:[interceptor],thisArg:lodash})}return new LodashWrapper(result,chainAll)}return this.thru(interceptor)}});arrayEach(["concat","join","pop","push","replace","shift","sort","splice","split","unshift"],function(methodName){var func=(/^(?:replace|split)$/.test(methodName)?stringProto:arrayProto)[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:join|pop|replace|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){return func.apply(this.value(),args)}return this[chainName](function(value){return func.apply(value,args)})}});LazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toString=wrapperToString;lodash.prototype.run=lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;lodash.prototype.collect=lodash.prototype.map;lodash.prototype.head=lodash.prototype.first;lodash.prototype.select=lodash.prototype.filter;lodash.prototype.tail=lodash.prototype.rest;return lodash}var _=runInContext();if(true){root._=_;!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return _}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else if(freeExports&&freeModule){if(moduleExports){(freeModule.exports=_)._=_}else{freeExports._=_}}else{root._=_}}).call(this)}).call(exports,__webpack_require__(140)(module),function(){return this}())},function(module,exports){module.exports=function(module){if(!module.webpackPolyfill){module.deprecate=function(){};module.paths=[];module.children=[];module.webpackPolyfill=1}return module}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _MapComponent=__webpack_require__(142);var _MapComponent2=_interopRequireDefault(_MapComponent);var _SearchComponent=__webpack_require__(149);var _SearchComponent2=_interopRequireDefault(_SearchComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const isArray=_writer.lodash.isArray;const isObject=_writer.lodash.isObject;const find=_writer.lodash.find;class LocationDetailComponent extends _substance.Component{constructor(...args){super(...args);this.handleActions({googleMapsLoaded:this.googleMapsLoaded,searchItemSelected:this.searchItemSelected,markerPositionChanged:this.markerPositionChanged})}dispose(){super.dispose()}createIdForObject(){this.state.location.concept.metadata.object["@id"]=(0,_writer.idGenerator)()}createLocation(){const location=this.state.location;this.createIdForObject();this.saveLocation(null,"POST").then(uuid=>{this.context.api.newsItem.addLocation(this.name,{title:location.concept.name,data:this.getGeometryObject(),uuid:uuid,type:this.getLocationType()});if(this.state.error){this.setState({error:false})}this.props.reload();this.send("close")}).catch(()=>this.setState({error:true}))}updateLocation(){const location=this.state.location;const uuid=location["@guid"]?location["@guid"]:null;if(!uuid){throw new Error("ConceptItem has no UUID to update")}this.saveLocation(uuid,"PUT").then(()=>{this.context.api.newsItem.updateLocation(this.name,{title:location.concept.name,data:this.getGeometryObject(),uuid:uuid,type:this.getLocationType()});if(this.state.error){this.setState({error:false})}this.props.reload();this.send("close")}).catch(()=>this.setState({error:true}))}getGeometryObject(){const geometry=findAttribute(this.state.location,"geometry");if(geometry){return{position:this.state.location.concept.metadata.object.data.geometry}}else{return{}}}setDescription(inputValue,role){const currentDescription=this.context.api.concept.getDefinitionForType(this.state.location.concept.definition,role);if(inputValue.length>0&&!currentDescription){const longDesc={"@role":role,keyValue:inputValue};this.state.location.concept.definition=this.context.api.concept.setDefinitionDependingOnArrayOrObject(this.state.location.concept.definition,longDesc)}else if(inputValue.length>=0&&currentDescription){currentDescription["keyValue"]=inputValue}}saveLocation(id,method){const location=this.state.location;location.concept.name=this.refs.locationNameInput.val().length>0?this.refs.locationNameInput.val():location.concept.name;const shortDescriptionInputValue=this.refs.locationShortDescInput.val();const longDescriptionInputValue=this.refs.locationLongDescText.val();if(!location.concept.definition){location.concept.definition=[]}this.setDescription(shortDescriptionInputValue,"drol:short");this.setDescription(longDescriptionInputValue,"drol:long");this.xmlDoc=_writer.jxon.unbuild(location,null,"conceptItem");const conceptItem=this.xmlDoc.documentElement.outerHTML;switch(method){case"PUT":return this.context.api.router.updateConceptItem(id,conceptItem);case"POST":return this.context.api.router.createConceptItem(conceptItem)}}searchItemSelected(googleLatLng){this.markerPositionChanged({lat:googleLatLng.lat(),lng:googleLatLng.lng()});this.refs.mapComponent.setProps({googleLatLng:googleLatLng})}googleMapsLoaded(google){this.google=google;if(this.state.newLocation&&this.state.query){try{this.refs.searchComponent.setProps({google:google,query:this.state.query})}catch(e){}}else{this.refs.searchComponent.setProps({google:google})}this.extendState({googleMapsLoaded:true})}updateMapPosition(){const latlng=this.getLatLngFromLoadedLocation();this.refs.mapComponent.setProps({googleLatLng:new this.google.maps.LatLng(latlng.lat,latlng.lng)})}updateMapPositionPolygon(){const wktPolygon=this.state.location.concept.metadata.object.data.geometry;try{this.refs.mapComponent.setProps({isPolygon:true,wktString:wktPolygon})}catch(e){console.error("e",e)}}getLatLngFromLoadedLocation(){const geometry=findAttribute(this.state.location.concept,"geometry");if(!geometry){return{lat:0,lng:0}}const latLongString=/POINT\((\-?[0-9\.\s]+)\)/.exec(geometry)[1].split(" ");return{lat:latLongString[1],lng:latLongString[0]}}markerPositionChanged(latLng){if(!this.state.location.concept.metadata.object.data){this.state.location.concept.metadata.object.data={}}this.state.location.concept.metadata.object.data.geometry="POINT("+latLng.lng+" "+latLng.lat+")"}getDescription(descriptionType){const locationConcept=this.state.location.concept;if(!locationConcept.definition){return undefined}if(isArray(locationConcept.definition)){return find(locationConcept.definition,function(definition){return definition["@role"]===descriptionType})}else if(isObject(locationConcept.definition)){return locationConcept.definition["@role"]===descriptionType?locationConcept.definition:undefined}}willReceiveProps(props){this.extendState({query:props.query,newLocation:props.newLocation,location:props.location,editable:props.editable})}getNameForLocation(){if(this.state.query){return this.state.query}else{return this.state.location.concept.name}}render($$){let shortDesc="",longDesc="";const name=this.getNameForLocation();if(this.state.googleMapsLoaded){shortDesc=this.getDescription("drol:short");longDesc=this.getDescription("drol:long");shortDesc=shortDesc?shortDesc:"";longDesc=longDesc?longDesc:"";if(this.state.location.concept.metadata.object["@type"]==="x-im/polygon"){console.warn("Edit of polygons is not yet supported");this.searchDisabled=true;this.isPolygon=true;this.updateMapPositionPolygon()}else{this.updateMapPosition()}}const el=$$("div");const formContainer=$$("form").addClass("location-form__container container").ref("formContainer").on("submit",e=>{e.preventDefault();if(this.refs["locationNameInput"].val()!==""){this.onClose("save")}});const rowContainer=$$("div").addClass("row");const hiddenSubmitButtonToEnableEnterSubmit=$$("input").attr({type:"submit",style:"display:none"});rowContainer.append(hiddenSubmitButtonToEnableEnterSubmit);const formGroup=$$("fieldset").addClass("form-group col-6").ref("formGroupName");formGroup.append($$("label").attr("for","locationNameInput").append(this.getLabel("Name")));if(this.state.editable){const locationName=$$("input").attr({type:"text",id:"locationNameInput"}).addClass("form-control").val(name).ref("locationNameInput");locationName.on("change",function(){if(this.refs["locationNameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}}.bind(this));formGroup.append(locationName)}else{formGroup.append($$("p").append(name).ref("locationNameP"))}rowContainer.append(formGroup);const formGroupShortDesc=$$("fieldset").addClass("form-group col-6").ref("formGroupShortDesc");formGroupShortDesc.append($$("label").attr("for","locationShortDescInput").append(this.getLabel("Short description")));if(this.state.editable){formGroupShortDesc.append($$("input").attr({id:"locationShortDescInput"}).addClass("form-control").val(shortDesc["keyValue"]).ref("locationShortDescInput"))}else{formGroupShortDesc.append($$("p").append(shortDesc["keyValue"]).ref("locationShortDescP"))}rowContainer.append(formGroupShortDesc);const formGroupLongDesc=$$("fieldset").addClass("form-group col-12").ref("formGroupLongDesc");formGroupLongDesc.append($$("label").attr("for","locationLongDescText").append(this.getLabel("Long description")));if(this.state.editable){formGroupLongDesc.append($$("textarea").attr({id:"locationLongDescText"}).addClass("form-control").val(longDesc["keyValue"]).ref("locationLongDescText"))}else{formGroupLongDesc.append($$("p").append(longDesc["keyValue"]).ref("locationLongDescP"))}rowContainer.append(formGroupLongDesc);formContainer.append(rowContainer);el.append(formContainer);if(this.props.exists){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-info").append(this.getLabel("Please note that this name is already in use")+": "+this.state.query)))}if(!this.searchDisabled){const searchComponent=$$(_SearchComponent2.default).ref("searchComponent");el.append(searchComponent)}if(this.isPolygon){el.append($$("p").addClass("col-12 not-supported").append(this.getLabel("Edit of polygons is not currently supported")))}const mapComponent=$$(_MapComponent2.default,{pluginId:this.props.plugin.id}).ref("mapComponent");el.append(mapComponent);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.context.i18n.t("ximplace-error-save"))))}return el}onClose(status){if("cancel"===status||this.state.editable===false){return true}if(this.state.newLocation){this.createLocation()}else{this.updateLocation()}return false}getLocationType(){const useGeometryType=this.context.api.getConfigValue("se.infomaker.ximplace","useGeometryType");if(useGeometryType){let locationType="";try{if(typeof this.state.location.concept.metadata.object["@type"]!=="undefined"){locationType=this.state.location.concept.metadata.object["@type"]}}catch(ex){console.error(ex);throw new Error("Invalid conceptItem for location")}if(locationType){return locationType}else{throw new Error("Invalid conceptItem for location. Missing object type")}}else{return"x-im/place"}}}function findAttribute(object,attribute){let match;function iterateObject(target,name){Object.keys(target).forEach(function(key){if(isObject(target[key])){iterateObject(target[key],name)}else if(key===name){match=target[key]}})}iterateObject(object,attribute);return match?match:undefined}exports.default=LocationDetailComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _googleMapsApiLoader=__webpack_require__(143);var _googleMapsApiLoader2=_interopRequireDefault(_googleMapsApiLoader);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class MapComponent extends _substance.Component{constructor(...args){super(...args)}handleWKTPolygon(wktString){var ptsArray=[];function addPoints(google,data){var pointsData=data.split(",");var len=pointsData.length;for(var i=0;i<len;i++){var xy=pointsData[i].split(" ");var pt=new google.maps.LatLng(xy[1],xy[0]);ptsArray.push(pt)}}var regex=/\(([^()]+)\)/g;var wktRings=[];var results;wktString=wktString.replace(/ +(?= )/g,"");do{results=regex.exec(wktString);if(results){wktRings.push(results[1])}}while(results);for(var i=0;i<wktRings.length;i++){addPoints(this.google,wktRings[i])}var poly=new this.google.maps.Polygon({paths:ptsArray,strokeColor:"#3A99D9",strokeOpacity:.8,strokeWeight:2,fillColor:"#1E90FF",fillOpacity:.35});poly.setMap(this.map);this.map.setZoom(9)}dispose(){this.map.unbindAll()}getDefaultMapOptions(){var latlng=new google.maps.LatLng(56.683687,16.363279);return{zoom:14,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:false}}didMount(){var apiKey=this.context.api.getConfigValue(this.props.pluginId,"googleMapAPIKey");(0,_googleMapsApiLoader2.default)({
libraries:["geometry","places"],apiKey:apiKey}).then(googleApi=>{this.googleMapsLoaded(googleApi)},err=>{console.error(err)})}googleMapsLoaded(google){this.google=google;let mapContaienr=document.getElementById("map-container");this.map=new google.maps.Map(mapContaienr,this.getDefaultMapOptions());this.send("googleMapsLoaded",google)}setMarker(googleLatLong){if(this.marker){this.marker.position=googleLatLong}else{this.marker=new google.maps.Marker({position:googleLatLong,icon:{path:google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,strokeColor:"#2a6f9e",strokeOpacity:1,strokeWeight:2,fillColor:"#3A99D9",fillOpacity:.35,scale:4},draggable:true});this.marker.addListener("dragend",function(event){this.send("markerPositionChanged",{lat:event.latLng.lat(),lng:event.latLng.lng()})}.bind(this))}this.marker.setMap(this.map)}updateMapLocation(googleLatLng){this.map.setCenter(googleLatLng);this.setMarker(googleLatLng)}willReceiveProps(props){if(props.googleLatLng){this.updateMapLocation(props.googleLatLng)}else if(props.isPolygon){this.handleWKTPolygon(props.wktString)}}shouldRerender(){return false}render($$){var el=$$("div").ref("mapComponent");var mapContainer=$$("div").attr("id","map-container").ref("mapContainer");el.append(mapContainer);return el}}exports.default=MapComponent},function(module,exports,__webpack_require__){module.exports=__webpack_require__(144)},function(module,exports,__webpack_require__){"use strict";var Promise=__webpack_require__(145).Promise;var urlBuilder=__webpack_require__(148);var googleApi;function loadAutoCompleteAPI(params){var script=document.createElement("script");script.type="text/javascript";script.src=urlBuilder({base:"https://maps.googleapis.com/maps/api/js",libraries:params.libraries||[],callback:"googleMapsAutoCompleteAPILoad",apiKey:params.apiKey,client:params.client});document.querySelector("head").appendChild(script)}function googleMapsApiLoader(params){if(googleApi){return Promise.resolve(googleApi)}var windowRef=window?window:{};var deferred=function(resolve,reject){loadAutoCompleteAPI(params);windowRef.googleMapsAutoCompleteAPILoad=function(){googleApi=windowRef.google;resolve(googleApi)};setTimeout(function(){if(!windowRef.google){reject(new Error("Loading took too long"))}},5e3)};return new Promise(deferred)}module.exports=googleMapsApiLoader},function(module,exports,__webpack_require__){var require;(function(process,global){(function(global,factory){true?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.ES6Promise=factory()})(this,function(){"use strict";function objectOrFunction(x){return typeof x==="function"||typeof x==="object"&&x!==null}function isFunction(x){return typeof x==="function"}var _isArray=undefined;if(!Array.isArray){_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}}else{_isArray=Array.isArray}var isArray=_isArray;var len=0;var vertxNext=undefined;var customSchedulerFn=undefined;var asap=function asap(callback,arg){queue[len]=callback;queue[len+1]=arg;len+=2;if(len===2){if(customSchedulerFn){customSchedulerFn(flush)}else{scheduleFlush()}}};function setScheduler(scheduleFn){customSchedulerFn=scheduleFn}function setAsap(asapFn){asap=asapFn}var browserWindow=typeof window!=="undefined"?window:undefined;var browserGlobal=browserWindow||{};var BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver;var isNode=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function useNextTick(){return function(){return process.nextTick(flush)}}function useVertxTimer(){if(typeof vertxNext!=="undefined"){return function(){vertxNext(flush)}}return useSetTimeout()}function useMutationObserver(){var iterations=0;var observer=new BrowserMutationObserver(flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=flush;return function(){return channel.port2.postMessage(0)}}function useSetTimeout(){var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1)}}var queue=new Array(1e3);function flush(){for(var i=0;i<len;i+=2){var callback=queue[i];var arg=queue[i+1];callback(arg);queue[i]=undefined;queue[i+1]=undefined}len=0}function attemptVertx(){try{var r=require;var vertx=__webpack_require__(147);vertxNext=vertx.runOnLoop||vertx.runOnContext;return useVertxTimer()}catch(e){return useSetTimeout()}}var scheduleFlush=undefined;if(isNode){scheduleFlush=useNextTick()}else if(BrowserMutationObserver){scheduleFlush=useMutationObserver()}else if(isWorker){scheduleFlush=useMessageChannel()}else if(browserWindow===undefined&&"function"==="function"){scheduleFlush=attemptVertx()}else{scheduleFlush=useSetTimeout()}function then(onFulfillment,onRejection){var _arguments=arguments;var parent=this;var child=new this.constructor(noop);if(child[PROMISE_ID]===undefined){makePromise(child)}var _state=parent._state;if(_state){(function(){var callback=_arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result)})})()}else{subscribe(parent,child,onFulfillment,onRejection)}return child}function resolve(object){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}var promise=new Constructor(noop);_resolve(promise,object);return promise}var PROMISE_ID=Math.random().toString(36).substring(16);function noop(){}var PENDING=void 0;var FULFILLED=1;var REJECTED=2;var GET_THEN_ERROR=new ErrorObject;function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function getThen(promise){try{return promise.then}catch(error){GET_THEN_ERROR.error=error;return GET_THEN_ERROR}}function tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function handleForeignThenable(promise,thenable,then){asap(function(promise){var sealed=false;var error=tryThen(then,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){_resolve(promise,value)}else{fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;_reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;_reject(promise,error)}},promise)}function handleOwnThenable(promise,thenable){if(thenable._state===FULFILLED){fulfill(promise,thenable._result)}else if(thenable._state===REJECTED){_reject(promise,thenable._result)}else{subscribe(thenable,undefined,function(value){return _resolve(promise,value)},function(reason){return _reject(promise,reason)})}}function handleMaybeThenable(promise,maybeThenable,then$$){if(maybeThenable.constructor===promise.constructor&&then$$===then&&maybeThenable.constructor.resolve===resolve){handleOwnThenable(promise,maybeThenable)}else{if(then$$===GET_THEN_ERROR){_reject(promise,GET_THEN_ERROR.error)}else if(then$$===undefined){fulfill(promise,maybeThenable)}else if(isFunction(then$$)){handleForeignThenable(promise,maybeThenable,then$$)}else{fulfill(promise,maybeThenable)}}}function _resolve(promise,value){if(promise===value){_reject(promise,selfFulfillment())}else if(objectOrFunction(value)){handleMaybeThenable(promise,value,getThen(value))}else{fulfill(promise,value)}}function publishRejection(promise){if(promise._onerror){promise._onerror(promise._result)}publish(promise)}function fulfill(promise,value){if(promise._state!==PENDING){return}promise._result=value;promise._state=FULFILLED;if(promise._subscribers.length!==0){asap(publish,promise)}}function _reject(promise,reason){if(promise._state!==PENDING){return}promise._state=REJECTED;promise._result=reason;asap(publishRejection,promise)}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers;var length=_subscribers.length;parent._onerror=null;_subscribers[length]=child;_subscribers[length+FULFILLED]=onFulfillment;_subscribers[length+REJECTED]=onRejection;if(length===0&&parent._state){asap(publish,parent)}}function publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return}var child=undefined,callback=undefined,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function ErrorObject(){this.error=null}var TRY_CATCH_ERROR=new ErrorObject;function tryCatch(callback,detail){try{return callback(detail)}catch(e){TRY_CATCH_ERROR.error=e;return TRY_CATCH_ERROR}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=undefined,error=undefined,succeeded=undefined,failed=undefined;if(hasCallback){value=tryCatch(callback,detail);if(value===TRY_CATCH_ERROR){failed=true;error=value.error;value=null}else{succeeded=true}if(promise===value){_reject(promise,cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==PENDING){}else if(hasCallback&&succeeded){_resolve(promise,value)}else if(failed){_reject(promise,error)}else if(settled===FULFILLED){fulfill(promise,value)}else if(settled===REJECTED){_reject(promise,value)}}function initializePromise(promise,resolver){try{resolver(function resolvePromise(value){_resolve(promise,value)},function rejectPromise(reason){_reject(promise,reason)})}catch(e){_reject(promise,e)}}var id=0;function nextId(){return id++}function makePromise(promise){promise[PROMISE_ID]=id++;promise._state=undefined;promise._result=undefined;promise._subscribers=[]}function Enumerator(Constructor,input){this._instanceConstructor=Constructor;this.promise=new Constructor(noop);if(!this.promise[PROMISE_ID]){makePromise(this.promise)}if(isArray(input)){this._input=input;this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0){fulfill(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){fulfill(this.promise,this._result)}}}else{_reject(this.promise,validationError())}}function validationError(){return new Error("Array Methods must be provided an Array")}Enumerator.prototype._enumerate=function(){var length=this.length;var _input=this._input;for(var i=0;this._state===PENDING&&i<length;i++){this._eachEntry(_input[i],i)}};Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor;var resolve$$=c.resolve;if(resolve$$===resolve){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING){this._settledAt(entry._state,i,entry._result)}else if(typeof _then!=="function"){this._remaining--;this._result[i]=entry}else if(c===Promise){var promise=new c(noop);handleMaybeThenable(promise,entry,_then);this._willSettleAt(promise,i)}else{this._willSettleAt(new c(function(resolve$$){return resolve$$(entry)}),i)}}else{this._willSettleAt(resolve$$(entry),i)}};Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;if(promise._state===PENDING){this._remaining--;if(state===REJECTED){_reject(promise,value)}else{this._result[i]=value}}if(this._remaining===0){fulfill(promise,this._result)}};Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;subscribe(promise,undefined,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})};function all(entries){return new Enumerator(this,entries).promise}function race(entries){var Constructor=this;if(!isArray(entries)){return new Constructor(function(_,reject){return reject(new TypeError("You must pass an array to race."))})}else{return new Constructor(function(resolve,reject){var length=entries.length;for(var i=0;i<length;i++){Constructor.resolve(entries[i]).then(resolve,reject)}})}}function reject(reason){var Constructor=this;var promise=new Constructor(noop);_reject(promise,reason);return promise}function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Promise(resolver){this[PROMISE_ID]=nextId();this._result=this._state=undefined;this._subscribers=[];if(noop!==resolver){typeof resolver!=="function"&&needsResolver();this instanceof Promise?initializePromise(this,resolver):needsNew()}}Promise.all=all;Promise.race=race;Promise.resolve=resolve;Promise.reject=reject;Promise._setScheduler=setScheduler;Promise._setAsap=setAsap;Promise._asap=asap;Promise.prototype={constructor:Promise,then:then,catch:function _catch(onRejection){return this.then(null,onRejection)}};function polyfill(){var local=undefined;if(typeof global!=="undefined"){local=global}else if(typeof self!=="undefined"){local=self}else{try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e){}if(promiseToString==="[object Promise]"&&!P.cast){return}}local.Promise=Promise}Promise.polyfill=polyfill;Promise.Promise=Promise;return Promise})}).call(exports,__webpack_require__(146),function(){return this}())},function(module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},function(module,exports){},function(module,exports){"use strict";function urlBuilder(params){var builtUrl=params.base;builtUrl+="?";if(params.apiKey){builtUrl+="key="+params.apiKey+"&"}if(params.client){builtUrl+="client="+params.client+"&"}if(params.libraries.length>0){builtUrl+="libraries=";params.libraries.forEach(function(library,index){builtUrl+=library;if(index!==params.libraries.length-1){builtUrl+=","}});builtUrl+="&"}builtUrl+="callback="+params.callback;return builtUrl}module.exports=urlBuilder},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class SearchComponent extends _substance.Component{constructor(...args){super(...args)}getInitialState(){return{searchResults:[],googleMapsLoaded:false}}didMount(){}willReceiveProps(props){let newState={};if(props.google){this.google=props.google;newState.googleMapsLoaded=true;if(props.query){newState.query=props.query;this.populateInitialQuery(props.query)}}if(Object.keys(newState).length>0){this.extendState(newState)}}populateInitialQuery(initialQuery){this.makeInitialSearch(initialQuery)}render($$){var el=$$("div").addClass("search-container").ref("searchContainer");var tmpSearch=$$("div").ref("tmpSearchContainer");el.append(tmpSearch);var container=$$("div").ref("searchContainer").addClass("search-component__main clearfix");if(this.state.googleMapsLoaded){var searchForm=$$("form").attr("style","display:flex").on("submit",this.search.bind(this)).ref("searchForm");var searchInput=$$("input").addClass("form-control search__query col-xs-9").ref("searchInput").val(this.state.query).attr("placeholder",this.getLabel("Address or place"));var searchButton=$$("button").addClass("btn btn-neutral col-xs-3").append(this.getLabel("Search")).on("click",this.search.bind(this)).ref("serchButton");searchForm.append([searchInput,searchButton]);container.append(searchForm);var searchList=$$("ul").ref("searchList");var items=this.state.searchResults.map(function(result){var lat=result.geometry.location.lat();var lng=result.geometry.location.lng();return $$("li").append(result.name).on("click",function(){this.send("searchItemSelected",new google.maps.LatLng(lat,lng))}.bind(this))}.bind(this));searchList.append(items);if(this.state.isSearching){container.append(searchList)}el.append(container)}else{el.append($$("span").append("Waiting for maps to load"))}return el}searchDone(results,status){if(status===this.google.maps.places.PlacesServiceStatus.OK&&results[0]){this.extendState({searchResults:results})}}search(e){this.extendState({isSearching:true});e.preventDefault();var request={query:this.refs.searchInput.val()};var service=new this.google.maps.places.PlacesService(this.refs.tmpSearchContainer.el.el);service.textSearch(request,this.searchDone.bind(this))}makeInitialSearch(query){var request={query:query};var service=new this.google.maps.places.PlacesService(this.refs.tmpSearchContainer.el.el);service.textSearch(request,function(results,status){if(status===this.google.maps.places.PlacesServiceStatus.OK&&results[0]){var lat=results[0].geometry.location.lat();var lng=results[0].geometry.location.lng();this.send("searchItemSelected",new google.maps.LatLng(lat,lng))}}.bind(this))}}exports.default=SearchComponent},function(module,exports){"use strict";module.exports={place:'<?xml version="1.0" encoding="UTF-8"?> '+'<conceptItem xmlns="http://iptc.org/std/nar/2006-10-01/" version="1" standard="NewsML-G2" standardversion="2.20" conformance="power"> '+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/> '+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/> '+"<itemMeta> "+'<itemClass qcode="cinat:concept"/> '+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/> '+'<itemMetaExtProperty type="imext:type" value="x-im/place"/> '+"</itemMeta> "+"<concept> "+'<conceptId uri="im://place/"/> '+'<type qcode="cpnat:poi"/>'+"<name></name>"+'<definition role="drol:long"></definition> '+'<definition role="drol:short"></definition> '+'<metadata xmlns="http://www.infomaker.se/newsml/1.0"> '+'<object id="" type="x-im/position"> '+"<data> "+"<geometry>POINT(14.55600 56.89921)</geometry> "+"</data> "+"</object> "+"</metadata> "+"</concept> "+"</conceptItem>"}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(133);var _XimPlacePackageConfigure=__webpack_require__(135);var _XimPlacePackageConfigure2=_interopRequireDefault(_XimPlacePackageConfigure);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const id="se.infomaker.ximplace-polygon";exports.default={id:id,name:"ximplace",configure:(0,_XimPlacePackageConfigure2.default)(id)}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(133);var _XimPlacePackageConfigure=__webpack_require__(135);var _XimPlacePackageConfigure2=_interopRequireDefault(_XimPlacePackageConfigure);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const id="se.infomaker.ximplace-position";exports.default={id:id,name:"ximplace",configure:(0,_XimPlacePackageConfigure2.default)(id)}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _AuthorPackage=__webpack_require__(154);var _AuthorPackage2=_interopRequireDefault(_AuthorPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_AuthorPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(155);__webpack_require__(157);var _AuthorMainComponent=__webpack_require__(159);var _AuthorMainComponent2=_interopRequireDefault(_AuthorMainComponent);var _AuthorValidation=__webpack_require__(163);var _AuthorValidation2=_interopRequireDefault(_AuthorValidation);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.ximauthor",name:"ximauthor",configure:function configure(config){config.addLabel("validation-no-author",{en:"No author specified",sv:"Ingen författare är vald"});config.addLabel("Search authors",{sv:"Sök författare"});config.addLabel("Authors",{sv:"Författare"});config.addLabel("Enter author",{sv:"Ange författare"});config.addLabel("Add",{sv:"Lägg till"});config.addLabel("Add new",{sv:"Lägg till ny"});config.addValidator(_AuthorValidation2.default);config.addComponentToSidebarWithTabId(this.id,"main",_AuthorMainComponent2.default)}}},function(module,exports){},,function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _AuthorListComponent=__webpack_require__(160);var _AuthorListComponent2=_interopRequireDefault(_AuthorListComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class AuthorMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximauthor"}didMount(){}getInitialState(){return{existingAuthors:_writer.api.newsItem.getAuthors()}}reloadAuthors(){this.extendState({existingAuthors:_writer.api.newsItem.getAuthors()})}render($$){const noSearch=_writer.api.getConfigValue(this.props.pluginConfigObject.id,"noSearch");const el=$$("div").ref("authorContainer").addClass("authors").append($$("h2").append(this.getLabel("Authors")));let searchComponent;if(noSearch){const AuthorAddComponent=this.context.componentRegistry.get("form-add");searchComponent=$$(AuthorAddComponent,{existingItems:this.state.existingAuthors,onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Enter author")}).ref("authorSearchComponent")}else{const AuthorSearchComponent=this.context.componentRegistry.get("form-search");searchComponent=$$(AuthorSearchComponent,{existingItems:this.state.existingAuthors,searchUrl:"/api/search/concepts/authors?q=",onSelect:this.addAuthor.bind(this),onCreate:this.createAuthor.bind(this),createAllowed:true,placeholderText:this.getLabel("Search authors")}).ref("authorSearchComponent")}const existingAuthorsList=$$(_AuthorListComponent2.default,{existingAuthors:this.state.existingAuthors,removeAuthor:this.removeAuthor.bind(this)}).ref("existingAuthorList");el.append(existingAuthorsList);el.append(searchComponent);return el}removeAuthor(author){try{if(_writer.NilUUID.isNilUUID(author.uuid)){_writer.api.newsItem.removeAuthorByTitle(this.name,author.title)}else{_writer.api.newsItem.removeAuthorByUUID(this.name,author.uuid)}this.reloadAuthors()}catch(e){console.error(e)}}addAuthor(author){try{_writer.api.newsItem.addAuthor(this.name,author);this.reloadAuthors()}catch(e){console.error("e",e)}}createAuthor(authorTemp){_writer.api.newsItem.addSimpleAuthor(this.name,authorTemp.inputValue);this.reloadAuthors()}}exports.default=AuthorMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _AuthorItemComponent=__webpack_require__(161);var _AuthorItemComponent2=_interopRequireDefault(_AuthorItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class AuthorListComponent extends _substance.Component{getIdForRef(author){if(_writer.NilUUID.isNilUUID(author.uuid)){return"author-"+author.title.replace(" ","")}else if(author.uuid){return"author-"+author.uuid}else{console.warn("No UUID")}}render($$){var existingAuthors=this.props.existingAuthors;var authorList=$$("ul").addClass("authors__list");existingAuthors.forEach(author=>{authorList.append($$(_AuthorItemComponent2.default,{author:author,removeAuthor:this.deleteAuthorAndReference.bind(this)}).ref(this.getIdForRef(author)))});return authorList}deleteAuthorAndReference(author){this.refs[this.getIdForRef(author)].remove();delete this.refs[this.getIdForRef(author)];this.props.removeAuthor(author)}}exports.default=AuthorListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _lodash=__webpack_require__(139);var _AuthorInfoComponent=__webpack_require__(162);var _AuthorInfoComponent2=_interopRequireDefault(_AuthorInfoComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class AuthorItemComponent extends _substance.Component{constructor(...args){super(...args);this.handleActions({avatarLoaded:this.avatarLoaded})}didMount(){}getInitialState(){return{name:undefined,isLoaded:false,isSimpleAuthor:false,loadedAuthor:{}}}dispose(){super.dispose()}loadAuthor(){if(_writer.NilUUID.isNilUUID(this.props.author.uuid)&&this.props.author.title){setTimeout(function(){this.setState({name:this.props.author.title,isLoaded:true,isSimpleAuthor:true,loadedAuthor:{name:this.props.author.title}})}.bind(this),1)}else{this.context.api.router.getConceptItem(this.props.author.uuid,this.props.author.type).then(function(dom){var conceptXML=dom.querySelector("concept");var linksXML=dom.querySelector("itemMeta links");var jsonFormat=_writer.jxon.build(conceptXML);var authorLinks;if(linksXML){authorLinks=_writer.jxon.build(linksXML)}this.setState({name:jsonFormat.name,isLoaded:true,isSimpleAuthor:false,loadedAuthor:jsonFormat,loadedAuhtorLinks:authorLinks})}.bind(this)).catch(function(){this.setState({name:this.props.author.title,isLoaded:true,isSimpleAuthor:true,loadedAuthor:{name:this.props.author.title}})}.bind(this))}}render($$){var author=this.props.author,authorItem=$$("li").addClass("authors__list-item").addClass("clearfix").ref("authorItem"),displayTitle=this.state.name?this.state.name:author.title;var deleteButton=$$("button").addClass("author__button--delete").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"})).attr("title",this.getLabel("Remove from article")).on("click",function(){this.removeAuthor(author)}.bind(this));if(!this.state.isLoaded){this.loadAuthor()}else if(this.state.isSimpleAuthor){this.populateElementsForSimpleAuthor($$,authorItem,displayTitle,deleteButton)}else{this.populateElementForAuthor($$,authorItem,author,displayTitle,deleteButton)}authorItem.on("mouseenter",this.showHover);authorItem.on("mouseleave",this.hideHover);return authorItem}populateElementsForSimpleAuthor($$,authorItem,displayTitle,deleteButton){authorItem.append($$("div").addClass("avatar__container").append($$(_substance.FontAwesomeIcon,{icon:"fa-user"}))).append($$("div").addClass("metadata__container").append($$("span").append(displayTitle).addClass("author__name notClickable meta")).attr("title",this.getLabel("Not editable author"))).append($$("div").addClass("button__container").append(deleteButton))}populateElementForAuthor($$,authorItem,author,displayTitle,deleteButton){var displayNameEl=$$("span").append(displayTitle);displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");displayNameEl.on("mouseenter",this.toggleTooltip);displayNameEl.on("mouseout",this.hideTooltip);this.updateTagItemName(displayNameEl,this.state.loadedAuthor);var metaDataContainer=$$("div").addClass("metadata__container").append($$("span").append(displayNameEl).addClass("author__name meta").on("click",this.showInformation));var email=this.findAttribute(this.state.loadedAuthor,"email");if(email){metaDataContainer.append($$("span").append(email).addClass("author__email meta"))}authorItem.append($$("div").addClass("avatar__container").ref("avatarContainer").append($$(_substance.FontAwesomeIcon,{icon:"fa-user"}))).append(metaDataContainer).append($$("div").addClass("button__container").append(deleteButton))}toggleTooltip(){}hideTooltip(){}updateTagItemName(tagItem,loadedTag){if(loadedTag&&loadedTag.definition){var definition=(0,_lodash.isArray)(loadedTag.definition)?loadedTag.definition:[loadedTag.definition];for(var i=0;i<definition.length;i++){var item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}removeAuthor(author){this.props.removeAuthor(author)}avatarLoaded(avatar){var loadedAuthor=this.state.loadedAuthor;loadedAuthor.avatarSrc=avatar.url;if(loadedAuthor.avatarSrc!==avatar.url){this.extendState({loadedAuthor:loadedAuthor})}}showInformation(){this.context.api.ui.showDialog(_AuthorInfoComponent2.default,{author:this.state.loadedAuthor},{secondary:false,title:this.state.loadedAuthor.name,global:true})}showHover(){var delButton=this.el.find(".author__button--delete");delButton.addClass("active")}hideHover(){var delButton=this.el.find(".author__button--delete");delButton.removeClass("active")}findAttribute(object,attribute){var match;function iterateObject(target,name){Object.keys(target).forEach(function(key){if((0,_lodash.isObject)(target[key])){iterateObject(target[key],name)}else if(key===name){match=target[key]}})}iterateObject(object,attribute);return match?match:undefined}}exports.default=AuthorItemComponent;
},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _lodash=__webpack_require__(139);class AuthorInfoComponent extends _substance.Component{constructor(...args){super(...args)}dispose(){super.dispose()}render($$){let el=$$("div").addClass("author__info");let description=(0,_lodash.find)(this.props.author.definition,function(def){return def["@role"]==="drol:long"});if(description){var descriptionEl=$$("p").append(description["keyValue"]);el.append(descriptionEl)}let email=this.findAttribute(this.props.author,"email");if(email){let emailEl=$$("a").append($$(_substance.FontAwesomeIcon,{icon:"fa-envelope-o"})).attr("href","mailto:"+email).append(email);el.append(emailEl)}let phone=this.findAttribute(this.props.author,"phone");if(phone){let phoneEl=$$("a").append($$(_substance.FontAwesomeIcon,{icon:"fa-phone"})).attr("href","tel:"+phone).append(phone);el.append(phoneEl)}return el}findAttribute(object,attribute){let match;function iterateObject(target,name){Object.keys(target).forEach(function(key){if((0,_lodash.isObject)(target[key])){iterateObject(target[key],name)}else if(key===name){match=target[key]}})}iterateObject(object,attribute);return match?match:undefined}onClose(){}}exports.default=AuthorInfoComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class AuthorValidation extends _writer.Validator{constructor(...args){super(...args)}validate(){if(_writer.api.newsItem.getAuthors().length===0){this.addWarning(_writer.api.getLabel("validation-no-author"))}}}exports.default=AuthorValidation},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(165);var _ContentrelationsPackage=__webpack_require__(167);var _ContentrelationsPackage2=_interopRequireDefault(_ContentrelationsPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_ContentrelationsPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ContentRelationsNode=__webpack_require__(168);var _ContentRelationsNode2=_interopRequireDefault(_ContentRelationsNode);var _ContentRelationsComponent=__webpack_require__(169);var _ContentRelationsComponent2=_interopRequireDefault(_ContentRelationsComponent);var _ContentRelationsConverter=__webpack_require__(170);var _ContentRelationsConverter2=_interopRequireDefault(_ContentRelationsConverter);var _ContentRelationsMainComponent=__webpack_require__(171);var _ContentRelationsMainComponent2=_interopRequireDefault(_ContentRelationsMainComponent);var _ContentRelationsDropHandler=__webpack_require__(175);var _ContentRelationsDropHandler2=_interopRequireDefault(_ContentRelationsDropHandler);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"contentrelations",id:"se.infomaker.contentrelations",configure:function configure(config){config.addSidebarTab("contentrelations","Relaterat innehåll");config.addComponentToSidebarWithTabId("contentrelations","contentrelations",_ContentRelationsMainComponent2.default);config.addDragAndDrop(_ContentRelationsDropHandler2.default);config.addComponent("contentrelations",_ContentRelationsComponent2.default);config.addNode(_ContentRelationsNode2.default);config.addConverter("newsml",_ContentRelationsConverter2.default);config.addLabel("ContentRelations",{sv:"Relaterat innehåll"});config.addLabel("Enter query",{sv:"Sökfråga"});config.addLabel("Search",{sv:"Sök"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class ContentRelationsNode extends _substance.BlockNode{}ContentRelationsNode.define({type:"contentrelations",uuid:{type:"string",optional:true},label:{type:"string",optional:true},products:{type:"string",optional:true},dataType:"string"});exports.default=ContentRelationsNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class ContentRelationsComponent extends _substance.Component{render($$){const el=$$("div").addClass("im-blocknode__container");el.append(this.renderHeader($$));el.append(this.renderContent($$));el.addClass("x-im-contentrelations");el.attr("contentEditable",false);return el}renderContent($$){const content=$$("div").addClass("im-blocknode__content");const link=$$("a").append(this.props.node.label).attr("href","#"+this.props.node.uuid).attr("target","_blank").on("click",function(evt){evt.stopPropagation()});content.append(link);return content}renderHeader($$){return $$("div").append([$$(_substance.FontAwesomeIcon,{icon:"fa-external-link"}),$$("strong").append(this.getLabel("External link")).attr("contenteditable",false)]).addClass("header").attr("contenteditable",false)}}exports.default=ContentRelationsComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ContentRelationsConverter={type:"contentrelations",tagName:"object",matchElement:function matchElement(el){return el.is("object")&&el.attr("type")==="x-im/link"},import:function _import(el,node){if(el.attr("uuid")){node.uuid=el.attr("uuid")}node.label=el.attr("title");node.dataType=el.attr("type")},export:function _export(node,el,converter){if(node.uuid){el.attr("uuid",node.uuid)}el.attr("title",node.label);el.attr("type",node.dataType);var links=converter.$$("links");var link=converter.$$("link");link.attr({rel:"self",type:"x-im/article"});if(node.uuid){link.attr("uuid",node.uuid)}links.append(link);el.append(links)}};exports.default=ContentRelationsConverter},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _ContentSearchComponent=__webpack_require__(172);var _ContentSearchComponent2=_interopRequireDefault(_ContentSearchComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentRelationsMainComponent extends _substance.Component{render($$){var el=$$("div").ref("relationsContainer").addClass("authors").append($$("h2").append(this.getLabel("ContentRelations")));el.append($$(_ContentSearchComponent2.default));return el}}exports.default=ContentRelationsMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ContentSearchResultComponent=__webpack_require__(173);var _ContentSearchResultComponent2=_interopRequireDefault(_ContentSearchResultComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentSearchComponent extends _substance.Component{getInitialState(){return{query:"",results:[]}}render($$){const el=$$("div").addClass("search__container");const searchForm=$$("form").addClass("clearfix").on("submit",this.search.bind(this)).ref("form");searchForm.append($$("input").attr({type:"submit",style:"display:none"}));const searchInput=$$("input").addClass("form-control search__query col-xs-9").ref("queryInput").attr("placeholder",this.getLabel("Enter query"));const searchButton=$$("button").addClass("sc-np-btn btn btn-neutral col-xs-3").append(this.getLabel("Search")).on("click",this.search.bind(this)).ref("serchButton");searchForm.append([searchInput,searchButton]);el.append(searchForm);const results=$$(_ContentSearchResultComponent2.default,{results:this.state.results,query:this.state.query});el.append(results);return el}search(e){e.preventDefault();const query=this.refs.queryInput.val();_writer.api.router.get("/api/search/concepts/articles?q="+query).then(reponse=>_writer.api.router.checkForOKStatus(reponse)).then(response=>response.json()).then(json=>{this.setState({query:query,results:json})}).catch(()=>{})}}exports.default=ContentSearchComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _SearchResultItem=__webpack_require__(174);var _SearchResultItem2=_interopRequireDefault(_SearchResultItem);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentSearchResultComponent extends _substance.Component{render($$){const el=$$("ul").addClass("search__results");const items=this.props.results.map(function(item){return $$(_SearchResultItem2.default,{item:item})});el.append(items);return el}}exports.default=ContentSearchResultComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class SearchResultItem extends _substance.Component{getInitialState(){return{imageLoaded:false,imageURL:""}}getDroplinkForItem(item){const imType=item.imType[0];const name=item.name[0];let data={uuid:item.uuid,imType:imType,name:name};let dropData=window.btoa(JSON.stringify(data));switch(imType){case"article":return"x-im-entity://x-im/article?data="+dropData;case"image":return"x-im-entity://x-im/image?data="+dropData;default:return"x-im-entity://x-im/article?data="+dropData}}getTitle($$,item){let name=item.name?item.name[0]:"Unidentified",products=item.type,productsType=item.typeCatalog?item.typeCatalog[0]:"text";if(!products){return name}if(productsType&&productsType==="icon"){const icons=products.map(function(product){return $$("img").attr("src",product).addClass("product-icon")});const result=$$("span").append(name);icons.forEach(function(icon){result.append(icon)});return result}else{return`${name} [${products.join(", ")}]`}}didMount(){this.dropLink=this.getDroplinkForItem(this.props.item)}_onDragStart(e){e.stopPropagation();e.dataTransfer.setData("text/uri-list",this.dropLink)}render($$){const item=this.props.item;return this.getItem($$,item)}getItem($$,item){const imType=item.imType?item.imType[0]:"article";switch(imType){case"article":return this.getArticleItem($$,item);case"image":return this.getImageItem($$,item);default:}}getArticleItem($$,item){const listItem=$$("li").addClass("article").attr("draggable",true).on("dragstart",this._onDragStart,this);const icon=$$(_substance.FontAwesomeIcon,{icon:"fa-file-text-o"}).addClass("type-icon");const label=$$("span").addClass("title").append(this.getTitle($$,item));listItem.append([icon,label]);return listItem}getImageItem($$,item){const listItem=$$("li").addClass("image").attr("draggable",true).on("dragstart",this._onDragStart,this);let icon=$$(_substance.FontAwesomeIcon,{icon:"fa-picture-o"});const label=$$("span").addClass("title").append(this.getTitle($$,item));if(this.state.imageLoaded){icon=$$("img").attr("src",this.state.imageURL).addClass("image-icon")}else{this.fetchImageURLForUUID(item.uuid).then(url=>{this.setState({imageLoaded:true,imageURL:url})})}listItem.append([icon,label]);return listItem}fetchImageURLForUUID(uuid){return _writer.api.router.get("/api/binary/url/"+uuid+"/40?imType=x-im/image&height=40").then(response=>response.text()).catch(error=>{console.error(error)})}}exports.default=SearchResultItem},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _insertRelatedContentLink=__webpack_require__(176);var _insertRelatedContentLink2=_interopRequireDefault(_insertRelatedContentLink);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ContentRelationsDropHandler extends _substance.DragAndDropHandler{match(params){if(!params.uri){return false}if(this.isContentRelationsArticleDrop(params)||this.isNpDroplink(params)){if(params.isNpDroplink){this.data=this.getDataFromNpDroplink(params.uri)}else if(params.isContentRelations){this.data=this.getDataFromURL(params.uri)}else{return false}return true}}isNpDroplink(params){const npDropLinkRegex=_writer.api.getConfigValue("se.infomaker.contentrelations","npDropLinkMatcher");if(!npDropLinkRegex){return false}const re=new RegExp(npDropLinkRegex);const urlMatches=re.exec(params.uri);if(urlMatches&&urlMatches.length>=1){params.isNpDroplink=true;return true}}isContentRelationsArticleDrop(params){if(params.uri.indexOf("x-im-entity://x-im/article")>=0){params.isContentRelations=true;return true}}getDataFromNpDroplink(link){link=decodeURIComponent(link);function decodeLabel(xml){const reg=new RegExp(".*<name>([^<]+)");const result=reg.exec(xml);return result[1]}function decodeUuid(xml){const reg=new RegExp(".*?id=([^<]+)");const result=reg.exec(xml);return result[1]}const name=decodeLabel(link);const uuid=decodeUuid(link);return{name:name,uuid:uuid}}getDataFromURL(url){const queryParamKey="data=";const dataPosition=url.indexOf(queryParamKey);let encodedData=url.substr(dataPosition+queryParamKey.length,url.length);return JSON.parse(window.atob(encodedData))}drop(tx){(0,_insertRelatedContentLink2.default)(tx,this.data)}}exports.default=ContentRelationsDropHandler},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=insertRelatedContentLink;function insertRelatedContentLink(tx,data){tx.insertBlockNode({dataType:"x-im/link",type:"contentrelations",uuid:data.uuid,label:data.name})}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _Channelselector=__webpack_require__(178);var _Channelselector2=_interopRequireDefault(_Channelselector);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_Channelselector2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(179);var _ChannelSelectorComponent=__webpack_require__(181);var _ChannelSelectorComponent2=_interopRequireDefault(_ChannelSelectorComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.hdsds.channelselector",name:"channelselector",configure:function configure(config){config.addLabel("channelselector-Products",{en:"Products",sv:"Produkter"});config.addComponentToSidebarWithTabId("channelselector","main",_ChannelSelectorComponent2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);const sortBy=_writer.lodash.sortBy;const clone=_writer.lodash.clone;class ChannelselectorComponent extends _substance.Component{constructor(...args){super(...args)}getInitialState(){this.configProducts=this.context.api.getConfigValue("se.infomaker.hdsds.channelselector","products");var channels=this.context.api.newsItem.getChannels(),initialChannels=[];channels.forEach(function(channel){var compare=_writer.lodash.find(this.configProducts,function(o){if(o.qcode===channel["qcode"]){o.active=true;return true}});initialChannels.push(compare)}.bind(this));return{products:sortBy(this.configProducts,["active","name"]),selectedProducts:initialChannels}}sortProducts(){return sortBy(this.state.products,["active","name"])}selectProduct(product){var selectedProduct=this.state.selectedProducts,products=this.state.products;var productIndex=products.indexOf(product);if(_writer.lodash.includes(selectedProduct,product)){delete products[productIndex].active;selectedProduct.splice(selectedProduct.indexOf(product),1);this.context.api.newsItem.removeChannel("channelselector",product)}else{selectedProduct.push(product);products[productIndex].active=true;var productToSave=clone(product);delete productToSave.active;this.context.api.newsItem.addChannel("channelselector",productToSave)}this.extendState({selectedProducts:selectedProduct})}render($$){var el=$$("div").addClass("sc-channelselector"),listContainer=$$("div").addClass("sc-productlist-container").addClass("list-group"),list=$$("div").addClass("sc-productlist"),title=$$("h2").append(this.getLabel("channelselector-Products"));var products=this.sortProducts().map(function(product){var cssClass=product.active?"active":"";return $$("a").addClass("list-group-item").addClass(cssClass).append(product.name.toString()).on("click",()=>{this.selectProduct(product)})},this);el.append(title);list.append(products);listContainer.append(list);el.append(listContainer);return el}}exports.default=ChannelselectorComponent},,,,,,,,,,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(202);var _TagsPackage=__webpack_require__(204);var _TagsPackage2=_interopRequireDefault(_TagsPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_TagsPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(202);var _TagsMainComponent=__webpack_require__(205);var _TagsMainComponent2=_interopRequireDefault(_TagsMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.tags",name:"ximtags",vendor:"infomaker.se",configure:function configure(config){config.addLabel("ximtags-could_not_load_uuid",{en:"This item could not be loaded. UUID: ",sv:"Detta objekt kunde inte laddas in. UUID: "});config.addLabel("ximtags-title",{sv:"Taggar",en:"Tags"});config.addLabel("ximtags-search_placeholder",{sv:"Sök taggar",en:"Search tags"});config.addLabel("ximtags-create",{en:"Create",sv:"Skapa"});config.addLabel("ximtags-save",{en:"Save",sv:"Spara"});config.addLabel("ximtags-edit",{en:"Edit",sv:"Redigera"});config.addLabel("ximtags-Person",{en:"Person",sv:"Person"});config.addLabel("ximtags-Organization",{en:"Organization",sv:"Organisation"});config.addLabel("ximtags-Topic",{en:"Topic",sv:"Ämne"});config.addLabel("ximtags-type-question-label",{en:"What kind of tag do you want to create?",sv:"Vilken typ vill du skapa?"});config.addLabel("ximtags-name_already_in_use",{en:"Please note that this name is already in use",sv:"Observera att namnet redan används"});config.addLabel("ximtags-error-save",{en:"Error when saving tag",sv:"Fel vid sparande av tag"});config.addLabel("ximtags-Short_description",{en:"Short description",sv:"Kort beskrivning"});config.addLabel("ximtags-Long_description",{en:"Long description",sv:"Lång beskrivning"});config.addLabel("ximtags-Website_url",{en:"Website url",sv:"Länk till webbsida"});config.addLabel("ximtags-Twitter_url",{en:"Twitter url",sv:"Länk till Twitter"});config.addLabel("ximtags-Facebook_url",{en:"Facebook url",sv:"Länk till Facebook"});config.addLabel("ximtags-Remove_from_article",{en:"Remove from article",sv:"Ta bort från artikel"});config.addComponentToSidebarWithTabId(this.id,"main",_TagsMainComponent2.default)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _TagsListComponent=__webpack_require__(206);var _TagsListComponent2=_interopRequireDefault(_TagsListComponent);var _TagEditBaseComponent=__webpack_require__(210);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _TagEditPersonComponent=__webpack_require__(212);var _TagEditPersonComponent2=_interopRequireDefault(_TagEditPersonComponent);var _TagEditCompanyComponent=__webpack_require__(211);var _TagEditCompanyComponent2=_interopRequireDefault(_TagEditCompanyComponent);var _concept=__webpack_require__(213);var _concept2=_interopRequireDefault(_concept);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximtags"}getInitialState(){return{existingTags:this.context.api.newsItem.getTags(["x-im/person","x-im/organisation","x-cmbr/channel","x-im/channel","x-im/category"])}}reload(){this.extendState({existingTags:this.context.api.newsItem.getTags(["x-im/person","x-im/organisation","x-cmbr/channel","x-im/channel","x-im/category"])})}render($$){const el=$$("div").ref("tagContainer").addClass("authors").append($$("h2").append(this.getLabel("ximtags-title")));const SearchComponent=this.context.componentRegistry.get("form-search");const searchComponent=$$(SearchComponent,{existingItems:this.state.existingTags,searchUrl:"/api/search/concepts/tags?q=",onSelect:this.addTag.bind(this),onCreate:this.createTag.bind(this),placeholderText:this.getLabel("ximtags-search_placeholder"),createAllowed:true}).ref("searchComponent");const tagList=$$(_TagsListComponent2.default,{tags:this.state.existingTags,removeTag:this.removeTag.bind(this),reload:this.reload.bind(this)}).ref("tagList");el.append(tagList);el.append(searchComponent);return el}removeTag(tag){try{this.context.api.newsItem.removeLinkByUUIDAndRel(this.name,tag.uuid,"subject");this.reload()}catch(e){}}addTag(tag){try{this.context.api.newsItem.addTag(this.name,tag);this.reload()}catch(e){}}createTag(tag,exists){try{this.context.api.ui.showDialog(_TagEditBaseComponent2.default,{tag:tag,exists:exists,close:this.closeFromDialog.bind(this),createPerson:this.createPerson.bind(this),createOrganisation:this.createOrganisation.bind(this)},{primary:false,title:this.getLabel("ximtags-create")+" "+tag.inputValue,global:true})}catch(e){}}createPerson(inputValue){const newName=inputValue.split(" ");const parser=new DOMParser;const tagXML=parser.parseFromString(_concept2.default.personTemplate,"text/xml").firstChild;tagXML.querySelector('itemMeta itemMetaExtProperty[type="imext:firstName"]').setAttribute("value",newName[0]);tagXML.querySelector('itemMeta itemMetaExtProperty[type="imext:lastName"]').setAttribute("value",newName[1]?newName[1]:"");const loadedTag=_writer.jxon.build(tagXML);this.context.api.ui.showDialog(_TagEditPersonComponent2.default,{tag:loadedTag,close:this.closeFromDialog.bind(this)},{primary:this.getLabel("ximtags-save"),title:this.getLabel("ximtags-create")+" "+inputValue,icon:"fa-user",global:true})}createOrganisation(inputValue){const parser=new DOMParser;const tagXML=parser.parseFromString(_concept2.default.organisationTemplate,"text/xml").firstChild;tagXML.querySelector("concept name").textContent=inputValue;const loadedTag=_writer.jxon.build(tagXML);this.context.api.ui.showDialog(_TagEditCompanyComponent2.default,{tag:loadedTag,close:this.closeFromDialog.bind(this)},{primary:this.getLabel("ximtags-save"),title:this.getLabel("ximtags-create")+" "+inputValue,icon:"fa-sitemap",global:true})}closeFromDialog(){this.reload()}}exports.default=TagsMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _TagItemComponent=__webpack_require__(207);var _TagItemComponent2=_interopRequireDefault(_TagItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsListComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximtags"}render($$){const tags=this.props.tags,tagList=$$("ul").addClass("tag-list"),tagEls=tags.map(tag=>{return $$(_TagItemComponent2.default,{tag:tag,removeTag:this.removeTag.bind(this),reload:this.props.reload.bind(this)}).ref("tag-"+tag.uuid)},this);tagList.append(tagEls);return tagList}removeTag(tag){delete this.refs["tag-"+tag.uuid];this.props.removeTag(tag)}}exports.default=TagsListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _Config=__webpack_require__(208);var _Config2=_interopRequireDefault(_Config);var _TagInfoComponent=__webpack_require__(209);var _TagInfoComponent2=_interopRequireDefault(_TagInfoComponent);var _TagEditCompanyComponent=__webpack_require__(211);var _TagEditCompanyComponent2=_interopRequireDefault(_TagEditCompanyComponent);var _TagEditPersonComponent=__webpack_require__(212);var _TagEditPersonComponent2=_interopRequireDefault(_TagEditPersonComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagsItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximtags"}getItemMetaExtPropertyByType(type){if(_writer.lodash.isArray(this.state.loadedTag.itemMeta.itemMetaExtProperty)){return _writer.lodash.find(this.state.loadedTag.itemMeta.itemMetaExtProperty,function(itemMeta){return itemMeta["@type"]===type})}else if(_writer.lodash.isObject(this.state.loadedTag.itemMeta.itemMetaExtProperty)){if(this.state.loadedTag.itemMeta.itemMetaExtProperty["@type"]===type){return this.state.loadedTag.itemMeta.itemMetaExtProperty}}}loadTag(){this.context.api.router.getConceptItem(this.props.tag.uuid,this.props.tag.type).then(xml=>{const conceptXML=xml.querySelector("conceptItem"),conceptItemJSON=_writer.jxon.build(conceptXML);this.extendState({loadedTag:conceptItemJSON,isLoaded:true});this.state.loadedTag.type=this.getItemMetaExtPropertyByType("imext:type")}).catch(()=>{this.extendState({isLoaded:true,couldNotLoad:true})})}render($$){const tag=this.props.tag,tagItem=$$("li").addClass("tag-list__item").ref("tagItem"),displayNameEl=$$("span");let displayName;displayNameEl.attr("title",TagsItemComponent.getNameForTag(tag));if(!this.state.isLoaded){this.loadTag()}else{if(this.state.couldNotLoad){displayNameEl.addClass("tag-item__title tag-item__title--no-avatar tag-item__title--notexisting").append(tag.title).attr("title",this.getLabel("ximtags-could_not_load_uuid")+tag.uuid);displayName=tag.title}else{displayName=this.state.loadedTag.concept.name;displayNameEl.addClass("tag-item__title tag-item__title--no-avatar").append(displayName);this.updateTagItemName(displayNameEl,this.state.loadedTag);displayNameEl.on("click",()=>{if(_Config2.default.isTagEditable(tag)){this.editTag(displayName)}else{this.showTag(displayName)}})}displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");tagItem.append(displayNameEl);const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("ximtags-Remove_from_article"))).on("click",()=>{this.removeTag(tag)});tagItem.append(deleteButton);const iconComponent=this.getIconForTag($$,tag);if(iconComponent){tagItem.append(iconComponent)}}return tagItem}showTag(title){this.context.api.ui.showDialog(_TagInfoComponent2.default,{tag:this.state.loadedTag,close:this.closeFromDialog.bind(this),couldNotLoad:this.state.couldNotLoad},{secondary:false,title:title,global:true})}editTag(title){let tagEdit;switch(this.state.loadedTag.type["@value"]){case"x-im/organisation":tagEdit=_TagEditCompanyComponent2.default;break;case"x-im/person":tagEdit=_TagEditPersonComponent2.default;break;default:break}this.context.api.ui.showDialog(tagEdit,{tag:this.state.loadedTag,close:this.closeFromDialog.bind(this),couldNotLoad:this.state.couldNotLoad},{primary:this.getLabel("ximtags-save"),title:this.getLabel("ximtags-edit")+" "+title,global:true})}closeFromDialog(){this.loadTag();this.props.reload()}removeTag(tag){this.props.removeTag(tag)}getIconForTag($$,tag){if(!tag.type){return this.getDefaultIconForTag($$)}const tagConfig=_Config2.default.types[tag.type];if(tagConfig){return $$(_substance.FontAwesomeIcon,{icon:tagConfig.icon}).addClass("tag-icon")}else{this.getDefaultIconForTag($$)}}static getNameForTag(tag){if(!tag.type){return undefined}const tagConfig=_Config2.default.types[tag.type];if(tagConfig){return tagConfig.name}}updateTagItemName(tagItem,loadedTag){if(loadedTag.concept&&loadedTag.concept.definition){const definition=_writer.lodash.isArray(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(let i=0;i<definition.length;i++){const item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}getDefaultIconForTag($$){return $$(_substance.FontAwesomeIcon,{icon:"fa-tag"}).addClass("tag-icon")}}exports.default=TagsItemComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={isTagEditable:function isTagEditable(tag){return Boolean(this.types[tag.type].editable)},types:{"x-im/person":{icon:"fa-user",name:"Person",editable:true},"x-im/organisation":{icon:"fa-sitemap",name:"Organisation",editable:true},"x-im/channel":{icon:"fa-random",name:"Channel",editable:false},"x-cmbr/channel":{icon:"fa-random",name:"Channel",editable:false},"x-cmbr/category":{icon:"fa-tags",name:"Category",editable:false},"x-im/category":{icon:"fa-tags",name:"Category",editable:false}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(210);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagInfoComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args)}render($$){const el=$$("div").addClass("tag-edit-base");const shortDescription=this.getConceptDefinition("drol:short");if(shortDescription){const shortDescEl=$$("p").append(shortDescription.keyValue);el.append(shortDescEl)}const longDescription=this.getConceptDefinition("drol:long");if(longDescription){const longDescEl=$$("p").append(longDescription.keyValue);el.append(longDescEl)}return el}onClose(){}}exports.default=TagInfoComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);const find=_writer.lodash.find;class TagEditBaseComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximtags"}saveConcept(uuid,newsItem){return this.context.api.router.updateConceptItem(uuid,newsItem)}createConcept(newsItem){return this.context.api.router.createConceptItem(newsItem)}updateFacebook(facebookInputValue){const facebookNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="x-im/social+facebook"]');if(facebookInputValue.length>0&&!facebookNode){this.createLinkNode(this.xmlDoc,{type:"x-im/social+facebook",rel:"irel:seeAlso",url:facebookInputValue})}else if(facebookNode&&facebookInputValue.length>0){facebookNode.setAttribute("url",facebookInputValue)}else if(facebookInputValue.length===0&&facebookNode){facebookNode.parentElement.removeChild(facebookNode)}}updateTwitter(twitterInputValue){const twitterNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="x-im/social+twitter"]');if(twitterInputValue.length>0&&!twitterNode){this.createLinkNode(this.xmlDoc,{type:"x-im/social+twitter",rel:"irel:seeAlso",url:twitterInputValue})}else if(twitterNode&&twitterInputValue.length>0){twitterNode.setAttribute("url",twitterInputValue)}else if(twitterInputValue.length===0&&twitterNode){
twitterNode.parentElement.removeChild(twitterNode)}}updateWebsite(websiteInputValue){const websiteNode=this.xmlDoc.documentElement.querySelector('itemMeta links link[rel="irel:seeAlso"][type="text/html"]');if(websiteInputValue.length>0&&!websiteNode){this.createLinkNode(this.xmlDoc,{type:"text/html",rel:"irel:seeAlso",url:websiteInputValue})}else if(websiteNode&&websiteInputValue.length>0){websiteNode.setAttribute("url",websiteInputValue)}else if(websiteInputValue.length===0&&websiteNode){websiteNode.parentElement.removeChild(websiteNode)}}createLinkNode(xmlDoc,attributes){const linkNode=xmlDoc.createElement("link");for(let key in attributes){if(attributes.hasOwnProperty(key)){linkNode.setAttribute(key,attributes[key])}}xmlDoc.documentElement.querySelector("itemMeta links").appendChild(linkNode);return linkNode}getItemMetaExtProperty(key){return find(this.props.tag.itemMeta.itemMetaExtProperty,item=>item["@type"]===key)}getConceptDefinition(key){return find(this.props.tag.concept.definition,item=>item["@role"]===key)}getSeeAlsoLinkByType(type){return find(this.props.tag.itemMeta.links.link,link=>link["@type"]===type&&link["@rel"]==="irel:seeAlso")}render($$){const el=$$("div").addClass("tag-edit tag-edit-base");const personBtn=$$("button").append($$(_substance.FontAwesomeIcon,{icon:"fa-user"})).append($$("span").append(this.getLabel("ximtags-Person"))).on("click",this.createPerson);const organisationBtn=$$("button").append($$(_substance.FontAwesomeIcon,{icon:"fa-sitemap"})).append($$("span").append(this.getLabel("ximtags-Organization"))).on("click",this.createOrganisation);el.append($$("small").addClass("text-muted").append(this.getLabel("ximtags-type-question-label")));el.append([personBtn,organisationBtn]);if(this.props.exists){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-info").append(this.getLabel("ximtags-name_already_in_use")+": "+this.props.tag.value)))}if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("ximtags-error-save"))))}return el}createPerson(){this.send("close");this.props.createPerson(this.props.tag.inputValue)}createOrganisation(){this.send("close");this.props.createOrganisation(this.props.tag.inputValue)}closeAndReload(){this.props.close();this.send("close")}renderElement($$,refName,label,inputValue,fullWidth,inputType){const cssClass=fullWidth?"col-xs-12":"col-xs-12 col-sm-6";let input;switch(inputType){case"textarea":input=this.getTextAreaElement($$);break;default:input=this.getTextInputElement($$);break}const formGroup=$$("fieldset").addClass("form-group").addClass(cssClass);formGroup.append($$("label").append(label));formGroup.append(input.val(inputValue).ref(refName));return formGroup}getTextInputElement($$){return $$("input").attr("type","text").addClass("form-control")}getTextAreaElement($$){return $$("textarea").attr("rows","4").addClass("form-control")}static getShortDescription(xmlTag){return xmlTag.documentElement.querySelector('concept definition[role="drol:short"]')}static getLongDescription(xmlTag){return xmlTag.documentElement.querySelector('concept definition[role="drol:long"]')}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditBaseComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(210);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagEditCompanyComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args);this.name="ximtags"}save(){const tag=this.props.tag,name=this.refs.nameInput.val(),shortDesc=this.refs.shortDescInput.val(),longDesc=this.refs.longDescTextarea.val(),uuid=tag["@guid"]?tag["@guid"]:null;tag.concept.name=name;const xmlTag=_writer.jxon.unbuild(tag,null,"conceptItem");this.xmlDoc=xmlTag;const shortDescNode=_TagEditBaseComponent2.default.getShortDescription(xmlTag),longDescNode=_TagEditBaseComponent2.default.getLongDescription(xmlTag);shortDescNode.textContent=shortDesc;longDescNode.textContent=longDesc;this.updateWebsite(this.refs.urlInput.val());this.updateTwitter(this.refs.twitterInput.val());this.updateFacebook(this.refs.facebookInput.val());if(uuid===null){this.createConcept(xmlTag.documentElement.outerHTML).then(uuid=>{this.xmlDoc.querySelector("conceptItem").setAttribute("guid",uuid);this.context.api.newsItem.addTag(this.name,{uuid:uuid,name:[name],type:["organisation"],imType:["x-im/organisation"]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}else{this.saveConcept(uuid,xmlTag.documentElement.outerHTML).then(()=>{this.context.api.newsItem.updateTag(this.name,uuid,{name:[name],imType:[tag.type["@value"]]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}}render($$){const tag=this.props.tag,el=$$("div").addClass("tag-edit tag-edit-person").addClass("row"),name=this.renderElement($$,"nameInput","Name",tag.concept.name,true,"input"),shortDesc=this.renderElement($$,"shortDescInput",this.getLabel("ximtags-Short_description"),this.getConceptDefinition("drol:short").keyValue,true,"input"),longDesc=this.renderElement($$,"longDescTextarea",this.getLabel("ximtags-Long_description"),this.getConceptDefinition("drol:long").keyValue,true,"textarea"),websiteUrl=this.getSeeAlsoLinkByType("text/html"),websiteUrlEl=this.renderElement($$,"urlInput",this.getLabel("ximtags-Website_url"),websiteUrl?websiteUrl["@url"]:"",true,"input"),twitterUrl=this.getSeeAlsoLinkByType("x-im/social+twitter"),twitterEl=this.renderElement($$,"twitterInput",this.getLabel("ximtags-Twitter_url"),twitterUrl?twitterUrl["@url"]:"",false,"input"),facebook=this.getSeeAlsoLinkByType("x-im/social+facebook"),facebookEl=this.renderElement($$,"facebookInput",this.getLabel("ximtags-Facebook_url"),facebook?facebook["@url"]:"",false,"input");name.on("change",()=>{if(this.refs["nameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}});el.append([name,shortDesc,longDesc,websiteUrlEl,twitterEl,facebookEl]);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("ximtags-error-save"))))}return el}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditCompanyComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _TagEditBaseComponent=__webpack_require__(210);var _TagEditBaseComponent2=_interopRequireDefault(_TagEditBaseComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class TagEditPersonComponent extends _TagEditBaseComponent2.default{constructor(...args){super(...args);this.name="ximtags"}save(){const tag=this.props.tag,firstName=this.refs.firstNameInput.val(),lastName=this.refs.lastNameInput.val(),shortDesc=this.refs.shortDescInput.val(),longDesc=this.refs.longDescTextarea.val(),uuid=tag["@guid"]?tag["@guid"]:null,fullName=firstName+" "+lastName;tag.concept.name=fullName;const xmlTag=_writer.jxon.unbuild(tag,null,"conceptItem");this.xmlDoc=xmlTag;const firstNameNode=xmlTag.documentElement.querySelector('itemMetaExtProperty[type="imext:firstName"]');const lastNameNode=xmlTag.documentElement.querySelector('itemMetaExtProperty[type="imext:lastName"]');firstNameNode.setAttribute("value",firstName);lastNameNode.setAttribute("value",lastName);const shortDescNode=_TagEditBaseComponent2.default.getShortDescription(xmlTag),longDescNode=_TagEditBaseComponent2.default.getLongDescription(xmlTag);shortDescNode.textContent=shortDesc;longDescNode.textContent=longDesc;this.updateWebsite(this.refs.urlInput.val());this.updateTwitter(this.refs.twitterInput.val());this.updateFacebook(this.refs.facebookInput.val());if(uuid===null){this.createConcept(xmlTag.documentElement.outerHTML).then(uuid=>{this.xmlDoc.querySelector("conceptItem").setAttribute("guid",uuid);this.context.api.newsItem.addTag(this.name,{uuid:uuid,name:[fullName],type:["person"],imType:["x-im/person"]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}else{this.saveConcept(uuid,xmlTag.documentElement.outerHTML).then(()=>{this.context.api.newsItem.updateTag(this.name,uuid,{name:[fullName],imType:[tag.type["@value"]]});if(this.state.error){this.extendState({error:false})}this.closeAndReload()}).catch(()=>this.extendState({error:true}))}}render($$){const el=$$("div").addClass("tag-edit tag-edit-person").addClass("row"),firstName=this.renderElement($$,"firstNameInput","First name",this.getItemMetaExtProperty("imext:firstName")["@value"],false,"input"),lastName=this.renderElement($$,"lastNameInput","Last name",this.getItemMetaExtProperty("imext:lastName")["@value"],false,"input"),shortDesc=this.renderElement($$,"shortDescInput",this.getLabel("ximtags-Short_description"),this.getConceptDefinition("drol:short").keyValue,true,"input"),longDesc=this.renderElement($$,"longDescTextarea",this.getLabel("ximtags-Long_description"),this.getConceptDefinition("drol:long").keyValue,true,"textarea"),websiteUrl=this.getSeeAlsoLinkByType("text/html"),websiteUrlEl=this.renderElement($$,"urlInput",this.getLabel("ximtags-Website_url"),websiteUrl?websiteUrl["@url"]:"",true,"input"),twitterUrl=this.getSeeAlsoLinkByType("x-im/social+twitter"),twitterEl=this.renderElement($$,"twitterInput",this.getLabel("ximtags-Twitter_url"),twitterUrl?twitterUrl["@url"]:"",false,"input"),facebook=this.getSeeAlsoLinkByType("x-im/social+facebook"),facebookEl=this.renderElement($$,"facebookInput",this.getLabel("ximtags-Facebook_url"),facebook?facebook["@url"]:"",false,"input");firstName.on("change",()=>{if(this.refs["firstNameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}});el.append([firstName,lastName,shortDesc,longDesc,websiteUrlEl,twitterEl,facebookEl]);if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("ximtags-error-save"))))}return el}onClose(status){if(status==="cancel"){return}else if(status==="save"){this.save();return false}}}exports.default=TagEditPersonComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={personTemplate:'<conceptItem conformance="power" standard="NewsML-G2" standardversion="2.20" version="1">'+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/>'+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/>'+"<itemMeta>"+'<itemClass qcode="cinat:concept"/>'+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/>'+"<edNote/>"+'<itemMetaExtProperty type="imext:type" value="x-im/person"/>'+'<itemMetaExtProperty type="imext:firstName" value=""/>'+'<itemMetaExtProperty type="imext:lastName" value=""/>'+'<links xmlns="http://www.infomaker.se/newsml/1.0" />'+"</itemMeta>"+"<concept>"+'<conceptId uri="im://person/"/>'+'<type qcode="cpnat:person"/>'+"<name></name>"+'<definition role="drol:long"></definition>'+'<definition role="drol:short"></definition>'+"</concept>"+"</conceptItem>",organisationTemplate:'<conceptItem conformance="power" standard="NewsML-G2" standardversion="2.20" version="1">'+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/>'+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/>'+"<itemMeta>"+'<itemClass qcode="cinat:concept"/>'+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/>'+'<itemMetaExtProperty type="imext:type" value="x-im/organisation"/>'+'<links xmlns="http://www.infomaker.se/newsml/1.0" />'+"</itemMeta>"+"<concept>"+'<conceptId uri="im://organisation/"/>'+'<type qcode="cpnat:organisation"/>'+"<name></name>"+'<definition role="drol:long"></definition>'+'<definition role="drol:short"></definition>'+'<metadata xmlns="http://www.infomaker.se/newsml/1.0">'+'<object id="" type="x-im/contact-info">'+"<data>"+"<email></email>"+"<phone></phone>"+"<fax></fax>"+"<streetAddress></streetAddress>"+"<postalCode></postalCode>"+"<country></country>"+"</data>"+"</object>"+"</metadata>"+"</concept>"+"</conceptItem>"}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _DefaultValidation=__webpack_require__(215);var _DefaultValidation2=_interopRequireDefault(_DefaultValidation);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;const validationPackage={id:"se.infomaker.defaultvalidation",name:"defaultvalidation",configure:config=>{config.addValidator(_DefaultValidation2.default)}};exports.default=(()=>{if(registerPlugin){registerPlugin(validationPackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);class DefaultValidation extends _writer.Validator{constructor(...args){super(...args)}validate(){var pubStatus=_writer.api.newsItem.getPubStatus(),headlines=this.newsItem.querySelectorAll('idf>group element[type="headline"]'),messageMethod;switch(pubStatus.qcode){case"imext:draft":case"stat:canceled":messageMethod=this.addWarning.bind(this);break;default:messageMethod=this.addError.bind(this)}if(headlines.length===0){messageMethod("The article is missing a headline which might make it hard to find.")}else if(headlines[0].childNodes.length===0||headlines[0].firstChild.nodeName!=="#text"||headlines[0].firstChild.textContent.trim()===""){messageMethod("The first headline in the article should not be empty.")}}}exports.default=DefaultValidation},,,,,,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimstoryPackage=__webpack_require__(224);var _XimstoryPackage2=_interopRequireDefault(_XimstoryPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_XimstoryPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(225);var _StoryMainComponent=__webpack_require__(227);var _StoryMainComponent2=_interopRequireDefault(_StoryMainComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.ximstory",name:"ximstory",configure:function configure(config){config.addLabel("ximstory-could_not_load_uuid",{en:"This item could not be loaded. UUID: ",sv:"Detta objekt kunde inte laddas in. UUID: "});config.addLabel("ximstory-search_stories",{en:"Search stories",sv:"Sök stories"});config.addLabel("ximstory-Save",{en:"Save",sv:"Spara"});config.addLabel("ximstory-create",{en:"Create ",sv:"Skapa "});config.addLabel("ximstory-remove_from_article",{en:"Remove from article",sv:"Ta bort från artikel"});config.addLabel("ximstory-name_already_in_use",{en:"Please note that this name is already in use",sv:"Observera att namnet redan används"});config.addLabel("ximstory-error-save",{en:"Error when saving story",sv:"Fel vid sparande av story"});config.addLabel("ximstory-Name",{en:"Name",sv:"Namn"});config.addLabel("ximstory-short_description",{en:"Short description",sv:"Kort beskrivning"});config.addLabel("ximstory-long_description",{en:"Long description",sv:"Lång beskrivning"});config.addLabel("ximstory-story",{en:"Story",sv:"Story"});config.addComponentToSidebarWithTabId(this.id,"main",_StoryMainComponent2.default)}}},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _StoryListComponent=__webpack_require__(228);var _StoryListComponent2=_interopRequireDefault(_StoryListComponent);var _StoryEditComponent=__webpack_require__(230);var _StoryEditComponent2=_interopRequireDefault(_StoryEditComponent);var _concept=__webpack_require__(231);var _concept2=_interopRequireDefault(_concept);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class StoryMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximstory"}getInitialState(){return{existingItems:this.context.api.newsItem.getStories(this.name)}}reload(){this.extendState({existingItems:this.context.api.newsItem.getStories(this.name)})}render($$){const el=$$("div").ref("tagContainer").addClass("stories").append($$("h2").append(this.getLabel("ximstory-story")));const SearchComponent=this.context.componentRegistry.get("form-search");const searchComponent=$$(SearchComponent,{existingItems:this.state.existingItems,searchUrl:"/api/search/concepts/stories?q=",onSelect:this.addStory.bind(this),onCreate:this.createStory.bind(this),placeholderText:this.getLabel("ximstory-search_stories"),createAllowed:true}).ref("searchComponent");const list=$$(_StoryListComponent2.default,{items:this.state.existingItems,removeItem:this.removeItem.bind(this),reload:this.reload.bind(this)}).ref("tagList");el.append(list);el.append(searchComponent);return el}removeItem(tag){try{this.context.api.newsItem.removeLinkByUUIDAndRel(this.name,tag.uuid,"subject");this.reload()}catch(e){}}addStory(story){try{this.context.api.newsItem.addStory(this.name,{uuid:story.uuid,title:story.name[0]});this.reload()}catch(e){}}createStory(searchItem,exists){const parser=new DOMParser;const storyXML=parser.parseFromString(_concept2.default.story,"text/xml").firstChild;const item=_writer.jxon.build(storyXML);item.concept.name=searchItem.inputValue;this.context.api.ui.showDialog(_StoryEditComponent2.default,{item:item,exists:exists,newLocation:true,close:this.closeFromDialog.bind(this),reload:this.reload.bind(this)},{primary:this.getLabel("ximstory-Save"),title:this.getLabel("ximstory-create")+" "+searchItem.inputValue,global:true})}closeFromDialog(){this.reload()}}exports.default=StoryMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _StoryItemComponent=__webpack_require__(229);var _StoryItemComponent2=_interopRequireDefault(_StoryItemComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class StoryListComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximstory"}render($$){const items=this.props.items,tagList=$$("ul").addClass("tag-list"),tagEls=items.map(item=>{return $$(_StoryItemComponent2.default,{item:item,removeItem:this.removeItem.bind(this),reload:this.props.reload.bind(this)}).ref("tag-"+item.uuid)},this);tagList.append(tagEls);return tagList}removeItem(tag){delete this.refs["tag-"+tag.uuid];this.props.removeItem(tag)}}exports.default=StoryListComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _StoryEditComponent=__webpack_require__(230);var _StoryEditComponent2=_interopRequireDefault(_StoryEditComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class StoryItemComponent extends _substance.Component{constructor(...args){super(...args);this.name="ximstory"}loadTag(){this.context.api.router.getConceptItem(this.props.item.uuid,this.props.item.type).then(xml=>{const conceptXML=xml.querySelector("conceptItem"),conceptItemJSON=_writer.jxon.build(conceptXML);this.extendState({loadedItem:conceptItemJSON,isLoaded:true})}).catch(()=>{this.extendState({isLoaded:true,couldNotLoad:true})})}render($$){const item=this.props.item,tagItem=$$("li").addClass("tag-list__item").ref("tagItem").attr("title","Story"),displayNameEl=$$("span");let displayName;if(!this.state.isLoaded){this.loadTag()}else{if(this.state.couldNotLoad){displayNameEl.addClass("tag-item__title tag-item__title--no-avatar tag-item__title--notexisting").append(item.title).attr("title",this.getLabel("ximstory-could_not_load_uuid")+item.uuid);displayName=item.title}else{displayName=this.state.loadedItem.concept.name;displayNameEl.addClass("tag-item__title tag-item__title--no-avatar").append(displayName);displayNameEl.on("click",()=>{this.showStory(displayName)})}displayNameEl.attr("title",displayName);this.updateTagItemName(displayNameEl,this.state.loadedItem);displayNameEl.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");tagItem.append(displayNameEl);const deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("ximstory-remove_from_article"))).on("click",()=>{this.removeTag(item)});tagItem.append(deleteButton);tagItem.append($$(_substance.FontAwesomeIcon,{icon:"fa-circle"}).addClass("tag-icon"))}return tagItem}updateTagItemName(tagItem,loadedTag){if(loadedTag.concept&&loadedTag.concept.definition){const definition=_writer.lodash.isArray(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(let i=0;i<definition.length;i++){const item=definition[i];if(item["@role"]==="drol:short"){if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}}}showStory(title){this.context.api.ui.showDialog(_StoryEditComponent2.default,{item:this.state.loadedItem,reload:this.closeFromDialog.bind(this)},{title:title,global:true})}closeFromDialog(){this.loadTag();this.props.reload()}removeTag(tag){this.props.removeItem(tag)}}exports.default=StoryItemComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);class StoryEditComponent extends _substance.Component{constructor(...args){super(...args)}createLocation(){const story=this.props.item;this.saveLocation(null,"POST").then(data=>{this.context.api.newsItem.addStory(this.name,{title:story.concept.name,uuid:data});if(this.state.error){this.extendState({error:false})}this.props.reload();this.send("close")}).catch(()=>{this.extendState({error:true})})}updateLocation(){const story=this.props.item,uuid=story["@guid"]?story["@guid"]:null;if(!uuid){throw new Error("ConceptItem has no UUID to update")}this.saveLocation(uuid,"PUT").then(()=>{this.context.api.newsItem.updateStory(this.name,{title:story.concept.name,uuid:uuid});if(this.state.error){this.extendState({error:false})}this.props.reload();this.send("close")}).catch(()=>{this.extendState({error:true})})}setDescription(inputValue,role){const currentDescription=this.context.api.concept.getDefinitionForType(this.props.item.concept.definition,role);if(inputValue.length>0&&!currentDescription){const longDesc={"@role":role,keyValue:inputValue};this.props.item.concept.definition=this.context.api.concept.setDefinitionDependingOnArrayOrObject(this.props.item.concept.definition,longDesc)}else if(inputValue.length>=0&&currentDescription){currentDescription["keyValue"]=inputValue}}saveLocation(id,method){const location=this.props.item;location.concept.name=this.refs.storyNameInput.val().length>0?this.refs.storyNameInput.val():location.concept.name;const shortDescriptionInputValue=this.refs.storyShortDescInput.val();const longDescriptionInputValue=this.refs.storyLongDescText.val();if(!location.concept.definition){location.concept.definition=[]}this.setDescription(shortDescriptionInputValue,"drol:short");this.setDescription(longDescriptionInputValue,"drol:long");this.xmlDoc=_writer.jxon.unbuild(location,null,"conceptItem");const conceptItem=this.xmlDoc.documentElement.outerHTML;switch(method){case"PUT":return this.context.api.router.updateConceptItem(id,conceptItem);case"POST":return this.context.api.router.createConceptItem(conceptItem)}}render($$){const el=$$("div").addClass("tag-edit-base");const formContainer=$$("form").addClass("concept-story__container clearfix").ref("formContainer").on("submit",e=>{e.preventDefault();if(this.refs["storyNameInput"].val()!==""){this.onClose("save")}});const hiddenSubmitButtonToEnableEnterSubmit=$$("input").attr({type:"submit",style:"display:none"});formContainer.append(hiddenSubmitButtonToEnableEnterSubmit);formContainer.append(this.renderNameInput($$));formContainer.append(this.renderShortDescription($$));formContainer.append(this.renderLongDescription($$));el.append(formContainer);if(this.props.exists){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-info").append(this.addLabel("ximstory-name_already_in_use")+": "+this.props.item.concept.name)))}if(this.state.error){el.append($$("div").addClass("pad-top").append($$("div").addClass("alert alert-error").append(this.getLabel("ximstory-error-save"))))}return el}renderNameInput($$){const nameInput=$$("input").attr({type:"text",id:"storyNameInput"}).addClass("form-control").val(this.props.item.concept.name).ref("storyNameInput");nameInput.on("change",function(){if(this.refs["storyNameInput"].val()===""){this.send("dialog:disablePrimaryBtn")}else{this.send("dialog:enablePrimaryBtn")}}.bind(this));const formGroup=$$("fieldset").addClass("form-group col-xs-6").ref("formGroupName");formGroup.append($$("label").attr("for","storyNameInput").append(this.getLabel("ximstory-Name")));formGroup.append(nameInput);return formGroup}renderShortDescription($$){const shortDescription=this.context.api.concept.getDefinitionForType(this.props.item.concept.definition,"drol:short");let shortDescriptionValue="";if(shortDescription){shortDescriptionValue=shortDescription["keyValue"]}const shortDescInput=$$("input").attr({id:"storyShortDescInput"}).addClass("form-control").val(shortDescriptionValue).ref("storyShortDescInput");const formGroupShortDesc=$$("fieldset").addClass("form-group col-xs-6").ref("formGroupShortDesc");formGroupShortDesc.append($$("label").attr("for","storyShortDescInput").append(this.getLabel("ximstory-short_description")));formGroupShortDesc.append(shortDescInput);return formGroupShortDesc}renderLongDescription($$){const longDescription=this.context.api.concept.getDefinitionForType(this.props.item.concept.definition,"drol:long");let longDescriptionValue="";if(longDescription){longDescriptionValue=longDescription.keyValue}const longDescText=$$("textarea").attr({id:"storyLongDescText"}).addClass("form-control").val(longDescriptionValue).ref("storyLongDescText");const formGroupLongDesc=$$("fieldset").addClass("form-group col-xs-12").ref("formGroupLongDesc");formGroupLongDesc.append($$("label").attr("for","storyLongDescText").append(this.getLabel("ximstory-long_description")));formGroupLongDesc.append(longDescText);return formGroupLongDesc}onClose(status){if("cancel"===status){return true}if(this.props.newLocation){this.createLocation()}else{this.updateLocation()}return false}}exports.default=StoryEditComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={story:'<?xml version="1.0" encoding="UTF-8"?> '+'<conceptItem xmlns="http://iptc.org/std/nar/2006-10-01/" version="1" standard="NewsML-G2" standardversion="2.20" conformance="power"> '+'<catalogRef href="http://www.iptc.org/std/catalog/catalog.IPTC-G2-Standards_27.xml"/> '+'<catalogRef href="http://infomaker.se/spec/catalog/catalog.infomaker.g2.1_0.xml"/> '+"<itemMeta> "+'<itemClass qcode="cinat:concept"/> '+'<provider literal=""/>'+"<firstCreated />"+"<versionCreated/>"+'<pubStatus qcode="stat:usable"/> '+'<itemMetaExtProperty type="imext:type" value="x-im/story"/> '+"</itemMeta> "+"<concept> "+'<conceptId uri="im://story/"/> '+'<type qcode="cpnat:abstract"/>'+"<name></name>"+'<definition role="drol:long"></definition> '+'<definition role="drol:short"></definition> '+"</concept> "+"</conceptItem>"}},,,,,,,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _XimchannelPackage=__webpack_require__(241);var _XimchannelPackage2=_interopRequireDefault(_XimchannelPackage);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(_XimchannelPackage2.default)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ConceptChannelMainComponent=__webpack_require__(242);var _ConceptChannelMainComponent2=_interopRequireDefault(_ConceptChannelMainComponent);__webpack_require__(245);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={id:"se.infomaker.ximchannel",name:"concept-channel",configure:function configure(config){config.addComponentToSidebarWithTabId(this.id,"main",_ConceptChannelMainComponent2.default);config.addLabel("Main channel",{sv:"Huvudkanal"});config.addLabel("Remove from article",{sv:"Ta bort från artikel"});config.addLabel("Search channels",{sv:"Sök kanaler"})}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _ChannelItemComponent=__webpack_require__(243);var _ChannelItemComponent2=_interopRequireDefault(_ChannelItemComponent);var _writer=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ConceptMainComponent extends _substance.Component{constructor(...args){super(...args);this.name="concept-channel"}reload(){this.setState({existingChannel:_writer.api.newsItem.getLinkByTypeAndRel(this.name,"x-im/channel","channel")})}getInitialState(){return{existingChannel:_writer.api.newsItem.getLinkByTypeAndRel(this.name,"x-im/channel","channel")}}render($$){var el=$$("ul").ref("conceptChannelList").addClass("concept-channel tag-list").append($$("h2").append(this.getLabel("Main channel")));if(this.state.existingChannel[0]){el.append($$(_ChannelItemComponent2.default,{channel:this.state.existingChannel[0],removeChannel:this.removeChannel.bind(this)}).ref("channelItem"))}else{const SearchComponent=this.context.componentRegistry.get("form-search");el.append($$(SearchComponent,{existingItems:this.state.existingTags,searchUrl:"/api/search/concepts/channels?q=",onSelect:this.addChannel.bind(this),placeholderText:"Search channels"}).ref("searchComponent"))}return el}addChannel(item){_writer.api.newsItem.addLink(this.name,{"@rel":"channel","@title":item.name[0],"@type":item.imType[0],"@uuid":item.uuid});this.reload()}removeChannel(channel){_writer.api.newsItem.removeLinkByUUIDAndRel(this.name,channel["@uuid"],"channel");this.reload()}}exports.default=ConceptMainComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var _ConceptChannelInfoComponent=__webpack_require__(244);var _ConceptChannelInfoComponent2=_interopRequireDefault(_ConceptChannelInfoComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}class ChannelItemComponent extends _substance.Component{constructor(...args){
super(...args);this.name="concept-channel"}getInitialState(){return{isLoaded:false,loadedChannel:{}}}loadChannel(item){_writer.api.router.getConceptItem(item["@uuid"],item["@type"]).then(xml=>{const conceptXML=xml.querySelector("conceptItem"),conceptItemJSON=_writer.jxon.build(conceptXML);this.extendState({loadedChannel:conceptItemJSON,isLoaded:true})}).catch(()=>{this.extendState({isLoaded:true,couldNotLoad:true})})}render($$){var channel=this.props.channel;if(!channel){return $$("div")}var channelItem=$$("li").addClass("tag-list__item tag-item__title--no-avatar").addClass("clearfix").ref("channelItem"),displayTitle=$$("span").append(this.state.loadedItem?this.state.loadedItem.concept.name:channel["@title"]);displayTitle.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-trigger","manual");var deleteButton=$$("span").append($$(_substance.FontAwesomeIcon,{icon:"fa-times"}).addClass("tag-icon tag-icon--delete").attr("title",this.getLabel("Remove from article"))).on("click",()=>{this.props.removeChannel(channel)});if(!this.state.isLoaded){this.loadChannel(this.props.channel)}else{channelItem.append($$("span").addClass("concept-channel__name tag-item__title tag-item__title--no-avatar ").append(displayTitle).on("click",this.showInformation)).append(deleteButton).append($$(_substance.FontAwesomeIcon,{icon:"fa-random"}).addClass("tag-icon"))}if(this.state.loadedItem){this.updateTagItemName(displayTitle,this.state.loadedItem)}return channelItem}updateTagItemName(tagItem,loadedTag){if(!loadedTag.concept||!loadedTag.concept.definition){tagItem.attr("title",loadedTag.concept.name)}let definition=_writer.lodash.isArray(loadedTag.concept.definition)?loadedTag.concept.definition:[loadedTag.concept.definition];for(var i=0;i<definition.length;i++){let item=definition[i];if(item["@role"]!=="drol:short"){continue}if(item["keyValue"]&&item["keyValue"].length>0){tagItem.attr("title",item["keyValue"]);break}}}showInformation(){_writer.api.ui.showDialog(_ConceptChannelInfoComponent2.default,{channel:this.state.loadedChannel},{secondary:false,title:this.state.loadedChannel.concept.name,global:true})}}exports.default=ChannelItemComponent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);var _writer=__webpack_require__(16);var find=_writer.lodash.find;var isArray=_writer.lodash.isArray;class ConceptChannelInfoComponent extends _substance.Component{constructor(...args){super(...args)}getConceptDefinition(key){if(!this.props.channel.concept.definition){return null}var definition=this.props.channel.concept.definition;if(!isArray(definition)){definition=[definition]}return find(definition,function(item){return item["@role"]===key})}render($$){var el=$$("div").addClass("tag-edit-base");var shortDescription=this.getConceptDefinition("drol:short");if(shortDescription){el.append($$("p").append(shortDescription.keyValue))}var longDescription=this.getConceptDefinition("drol:long");if(longDescription){el.append($$("p").append(longDescription.keyValue))}return el}onClose(){}}exports.default=ConceptChannelInfoComponent},function(module,exports){},,,,,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(253);var _DropheadPackage=__webpack_require__(255);var _DropheadPackage2=_interopRequireDefault(_DropheadPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_DropheadPackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _DropheadComponent=__webpack_require__(256);var _DropheadComponent2=_interopRequireDefault(_DropheadComponent);var _DropheadConverter=__webpack_require__(257);var _DropheadConverter2=_interopRequireDefault(_DropheadConverter);var _DropheadNode=__webpack_require__(258);var _DropheadNode2=_interopRequireDefault(_DropheadNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"drophead",id:"se.infomaker.drophead",configure:function configure(config){_DropheadNode2.default.type=this.name;_DropheadConverter2.default.type=_DropheadNode2.default.type;_DropheadConverter2.default.element=_DropheadNode2.default.type;config.addNode(_DropheadNode2.default);config.addComponent(_DropheadNode2.default.type,_DropheadComponent2.default);config.addConverter("newsml",_DropheadConverter2.default);config.addTextType({name:this.name,data:{type:_DropheadNode2.default.type}});config.addLabel("drophead",{en:"Drophead",sv:"Nedryckare"});config.addLabel("drophead.content",{en:"Drophead",sv:"Nedryckare"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class DropheadComponent extends Component{render($$){return $$("div").addClass("sc-drophead").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=DropheadComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="drophead"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","drophead").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class DropheadNode extends TextBlock{}DropheadNode.define({id:{type:"string"}});exports.default=DropheadNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(260);var _PagedatelinePackage=__webpack_require__(262);var _PagedatelinePackage2=_interopRequireDefault(_PagedatelinePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PagedatelinePackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PagedatelineComponent=__webpack_require__(263);var _PagedatelineComponent2=_interopRequireDefault(_PagedatelineComponent);var _PagedatelineConverter=__webpack_require__(264);var _PagedatelineConverter2=_interopRequireDefault(_PagedatelineConverter);var _PagedatelineNode=__webpack_require__(265);var _PagedatelineNode2=_interopRequireDefault(_PagedatelineNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"pagedateline",id:"se.infomaker.pagedateline",configure:function configure(config){_PagedatelineNode2.default.type=this.name;_PagedatelineConverter2.default.type=_PagedatelineNode2.default.type;_PagedatelineConverter2.default.element=_PagedatelineNode2.default.type;config.addNode(_PagedatelineNode2.default);config.addComponent(_PagedatelineNode2.default.type,_PagedatelineComponent2.default);config.addConverter("newsml",_PagedatelineConverter2.default);config.addTextType({name:this.name,data:{type:_PagedatelineNode2.default.type}});config.addLabel("pagedateline",{en:"Pagedateline",sv:"Vinjett"});config.addLabel("pagedateline.content",{en:"Pagedateline",sv:"Vinjett"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class PagedatelineComponent extends Component{render($$){return $$("div").addClass("sc-pagedateline").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=PagedatelineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="pagedateline"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","pagedateline").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class PagedatelineNode extends TextBlock{}PagedatelineNode.define({id:{type:"string"}});exports.default=PagedatelineNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(267);var _DatelinePackage=__webpack_require__(269);var _DatelinePackage2=_interopRequireDefault(_DatelinePackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_DatelinePackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _DatelineComponent=__webpack_require__(270);var _DatelineComponent2=_interopRequireDefault(_DatelineComponent);var _DatelineConverter=__webpack_require__(271);var _DatelineConverter2=_interopRequireDefault(_DatelineConverter);var _DatelineNode=__webpack_require__(272);var _DatelineNode2=_interopRequireDefault(_DatelineNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"dateline",id:"se.infomaker.dateline",configure:function configure(config){_DatelineNode2.default.type=this.name;_DatelineConverter2.default.type=_DatelineNode2.default.type;_DatelineConverter2.default.element=_DatelineNode2.default.type;config.addNode(_DatelineNode2.default);config.addComponent(_DatelineNode2.default.type,_DatelineComponent2.default);config.addConverter("newsml",_DatelineConverter2.default);config.addTextType({name:this.name,data:{type:_DatelineNode2.default.type}});config.addLabel("dateline",{en:"Dateline",sv:"Ortdatering"});config.addLabel("dateline.content",{en:"Dateline",sv:"Ortdatering"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class DatelineComponent extends Component{render($$){return $$("div").addClass("sc-dateline").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=DatelineComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="dateline"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","dateline").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class DatelineNode extends TextBlock{}DatelineNode.define({id:{type:"string"}});exports.default=DatelineNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(274);var _PreleadinPackage=__webpack_require__(276);var _PreleadinPackage2=_interopRequireDefault(_PreleadinPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_PreleadinPackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _PreleadinComponent=__webpack_require__(277);var _PreleadinComponent2=_interopRequireDefault(_PreleadinComponent);var _PreleadinConverter=__webpack_require__(278);var _PreleadinConverter2=_interopRequireDefault(_PreleadinConverter);var _PreleadinNode=__webpack_require__(279);var _PreleadinNode2=_interopRequireDefault(_PreleadinNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"preleadin",id:"se.infomaker.preleadin",configure:function configure(config){_PreleadinNode2.default.type=this.name;_PreleadinConverter2.default.type=_PreleadinNode2.default.type;_PreleadinConverter2.default.element=_PreleadinNode2.default.type;config.addNode(_PreleadinNode2.default);config.addComponent(_PreleadinNode2.default.type,_PreleadinComponent2.default);config.addConverter("newsml",_PreleadinConverter2.default);config.addTextType({name:this.name,data:{type:_PreleadinNode2.default.type}});config.addLabel("preleadin",{en:"Preleadin",sv:"Överingress"});config.addLabel("preleadin.content",{en:"Preleadin",sv:"Överingress"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class PreleadinComponent extends Component{render($$){return $$("div").addClass("sc-preleadin").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=PreleadinComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="preleadin"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","preleadin").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class PreleadinNode extends TextBlock{}PreleadinNode.define({id:{type:"string"}});exports.default=PreleadinNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(281);var _MadmansrowPackage=__webpack_require__(283);var _MadmansrowPackage2=_interopRequireDefault(_MadmansrowPackage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const{registerPlugin}=writer;exports.default=(()=>{if(registerPlugin){registerPlugin(_MadmansrowPackage2.default)}else{console.error("Could not register plugin")}})},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _MadmansrowComponent=__webpack_require__(284);var _MadmansrowComponent2=_interopRequireDefault(_MadmansrowComponent);var _MadmansrowConverter=__webpack_require__(285);var _MadmansrowConverter2=_interopRequireDefault(_MadmansrowConverter);var _MadmansrowNode=__webpack_require__(286);var _MadmansrowNode2=_interopRequireDefault(_MadmansrowNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={name:"madmansrow",id:"se.infomaker.madmansrow",configure:function configure(config){_MadmansrowNode2.default.type=this.name;_MadmansrowConverter2.default.type=_MadmansrowNode2.default.type;_MadmansrowConverter2.default.element=_MadmansrowNode2.default.type;config.addNode(_MadmansrowNode2.default);config.addComponent(_MadmansrowNode2.default.type,_MadmansrowComponent2.default);config.addConverter("newsml",_MadmansrowConverter2.default);config.addTextType({name:this.name,data:{type:_MadmansrowNode2.default.type}});config.addLabel("madmansrow",{en:"Madmansrow",sv:"Dårrad"});config.addLabel("madmansrow.content",{en:"Madmansrow",sv:"Dårrad"})}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{Component,TextPropertyComponent}=substance;class MadmansrowComponent extends Component{render($$){return $$("div").addClass("sc-madmansrow").attr("data-id",this.props.node.id).append($$(TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=MadmansrowComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={tagName:"element",matchElement:function matchElement(el){return el.is('element[type="madmansrow"]')},import:function _import(el,node,converter){node.content=converter.annotatedText(el,[node.id,"content"])},export:function _export(node,el,converter){return el.attr("type","madmansrow").append(converter.annotatedText([node.id,"content"]))}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{TextBlock}=substance;class MadmansrowNode extends TextBlock{}MadmansrowNode.define({id:{type:"string"}});exports.default=MadmansrowNode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _writer=__webpack_require__(16);var _Blockquote=__webpack_require__(288);var _Blockquote2=_interopRequireDefault(_Blockquote);var _BlockquoteComponent=__webpack_require__(291);var _BlockquoteComponent2=_interopRequireDefault(_BlockquoteComponent);var _BlockquoteConverter=__webpack_require__(292);var _BlockquoteConverter2=_interopRequireDefault(_BlockquoteConverter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const blockquotePackage={id:"se.infomaker.blockquote",name:"blockquote",configure:function configure(config){config.addNode(_Blockquote2.default);config.addComponent(_Blockquote2.default.type,_BlockquoteComponent2.default);config.addConverter("newsml",_BlockquoteConverter2.default);config.addTextType({name:"blockquote",data:{type:"blockquote"}});config.addLabel("blockquote",{en:"Blockquote",de:"Blockequote",sv:"Citat"});config.addLabel("blockquote.content",{en:"Blockequote",de:"Blockequote",sv:"Citat"})}};exports.default=(()=>{if(_writer.registerPlugin){(0,_writer.registerPlugin)(blockquotePackage)}else{console.info("Register method not yet available")}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});__webpack_require__(289);var _substance=__webpack_require__(14);class Blockquote extends _substance.TextBlock{}Blockquote.type="blockquote";exports.default=Blockquote},function(module,exports){},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _substance=__webpack_require__(14);class BlockquoteComponent extends _substance.Component{render($$){return $$("div").addClass("sc-paragraph sc-blockquote").attr("data-id",this.props.node.id).append($$(_substance.TextPropertyComponent,{path:[this.props.node.id,"content"]}))}}exports.default=BlockquoteComponent},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={type:"blockquote",tagName:"element",matchElement:function matchElement(el){return el.is('element[type="blockquote"]')},import:function _import(el,node,converter){var state=converter.state;var oldValue=state.trimWhitespaces;state.trimWhitespaces=true;node.content=converter.annotatedText(el,[node.id,"content"]);state.trimWhitespaces=oldValue},export:function _export(node,el,converter){el.attr("type","blockquote").append(converter.annotatedText([node.id,"content"]))}}}]);const path=require("path");const webpack=require("webpack");const ExtractTextPlugin=require("extract-text-webpack-plugin");const CopyWebpackPlugin=require("copy-webpack-plugin");const autoprefixer=require("autoprefixer");console.log("\n ----------------------------");console.log(" Plugin development build ");console.log(" ----------------------------\n");module.exports={entry:"./plugins/plugin-build-spec/im-writer.js",output:{filename:"index.js",path:"dist"},externals:{substance:"substance",writer:"writer"},devtool:"source-map",devServer:{historyApiFallback:true,inline:true,compress:false,port:5001},module:{loaders:[{test:/\.(png|woff|woff2|eot|ttf|svg)$/,loader:"url-loader?limit=100000"},{test:/\.scss$/,loader:ExtractTextPlugin.extract("style","css!sass")},{test:/\.js?$/,exclude:/(node_modules)/,loaders:["babel?presets[]=stage-0,presets[]=es2015-node6"]}],preLoaders:[{test:/\.js?$/,loader:"eslint",exclude:/node_modules/}]},cssLoader:{modules:false,importLoaders:1,sourceMap:true},eslint:{failOnWarning:false,failOnError:true},plugins:[new ExtractTextPlugin("style.css"),new webpack.DefinePlugin({"process.env":{NODE_ENV:JSON.stringify("development")}})]};const path=require("path");const webpack=require("webpack");const ExtractTextPlugin=require("extract-text-webpack-plugin");const CopyWebpackPlugin=require("copy-webpack-plugin");const autoprefixer=require("autoprefixer");const fs=require("fs");console.log("\n ----------------------------");console.log(" Plugin production build ");console.log(" ----------------------------\n");function getPluginBuildSpec(dir){const result={};const list=fs.readdirSync(dir);list.forEach(function(file){const basename=file.substr(0,file.length-3);result[basename]=dir+"/"+basename});return result}module.exports={entry:getPluginBuildSpec("./plugins/plugin-build-spec"),output:{path:path.join(__dirname,"dist"),filename:"[name].js"},postcss:[autoprefixer({browsers:["last 2 versions"]})],externals:{substance:"substance",writer:"writer"},module:{loaders:[{test:/\.(png|woff|woff2|eot|ttf|svg)$/,loader:"url-loader?limit=100000"},{test:/\.scss$/,loader:ExtractTextPlugin.extract("style","css!sass")},{test:/\.js?$/,exclude:/(node_modules)/,loaders:["babel?presets[]=stage-0,presets[]=es2015-node6"]}],preLoaders:[{test:/\.js?$/,loader:"eslint",exclude:/node_modules/}]},cssLoader:{modules:false,importLoaders:1,sourceMap:false},eslint:{failOnWarning:false,failOnError:true},plugins:[function(){this.plugin("done",function(stats){if(stats.compilation.errors&&stats.compilation.errors.length&&process.argv.indexOf("--watch")==-1){console.log(stats.compilation.errors);process.exit(1)}})},new ExtractTextPlugin("[name].css"),new webpack.DefinePlugin({"process.env":{NODE_ENV:JSON.stringify("production")}})]};